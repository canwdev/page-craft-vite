import{cj as e,q as l,ap as t,K as s,a6 as a,d as o,t as n,r as i,I as u,as as c,at as r,al as p,au as d,ae as m,c as v,o as y,b as f,e as g,n as b,F as h,D as w,U as C,x as _,p as x,g as S,P as j,M as k,Q as A,f as R,h as $,w as E,T as L,k as I,aA as V,W as B,X as T,O as U,ck as M}from"./index-Dcsrw7an.js";import{k as O,l as P}from"./index.vue_vue_type_style_index_0_lang-CixmpL7D.js";import{_ as N}from"./index.vue_vue_type_style_index_0_lang-Df9XRKpL.js";import{T as F}from"./TabLayout-C1UfuSWM.js";import{V as K,m as q}from"./index-CQE1pfcY.js";import{u as G}from"./use-remote-options-CrKSz0Lf.js";import{m as D}from"./CraftPage-xnLEqfFt.js";/* empty css                  *//* empty css                        *//* empty css                  *//* empty css                   *//* empty css                    */import"./index-BSUZN_B5.js";import"./enum-CdO7LyZZ.js";import"./use-beforeunload-HobKYt9I.js";import"./humanfs-api-Dvdi9RO8.js";import"./index-vcidOvW8.js";import"./use-model-wrapper-D-qKYU8I.js";import"./index.vue_vue_type_style_index_0_lang-BKM7gDo_.js";import"./set-BUS1Iazm.js";import"./QuickContextMenu.vue_vue_type_script_setup_true_lang-D5SzNeNJ.js";/* empty css                      */import"./use-local-dir-DpVBd9yr.js";import"./file-history-OL31BKSf.js";import"./useIDBKeyval-DAptoUO-.js";/* empty css                   */var J=(e=>(e.GLOBAL="global",e.VARIABLES="variables",e.CURRENT="current",e))(J||{});const z=o({__name:"ElementByPoint",props:{parentClass:{default:void 0}},emits:["select"],setup(e,{emit:l}){const t=e,{parentClass:s}=n(t),a=l,o=i(null);u((()=>{s.value&&(o.value=document.querySelector(s.value))}));const{x:w,y:C}=c({type:"client"}),{element:_}=r({x:w,y:C}),x=p(d(_));m("scroll",x.update,!0);const S=v((()=>!(o.value&&!o.value.contains(_.value)||o.value===_.value))),j=v((()=>_.value&&S.value?{display:"block",width:`${x.width}px`,height:`${x.height}px`,left:`${x.left}px`,top:`${x.top}px`,transition:"all 0.05s linear"}:{display:"none"})),k=v((()=>({transform:`translate(calc(${w.value}px - 50%), calc(${C.value}px - 50%))`,color:S.value?"white":"grey"})));return m("click",(e=>{S.value&&(e.stopPropagation(),e.preventDefault(),a("select",_.value))}),{capture:!0}),(e,l)=>(y(),f(h,null,[g("div",{style:b(j.value),class:"mc-element-by-point-box"},null,4),g("div",{style:b(k.value),class:"mc-element-by-point-pointer"},null,4)],64))}}),Q=g("span",{class:"mdi mdi-format-paint"},null,-1),Y=["title"],W=[g("span",{class:"mdi mdi-button-cursor"},null,-1)],X=["title"],H=[g("span",{class:"mdi mdi-menu"},null,-1)],Z=["title"],ee=[g("span",{class:"mdi mdi-code-braces"},null,-1)],le=["title"],te=[g("span",{class:"mdi mdi-content-copy"},null,-1)],se={class:"style-editor-inner"},ae={key:0,class:"style-editor-action-bar"},oe={class:"code-editor-placeholder"},ne=o({__name:"index",props:{visible:{type:Boolean,default:!1},selecting:{type:Boolean,default:!1},selectingParentClass:{default:void 0},showTabs:{type:Boolean,default:!1},styleCode:{default:""}},emits:["update:visible","update:selecting","onFormat","onInsertCode","update:styleCode"],setup(o,{expose:c,emit:r}){const p=o,{showTabs:d}=n(p),b=r,{t:ne}=w(),ie=C(p,"visible",b),ue=e(),{globalStyleCode:ce}=(()=>{const o=e(),n=l(t.GLOBAL_STYLE,"");s(n,(e=>{i()}));const i=async()=>{try{o.globalCSS=n.value?await a(n.value):""}catch(e){window.$message.error(e.message)}};return{globalStyleCode:n}})(),re=l(t.VARIABLES_STYLE,""),pe=C(p,"styleCode",b,{passive:!0});s(pe,(()=>{he()}));const de=i(),me=i(!1),ve=()=>{const e=de.value.getInstance();null==e||e.layout()},ye=()=>{me.value||setTimeout((()=>{de.value.getInstance().focus()}),100)};s(ie,(e=>{e&&(ve(),ye())})),s(me,(e=>{e||ye()}));const fe=i(),ge=()=>{console.warn(fe.value.message,{...fe.value}),setTimeout((()=>{fe.value=null}),500)},be=i(""),he=async(e=!1)=>{try{const l=re.value+"\n"+pe.value;if(be.value===l&&!e)return;be.value=l;const t=l?await a(l):"";ue.currentCSS=t,fe.value=""}catch(l){fe.value=l}};s(re,(()=>{he()}),{immediate:!0}),O("PlaygroundPageStyleSync",(()=>{he(!0)}));const we=async()=>{var e;const l=de.value.getInstance(),t=l.getValue();if(t.trim()){const s=P(t);if(t.trim()!==s.trim()){const t=null==(e=l.getModel())?void 0:e.getFullModelRange();t?l.executeEdits(null,[{text:s,range:t}]):pe.value=s}}l.focus(),b("onFormat")},Ce=()=>{const e=de.value.getInstance().getValue();window.$qlUtils.copy(e)},_e=C(p,"selecting",b,{passive:!0}),xe=e=>{_e.value&&(Se({el:e}),_e.value=!1)},Se=({el:e,code:l="",isAppend:t=!1})=>{U((()=>{if(e){let t=M(e);if(!t)return;l=`\n${t} {\n\n}\n`}l&&je(l,t)}))},je=(e,l=!1)=>{if(b("onInsertCode"),l)return void(pe.value=pe.value+"\n"+e);const t=de.value.getInstance(),s=t.getSelection();t.executeEdits("",[{range:new q.Range((null==s?void 0:s.startLineNumber)||0,(null==s?void 0:s.startColumn)||0,(null==s?void 0:s.endLineNumber)||0,(null==s?void 0:s.endColumn)||0),text:e,forceMoveMarkers:!0}]),setTimeout((()=>{t.focus()}),100)},{snippetsOptions:ke,updateEditorAutoComplete:Ae}=(({insertCode:e,vueMonacoRef:s})=>{const a=l(t.CUSTOM_SNIPPETS,[]),o=()=>{D.$monacoScssSnippetsCustom=[],i(a.value)};u((()=>{o()}));const n=(l,t)=>{const s={label:l.label,props:{}};if(l.code||l.snippet){t&&t(l);const a=l.snippet||l.code;s.props.onClick=async()=>{e(a)},s.props.onContextmenu=async()=>{window.$qlUtils.copy(a)}}return s},i=(e=[],l=[])=>(e.forEach((e=>{l.push({children:e.children?c(e.children):void 0,...n(e,(e=>{e.snippet&&D.$monacoScssSnippetsCustom.push({label:e.label,snippet:e.snippet})}))})})),l),c=(e=[],l=[])=>(e.forEach((e=>{l.push({children:e.children?c(e.children):void 0,...n(e)})})),l),{options:r}=G({fetchFn:async()=>{const e=await fetch("./scss-snippets.json");return await e.json()},mapFn:e=>n(e,(e=>{e.snippet&&D.$monacoScssSnippets.push({label:e.label,snippet:e.snippet})}))});return{snippetsOptions:v((()=>{const e=[...r.value,{label:"⚙️ Manage",children:[{label:"➕ Add custom snippet",props:{onClick:async()=>{const e=s.value.getInstance(),l=e.getSelection(),t=e.getModel().getValueInRange(l).trim();if(!t)return void window.$message.error("Please select code first!");const n=/\.(\w|-)+/g.exec(t)||[];console.log(n);const i=await window.$mcUtils.showInputPrompt({title:"Input snippet label",value:n[0]||""});i?(a.value.push({label:i,snippet:t}),o()):window.$message.error("Please input label!")}}},{label:"📥 Import JSON...",props:{onClick:async()=>{const e=await window.$mcUtils.handleImportJson();a.value=e||[],window.$message.success("Import success!")}}},{label:"📤 Export JSON...",props:{onClick:async()=>{window.$mcUtils.handleExportFile(await window.$mcUtils.promptGetFileName("ScssSnippets"),JSON.stringify(a.value,null,2),".json")}}},{label:"❌ Clear All...",children:[{label:"✅ Confirm Clear All Custom Snippets",props:{onClick:()=>{a.value=[],o()}}},{label:"❎ Cancel",props:{isBack:1}}]}]}];return a.value.length&&e.push({label:"🔮 Custom",children:[...c(a.value)]}),e})),updateEditorAutoComplete:e=>{const l=new Set,t=/\.(\w|-)+/g,s=/\$[\w-]+/g;let a;for(;null!==(a=t.exec(e));)l.add(a[0]);for(;null!==(a=s.exec(e));)l.add(a[0]);D.$monacoScssVariables=Array.from(l)}}})({insertCode:je,vueMonacoRef:de}),Re=i([{label:ne("common.global_style"),value:J.GLOBAL},{label:ne("common.variables"),value:J.VARIABLES},{label:ne("actions.current"),value:J.CURRENT}]),$e=l(t.CURRENT_TAB,J.CURRENT,localStorage,{listenToStorageChanges:!1});s(d,(e=>{e||($e.value=J.GLOBAL)}),{immediate:!0}),s((()=>$e),(e=>{Ae(ce.value+re.value)}),{immediate:!0});const Ee=e=>{const l=e.key.toLowerCase();e.ctrlKey&&e.shiftKey&&"f"===l&&we()};return m(document,"keydown",(e=>{if(!ie.value)return;const l=e.key.toLowerCase();e.ctrlKey&&e.shiftKey&&"x"===l?_e.value=!_e.value:e.altKey&&"`"===l&&(me.value=!me.value)})),c({handleAddStyle:Se}),(e,l)=>(y(),f(h,null,[_(_e)?(y(),x(z,{key:0,onSelect:xe,"parent-class":_($e)===_(J).CURRENT?e.selectingParentClass:void 0},null,8,["parent-class"])):S("",!0),j(N,{class:"mc-style-editor-dialog",visible:_(ie),"onUpdate:visible":l[7]||(l[7]=e=>T(ie)?ie.value=e:null),onResize:ve,wid:"style_editor",onKeyup:Ee,onOnActive:ye,"allow-maximum":"","init-win-options":{width:"400px",height:"500px"}},{titleBarLeft:k((()=>[Q,A(" "+R(_(ne)("common.style_editor"))+" (scss) ",1)])),titleBarRightControls:k((()=>[g("button",{title:_(ne)("msgs.select_an_element_in")+" (ctrl+shift+x)",class:$({active:_(_e)}),onClick:l[0]||(l[0]=E((e=>_e.value=!_(_e)),["stop","prevent"]))},W,10,Y),g("button",{onClick:l[1]||(l[1]=e=>me.value=!_(me)),class:$({active:_(me)}),title:_(ne)("actions.add_tool_codes")},H,10,X),g("button",{title:_(ne)("actions.beautify_code")+" (ctrl+shift+f)",onClick:we},ee,8,Z),g("button",{title:_(ne)("actions.copy_code")+" (ctrl+a ctrl+c)",onClick:Ce},te,8,le)])),default:k((()=>[j(L,{name:"mc-fade"},{default:k((()=>{var e;return[I(g("div",{class:"code-mc-error-tip-button font-code",onClick:ge},R(null==(e=_(fe))?void 0:e.message),513),[[V,_(fe)]])]})),_:1}),g("div",se,[j(L,{name:"fade-down"},{default:k((()=>[j(B,{visible:_(me),"onUpdate:visible":l[2]||(l[2]=e=>T(me)?me.value=e:null),options:_(ke),title:`${_(ne)("actions.add_tool_codes")} (alt+\`)`,class:"font-code vp-panel style-qo","is-static":""},null,8,["visible","options","title"])])),_:1}),_(d)?(y(),f("div",ae,[j(F,{modelValue:_($e),"onUpdate:modelValue":l[3]||(l[3]=e=>T($e)?$e.value=e:null),options:_(Re),horizontal:""},null,8,["modelValue","options"])])):S("",!0),g("div",oe,[_($e)===_(J).GLOBAL?(y(),x(K,{key:0,ref_key:"vueMonacoRef",ref:de,modelValue:_(ce),"onUpdate:modelValue":l[4]||(l[4]=e=>T(ce)?ce.value=e:null),language:"scss","debounce-ms":500,"show-line-numbers":""},null,8,["modelValue"])):_($e)===_(J).VARIABLES?(y(),x(K,{key:1,ref_key:"vueMonacoRef",ref:de,modelValue:_(re),"onUpdate:modelValue":l[5]||(l[5]=e=>T(re)?re.value=e:null),language:"scss","debounce-ms":500,"show-line-numbers":""},null,8,["modelValue"])):(y(),x(K,{key:2,ref_key:"vueMonacoRef",ref:de,modelValue:_(pe),"onUpdate:modelValue":l[6]||(l[6]=e=>T(pe)?pe.value=e:null),language:"scss","debounce-ms":500,"show-line-numbers":""},null,8,["modelValue"]))])])])),_:1},8,["visible"])],64))}});export{ne as default};
