import{I as e,T as a}from"./I18nToolSettings-DSPzIQfF.js";import{d as s,a as o,c as l,e as t,a2 as i,g as n,h as r,i as c,a3 as u,a4 as m,a5 as d,s as p,k as v,a6 as w,m as g,a7 as h,a8 as f,_ as y,r as S,b,x as k,y as _,F as x,I as T,B as D,A as C,D as O,E as N,z as I,P as F}from"./index-Bd5ECny6.js";import{D as H,u as z}from"./use-file-drop-BhWl0Nn5.js";import{C as R}from"./CommonNavbar-ui9zd-OT.js";import"./use-common-settings-C_E-ucpE.js";const A={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 20 20"},V=[t("g",{fill:"none"},[t("path",{d:"M3 5a2 2 0 0 1 2-2h8.379a2 2 0 0 1 1.414.586l1.621 1.621A2 2 0 0 1 17 6.621V15a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5zm2-1a1 1 0 0 0-1 1v10a1 1 0 0 0 1 1v-4.5A1.5 1.5 0 0 1 6.5 10h7a1.5 1.5 0 0 1 1.5 1.5V16a1 1 0 0 0 1-1V6.621a1 1 0 0 0-.293-.707l-1.621-1.621A1 1 0 0 0 13.379 4H13v2.5A1.5 1.5 0 0 1 11.5 8h-4A1.5 1.5 0 0 1 6 6.5V4H5zm2 0v2.5a.5.5 0 0 0 .5.5h4a.5.5 0 0 0 .5-.5V4H7zm7 12v-4.5a.5.5 0 0 0-.5-.5h-7a.5.5 0 0 0-.5.5V16h8z",fill:"currentColor"})],-1)],$=s({name:"Save20Regular",render:function(e,a){return o(),l("svg",A,V)}}),j={types:[{description:"JSON",accept:{"application/JSON":[".json"]}}]},B=s({name:"VueI18nEditTool",components:{CommonNavbar:R,QuickOptions:i,I18nToolSettings:e,TranslateTreeItem:a,DropZone:H,Save20Regular:$},setup(){const{t:e}=n(),a=r(),s=c(u.parseWithRoot()),o=c(!1),{appendHistory:l,historyMenuOptions:t}=m(d.I18N_FILE_HANDLE_HISTORY,(async e=>{i.value=e;const a=await e.getFile();await y(a)})),i=p(),y=async e=>{try{o.value=!0;const a=await h(e),l=JSON.parse(a);s.value=u.parseWithRoot(l)}catch(a){console.error(a),window.$message.error(a.message)}finally{o.value=!1}},S=async()=>{const[e]=await window.showOpenFilePicker(j);await l(e),i.value=e;const a=await e.getFile();await y(a)},b=()=>{i.value=void 0,s.value=u.parseWithRoot()},k=async()=>{try{if(o.value=!0,!i.value)return;const a=await i.value.createWritable(),l=JSON.stringify(f(s.value),null,2);await a.write(l),await a.close(),window.$message.success(e("msgs.saved"))}catch(a){console.error(a),window.$message.error(a.message)}finally{o.value=!1}},_=async()=>{var a;try{o.value=!0,console.log(s.value);const l=JSON.stringify(f(s.value),null,2),t=await window.showSaveFilePicker({suggestedName:null==(a=i.value)?void 0:a.name,...j}),n=await t.createWritable();await n.write(l),await n.close(),window.$message.success(e("msgs.saved"))}catch(l){console.error(l),window.$message.error(l.message)}finally{o.value=!1}};v((()=>{i.value?k():_()})),w((()=>!!i.value));const x=c(!1),T=()=>{s.value=u.parseWithRoot({hello_world:{section_a:{test_str:"This is a test string",test_arr:["line 1","line 2","line 3"],test_number:114514,"":"中English混合"},section_b:{"":"Blur this input and it'll generate the key automatically!"},section_c:{"":"平行、行列"}}})},D=g((()=>[{label:e("common.settings"),props:{onClick:()=>{x.value=!0}}},{label:e("common.toolbox"),props:{onClick:()=>{a.isShowQuickLaunch=!a.isShowQuickLaunch}}},i.value?{label:"💻 "+e("actions.close")+" JSON",children:[{label:e(e("msgs.confirm_close")),props:{onClick:b,isBack:!0}}]}:{label:"💻  "+e("actions.open")+" JSON",props:{onClick:()=>{S()}},dropdown:t.value},i.value?{label:"💾 "+e("actions.save"),props:{onClick:()=>{k()}}}:null,{label:e("actions.save_as")+"...",props:{onClick:()=>{_()}}},{label:e("common.demo"),children:[{label:e("msgs.load_demo_this_will"),props:{onClick:T,isBack:!0}}]}].filter(Boolean)));return{translateTreeRoot:s,fileHandle:i,handleImport:y,handleSelectFile:S,handleCloseFile:b,handleSaveFile:k,handleExport:_,loadDemo:T,...z({cb:async e=>{try{o.value=!0;for(const a of e.dataTransfer.items)if("file"===a.kind){const e=await a.getAsFileSystemHandle();if("directory"!==e.kind){await l(e),i.value=e;const a=await e.getFile();await y(a)}else window.$message.error("Please drag and drop a json file here!")}}catch(a){console.error(a),window.$message.error(a.message)}finally{o.value=!1}}}),mainStore:a,isShowToolSettings:x,isLoading:o,menuOptions:D}}}),J={key:0,class:"mc-loading-container position-fixed"},E={class:"scroll-content _scrollbar_mini"},L={class:"i18n-container"},W=t("div",{class:"height-placeholder"},null,-1);const P=y(B,[["render",function(e,a,s,i,n,r){const c=F,u=S("DropZone"),m=S("QuickOptions"),d=S("CommonNavbar"),p=S("TranslateTreeItem"),v=S("I18nToolSettings");return o(),l("div",{class:"vue-i18n-edit-tool i18n-style",onDragover:a[1]||(a[1]=D(((...a)=>e.fileDragover&&e.fileDragover(...a)),["prevent","stop"])),onDragleave:a[2]||(a[2]=D((a=>e.showDropzone=!1),["prevent","stop"])),onDrop:a[3]||(a[3]=D(((...a)=>e.fileDrop&&e.fileDrop(...a)),["prevent","stop"]))},[b(_,{name:"mc-fade"},{default:k((()=>[e.isLoading?(o(),l("div",J,[b(c)])):C("",!0)])),_:1}),b(_,{name:"mc-fade"},{default:k((()=>[O(b(u,{"position-fixed":"",text:e.$t("msgs.drag_file_here")},null,8,["text"]),[[N,e.showDropzone]])])),_:1}),b(d,null,{extra:k((()=>[b(m,{"is-static":"",options:e.menuOptions,horizontal:"","auto-focus":!1,"item-cls":"vp-button"},null,8,["options"])])),_:1}),t("div",E,[t("div",L,[(o(!0),l(x,null,T(e.translateTreeRoot,((a,s)=>{var l;return o(),I(p,{key:s,item:a,index:s,title:null==(l=e.fileHandle)?void 0:l.name},null,8,["item","index","title"])})),128)),W])]),b(v,{visible:e.isShowToolSettings,"onUpdate:visible":a[0]||(a[0]=a=>e.isShowToolSettings=a)},null,8,["visible"])],32)}]]);export{P as default};
