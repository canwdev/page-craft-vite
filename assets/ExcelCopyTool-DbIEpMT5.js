import{F as e}from"./FileChooser-X9fYpU-s.js";import{a as o}from"./index-BWzdhM7Z.js";import{D as s,u as t}from"./use-file-drop-DYBUVASZ.js";import{d as a,M as n,u as l,r as i,A as r,y as c,s as d,E as m,at as u,x as p,e as w,au as f,ah as h,P as _,av as y,_ as v,i as g,o as C,c as S,k as b,l as x,T as k,a as X,p as j,g as L,w as D,aw as T,W as N,ax as E,a1 as R,f as O,F as $,m as F,a9 as M,aq as z}from"./index-B_8g2bxo.js";import{a as A}from"./use-beforeunload-CnEAWhnx.js";import{C as I}from"./CommonNavbar-DInEh-4t.js";import{_ as J,a as P}from"./Tabs-Ad1pwSWj.js";import{_ as B}from"./Checkbox-BMCJIerk.js";import{_ as H}from"./Select-B9LExM5-.js";import{_ as K}from"./Dropdown-CsBF2fzf.js";import{_ as W}from"./Spin-DKTdphx2.js";import"./utils-vFQznSBh.js";import"./Tag-DZeuv2Mx.js";import"./Add-BNHsnCDy.js";import"./Popover-BKGBJvpF.js";import"./Icon-CMxllykI.js";const U=e=>new Promise(((o,s)=>{if(document.getElementById(e))o();else{const t=document.createElement("script");t.src=e,t.id=e,t.onload=function(){this.onerror=this.onload=null,o()},t.onerror=function(e){this.onerror=this.onload=null,s(e)},document.body.appendChild(t)}}));window.demo_aoa_to_sheet=[["Name","Value","Num","Time","âœ¨Tips"],["test001","line1\nline2",123,new Date,"You can set window.json_to_sheet = [] to generate table!"],["test001","line1\n\nline3",-1,new Date,"window.json_to_sheet"]],window.demo_json_to_sheet=[{region:"DE",product_name:"Test1",code:"123456",url:"http://localhost:8080",tips:"âœ¨ You can set window.demo_json_to_sheet = [] to generate table!"},{region:"FR",product_name:"Test2",code:"7890",url:"https://example.com",tips:"window.demo_json_to_sheet"}];const Y=a({name:"ExcelCopyTool",components:{CommonNavbar:I,FileChooser:e,DropZone:s},setup(){const{t:e}=n(),s=l(),a=i(),v=i(),g=i(!1),C=r(null),S=r(),b=i([]),x=i(0);c(x,(()=>{j()}));const k=()=>{if(!g.value){const e="XLSX Not Ready!";throw window.$message.error(e),new Error(e)}},X=e=>(b.value=e.SheetNames,e.Sheets[b.value[x.value]]),j=()=>{const e=S.value;if(!e)return void(v.value.innerHTML="");console.log("[renderWorkbook]",e);const o=window.XLSX.utils.sheet_to_html(X(e));v.value.innerHTML=o},L=async e=>{if(C.value=null,k(),!/\.xlsx$/g.test(e.name))return void window.$message.error("Only supports reading xlsx format!");const o=new FileReader;S.value=null,o.onload=function(o){C.value=e;const s=o.target.result;x.value=0,S.value=window.XLSX.read(s,{type:"binary"}),j()},o.readAsBinaryString(e)},D=i(!0);d((async()=>{await(async()=>{if(window.XLSX)g.value=!0;else{try{await U("./lib/xlsx.mini.js")}catch(e){window.$message.error(e.message),console.error(e)}window.$message.success("XLSX Ready!"),console.log("XLSX ready",window.XLSX),g.value=!0}})()}));const T=m("excel_copy_tool_copy_mode",u.HTML,localStorage,{listenToStorageChanges:!1}),N=({currentOnly:e=!1}={})=>{const o=e=>{const o=T.value;return o===u.DISABLED||o===u.TEXT?e:e.map((e=>{for(const s in e)"string"==typeof e[s]&&(e[s]=f(e[s],o));return e}))};if(!S.value){const e="Please open Excel file first!";throw window.$message.error(e),new Error(e)}if(e){const e=window.XLSX.utils.sheet_to_json(X(S.value));return o(e)}const s=S.value,t={};return s.SheetNames.forEach((function(e){const a=window.XLSX.utils.sheet_to_row_object_array(s.Sheets[e]);a.length>0&&(t[e]=o(a))})),t},E=async(e={})=>{var o;const s=N(e);let t=null==(o=C.value)?void 0:o.name;t&&(t=t.substring(0,t.lastIndexOf("."))),h(await _(t,"excel_sheet_export"),JSON.stringify(s,null,2),".json")};A((async()=>{await E()}));const R=[{label:"ðŸ§© Current Sheet",children:[{label:"ðŸ“¤ Export JSON",props:{onClick:async()=>{await E({currentOnly:!0})}}},{label:"ðŸ“‹ Copy JSON",props:{onClick:async()=>{const e=N({currentOnly:!0});await o(JSON.stringify(e,null,2)),window.$message.success("Sheet JSON Copied!")}}},{label:"ðŸ’» Print to Console",props:{onClick:async()=>{const e=N({currentOnly:!0});console.log(e),window.$message.success("Print to Console!")}}}]},{label:"ðŸ“— All Sheets",children:[{label:"ðŸ“¤ Export All JSON",props:{onClick:async()=>{await E()}}},{label:"ðŸ“‹ Copy All JSON",props:{onClick:async()=>{const e=N();await o(JSON.stringify(e,null,2)),window.$message.success("Sheet JSON Copied!")}}},{label:"ðŸ’» Print All to Console",props:{onClick:async()=>{const e=N();console.log(e),window.$message.success("Print to Console!")}}}]}],O=()=>{C.value=null,S.value=null,b.value=[],x.value=0,v.value.innerHTML=""};return p((()=>{O()})),{sheetNames:b,sheetNameIndex:x,handleImport:L,importFileChooserRef:a,loadDemo:()=>{k();const e=window.XLSX.utils.aoa_to_sheet(window.demo_aoa_to_sheet),o=window.XLSX.utils.json_to_sheet(window.demo_json_to_sheet),s=window.XLSX.utils.book_new();window.XLSX.utils.book_append_sheet(s,e,"aoa_to_sheet"),window.XLSX.utils.book_append_sheet(s,o,"json_to_sheet"),x.value=0,S.value=s,j()},tableWrapperElRef:v,handleClick:s=>{let t=s.target;if(!(e=>"td"===e.tagName.toLowerCase())(t)||!T.value||T.value===u.DISABLED)return;if(!t.innerText)return;let a=t.innerText;console.log(T.value);let n="";a=s.ctrlKey&&s.altKey?f(a,n=u.JSON):s.ctrlKey?f(a,n=u.TEXT):s.altKey?f(a,n=u.HTML):f(a,n=T.value),o(a),window.$message.success(n+" "+e("msgs.copy_success"));const l=document.createRange();l.selectNode(t);const i=window.getSelection();i&&(i.removeAllRanges(),i.addRange(l))},copyMode:T,modTextConvertOptions:w((()=>[{label:"Disabled",value:u.DISABLED},...y])),dropdownMenuOptions:R,textConvertMultipleLine:f,...t({cbFiles:e=>{e.length&&L(e[0])}}),isTrimEmptyLines:D,mainStore:s,isReady:g,workbookRef:S,fileRef:C,handleCloseFile:O}}}),Z={key:0,class:"mc-loading-container"};const q=v(Y,[["render",function(e,o,s,t,a,n){const l=g("DropZone"),i=B,r=M,c=H,d=z,m=K,u=g("CommonNavbar"),p=W,w=J,f=P,h=T,_=g("FileChooser");return C(),S("div",{class:"excel-copy-tool",onDragover:o[6]||(o[6]=D(((...o)=>e.fileDragover&&e.fileDragover(...o)),["prevent","stop"])),onDragleave:o[7]||(o[7]=D((o=>e.showDropzone=!1),["prevent","stop"])),onDrop:o[8]||(o[8]=D(((...o)=>e.fileDrop&&e.fileDrop(...o)),["prevent","stop"]))},[b(k,{name:"mc-fade"},{default:x((()=>[N(b(l,{"position-fixed":"",text:"Drop Excel file here"},null,512),[[E,e.showDropzone]])])),_:1}),X("div",null,[b(u,null,{extra:x((()=>[b(d,null,{default:x((()=>[b(d,{size:"small",align:"center"},{default:x((()=>[b(i,{size:"small",checked:e.isTrimEmptyLines,"onUpdate:checked":o[0]||(o[0]=o=>e.isTrimEmptyLines=o)},{default:x((()=>[R(O(e.$t("msgs.trim_empty_lines")),1)])),_:1},8,["checked"]),b(r,{text:"",onClick:o[1]||(o[1]=o=>e.mainStore.isShowTextTransformer=!0)},{default:x((()=>[R(O(e.$t("common.text_transformer"))+":",1)])),_:1}),b(c,{size:"small",value:e.copyMode,"onUpdate:value":o[2]||(o[2]=o=>e.copyMode=o),options:e.modTextConvertOptions,style:{width:"100px"}},null,8,["value","options"])])),_:1}),e.workbookRef?(C(),j(m,{key:0,options:e.dropdownMenuOptions,placement:"bottom-start","key-field":"label",disabled:!e.isReady},{default:x((()=>[b(r,{size:"small"},{default:x((()=>[R("ðŸ’» "+O(e.$t("actions.export")),1)])),_:1})])),_:1},8,["options","disabled"])):L("",!0),e.fileRef?(C(),j(r,{key:2,type:"primary",size:"small",onClick:e.handleCloseFile},{default:x((()=>[R(O(e.$t("actions.close")),1)])),_:1},8,["onClick"])):(C(),j(r,{key:1,type:"primary",disabled:!e.isReady,onClick:o[3]||(o[3]=o=>e.importFileChooserRef.chooseFile()),size:"small"},{default:x((()=>[R(O(e.$t("actions.open")+" Excel"),1)])),_:1},8,["disabled"])),e.fileRef?L("",!0):(C(),j(r,{key:3,onClick:e.loadDemo,size:"small",disabled:!e.isReady},{default:x((()=>[R(O(e.$t("common.demo")),1)])),_:1},8,["onClick","disabled"]))])),_:1})])),_:1}),b(k,{name:"mc-fade"},{default:x((()=>[e.isReady?L("",!0):(C(),S("div",Z,[b(p)]))])),_:1}),e.isReady?(C(),j(h,{key:0,class:"sheet-name-card",size:"small"},{default:x((()=>[b(f,{size:"small",type:"card",animated:"",value:e.sheetNameIndex,"onUpdate:value":o[4]||(o[4]=o=>e.sheetNameIndex=o)},{default:x((()=>[(C(!0),S($,null,F(e.sheetNames,((e,o)=>(C(),j(w,{style:{padding:"0"},name:o,tab:e,key:e},null,8,["name","tab"])))),128))])),_:1},8,["value"])])),_:1})):L("",!0)]),X("div",{ref:"tableWrapperElRef",class:"excel-table-container vp-bg",onClick:o[5]||(o[5]=(...o)=>e.handleClick&&e.handleClick(...o))},null,512),b(_,{ref:"importFileChooserRef",accept:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",onSelected:e.handleImport},null,8,["onSelected"])],32)}]]);export{q as default};
