import{_ as I,a as O,i as B}from"./translate-MgIgyKya.js";import{_ as J,u as A,a as W,c as j,d as E,b as U}from"./use-meta-RFB9Km7d.js";import{d as P,c as u,x as k,B as g,g as L,h as M,r as b,R as y,i as Z,k as G,S as K,U as Q,V as H,b as X,W as q,y as l,z as s,A as N,J as Y,K as x,D,C as S,F as ee,G as oe,H as d,I as m,e as f,N as ne,X as se,P as te}from"./index-ve-9jXjp.js";const ae={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 20 20"},le=g("g",{fill:"none"},[g("path",{d:"M3 5a2 2 0 0 1 2-2h8.379a2 2 0 0 1 1.414.586l1.621 1.621A2 2 0 0 1 17 6.621V15a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5zm2-1a1 1 0 0 0-1 1v10a1 1 0 0 0 1 1v-4.5A1.5 1.5 0 0 1 6.5 10h7a1.5 1.5 0 0 1 1.5 1.5V16a1 1 0 0 0 1-1V6.621a1 1 0 0 0-.293-.707l-1.621-1.621A1 1 0 0 0 13.379 4H13v2.5A1.5 1.5 0 0 1 11.5 8h-4A1.5 1.5 0 0 1 6 6.5V4H5zm2 0v2.5a.5.5 0 0 0 .5.5h4a.5.5 0 0 0 .5-.5V4H7zm7 12v-4.5a.5.5 0 0 0-.5-.5h-7a.5.5 0 0 0-.5.5V16h8z",fill:"currentColor"})],-1),ie=[le],re=P({name:"Save20Regular",render:function(t,p){return u(),k("svg",ae,ie)}}),R={types:[{description:"JSON",accept:{"application/JSON":[".json"]}}]},ce=P({name:"VueI18nEditTool",components:{I18nToolSettings:I,TranslateTreeItem:O,DropZone:J,Save20Regular:re},setup(){const{t:e}=L(),t=M(),p=b(y.parseWithRoot()),i=b(!1),r=Z(),_=async a=>{try{i.value=!0;const o=await Q(a),n=JSON.parse(o);p.value=y.parseWithRoot(n)}catch(o){console.error(o),window.$message.error(o.message)}finally{i.value=!1}},$=async()=>{const[a]=await window.showOpenFilePicker(R);r.value=a;const o=await a.getFile();await _(o)},T=()=>{r.value=void 0,p.value=y.parseWithRoot()},w=async()=>{try{if(i.value=!0,!r.value)return;const a=await r.value.createWritable(),o=JSON.stringify(H(p.value),null,2);await a.write(o),await a.close(),window.$message.success(e("msgs.saved"))}catch(a){console.error(a),window.$message.error(a.message)}finally{i.value=!1}},c=async()=>{var a;try{i.value=!0,console.log(p.value);const o=JSON.stringify(H(p.value),null,2),v=await(await window.showSaveFilePicker({suggestedName:(a=r.value)==null?void 0:a.name,...R})).createWritable();await v.write(o),await v.close(),window.$message.success(e("msgs.saved"))}catch(o){console.error(o),window.$message.error(o.message)}finally{i.value=!1}},{metaTitle:h}=A();G(()=>{if(r.value){w();return}c()}),K(()=>!!r.value);const C=b(!1);return{metaTitle:h,translateTreeRoot:p,fileHandle:r,handleImport:_,handleSelectFile:$,handleCloseFile:T,handleSaveFile:w,handleExport:c,loadDemo:()=>{p.value=y.parseWithRoot({hello_world:{section_a:{test_str:"This is a test string",test_arr:["line 1","line 2","line 3"],test_number:114514},section_b:{"":"Blur this input and it'll generate the key automatically!"},section_c:{"":"中文 is Supported"}}})},iconTranslate:B,...W({cb:async a=>{try{i.value=!0;for(const o of a.dataTransfer.items)if(o.kind==="file"){const n=await o.getAsFileSystemHandle();if(n.kind!=="directory"){r.value=n;const v=await n.getFile();await _(v)}else window.$message.error("Please drag and drop a json file here!")}}catch(o){console.error(o),window.$message.error(o.message)}finally{i.value=!1}}}),mainStore:t,isShowToolSettings:C,isLoading:i}}}),de={key:0,class:"mc-loading-container position-fixed"},ue={class:"vp-panel navbar-wrap",style:{position:"sticky",top:"0","z-index":"100","margin-bottom":"10px"}},pe={class:"_container"},me=g("div",{class:"height-placeholder"},null,-1);function ve(e,t,p,i,r,_){const $=E,T=J,w=U,c=ne,h=se,C=q("Save20Regular"),F=te,z=j,a=O,o=I;return u(),k("div",{class:"vue-i18n-edit-tool i18n-style",onDragover:t[4]||(t[4]=D((...n)=>e.fileDragover&&e.fileDragover(...n),["prevent","stop"])),onDragleave:t[5]||(t[5]=D(n=>e.showDropzone=!1,["prevent","stop"])),onDrop:t[6]||(t[6]=D((...n)=>e.fileDrop&&e.fileDrop(...n),["prevent","stop"]))},[l(N,{name:"mc-fade"},{default:s(()=>[e.isLoading?(u(),k("div",de,[l($)])):S("",!0)]),_:1}),l(N,{name:"mc-fade"},{default:s(()=>[ee(l(T,{"position-fixed":"",text:e.$t("msgs.drag_file_here")},null,8,["text"]),[[oe,e.showDropzone]])]),_:1}),g("div",ue,[l(z,{subtitle:"",onBack:t[2]||(t[2]=n=>e.$router.push({name:"HomePage"}))},{title:s(()=>[d(m(e.metaTitle),1)]),avatar:s(()=>[l(w,{src:e.iconTranslate,style:{background:"none"}},null,8,["src"])]),extra:s(()=>[l(F,null,{default:s(()=>[l(c,{secondary:"",size:"small",onClick:t[0]||(t[0]=n=>e.isShowToolSettings=!0)},{default:s(()=>[d(m(e.$t("common.settings")),1)]),_:1}),l(c,{secondary:"",size:"small",onClick:t[1]||(t[1]=n=>e.mainStore.isShowQuickLaunch=!0)},{default:s(()=>[d(m(e.$t("common.tools")),1)]),_:1}),e.fileHandle?(u(),f(h,{key:0,onPositiveClick:e.handleCloseFile},{trigger:s(()=>[e.fileHandle?(u(),f(c,{key:0,secondary:"",type:"primary",size:"small"},{default:s(()=>[d(" Close JSON ")]),_:1})):S("",!0)]),default:s(()=>[d(" Confirm close JSON? Unsaved contents will be lost. ")]),_:1},8,["onPositiveClick"])):(u(),f(c,{key:1,type:"primary",onClick:e.handleSelectFile,size:"small"},{default:s(()=>[d(m(e.$t("actions.open_json")),1)]),_:1},8,["onClick"])),e.fileHandle?(u(),f(c,{key:2,onClick:e.handleSaveFile,size:"small",type:"info"},{icon:s(()=>[l(C)]),default:s(()=>[d(" "+m(e.$t("actions.save")),1)]),_:1},8,["onClick"])):S("",!0),l(c,{secondary:"",onClick:e.handleExport,size:"small"},{default:s(()=>[d(m(e.$t("actions.save_as"))+"... ",1)]),_:1},8,["onClick"]),e.fileHandle?S("",!0):(u(),f(h,{key:3,onPositiveClick:e.loadDemo},{trigger:s(()=>[l(c,{tertiary:"",size:"small"},{default:s(()=>[d(m(e.$t("common.demo")),1)]),_:1})]),default:s(()=>[d(" "+m(e.$t("msgs.load_demo_this_will")),1)]),_:1},8,["onPositiveClick"]))]),_:1})]),_:1})]),g("div",pe,[(u(!0),k(Y,null,x(e.translateTreeRoot,(n,v)=>{var V;return u(),f(a,{key:v,item:n,index:v,title:(V=e.fileHandle)==null?void 0:V.name},null,8,["item","index","title"])}),128))]),me,l(o,{visible:e.isShowToolSettings,"onUpdate:visible":t[3]||(t[3]=n=>e.isShowToolSettings=n)},null,8,["visible"])],32)}const we=X(ce,[["render",ve]]);export{we as default};
