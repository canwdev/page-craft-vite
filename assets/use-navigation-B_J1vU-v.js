import{f as e,n as t,t as s,s as o}from"./index-BVPZ2aTg.js";import{ao as i,c as l,r as n,N as a,O as r,P as c,s as h,L as u}from"./index-BJklM7uy.js";import{u as d}from"./file-history-DSZQkfOk.js";const p=({selectedPaths:t,basePath:s,isLoading:o,emit:n})=>{const a=i({cutPaths:[],copyPaths:[]});return{enablePaste:l((()=>a.cutPaths.length>0||a.copyPaths.length>0)),handleCut:()=>{a.copyPaths=[],a.cutPaths=t.value},handleCopy:()=>{a.cutPaths=[],a.copyPaths=t.value},handlePaste:async()=>{let t=[],i=!1;if(a.cutPaths.length)t=a.cutPaths,i=!0;else{if(!a.copyPaths.length)return;t=a.copyPaths}try{o.value=!0,await e.copyPaste({fromPaths:t,toPath:s.value,isMove:i}),a.cutPaths=[],a.copyPaths=[],n("refresh")}finally{o.value=!1}}}};
/*! @viselect/vanilla v3.9.0 MIT | https://github.com/Simonwep/selection/tree/master/packages/vanilla */class _{constructor(){this._listeners=new Map,this.on=this.addEventListener,this.off=this.removeEventListener,this.emit=this.dispatchEvent}addEventListener(e,t){const s=this._listeners.get(e)??new Set;return this._listeners.set(e,s),s.add(t),this}removeEventListener(e,t){var s;return null==(s=this._listeners.get(e))||s.delete(t),this}dispatchEvent(e,...t){let s=!0;for(const o of this._listeners.get(e)??[])s=!1!==o(...t)&&s;return s}unbindAllListeners(){this._listeners.clear()}}const v=(e,t="px")=>"number"==typeof e?e+t:e,m=({style:e},t,s)=>{if("object"==typeof t)for(const[o,i]of Object.entries(t))void 0!==i&&(e[o]=v(i));else void 0!==s&&(e[t]=v(s))},g=(e=0,t=0,s=0,o=0)=>{const i={x:e,y:t,width:s,height:o,top:t,left:e,right:e+s,bottom:t+o};return{...i,toJSON:()=>JSON.stringify(i)}},f=(e,t,s="touch")=>{switch(s){case"center":{const s=t.left+t.width/2,o=t.top+t.height/2;return s>=e.left&&s<=e.right&&o>=e.top&&o<=e.bottom}case"cover":return t.left>=e.left&&t.top>=e.top&&t.right<=e.right&&t.bottom<=e.bottom;case"touch":return e.right>=t.left&&e.left<=t.right&&e.bottom>=t.top&&e.top<=t.bottom}},y=e=>Array.isArray(e)?e:[e],b=e=>(t,s,o,i={})=>{(t instanceof HTMLCollection||t instanceof NodeList)&&(t=Array.from(t)),s=y(s),t=y(t);for(const l of t)if(l)for(const t of s)l[e](t,o,{capture:!1,...i})},S=b("addEventListener"),E=b("removeEventListener"),x=e=>{var t;const{clientX:s,clientY:o,target:i}=(null==(t=e.touches)?void 0:t[0])??e;return{x:s,y:o,target:i}},w=(e,t=document)=>y(e).map((e=>"string"==typeof e?Array.from(t.querySelectorAll(e)):e instanceof Element?e:null)).flat().filter(Boolean),{abs:A,max:T,min:L,ceil:P}=Math,M=(e=[])=>({stored:e,selected:[],touched:[],changed:{added:[],removed:[]}}),C=class extends _{constructor(e){var t,s,o,i,l;super(),this._selection=M(),this._targetBoundaryScrolled=!0,this._selectables=[],this._areaLocation={y1:0,x2:0,y2:0,x1:0},this._areaRect=g(),this._singleClick=!0,this._scrollAvailable=!0,this._scrollingActive=!1,this._scrollSpeed={x:0,y:0},this._scrollDelta={x:0,y:0},this._lastMousePosition={x:0,y:0},this.enable=this._toggleStartEvents,this.disable=this._toggleStartEvents.bind(this,!1),this._options={selectionAreaClass:"selection-area",selectionContainerClass:void 0,selectables:[],document:window.document,startAreas:["html"],boundaries:["html"],container:"body",...e,behaviour:{overlap:"invert",intersect:"touch",triggers:[0],...e.behaviour,startThreshold:null!=(t=e.behaviour)&&t.startThreshold?"number"==typeof e.behaviour.startThreshold?e.behaviour.startThreshold:{x:10,y:10,...e.behaviour.startThreshold}:{x:10,y:10},scrolling:{speedDivider:10,manualSpeed:750,...null==(s=e.behaviour)?void 0:s.scrolling,startScrollMargins:{x:0,y:0,...null==(i=null==(o=e.behaviour)?void 0:o.scrolling)?void 0:i.startScrollMargins}}},features:{range:!0,touch:!0,deselectOnBlur:!1,...e.features,singleTap:{allow:!0,intersect:"native",...null==(l=e.features)?void 0:l.singleTap}}};for(const c of Object.getOwnPropertyNames(Object.getPrototypeOf(this)))"function"==typeof this[c]&&(this[c]=this[c].bind(this));const{document:n,selectionAreaClass:a,selectionContainerClass:r}=this._options;this._area=n.createElement("div"),this._clippingElement=n.createElement("div"),this._clippingElement.appendChild(this._area),this._area.classList.add(a),r&&this._clippingElement.classList.add(r),m(this._area,{willChange:"top, left, bottom, right, width, height",top:0,left:0,position:"fixed"}),m(this._clippingElement,{overflow:"hidden",position:"fixed",transform:"translate3d(0, 0, 0)",pointerEvents:"none",zIndex:"1"}),this._frame=(e=>{let t,s=-1,o=!1;return{next:(...i)=>{t=i,o||(o=!0,s=requestAnimationFrame((()=>{e(...t),o=!1})))},cancel:()=>{cancelAnimationFrame(s),o=!1}}})((e=>{this._recalculateSelectionAreaRect(),this._updateElementSelection(),this._emitEvent("move",e),this._redrawSelectionArea()})),this.enable()}_toggleStartEvents(e=!0){const{document:t,features:s}=this._options,o=e?S:E;o(t,"mousedown",this._onTapStart),s.touch&&o(t,"touchstart",this._onTapStart,{passive:!1})}_onTapStart(e,t=!1){const{x:s,y:o,target:i}=x(e),{document:l,startAreas:n,boundaries:a,features:r,behaviour:c}=this._options,h=i.getBoundingClientRect();if(e instanceof MouseEvent&&!((e,t)=>t.some((t=>"number"==typeof t?e.button===t:"object"==typeof t&&t.button===e.button&&t.modifiers.every((t=>{switch(t){case"alt":return e.altKey;case"ctrl":return e.ctrlKey||e.metaKey;case"shift":return e.shiftKey}})))))(e,c.triggers))return;const u=w(n,l),d=w(a,l);this._targetElement=d.find((e=>f(e.getBoundingClientRect(),h)));const p=e.composedPath(),_=u.find((e=>p.includes(e)));if(this._targetBoundary=d.find((e=>p.includes(e))),!this._targetElement||!_||!this._targetBoundary||!t&&!1===this._emitEvent("beforestart",e))return;this._areaLocation={x1:s,y1:o,x2:0,y2:0};const v=l.scrollingElement??l.body;this._scrollDelta={x:v.scrollLeft,y:v.scrollTop},this._singleClick=!0,this.clearSelection(!1,!0),S(l,["touchmove","mousemove"],this._delayedTapMove,{passive:!1}),S(l,["mouseup","touchcancel","touchend"],this._onTapStop),S(l,"scroll",this._onScroll),r.deselectOnBlur&&(this._targetBoundaryScrolled=!1,S(this._targetBoundary,"scroll",this._onStartAreaScroll))}_onSingleTap(e){const{singleTap:{intersect:t},range:s}=this._options.features,o=x(e);let i;if("native"===t)i=o.target;else if("touch"===t){this.resolveSelectables();const{x:e,y:t}=o;i=this._selectables.find((s=>{const{right:o,left:i,top:l,bottom:n}=s.getBoundingClientRect();return e<o&&e>i&&t<n&&t>l}))}if(!i)return;for(this.resolveSelectables();!this._selectables.includes(i);){if(!i.parentElement)return void(this._targetBoundaryScrolled||this.clearSelection());i=i.parentElement}const{stored:l}=this._selection;if(this._emitEvent("start",e),e.shiftKey&&s&&this._latestElement){const e=this._latestElement,[t,s]=4&e.compareDocumentPosition(i)?[i,e]:[e,i],o=[...this._selectables.filter((e=>4&e.compareDocumentPosition(t)&&2&e.compareDocumentPosition(s))),t,s];this.select(o),this._latestElement=e}else l.includes(i)&&(1===l.length||e.ctrlKey||l.every((e=>this._selection.stored.includes(e))))?this.deselect(i):(this.select(i),this._latestElement=i)}_delayedTapMove(e){const{container:t,document:s,behaviour:{startThreshold:o}}=this._options,{x1:i,y1:l}=this._areaLocation,{x:n,y:a}=x(e);if("number"==typeof o&&A(n+a-(i+l))>=o||"object"==typeof o&&A(n-i)>=o.x||A(a-l)>=o.y){if(E(s,["mousemove","touchmove"],this._delayedTapMove,{passive:!1}),!1===this._emitEvent("beforedrag",e))return void E(s,["mouseup","touchcancel","touchend"],this._onTapStop);S(s,["mousemove","touchmove"],this._onTapMove,{passive:!1}),m(this._area,"display","block"),w(t,s)[0].appendChild(this._clippingElement),this.resolveSelectables(),this._singleClick=!1,this._targetRect=this._targetElement.getBoundingClientRect(),this._scrollAvailable=this._targetElement.scrollHeight!==this._targetElement.clientHeight||this._targetElement.scrollWidth!==this._targetElement.clientWidth,this._scrollAvailable&&(S(this._targetElement,"wheel",this._wheelScroll,{passive:!1}),S(this._options.document,"keydown",this._keyboardScroll,{passive:!1}),this._selectables=this._selectables.filter((e=>this._targetElement.contains(e)))),this._setupSelectionArea(),this._emitEvent("start",e),this._onTapMove(e)}this._handleMoveEvent(e)}_setupSelectionArea(){const{_clippingElement:e,_targetElement:t,_area:s}=this,o=this._targetRect=t.getBoundingClientRect();this._scrollAvailable?(m(e,{top:o.top,left:o.left,width:o.width,height:o.height}),m(s,{marginTop:-o.top,marginLeft:-o.left})):(m(e,{top:0,left:0,width:"100%",height:"100%"}),m(s,{marginTop:0,marginLeft:0}))}_onTapMove(e){const{_scrollSpeed:t,_areaLocation:s,_options:o,_frame:i}=this,{speedDivider:l}=o.behaviour.scrolling,n=this._targetElement,{x:a,y:r}=x(e);if(s.x2=a,s.y2=r,this._lastMousePosition.x=a,this._lastMousePosition.y=r,this._scrollAvailable&&!this._scrollingActive&&(t.y||t.x)){this._scrollingActive=!0;const o=()=>{if(!t.x&&!t.y)return void(this._scrollingActive=!1);const{scrollTop:a,scrollLeft:r}=n;t.y&&(n.scrollTop+=P(t.y/l),s.y1-=n.scrollTop-a),t.x&&(n.scrollLeft+=P(t.x/l),s.x1-=n.scrollLeft-r),i.next(e),requestAnimationFrame(o)};requestAnimationFrame(o)}else i.next(e);this._handleMoveEvent(e)}_handleMoveEvent(e){const{features:t}=this._options;(t.touch&&matchMedia("(hover: none), (pointer: coarse)").matches||this._scrollAvailable&&"safari"in window)&&e.preventDefault()}_onScroll(){const{_scrollDelta:e,_options:{document:t}}=this,{scrollTop:s,scrollLeft:o}=t.scrollingElement??t.body;this._areaLocation.x1+=e.x-o,this._areaLocation.y1+=e.y-s,e.x=o,e.y=s,this._setupSelectionArea(),this._frame.next(null)}_onStartAreaScroll(){this._targetBoundaryScrolled=!0,E(this._targetElement,"scroll",this._onStartAreaScroll)}_wheelScroll(e){const{manualSpeed:t}=this._options.behaviour.scrolling,s=e.deltaY?e.deltaY>0?1:-1:0,o=e.deltaX?e.deltaX>0?1:-1:0;this._scrollSpeed.y+=s*t,this._scrollSpeed.x+=o*t,this._onTapMove(e),e.preventDefault()}_keyboardScroll(e){const{manualSpeed:t}=this._options.behaviour.scrolling,s="ArrowLeft"===e.key?-1:"ArrowRight"===e.key?1:0,o="ArrowUp"===e.key?-1:"ArrowDown"===e.key?1:0;this._scrollSpeed.x+=Math.sign(s)*t,this._scrollSpeed.y+=Math.sign(o)*t,e.preventDefault(),this._onTapMove({clientX:this._lastMousePosition.x,clientY:this._lastMousePosition.y,preventDefault:()=>{}})}_recalculateSelectionAreaRect(){const{_scrollSpeed:e,_areaLocation:t,_targetElement:s,_options:o}=this,{scrollTop:i,scrollHeight:l,clientHeight:n,scrollLeft:a,scrollWidth:r,clientWidth:c}=s,h=this._targetRect,{x1:u,y1:d}=t;let{x2:p,y2:_}=t;const{behaviour:{scrolling:{startScrollMargins:v}}}=o;p<h.left+v.x?(e.x=a?-A(h.left-p+v.x):0,p=p<h.left?h.left:p):p>h.right-v.x?(e.x=r-a-c?A(h.left+h.width-p-v.x):0,p=p>h.right?h.right:p):e.x=0,_<h.top+v.y?(e.y=i?-A(h.top-_+v.y):0,_=_<h.top?h.top:_):_>h.bottom-v.y?(e.y=l-i-n?A(h.top+h.height-_-v.y):0,_=_>h.bottom?h.bottom:_):e.y=0;const m=L(u,p),f=L(d,_),y=T(u,p),b=T(d,_);this._areaRect=g(m,f,y-m,b-f)}_redrawSelectionArea(){const{x:e,y:t,width:s,height:o}=this._areaRect,{style:i}=this._area;i.left=`${e}px`,i.top=`${t}px`,i.width=`${s}px`,i.height=`${o}px`}_onTapStop(e,t){var s;const{document:o,features:i}=this._options,{_singleClick:l}=this;E(this._targetElement,"scroll",this._onStartAreaScroll),E(o,["mousemove","touchmove"],this._delayedTapMove),E(o,["touchmove","mousemove"],this._onTapMove),E(o,["mouseup","touchcancel","touchend"],this._onTapStop),E(o,"scroll",this._onScroll),this._keepSelection(),e&&l&&i.singleTap.allow?this._onSingleTap(e):!l&&!t&&(this._updateElementSelection(),this._emitEvent("stop",e)),this._scrollSpeed.x=0,this._scrollSpeed.y=0,E(this._targetElement,"wheel",this._wheelScroll,{passive:!0}),E(this._options.document,"keydown",this._keyboardScroll,{passive:!0}),this._clippingElement.remove(),null==(s=this._frame)||s.cancel(),m(this._area,"display","none")}_updateElementSelection(){const{_selectables:e,_options:t,_selection:s,_areaRect:o}=this,{stored:i,selected:l,touched:n}=s,{intersect:a,overlap:r}=t.behaviour,c="invert"===r,h=[],u=[],d=[];for(let _=0;_<e.length;_++){const t=e[_];if(f(o,t.getBoundingClientRect(),a)){if(l.includes(t))i.includes(t)&&!n.includes(t)&&n.push(t);else{if(c&&i.includes(t)){d.push(t);continue}u.push(t)}h.push(t)}}c&&u.push(...i.filter((e=>!l.includes(e))));const p="keep"===r;for(let _=0;_<l.length;_++){const e=l[_];!h.includes(e)&&(!p||!i.includes(e))&&d.push(e)}s.selected=h,s.changed={added:u,removed:d},this._latestElement=void 0}_emitEvent(e,t){return this.emit(e,{event:t,store:this._selection,selection:this})}_keepSelection(){const{_options:e,_selection:t}=this,{selected:s,changed:o,touched:i,stored:l}=t,n=s.filter((e=>!l.includes(e)));switch(e.behaviour.overlap){case"drop":t.stored=[...n,...l.filter((e=>!i.includes(e)))];break;case"invert":t.stored=[...n,...l.filter((e=>!o.removed.includes(e)))];break;case"keep":t.stored=[...l,...s.filter((e=>!l.includes(e)))]}}trigger(e,t=!0){this._onTapStart(e,t)}resolveSelectables(){this._selectables=w(this._options.selectables,this._options.document)}clearSelection(e=!0,t=!1){const{selected:s,stored:o,changed:i}=this._selection;i.added=[],i.removed.push(...s,...e?o:[]),t||(this._emitEvent("move",null),this._emitEvent("stop",null)),this._selection=M(e?[]:o)}getSelection(){return this._selection.stored}getSelectionArea(){return this._area}getSelectables(){return this._selectables}setAreaLocation(e){Object.assign(this._areaLocation,e),this._redrawSelectionArea()}getAreaLocation(){return this._areaLocation}cancel(e=!1){this._onTapStop(null,!e)}destroy(){this.cancel(),this.disable(),this._clippingElement.remove(),super.unbindAllListeners()}select(e,t=!1){const{changed:s,selected:o,stored:i}=this._selection,l=w(e,this._options.document).filter((e=>!o.includes(e)&&!i.includes(e)));return i.push(...l),o.push(...l),s.added.push(...l),s.removed=[],this._latestElement=void 0,t||(this._emitEvent("move",null),this._emitEvent("stop",null)),l}deselect(e,t=!1){const{selected:s,stored:o,changed:i}=this._selection,l=w(e,this._options.document).filter((e=>s.includes(e)||o.includes(e)));this._selection.stored=o.filter((e=>!l.includes(e))),this._selection.selected=s.filter((e=>!l.includes(e))),this._selection.changed.added=[],this._selection.changed.removed.push(...l.filter((e=>!i.removed.includes(e)))),this._latestElement=void 0,t||(this._emitEvent("move",null),this._emitEvent("stop",null))}};C.version="3.9.0";let R=C;const k=({filteredFiles:e,basePath:o})=>{const i=n([]),h=l((()=>new Set(i.value)));c(e,(()=>{i.value=[]}));const u=n(),{selectionArea:d}=(({containerRef:e,onStart:t,onStop:s,toggleClass:o="active",selectables:i=[".selectable"]})=>{const l=n();return a((()=>{l.value=new R({selectables:i,boundaries:[e.value],features:{touch:!1,singleTap:{allow:!1}},container:e.value}).on("start",(({store:e,event:s})=>{s.ctrlKey||s.metaKey||(l.value.clearSelection(),setTimeout((()=>{t&&t()})))})).on("move",(({store:{changed:{added:e,removed:t}}})=>{for(const s of e)s.classList.add(o);for(const s of t)s.classList.remove(o)})).on("stop",(({store:{stored:e}})=>{setTimeout((()=>{s&&s(e)}))}))})),r((()=>{l.value&&l.value.destroy()})),{selectionArea:l}})({containerRef:u,onStart:()=>{i.value=[]},onStop:t=>{const s={};e.value.forEach((e=>{s[e.name]=e}));const o=[];t.forEach((e=>{const t=e.getAttribute("data-name");t&&s[t]&&o.push(s[t])})),i.value=o}}),p=l((()=>i.value.map((e=>t(o.value+"/"+e.name)))));return{selectedItems:i,selectedItemsSet:h,explorerContentRef:u,toggleSelect:({item:t,event:o,toggle:l=!1})=>{if(o.ctrlKey||o.metaKey||l)i.value=s([...i.value],t);else if(o.shiftKey){let s=0;const o=i.value[0];o&&(s=e.value.findIndex((e=>e.name===o.name)));let l=e.value.findIndex((e=>e.name===t.name));s>l&&([l,s]=[s,l]),i.value=e.value.slice(s,l+1)}else i.value=[t]},toggleSelectAll:()=>{const t=e.value;i.value.length===t.length?i.value=[]:i.value=[...t]},selectedPaths:p,selectionArea:d}},O=({emit:e})=>{const t=n(null),{appendHistory:s,historyMenuOptions:i}=d("mc_explorer_local_dir3",(async s=>{await o(s),e("refresh"),t.value=s})),a=async()=>{await o(),e("refresh"),t.value=null};return{handleOpenLocalDir:async()=>{const i=await window.showDirectoryPicker();await o(i),e("refresh"),await s(i),t.value=i},localDirHistoryOptions:l((()=>{const e=[...i.value];return t.value&&e.push({label:"✖️ Close Local Folder",props:{onClick:a}}),e}))}},B=({getListFn:e,openEntryFn:o})=>{const i=n([]),a=h(u.MC_EXPLORER_BASE_PATH,"/",localStorage,{listenToStorageChanges:!1}),r=l((()=>{let e=t(a.value);return/\/$/gi.test(e)||(e+="/"),e})),c=n(!1),d=async()=>{try{a.value=r.value,c.value=!0,a.value||(a.value="/"),i.value=await e()}catch(t){console.error(t),i.value=[]}finally{c.value=!1}},p=n([]),_=n([]),v=(e,t=r.value)=>{const s=e[e.length-1];(!s||s&&s!==t)&&e.push(t)},m=l((()=>{const e=a.value.split("/").filter((e=>!!e));return g.value?e.length>0:e.length>1})),g=l((()=>/^\//g.test(a.value))),f=async(e,t=!0)=>{a.value=e,S.value="",await d(),t&&v(p.value)},y=h(u.MC_EXPLORER_COMPONENT_DIR_STAR_LIST,[]),b=l((()=>y.value.includes(r.value))),S=n(""),E=l((()=>{const e=S.value.toLowerCase();return i.value.filter((t=>t.name.toLowerCase().includes(e)))}));return{isLoading:c,filteredFiles:E,handleOpen:async e=>{const s=t(a.value+"/"+e.name);e.isDirectory?await f(s):await o({item:e,path:s})},handleRefresh:d,basePathNormalized:r,starList:y,handleOpenPath:f,backHistory:p,goBack:async()=>{const e=p.value[p.value.length-2];e&&(p.value.pop(),v(_.value),await f(e,!1))},forwardHistory:_,goForward:async()=>{const e=_.value.pop();e&&(v(p.value,e),await f(e,!1))},allowUp:m,goUp:async()=>{const e=a.value.split("/").filter((e=>!!e));if(e.pop(),!e.length&&!g.value)return void(await d());let t=e.join("/")+"/";g.value&&(t="/"+t),await f(t)},basePath:a,toggleStar:()=>{y.value=s([...y.value],r.value)},isStared:b,filterText:S}};export{p as a,O as b,B as c,k as u};
