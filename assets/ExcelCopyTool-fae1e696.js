import{d as j,_ as z,u as I,a as B,r as m,s as J,b as K,w as A,o as H,C as g,c as U,e as V,f as M,g as y,h as W,p as P,i as G,j as T,k as R,l as s,m as l,T as Z,n as F,q as X,t as q,v as Q,x as Y,y as _,z as f,F as ee,A as oe,B as ne,D as te,E as se,G as ae,H as le,I as re,J as ie,K as pe}from"./index-de16cf89.js";import{_ as O,d as ue,u as ce,a as me,b as de}from"./use-file-drop-a9c14ca7.js";const _e=""+new URL("excel-59df11bd.svg",import.meta.url).href,fe=o=>o.tagName.toLowerCase()==="td",we=j({name:"ExcelCopyTool",components:{FileChooser:z,DropZone:O},setup(){const{t:o}=I(),n=B(),E=m(),h=m(),b=m(!1),p=J(),w=m([]),u=m(0),{metaTitle:C}=K();A(u,()=>{d()});const c=()=>{if(!b.value){const e="XLSX Not Ready!";throw window.$message.error(e),new Error(e)}},$=e=>(w.value=e.SheetNames,e.Sheets[w.value[u.value]]),d=()=>{const e=p.value;if(!e){h.value.innerHTML="";return}const a=window.XLSX.utils.sheet_to_html($(e));h.value.innerHTML=a},v=async e=>{if(c(),!/\.xlsx$/g.test(e.name)){window.$message.error("Only supports reading xlsx format!");return}const a=new FileReader;p.value=null,a.onload=function(t){const r=t.target.result;u.value=0,p.value=window.XLSX.read(r,{type:"binary"}),d()},a.readAsBinaryString(e)},D=m(!0);H(async()=>{try{await ue("//unpkg.com/xlsx@0.16.9/xlsx.mini.js")}catch(e){window.$message.error(e.message),console.error(e)}window.$message.success("XLSX Ready!"),console.log("XLSX ready",window.XLSX),b.value=!0});const i=m(g.json),L=e=>{let a=e.target;if(!fe(a)||!i.value||i.value===g.none||!a.innerText)return;let t=a.innerText;console.log(i.value);let r="";e.ctrlKey&&e.altKey?t=y(t,r=g.json):e.ctrlKey?t=y(t,r=g.text):e.altKey?t=y(t,r=g.html):t=y(t,r=i.value),M(t),window.$message.success(r+" "+o("msgs.copy_success"));const x=document.createRange();x.selectNode(a);const N=window.getSelection();N&&(N.removeAllRanges(),N.addRange(x))},S=()=>{if(!p.value){const t="Please open Excel file first!";throw window.$message.error(t),new Error(t)}const e=p.value,a={};return e.SheetNames.forEach(function(t){const r=window.XLSX.utils.sheet_to_row_object_array(e.Sheets[t]);r.length>0&&(a[t]=r)}),a},k=async()=>{const e=S();W(await P(null,"excel_sheet_export"),JSON.stringify(e,null,2),".json")};return U(async()=>{await k()}),{metaTitle:C,iconExcel:_e,sheetNames:w,sheetNameIndex:u,handleImport:v,importFileChooserRef:E,loadDemo(){c();const e=[["Name","Value","Num","Time"],["test001",`line1
line2`,123,new Date],["test001",`line1

line3`,-1,new Date]],a=window.XLSX.utils.aoa_to_sheet(e),t=window.XLSX.utils.book_new();window.XLSX.utils.book_append_sheet(t,a,"Sheet1"),u.value=0,p.value=t,d()},tableWrapperRef:h,handleClick:L,copyMode:i,CopyModeOptions:V,dropdownMenuOptions:[{label:"Copy Sheets JSON",props:{onClick:async()=>{const e=S();M(JSON.stringify(e,null,2)),window.$message.success("Sheet JSON Copied!")}}},{label:"Export Sheets JSON",props:{onClick:async()=>{k()}}}],formatMultipleLine:y,...ce({cbFiles:e=>{e.length&&v(e[0])}}),isTrimEmptyLines:D,mainStore:n}}});function ge(o,n,E,h,b,p){const w=O,u=me,C=te,c=se,$=ae,d=le,v=re,D=de,i=q,L=pe,S=ie,k=z;return T(),R("div",{class:"excel-copy-tool",onDragover:n[7]||(n[7]=X((...e)=>o.fileDragover&&o.fileDragover(...e),["prevent","stop"])),onDragleave:n[8]||(n[8]=X(e=>o.showDropzone=!1,["prevent","stop"])),onDrop:n[9]||(n[9]=X((...e)=>o.fileDrop&&o.fileDrop(...e),["prevent","stop"]))},[s(Z,{name:"mc-fade"},{default:l(()=>[Q(s(w,{text:"Drop Excel file here"},null,512),[[Y,o.showDropzone]])]),_:1}),F("div",null,[s(i,{size:"small"},{default:l(()=>[s(D,{subtitle:"",onBack:n[4]||(n[4]=e=>o.$router.push({name:"HomePage"}))},{title:l(()=>[_(f(o.metaTitle),1)]),avatar:l(()=>[s(u,{src:o.iconExcel,style:{background:"none"}},null,8,["src"])]),extra:l(()=>[s(d,null,{default:l(()=>[s(d,{size:"small",align:"center"},{default:l(()=>[s(C,{size:"small",checked:o.isTrimEmptyLines,"onUpdate:checked":n[0]||(n[0]=e=>o.isTrimEmptyLines=e)},{default:l(()=>[_(f(o.$t("msgs.trim_empty_lines")),1)]),_:1},8,["checked"]),s(c,{text:"",onClick:n[1]||(n[1]=e=>o.mainStore.isShowTextTransformer=!0)},{default:l(()=>[_(f(o.$t("common.text_transformer"))+":",1)]),_:1}),s($,{size:"small",value:o.copyMode,"onUpdate:value":n[2]||(n[2]=e=>o.copyMode=e),options:o.CopyModeOptions,style:{width:"100px"}},null,8,["value","options"])]),_:1}),s(c,{type:"primary",onClick:n[3]||(n[3]=e=>o.importFileChooserRef.chooseFile()),size:"small"},{default:l(()=>[_(f(o.$t("actions.open_excel")),1)]),_:1}),s(v,{options:o.dropdownMenuOptions,placement:"bottom-start","key-field":"label"},{default:l(()=>[s(c,{size:"small"},{default:l(()=>[_(f(o.$t("actions.export")),1)]),_:1})]),_:1},8,["options"]),s(c,{onClick:o.loadDemo,size:"small"},{default:l(()=>[_(f(o.$t("common.demo")),1)]),_:1},8,["onClick"])]),_:1})]),_:1})]),_:1}),s(i,{class:"sheet-name-card",size:"small"},{default:l(()=>[s(S,{size:"small",type:"card",animated:"",value:o.sheetNameIndex,"onUpdate:value":n[5]||(n[5]=e=>o.sheetNameIndex=e)},{default:l(()=>[(T(!0),R(ee,null,oe(o.sheetNames,(e,a)=>(T(),ne(L,{style:{padding:"0"},name:a,tab:e,key:e},null,8,["name","tab"]))),128))]),_:1},8,["value"])]),_:1})]),F("div",{ref:"tableWrapperRef",class:"excel-table-container",onClick:n[6]||(n[6]=(...e)=>o.handleClick&&o.handleClick(...e))},null,512),s(k,{ref:"importFileChooserRef",accept:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",onSelected:o.handleImport},null,8,["onSelected"])],32)}const ve=G(we,[["render",ge],["__scopeId","data-v-b8288744"]]);export{ve as default};
