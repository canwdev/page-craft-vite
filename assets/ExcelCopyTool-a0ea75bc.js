import{d as O,_ as R,a as F,r as p,s as j,u as I,w as B,o as J,C as f,b as U,c as V,e as X,f as g,h as A,g as H,i as K,j as $,k as t,l as a,T as W,m as M,n as E,p as P,q as L,t as Z,v as q,x as m,y as G,F as Q,z as Y,A as ee,B as oe,D as ne,E as se,G as te,H as le,I as ae,J as re}from"./index-f1c21af2.js";import{_ as z,d as ie,u as pe,a as ue,b as ce}from"./use-file-drop-e50994e8.js";const de=""+new URL("excel-59df11bd.svg",import.meta.url).href,me=n=>n.tagName.toLowerCase()==="td",_e=O({name:"ExcelCopyTool",components:{FileChooser:R,DialogTextTransformer:F,DropZone:z},setup(){const n=p(),s=p(),k=p(!1),u=j(),w=p([]),d=p(0),{metaTitle:C}=I();B(d,()=>{i()});const y=()=>{if(!k.value){const o="XLSX Not Ready!";throw window.$message.error(o),new Error(o)}},b=o=>(w.value=o.SheetNames,o.Sheets[w.value[d.value]]),i=()=>{const o=u.value;if(!o){s.value.innerHTML="";return}const l=window.XLSX.utils.sheet_to_html(b(o));s.value.innerHTML=l},v=async o=>{if(y(),!/\.xlsx$/g.test(o.name)){alert("Only supports reading xlsx format!");return}const l=new FileReader;u.value=null,l.onload=function(e){const r=e.target.result;d.value=0,u.value=window.XLSX.read(r,{type:"binary"}),i()},l.readAsBinaryString(o)},h=p(!0);J(async()=>{try{await ie("//unpkg.com/xlsx@0.16.9/xlsx.mini.js")}catch(o){window.$message.error(o.message),console.error(o)}window.$message.success("XLSX Ready!"),console.log("XLSX ready",window.XLSX),k.value=!0});const c=p(f.json),D=o=>{let l=o.target;if(!me(l)||!c.value||c.value===f.none||!l.innerText)return;let e=l.innerText;console.log(c.value);let r="";o.ctrlKey&&o.altKey?e=g(e,r=f.json):o.ctrlKey?e=g(e,r=f.text):o.altKey?e=g(e,r=f.html):e=g(e,r=c.value),X(e),window.$message.success(r+" copied!");const N=document.createRange();N.selectNode(l);const x=window.getSelection();x&&(x.removeAllRanges(),x.addRange(N))},_=()=>{if(!u.value){const e="Please open Excel file first!";throw window.$message.error(e),new Error(e)}const o=u.value,l={};return o.SheetNames.forEach(function(e){const r=window.XLSX.utils.sheet_to_row_object_array(o.Sheets[e]);r.length>0&&(l[e]=r)}),l},T=p(!1),S=()=>{const o=_();A(H(null,"excel_sheet_export"),JSON.stringify(o,null,2),".json")};return U(()=>{S()}),{metaTitle:C,iconExcel:de,sheetNames:w,sheetNameIndex:d,handleImport:v,importFileChooserRef:n,loadDemo(){y();const o=[["Name","Value","Num","Time"],["test001",`line1
line2`,123,new Date],["test001",`line1

line3`,-1,new Date]],l=window.XLSX.utils.aoa_to_sheet(o),e=window.XLSX.utils.book_new();window.XLSX.utils.book_append_sheet(e,l,"Sheet1"),d.value=0,u.value=e,i()},tableWrapperRef:s,handleClick:D,copyMode:c,CopyModeOptions:V,dropdownMenuOptions:[{label:"Copy Sheets JSON",props:{onClick:async()=>{const o=_();X(JSON.stringify(o,null,2)),window.$message.success("Sheet JSON Copied!")}}},{label:"Export Sheets JSON",props:{onClick:async()=>{S()}}}],isShowCopyDialog:T,formatMultipleLine:g,...pe({cbFiles:o=>{o.length&&v(o[0])}}),isTrimEmptyLines:h}}});function fe(n,s,k,u,w,d){const C=z,y=ue,b=oe,i=ne,v=se,h=te,c=le,D=ce,_=P,T=re,S=ae,o=R,l=F;return L(),$("div",{class:"excel-copy-tool",onDragover:s[8]||(s[8]=E((...e)=>n.fileDragover&&n.fileDragover(...e),["prevent","stop"])),onDragleave:s[9]||(s[9]=E(e=>n.showDropzone=!1,["prevent","stop"])),onDrop:s[10]||(s[10]=E((...e)=>n.fileDrop&&n.fileDrop(...e),["prevent","stop"]))},[t(W,{name:"mc-fade"},{default:a(()=>[Z(t(C,{text:"Drop Excel file here"},null,512),[[q,n.showDropzone]])]),_:1}),M("div",null,[t(_,{size:"small"},{default:a(()=>[t(D,{subtitle:"",onBack:s[4]||(s[4]=e=>n.$router.push({name:"HomeView"}))},{title:a(()=>[m(G(n.metaTitle),1)]),avatar:a(()=>[t(y,{src:n.iconExcel,style:{background:"none"}},null,8,["src"])]),extra:a(()=>[t(h,null,{default:a(()=>[t(h,{size:"small",align:"center"},{default:a(()=>[t(b,{size:"small",checked:n.isTrimEmptyLines,"onUpdate:checked":s[0]||(s[0]=e=>n.isTrimEmptyLines=e)},{default:a(()=>[m("Trim empty lines")]),_:1},8,["checked"]),t(i,{text:"",onClick:s[1]||(s[1]=e=>n.isShowCopyDialog=!0)},{default:a(()=>[m("CopyMode:")]),_:1}),t(v,{size:"small",value:n.copyMode,"onUpdate:value":s[2]||(s[2]=e=>n.copyMode=e),options:n.CopyModeOptions,style:{width:"100px"}},null,8,["value","options"])]),_:1}),t(i,{type:"primary",onClick:s[3]||(s[3]=e=>n.importFileChooserRef.chooseFile()),size:"small"},{default:a(()=>[m(" Import Excel ")]),_:1}),t(c,{options:n.dropdownMenuOptions,placement:"bottom-start","key-field":"label"},{default:a(()=>[t(i,{size:"small"},{default:a(()=>[m("Export")]),_:1})]),_:1},8,["options"]),t(i,{onClick:n.loadDemo,size:"small"},{default:a(()=>[m("Demo")]),_:1},8,["onClick"])]),_:1})]),_:1})]),_:1}),t(_,{class:"sheet-name-card",size:"small"},{default:a(()=>[t(S,{size:"small",type:"card",animated:"",value:n.sheetNameIndex,"onUpdate:value":s[5]||(s[5]=e=>n.sheetNameIndex=e)},{default:a(()=>[(L(!0),$(Q,null,Y(n.sheetNames,(e,r)=>(L(),ee(T,{style:{padding:"0"},name:r,tab:e,key:e},null,8,["name","tab"]))),128))]),_:1},8,["value"])]),_:1})]),M("div",{ref:"tableWrapperRef",class:"excel-table-container",onClick:s[6]||(s[6]=(...e)=>n.handleClick&&n.handleClick(...e))},null,512),t(o,{ref:"importFileChooserRef",accept:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",onSelected:n.handleImport},null,8,["onSelected"]),t(l,{visible:n.isShowCopyDialog,"onUpdate:visible":s[7]||(s[7]=e=>n.isShowCopyDialog=e)},null,8,["visible"])],32)}const ye=K(_e,[["render",fe],["__scopeId","data-v-f3661230"]]);export{ye as default};
