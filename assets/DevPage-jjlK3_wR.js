import{_ as e}from"./index.vue_vue_type_style_index_0_lang-Df9XRKpL.js";import{t,c as l,d as a,o as i,b as s,e as n,w as o,f as c,x as d,h as r,l as m,_ as p,r as u,E as v,U as b,k as h,P as f,M as C,V as w,W as y,X as g,T as k,F as x,m as D,p as _,Y as M,bB as L,Z as S,$ as P,a0 as F,I as z,v as $,g as I,Q as R,al as T,i as Y}from"./index-Dcsrw7an.js";/* empty css                   */import{d as j,f as O}from"./index-BSUZN_B5.js";import{_ as U}from"./QuickContextMenu.vue_vue_type_script_setup_true_lang-D5SzNeNJ.js";import{u as H,a as B,b as N,c as E}from"./use-local-dir-DpVBd9yr.js";import{f as V,n as A,g as K}from"./humanfs-api-Dvdi9RO8.js";import{_ as W,S as G}from"./index.vue_vue_type_script_setup_true_lang-D-CNzH-9.js";import{C as Q}from"./CommonNavbar-CYqCX-Ap.js";import"./file-history-OL31BKSf.js";import"./useIDBKeyval-DAptoUO-.js";/* empty css                  *//* empty css                  */import"./RectSwitch-DyIQ1C31.js";import"./use-model-wrapper-D-qKYU8I.js";const J=e=>{const{item:a}=t(e);return{iconName:l((()=>a.value.isDirectory?"folder":"text-x-preview")),titleDesc:l((()=>`Name: ${a.value.name}\nSize: ${j(a.value.size)}\nType: ${a.value.mimeType||"-"}\nLast Modified: ${O(a.value.lastModified,"YYYY-MM-DD HH:mm:ss")}\nCreated: ${O(a.value.birthtime,"YYYY-MM-DD HH:mm:ss")}\n`))}},X=["title"],Z={class:"list-col c-filename"},q=["checked"],ee={class:"list-col c-size"},te={class:"list-col c-time"},le={class:"list-col c-time"},ae=p(a({__name:"FileListItem",props:{item:{},active:{type:Boolean}},emits:["open","select"],setup(e,{emit:t}){const l=e,{iconName:a,titleDesc:p}=J(l);return(e,t)=>(i(),s("button",{class:r(["btn-no-style file-list-item file-list-row",{active:e.active,hidden:e.item.hidden}]),onClick:t[4]||(t[4]=o((t=>e.$emit("select",{item:e.item,event:t})),["stop"])),onKeyup:t[5]||(t[5]=m((t=>e.$emit("open",e.item)),["enter"])),onDblclick:t[6]||(t[6]=o((t=>e.$emit("open",e.item)),["stop"])),title:d(p)},[n("div",Z,[n("input",{class:"file-checkbox",type:"checkbox",checked:e.active,onClick:t[0]||(t[0]=o((t=>e.$emit("select",{item:e.item,event:t,toggle:!0})),["stop"])),onDblclick:t[1]||(t[1]=o((()=>{}),["stop"]))},null,40,q),n("span",{class:"text-overflow filename-text",onClick:t[2]||(t[2]=o((t=>e.$emit("open",e.item)),["stop"])),onDblclick:t[3]||(t[3]=o((()=>{}),["stop"]))},c(e.item.isDirectory?"📁":"📄")+" "+c(e.item.name),33)]),n("div",ee,c(d(j)(e.item.size)),1),n("div",te,c(d(O)(e.item.lastModified)),1),n("div",le,c(d(O)(e.item.birthtime)),1)],42,X))}}),[["__scopeId","data-v-f9d28868"]]),ie=["title"],se=["checked"],ne={class:"desktop-icon-image"},oe=p(a({__name:"FileGridItem",props:{item:{},active:{type:Boolean}},emits:["open","select"],setup(e,{emit:t}){const l=e,{iconName:a,titleDesc:p}=J(l);return(e,t)=>(i(),s("button",{class:r(["file-grid-item btn-no-style",{active:e.active,hidden:e.item.hidden}]),onClick:t[4]||(t[4]=o((t=>e.$emit("select",{item:e.item,event:t})),["stop"])),onKeyup:t[5]||(t[5]=m((t=>e.$emit("open",e.item)),["enter"])),onDblclick:t[6]||(t[6]=o((t=>e.$emit("open",e.item)),["stop"])),title:d(p)},[n("input",{class:"file-checkbox",type:"checkbox",checked:e.active,onClick:t[0]||(t[0]=o((t=>e.$emit("select",{item:e.item,event:t,toggle:!0})),["stop"])),onDblclick:t[1]||(t[1]=o((()=>{}),["stop"]))},null,40,se),n("span",ne,c(e.item.isDirectory?"📁":"📄"),1),n("span",{class:"desktop-icon-name",onClick:t[2]||(t[2]=o((t=>e.$emit("open",e.item)),["stop"])),onDblclick:t[3]||(t[3]=o((()=>{}),["stop"]))},c(e.item.name),33)],42,ie))}}),[["__scopeId","data-v-26e66db6"]]);var ce=(e=>(e.default="default",e.name="name",e.nameDesc="nameDesc",e.size="size",e.sizeDesc="sizeDesc",e.extension="extension",e.extensionDesc="extensionDesc",e.lastModified="lastModified",e.lastModifiedDesc="lastModifiedDesc",e.birthTime="birthTime",e.birthTimeDesc="birthTimeDesc",e))(ce||{});const de={default:(e,t)=>{const l=(e.isDirectory?1:2)-(t.isDirectory?1:2);return 0!==l?l:e.name.toLowerCase().localeCompare(t.name.toLowerCase())},name:(e,t)=>e.name.toLowerCase().localeCompare(t.name.toLowerCase()),nameDesc:(e,t)=>-e.name.toLowerCase().localeCompare(t.name.toLowerCase()),size:(e,t)=>(e.size||0)-(t.size||0),sizeDesc:(e,t)=>-((e.size||0)-(t.size||0)),extension:(e,t)=>e.ext.toLowerCase().localeCompare(t.ext.toLowerCase()),extensionDesc:(e,t)=>-e.ext.toLowerCase().localeCompare(t.ext.toLowerCase()),lastModified:(e,t)=>e.lastModified-t.lastModified,lastModifiedDesc:(e,t)=>-(e.lastModified-t.lastModified),birthTime:(e,t)=>e.birthtime-t.birthtime,birthTimeDesc:(e,t)=>-(e.birthtime-t.birthtime)},re=e=>(P("data-v-aed58de9"),e=e(),F(),e),me={class:"explorer-actions vp-panel"},pe={class:"action-group"},ue=[re((()=>n("span",{class:"mdi mdi-file-document-plus-outline"},null,-1)))],ve=[re((()=>n("span",{class:"mdi mdi-folder-plus-outline"},null,-1)))],be=re((()=>n("div",{class:"split-line"},null,-1))),he=["disabled"],fe=[re((()=>n("span",{class:"mdi mdi-content-cut"},null,-1)))],Ce=["disabled"],we=[re((()=>n("span",{class:"mdi mdi-content-copy"},null,-1)))],ye=["disabled"],ge=[re((()=>n("span",{class:"mdi mdi-content-paste"},null,-1)))],ke=["disabled"],xe=[re((()=>n("span",{class:"mdi mdi-rename"},null,-1)))],De=["disabled"],_e=[re((()=>n("span",{class:"mdi mdi-delete-forever-outline"},null,-1)))],Me=re((()=>n("div",{class:"split-line"},null,-1))),Le=[re((()=>n("span",{class:"mdi mdi-folder-open-outline"},null,-1)))],Se={class:"action-group"},Pe={key:0,class:"mdi mdi-view-grid-outline"},Fe={key:1,class:"mdi mdi-view-list-outline"},ze={class:"action-button-wrap"},$e=[re((()=>n("span",{class:"mdi mdi-sort-alphabetical-variant"},null,-1)))],Ie=[re((()=>n("span",{class:"mdi mdi-check-all"},null,-1)))],Re={key:0,class:"explorer-list-view"},Te=L('<div class="vp-bg file-list-header file-list-row" data-v-aed58de9><div class="list-col c-filename" style="padding-left:24px;" data-v-aed58de9>Name</div><div class="list-col c-size" data-v-aed58de9>Size</div><div class="list-col c-time" data-v-aed58de9>Last Modified</div><div class="list-col c-time" data-v-aed58de9>Created</div></div>',1),Ye={key:1,class:"explorer-grid-view"},je=p(a({__name:"FileList",props:{files:{},isLoading:{type:Boolean},basePath:{}},emits:["open","update:isLoading","refresh"],setup(e,{emit:a}){const c=a,r=e,{basePath:m,files:p}=t(r),L=b(r,"isLoading",c),{isGridView:P,showSortMenu:F,sortOptions:z,filteredFiles:$}=(e=>{const t=u(!1),a=u(ce.default);return{isGridView:t,showSortMenu:u(!1),sortOptions:l((()=>[{label:"Default",value:ce.default},{label:"Name ▲",value:ce.name},{label:"Name ▼",value:ce.nameDesc},{label:"Size ▲",value:ce.size},{label:"Size ▼",value:ce.sizeDesc},{label:"Extension ▲",value:ce.extension},{label:"Extension ▼",value:ce.extensionDesc},{label:"Last Modified ▲",value:ce.lastModified},{label:"Last Modified ▼",value:ce.lastModifiedDesc},{label:"Created Time ▲",value:ce.birthTime},{label:"Created Time ▼",value:ce.birthTimeDesc}].map((e=>({label:e.label,props:{class:a.value===e.value?"active":"",onClick:()=>{a.value=e.value}}}))))),filteredFiles:l((()=>e.value.sort(de[a.value])))}})(p),{selectedItems:I,selectedItemsSet:R,explorerContentRef:T,toggleSelect:Y,toggleSelectAll:j,selectedPaths:O}=H({filteredFiles:$,basePath:m}),{enablePaste:E,handleCut:K,handleCopy:W,handlePaste:G}=B({selectedPaths:O,basePath:m,isLoading:L,emit:c}),{handleCreateFile:Q,handleCreateFolder:J,handleRename:X,confirmDelete:Z,ctxMenuOptions:q,ctxMenuRef:ee,handleShowCtxMenu:te,enableAction:le}=(({isLoading:e,selectedPaths:t,basePath:a,selectedItems:i,enablePaste:s,handlePaste:n,handleCut:o,handleCopy:c,selectedItemsSet:d,emit:r})=>{const m=async()=>{try{const t=i.value[0],l=await window.$mcUtils.showInputPrompt({title:"Rename",value:t.name});e.value=!0,await V.renameEntry({fromPath:A(a.value+"/"+t.name),toPath:A(a.value+"/"+l)}),r("refresh")}finally{e.value=!1}},p=async()=>{try{e.value=!0,await V.deleteEntry({path:t.value})}finally{e.value=!1,r("refresh")}},b=()=>{window.$dialog.confirm("确认删除？此操作不可撤销","Confirm Delete",{type:"warning"}).then((()=>{p()})).catch()},h=l((()=>{if(!i.value.length)return[{label:"Refresh",props:{onClick:()=>r("refresh")}},{label:"Paste",props:{onClick:n},disabled:!s.value}];const e=1===i.value.length;return[e&&{label:"Open",props:{onClick:()=>r("open",i.value[0])}},{split:!0},{label:"Cut",props:{onClick:o}},{label:"Copy",props:{onClick:c}},{split:!0},e&&{label:"Rename",props:{onClick:m}},{label:"Delete",props:{onClick:b}}].filter(Boolean)})),f=u(),C=l((()=>i.value.length>0));return{handleCreateFile:async()=>{try{const t=await window.$mcUtils.showInputPrompt({title:"Create File",value:`file_${v(new Date).format("YYYYMMDD_HHmmss")}.txt`});e.value=!0,await V.createFile({path:A(a.value+"/"+t),file:""}),r("refresh")}finally{e.value=!1}},handleCreateFolder:async()=>{try{const t=await window.$mcUtils.showInputPrompt({title:"Create Folder",value:`folder_${v(new Date).format("YYYYMMDD_HHmmss")}`});e.value=!0,await V.createDir({path:A(a.value+"/"+t)}),r("refresh")}finally{e.value=!1}},handleRename:m,doDeleteSelected:p,confirmDelete:b,ctxMenuOptions:h,ctxMenuRef:f,handleShowCtxMenu:(e,t)=>{e?d.value.has(e)||(i.value=[e]):i.value=[],f.value.showMenu(t)},enableAction:C}})({isLoading:L,selectedPaths:O,basePath:m,selectedItems:I,enablePaste:E,handlePaste:G,handleCut:K,handleCopy:W,selectedItemsSet:R,emit:c}),{handleOpenLocalDir:ie,localDirHistoryOptions:se}=N({emit:c});return(e,t)=>{const l=S;return h((i(),s("div",{class:"explorer-list-wrap",onContextmenu:t[16]||(t[16]=o((()=>{}),["prevent"]))},[n("div",me,[n("div",pe,[n("button",{class:"btn-action btn-no-style",onClick:t[0]||(t[0]=e=>d(Q)()),title:"Create Document"},ue),n("button",{class:"btn-action btn-no-style",onClick:t[1]||(t[1]=(...e)=>d(J)&&d(J)(...e)),title:"Create Folder"},ve),be,n("button",{class:"btn-action btn-no-style",disabled:!d(le),onClick:t[2]||(t[2]=(...e)=>d(K)&&d(K)(...e)),title:"Cut"},fe,8,he),n("button",{class:"btn-action btn-no-style",disabled:!d(le),onClick:t[3]||(t[3]=(...e)=>d(W)&&d(W)(...e)),title:"Copy"},we,8,Ce),n("button",{class:"btn-action btn-no-style",disabled:!d(E),onClick:t[4]||(t[4]=(...e)=>d(G)&&d(G)(...e)),title:"Paste"},ge,8,ye),n("button",{class:"btn-action btn-no-style",disabled:1!==d(I).length,onClick:t[5]||(t[5]=(...e)=>d(X)&&d(X)(...e)),title:"Rename"},xe,8,ke),n("button",{class:"btn-action btn-no-style",disabled:!d(le),onClick:t[6]||(t[6]=(...e)=>d(Z)&&d(Z)(...e)),title:"Delete"},_e,8,De),Me,f(w,{options:d(se)},{default:C((()=>[n("button",{class:"btn-action btn-no-style",title:"Open Local Folder",onClick:t[7]||(t[7]=(...e)=>d(ie)&&d(ie)(...e))},Le)])),_:1},8,["options"])]),n("div",Se,[n("button",{onClick:t[8]||(t[8]=e=>P.value=!d(P)),class:"btn-action btn-no-style",title:"Toggle grid view"},[d(P)?(i(),s("span",Pe)):(i(),s("span",Fe))]),n("div",ze,[n("button",{class:"btn-action btn-no-style",title:"Toggle Sort",onClick:t[9]||(t[9]=e=>F.value=!0)},$e),f(k,{name:"fade-scale"},{default:C((()=>[f(y,{visible:d(F),"onUpdate:visible":t[10]||(t[10]=e=>g(F)?F.value=e:null),options:d(z)},null,8,["visible","options"])])),_:1})]),n("button",{class:"btn-action btn-no-style",onClick:t[11]||(t[11]=(...e)=>d(j)&&d(j)(...e)),title:"Toggle Select All"},Ie)])]),n("div",{ref_key:"explorerContentRef",ref:T,class:"explorer-content",onClick:t[14]||(t[14]=e=>I.value=[]),onContextmenu:t[15]||(t[15]=o((e=>d(te)(null,e)),["prevent","stop"]))},[d(P)?(i(),s("div",Ye,[(i(!0),s(x,null,D(d($),(e=>(i(),_(oe,{class:"selectable",item:e,key:e.name,"data-name":e.name,active:d(R).has(e),onOpen:t[13]||(t[13]=e=>c("open",e)),onSelect:d(Y),onContextmenu:o((t=>d(te)(e,t)),["prevent","stop"])},null,8,["item","data-name","active","onSelect","onContextmenu"])))),128))])):(i(),s("div",Re,[Te,(i(!0),s(x,null,D(d($),(e=>(i(),_(ae,{class:"selectable",item:e,key:e.name,"data-name":e.name,active:d(R).has(e),onOpen:t[12]||(t[12]=e=>c("open",e)),onSelect:d(Y),onContextmenu:o((t=>d(te)(e,t)),["prevent","stop"])},null,8,["item","data-name","active","onSelect","onContextmenu"])))),128))])),(i(),_(M,{to:"body"},[f(U,{options:d(q),ref_key:"ctxMenuRef",ref:ee},null,8,["options"])]))],544)],32)),[[l,d(L)]])}}}),[["__scopeId","data-v-aed58de9"]]),Oe={class:"explorer-wrap"},Ue={class:"explorer-header vp-panel"},He={class:"nav-address"},Be={class:"nav-wrap"},Ne=["disabled"],Ee=[n("span",{class:"mdi mdi-arrow-left"},null,-1)],Ve=["disabled"],Ae=[n("span",{class:"mdi mdi-arrow-right"},null,-1)],Ke=["disabled"],We=[n("span",{class:"mdi mdi-arrow-up"},null,-1)],Ge={class:"input-wrap"},Qe=[n("span",{class:"mdi mdi-refresh"},null,-1)],Je={key:0,class:"mdi mdi-star"},Xe={key:1,class:"mdi mdi-star-outline"},Ze={key:0,class:"star-list"},qe=["onClick","title","onContextmenu"],et={class:"explorer-content-wrap scrollbar-mini"},tt=a({__name:"index",setup(e){const{isLoading:t,filteredFiles:l,handleOpen:a,handleRefresh:r,basePathNormalized:m,starList:p,handleOpenPath:u,backHistory:v,goBack:b,forwardHistory:C,goForward:w,allowUp:y,goUp:k,basePath:_,toggleStar:M,isStared:L,filterText:S}=E({getListFn:async()=>await V.getList({path:_.value,isStat:!0}),openEntryFn:async({item:e,path:t})=>{if(console.log({item:e,path:t}),Number(e.size)>1048576)return void console.error("文件大于1MB，不支持预览");const l=await V.getFile({path:t});console.log(l)}});return z((()=>{r()})),(e,P)=>(i(),s("div",Oe,[n("div",Ue,[n("div",He,[n("div",Be,[n("button",{disabled:d(v).length<=1,class:"btn-action vp-button",onClick:P[0]||(P[0]=(...e)=>d(b)&&d(b)(...e)),title:"Back"},Ee,8,Ne),n("button",{disabled:d(C).length<=0,class:"btn-action vp-button",onClick:P[1]||(P[1]=(...e)=>d(w)&&d(w)(...e)),title:"Forward"},Ae,8,Ve),n("button",{class:"btn-action vp-button",disabled:!d(y),onClick:P[2]||(P[2]=(...e)=>d(k)&&d(k)(...e)),title:"Up"},We,8,Ke)]),n("div",Ge,[h(n("input",{placeholder:"Path","onUpdate:modelValue":P[3]||(P[3]=e=>g(_)?_.value=e:null),class:"input-addr vp-input",onChange:P[4]||(P[4]=(...e)=>d(r)&&d(r)(...e))},null,544),[[$,d(_)]]),n("button",{class:"vp-button btn-action",onClick:P[5]||(P[5]=(...e)=>d(r)&&d(r)(...e))},Qe),n("button",{class:"vp-button btn-action",onClick:P[6]||(P[6]=(...e)=>d(M)&&d(M)(...e))},[d(L)?(i(),s("span",Je)):(i(),s("span",Xe))]),h(n("input",{placeholder:"Filter name","onUpdate:modelValue":P[7]||(P[7]=e=>g(S)?S.value=e:null),class:"input-filter vp-input"},null,512),[[$,d(S)]])])]),d(p).length?(i(),s("div",Ze,[(i(!0),s(x,null,D(d(p),((e,t)=>(i(),s("div",{key:e},[n("button",{onClick:t=>d(u)(e),class:"vp-button",title:e,onContextmenu:o((()=>d(p).splice(t,1)),["prevent"])},c(d(K)(e)),41,qe)])))),128))])):I("",!0)]),n("div",et,[f(je,{"is-loading":d(t),"onUpdate:isLoading":P[8]||(P[8]=e=>g(t)?t.value=e:null),files:d(l),onOpen:d(a),onRefresh:d(r),"base-path":d(m)},null,8,["is-loading","files","onOpen","onRefresh","base-path"])])]))}}),lt=a({__name:"FileManagerWindow",props:{visible:{type:Boolean,default:!0}},emits:["update:visible"],setup(t,{emit:l}){const a=b(t,"visible",l);return(t,l)=>(i(),_(e,{ref:"iframeWinRef",class:"iframe-browser-vp-window",visible:d(a),"onUpdate:visible":l[0]||(l[0]=e=>g(a)?a.value=e:null),wid:"iframe_browser","allow-maximum":"","init-win-options":{width:"600px",height:"500px"}},{titleBarLeft:C((()=>[R("🗃️ "+c(t.$t("common.file_explorer")),1)])),default:C((()=>[d(a)?(i(),_(tt,{key:0})):I("",!0)])),_:1},8,["visible"]))}}),at={class:"dev-page scrollbar-mini"},it={class:"container"},st=p(a({__name:"DevPage",setup(e){const t=T({isShowFileManager:!1}),a=l((()=>[{label:"isShowFileManager",key:"isShowFileManager",store:t,type:G.SWITCH}]));return(e,l)=>{const o=Y("RouterLink");return i(),s("div",at,[f(Q,null,{extra:C((()=>[f(o,{to:{name:"CanUIDemoPage"}},{default:C((()=>[R("UI Demo")])),_:1})])),_:1}),n("div",it,[f(W,{style:{"max-width":"500px"},"option-list":d(a)},null,8,["option-list"])]),f(lt,{visible:d(t).isShowFileManager,"onUpdate:visible":l[0]||(l[0]=e=>d(t).isShowFileManager=e)},null,8,["visible"])])}}}),[["__scopeId","data-v-45c4e58e"]]);export{st as default};
