import{d as e,t as o,r as t,_ as n,e as s,k as l,aH as a,f as i,o as r,$ as c,I as d,u,R as p,P as m,N as w,s as h,aI as f,L as v,O as y,aJ as _,c as g,aK as b,A as C,G as S,at as x,an as L,M as k,U as E,Q as R,q as D,T as N,Z as T,g as X,p as O,aD as j,V as F,h as I,F as M,m as $,aL as A,aM as J,w as V}from"./index-BJklM7uy.js";/* empty css                   *//* empty css                    *//* empty css                    */import{D as P,u as B}from"./use-file-drop-FX8JCuIK.js";import{a as H}from"./use-beforeunload-cpGEAtLA.js";import{C as z}from"./CommonNavbar-BN_veBGg.js";import{R as K}from"./RectSwitch-Dpia0p_L.js";import{T as G}from"./TabLayout-r0pFeegw.js";import"./use-model-wrapper-Cm8bqa9M.js";const U=e({name:"FileChooser",props:{showInput:{type:Boolean,default:!1},multiple:{type:Boolean,default:!1},sizeLimit:{type:Number,default:2},accept:{type:String,default:null}},emits:["selected"],setup(e,{emit:n}){const{multiple:s,sizeLimit:l}=o(e),a=t();return{handleInputFileChange:async e=>{const o=a.value;if(!o)return;const t=Array.from(o.files||[]);o.value="",n("selected",s.value?t:t[0])},chooseFile:()=>{a.value.click()},fileInputRef:a}}}),Y={class:"file-chooser"},W=["accept","multiple"];const Z=n(U,[["render",function(e,o,t,n,c,d){return r(),s("div",Y,[l(i("input",{type:"file",ref:"fileInputRef",onChange:o[0]||(o[0]=(...o)=>e.handleInputFileChange&&e.handleInputFileChange(...o)),accept:e.accept,multiple:e.multiple},null,40,W),[[a,e.showInput]])])}]]),q=e=>new Promise(((o,t)=>{if(document.getElementById(e))o();else{const n=document.createElement("script");n.src=e,n.id=e,n.onload=function(){this.onerror=this.onload=null,o()},n.onerror=function(e){this.onerror=this.onload=null,t(e)},document.body.appendChild(n)}}));window.demo_aoa_to_sheet=[["Name","Value","Num","Time","âœ¨Tips"],["test001","line1\nline2",123,new Date,"You can set window.json_to_sheet = [] to generate table!"],["test001","line1\n\nline3",-1,new Date,"window.json_to_sheet"]],window.demo_json_to_sheet=[{region:"DE",product_name:"Test1",code:"123456",url:"http://localhost:8080",tips:"âœ¨ You can set window.demo_json_to_sheet = [] to generate table!"},{region:"FR",product_name:"Test2",code:"7890",url:"https://example.com",tips:"window.demo_json_to_sheet"}];const Q=e({name:"ExcelCopyTool",computed:{GlobalEvents:()=>S,globalEventBus:()=>C},components:{TabLayout:G,RectSwitch:K,DropdownMenu:c,CommonNavbar:z,FileChooser:Z,DropZone:P},setup(){const{t:e}=d(),o=u(),n=t(),s=t(),l=t(!1),a=p(null),i=p(),r=t([]),c=t(0);m(c,(()=>{E()}));const C=()=>{if(!l.value){const e="XLSX Not Ready!";throw window.$message.error(e),new Error(e)}},S=e=>(r.value=e.SheetNames,e.Sheets[r.value[c.value]]),E=()=>{const e=i.value;if(!e)return void(s.value.innerHTML="");console.log("[renderWorkbook]",e);const o=window.XLSX.utils.sheet_to_html(S(e));s.value.innerHTML=o},R=async e=>{if(a.value=null,C(),!/\.xlsx$/g.test(e.name))return void window.$message.error("Only supports reading xlsx format!");const o=new FileReader;i.value=null,o.onload=function(o){a.value=e;const t=o.target.result;c.value=0,i.value=window.XLSX.read(t,{type:"binary"}),E()},o.readAsBinaryString(e)},D=t(!0);w((async()=>{await(async()=>{if(window.XLSX)l.value=!0;else{try{await q("./lib/xlsx.mini.js")}catch(e){window.$message.error(e.message),console.error(e)}console.log("XLSX ready",window.XLSX),l.value=!0}})()}));const N=h(v.EXCEL_COPY_TOOL_COPY_MODE,f.HTML,localStorage,{listenToStorageChanges:!1}),T=({currentOnly:e=!1}={})=>{const o=e=>{const o=N.value;return o===f.DISABLED||o===f.TEXT?e:e.map((e=>{for(const t in e)"string"==typeof e[t]&&(e[t]=_(e[t],o));return e}))};if(!i.value){const e="Please open Excel file first!";throw window.$message.error(e),new Error(e)}if(e){const e=window.XLSX.utils.sheet_to_json(S(i.value));return o(e)}const t=i.value,n={};return t.SheetNames.forEach((function(e){const s=window.XLSX.utils.sheet_to_row_object_array(t.Sheets[e]);s.length>0&&(n[e]=o(s))})),n},X=async(e={})=>{var o;const t=T(e);let n=null==(o=a.value)?void 0:o.name;n&&(n=n.substring(0,n.lastIndexOf("."))),L(await k(n,"excel_sheet_export"),JSON.stringify(t,null,2),".json")};H((async()=>{await X()}));const O=[{label:"ðŸ§© Current Sheet",children:[{label:"ðŸ“¤ Export JSON",props:{onClick:async()=>{await X({currentOnly:!0})}}},{label:"ðŸ“‹ Copy JSON",props:{onClick:async()=>{const e=T({currentOnly:!0});await x(JSON.stringify(e,null,2)),window.$message.success("Sheet JSON Copied!")}}},{label:"ðŸ’» Print to Console",props:{onClick:async()=>{const e=T({currentOnly:!0});console.log(e),window.$message.success("Print to Console!")}}}]},{label:"ðŸ“— All Sheets",children:[{label:"ðŸ“¤ Export All JSON",props:{onClick:async()=>{await X()}}},{label:"ðŸ“‹ Copy All JSON",props:{onClick:async()=>{const e=T();await x(JSON.stringify(e,null,2)),window.$message.success("Sheet JSON Copied!")}}},{label:"ðŸ’» Print All to Console",props:{onClick:async()=>{const e=T();console.log(e),window.$message.success("Print to Console!")}}}]}],j=()=>{a.value=null,i.value=null,r.value=[],c.value=0,s.value.innerHTML=""};return y((()=>{j()})),{sheetNames:r,sheetNameIndex:c,handleImport:R,importFileChooserRef:n,loadDemo:()=>{C();const e=window.XLSX.utils.aoa_to_sheet(window.demo_aoa_to_sheet),o=window.XLSX.utils.json_to_sheet(window.demo_json_to_sheet),t=window.XLSX.utils.book_new();window.XLSX.utils.book_append_sheet(t,e,"aoa_to_sheet"),window.XLSX.utils.book_append_sheet(t,o,"json_to_sheet"),c.value=0,i.value=t,E()},tableWrapperElRef:s,handleClick:o=>{let t=o.target;if(!(e=>"td"===e.tagName.toLowerCase())(t)||!N.value||N.value===f.DISABLED)return;if(!t.innerText)return;let n=t.innerText;console.log(N.value);let s="";n=o.ctrlKey&&o.altKey?_(n,s=f.JSON):o.ctrlKey?_(n,s=f.TEXT):o.altKey?_(n,s=f.HTML):_(n,s=N.value),x(n),window.$message.success(s+" "+e("msgs.copy_success"));const l=document.createRange();l.selectNode(t);const a=window.getSelection();a&&(a.removeAllRanges(),a.addRange(l))},copyMode:N,modTextConvertOptions:g((()=>[{label:"Disabled",value:f.DISABLED},...b])),dropdownMenuOptions:O,textConvertMultipleLine:_,...B({cbFiles:e=>{e.length&&R(e[0])}}),isTrimEmptyLines:D,mainStore:o,isReady:l,workbookRef:i,fileRef:a,handleCloseFile:j}}}),ee={class:"flex-row-center-gap"},oe={class:"flex-row-center-gap"},te={class:"vp-button"},ne=["disabled"],se=["disabled"],le={key:0,class:"sheet-name-card vp-panel"};const ae=n(Q,[["render",function(e,o,t,n,c,d){const u=D("DropZone"),p=j,m=D("RectSwitch"),w=D("DropdownMenu"),h=D("CommonNavbar"),f=A,v=J,y=D("FileChooser"),_=T;return r(),s("div",{class:"excel-copy-tool",onDragover:o[8]||(o[8]=V(((...o)=>e.fileDragover&&e.fileDragover(...o)),["prevent","stop"])),onDragleave:o[9]||(o[9]=V((o=>e.showDropzone=!1),["prevent","stop"])),onDrop:o[10]||(o[10]=V(((...o)=>e.fileDrop&&e.fileDrop(...o)),["prevent","stop"]))},[E(N,{name:"mc-fade"},{default:R((()=>[l(E(u,{"position-fixed":"",text:"Drop Excel file here"},null,512),[[a,e.showDropzone]])])),_:1}),l((r(),s("div",null,[E(h,null,{extra:R((()=>[i("div",ee,[i("div",oe,[E(p,{size:"small",modelValue:e.isTrimEmptyLines,"onUpdate:modelValue":o[0]||(o[0]=o=>e.isTrimEmptyLines=o)},{default:R((()=>[F(I(e.$t("msgs.trim_empty_lines")),1)])),_:1},8,["modelValue"]),i("a",{onClick:o[1]||(o[1]=o=>e.globalEventBus.emit(e.GlobalEvents.OPEN_TEXT_TRANSFORMER))},I(e.$t("common.text_transformer"))+": ",1),E(m,{size:"small",modelValue:e.copyMode,"onUpdate:modelValue":o[2]||(o[2]=o=>e.copyMode=o),options:e.modTextConvertOptions},null,8,["modelValue","options"])]),e.workbookRef?(r(),O(w,{key:0,options:e.dropdownMenuOptions,disabled:!e.isReady},{default:R((()=>[i("button",te,[o[11]||(o[11]=i("span",{class:"mdi mdi-download"},null,-1)),F(" "+I(e.$t("actions.export")),1)])])),_:1},8,["options","disabled"])):X("",!0),e.fileRef?(r(),s("button",{key:2,class:"vp-button primary",onClick:o[4]||(o[4]=(...o)=>e.handleCloseFile&&e.handleCloseFile(...o))},I(e.$t("actions.close")),1)):(r(),s("button",{key:1,disabled:!e.isReady,onClick:o[3]||(o[3]=o=>e.importFileChooserRef.chooseFile()),class:"vp-button primary"},I(e.$t("actions.open")+" Excel"),9,ne)),e.fileRef?X("",!0):(r(),s("button",{key:3,onClick:o[5]||(o[5]=(...o)=>e.loadDemo&&e.loadDemo(...o)),class:"vp-button",disabled:!e.isReady},I(e.$t("common.demo")),9,se))])])),_:1}),e.isReady&&e.sheetNames.length?(r(),s("div",le,[E(v,{modelValue:e.sheetNameIndex,"onUpdate:modelValue":o[6]||(o[6]=o=>e.sheetNameIndex=o),type:"card"},{default:R((()=>[(r(!0),s(M,null,$(e.sheetNames,((e,o)=>(r(),O(f,{key:o,label:e,name:o},null,8,["label","name"])))),128))])),_:1},8,["modelValue"])])):X("",!0)])),[[_,!e.isReady]]),i("div",{ref:"tableWrapperElRef",class:"excel-table-container vp-panel",onClick:o[7]||(o[7]=(...o)=>e.handleClick&&e.handleClick(...o))},null,512),E(y,{ref:"importFileChooserRef",accept:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",onSelected:e.handleImport},null,8,["onSelected"])],32)}]]);export{ae as default};
