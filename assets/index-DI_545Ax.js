import{c8 as e,q as l,ap as t,K as a,a5 as s,d as o,t as n,r as i,I as u,as as r,at as c,al as p,au as d,ad as m,c as v,o as f,b as y,e as g,n as b,F as h,D as w,S as C,c9 as x,x as _,p as S,g as k,O as j,L as $,P as A,f as R,h as V,w as I,T as L,k as E,aA as T,V as U,W as B,N as M,ca as P}from"./index-D7imv_Md.js";import{k as N,l as O}from"./index.vue_vue_type_style_index_0_lang-cU_mVrg2.js";import{V as K}from"./index-ChBI-IfP.js";import{T as F}from"./TabLayout-CsB4Yfbx.js";import{V as q,m as G}from"./index-CP_TvyA7.js";import{u as z}from"./use-remote-options-BfsfSPcO.js";import{m as J}from"./CraftPage-C-fJ6KCv.js";/* empty css                  *//* empty css                        *//* empty css                    */import"./index-BR_HEkHY.js";import"./index.vue_vue_type_style_index_0_lang-DEuY5zHr.js";import"./set-CT1JW_BL.js";import"./use-beforeunload-walRddPp.js";import"./humanfs-api-Dvdi9RO8.js";import"./index-vcidOvW8.js";import"./use-model-wrapper-B0P8Zqss.js";import"./QuickContextMenu.vue_vue_type_script_setup_true_lang-BpOU60Dx.js";/* empty css                      */import"./use-local-dir-CBTdfN0o.js";import"./file-history-CLLvp5b9.js";import"./useIDBKeyval-BIf4fra4.js";/* empty css                   */const D=o({__name:"ElementByPoint",props:{parentClass:{default:void 0}},emits:["select"],setup(e,{emit:l}){const t=e,{parentClass:a}=n(t),s=l,o=i(null);u((()=>{a.value&&(o.value=document.querySelector(a.value))}));const{x:w,y:C}=r({type:"client"}),{element:x}=c({x:w,y:C}),_=p(d(x));m("scroll",_.update,!0);const S=v((()=>!(o.value&&!o.value.contains(x.value)||o.value===x.value))),k=v((()=>x.value&&S.value?{display:"block",width:`${_.width}px`,height:`${_.height}px`,left:`${_.left}px`,top:`${_.top}px`,transition:"all 0.05s linear"}:{display:"none"})),j=v((()=>({transform:`translate(calc(${w.value}px - 50%), calc(${C.value}px - 50%))`,color:S.value?"white":"grey"})));return m("click",(e=>{S.value&&(e.stopPropagation(),e.preventDefault(),s("select",x.value))}),{capture:!0}),(e,l)=>(f(),y(h,null,[g("div",{style:b(k.value),class:"mc-element-by-point-box"},null,4),g("div",{style:b(j.value),class:"mc-element-by-point-pointer"},null,4)],64))}}),Y=g("i",{class:"fa fa-paint-brush","aria-hidden":"true"},null,-1),H=["title"],Q=[g("i",{class:"fa fa-mouse-pointer","aria-hidden":"true"},null,-1)],W=["title"],X=[g("i",{class:"fa fa-list","aria-hidden":"true"},null,-1)],Z=["title"],ee=[g("i",{class:"fa fa-css3","aria-hidden":"true"},null,-1)],le=["title"],te=[g("i",{class:"fa fa-files-o","aria-hidden":"true"},null,-1)],ae={class:"style-editor-inner"},se={key:0,class:"style-editor-action-bar"},oe={class:"code-editor-placeholder"},ne=o({__name:"index",props:{visible:{type:Boolean,default:!1},selecting:{type:Boolean,default:!1},selectingParentClass:{default:void 0},showTabs:{type:Boolean,default:!1},styleCode:{default:""}},emits:["update:visible","update:selecting","onFormat","onInsertCode","update:styleCode"],setup(o,{expose:r,emit:c}){const p=o,{showTabs:d}=n(p),b=c,{t:ne}=w(),ie=C(p,"visible",b),ue=e(),{globalStyleCode:re}=(()=>{const o=e(),n=l(t.GLOBAL_STYLE,"");a(n,(e=>{i()}));const i=async()=>{try{o.globalCSS=n.value?await s(n.value):""}catch(e){window.$message.error(e.message)}};return{globalStyleCode:n}})(),ce=l(t.VARIABLES_STYLE,""),pe=C(p,"styleCode",b,{passive:!0});a(pe,(()=>{he()}));const de=i(),me=i(!1),ve=()=>{const e=de.value.getInstance();null==e||e.layout()},fe=()=>{me.value||setTimeout((()=>{de.value.getInstance().focus()}),100)};a(ie,(e=>{e&&(ve(),fe())})),a(me,(e=>{e||fe()}));const ye=i(),ge=()=>{console.warn(ye.value.message,{...ye.value}),setTimeout((()=>{ye.value=null}),500)},be=i(""),he=async(e=!1)=>{try{const l=ce.value+"\n"+pe.value;if(be.value===l&&!e)return;be.value=l;const t=l?await s(l):"";ue.currentCSS=t,ye.value=""}catch(l){ye.value=l}};a(ce,(()=>{he()}),{immediate:!0}),N("PlaygroundPageStyleSync",(()=>{he(!0)}));const we=async()=>{var e;const l=de.value.getInstance(),t=l.getValue();if(t.trim()){const a=O(t);if(t.trim()!==a.trim()){const t=null==(e=l.getModel())?void 0:e.getFullModelRange();t?l.executeEdits(null,[{text:a,range:t}]):pe.value=a}}l.focus(),b("onFormat")},Ce=()=>{const e=de.value.getInstance().getValue();window.$qlUtils.copy(e)},xe=C(p,"selecting",b,{passive:!0}),_e=e=>{xe.value&&(Se({el:e}),xe.value=!1)},Se=({el:e,code:l="",isAppend:t=!1})=>{M((()=>{if(e){let t=P(e);if(!t)return;l=`\n${t} {\n\n}\n`}l&&ke(l,t)}))},ke=(e,l=!1)=>{if(b("onInsertCode"),l)return void(pe.value=pe.value+"\n"+e);const t=de.value.getInstance(),a=t.getSelection();t.executeEdits("",[{range:new G.Range((null==a?void 0:a.startLineNumber)||0,(null==a?void 0:a.startColumn)||0,(null==a?void 0:a.endLineNumber)||0,(null==a?void 0:a.endColumn)||0),text:e,forceMoveMarkers:!0}]),setTimeout((()=>{t.focus()}),100)},{snippetsOptions:je,updateEditorAutoComplete:$e}=(({insertCode:e,vueMonacoRef:a})=>{const s=l(t.CUSTOM_SNIPPETS,[]),o=()=>{J.$monacoScssSnippetsCustom=[],i(s.value)};u((()=>{o()}));const n=(l,t)=>{const a={label:l.label,props:{}};if(l.code||l.snippet){t&&t(l);const s=l.snippet||l.code;a.props.onClick=async()=>{e(s)},a.props.onContextmenu=async()=>{window.$qlUtils.copy(s)}}return a},i=(e=[],l=[])=>(e.forEach((e=>{l.push({children:e.children?r(e.children):void 0,...n(e,(e=>{e.snippet&&J.$monacoScssSnippetsCustom.push({label:e.label,snippet:e.snippet})}))})})),l),r=(e=[],l=[])=>(e.forEach((e=>{l.push({children:e.children?r(e.children):void 0,...n(e)})})),l),{options:c}=z({fetchFn:async()=>{const e=await fetch("./scss-snippets.json");return await e.json()},mapFn:e=>n(e,(e=>{e.snippet&&J.$monacoScssSnippets.push({label:e.label,snippet:e.snippet})}))});return{snippetsOptions:v((()=>{const e=[...c.value,{label:"⚙️ Manage",children:[{label:"➕ Add custom snippet",props:{onClick:async()=>{const e=a.value.getInstance(),l=e.getSelection();let t=e.getModel().getValueInRange(l).trim();if(!t)return void window.$message.error("Please select code first!");let n=/\.(\w|-)+/g.exec(t)||[];console.log(n);let i=await window.$mcUtils.showInputPrompt({title:"Input snippet label",value:n[0]||""});i?(s.value.push({label:i,snippet:t}),o()):window.$message.error("Please input label!")}}},{label:"📥 Import JSON...",props:{onClick:async()=>{const e=await window.$mcUtils.handleImportJson();s.value=e||[],window.$message.success("Import success!")}}},{label:"📤 Export JSON...",props:{onClick:async()=>{window.$mcUtils.handleExportFile(await window.$mcUtils.promptGetFileName("ScssSnippets"),JSON.stringify(s.value,null,2),".json")}}},{label:"❌ Clear All...",children:[{label:"✅ Confirm Clear All Custom Snippets",props:{onClick:()=>{s.value=[],o()}}},{label:"❎ Cancel",props:{isBack:1}}]}]}];return s.value.length&&e.push({label:"🔮 Custom",children:[...r(s.value)]}),e})),updateEditorAutoComplete:e=>{const l=new Set;let t,a=/\.(\w|-)+/g,s=/\$[\w-]+/g;for(;null!==(t=a.exec(e));)l.add(t[0]);for(;null!==(t=s.exec(e));)l.add(t[0]);J.$monacoScssVariables=Array.from(l)}}})({insertCode:ke,vueMonacoRef:de}),Ae=i([{label:ne("common.global_style"),value:x.GLOBAL},{label:ne("common.variables"),value:x.VARIABLES},{label:ne("actions.current"),value:x.CURRENT}]),Re=l(t.CURRENT_TAB,x.CURRENT,localStorage,{listenToStorageChanges:!1});a(d,(e=>{e||(Re.value=x.GLOBAL)}),{immediate:!0}),a((()=>Re),(e=>{$e(re.value+ce.value)}),{immediate:!0});const Ve=e=>{const l=e.key.toLowerCase();e.ctrlKey&&e.shiftKey&&"f"===l&&we()};return m(document,"keydown",(e=>{if(!ie.value)return;const l=e.key.toLowerCase();e.ctrlKey&&e.shiftKey&&"x"===l?xe.value=!xe.value:e.altKey&&"`"===l&&(me.value=!me.value)})),r({handleAddStyle:Se}),(e,l)=>(f(),y(h,null,[_(xe)?(f(),S(D,{key:0,onSelect:_e,"parent-class":_(Re)===_(x).CURRENT?e.selectingParentClass:void 0},null,8,["parent-class"])):k("",!0),j(K,{class:"mc-style-editor-dialog",visible:_(ie),"onUpdate:visible":l[7]||(l[7]=e=>B(ie)?ie.value=e:null),onResize:ve,wid:"style_editor",onKeyup:Ve,onOnActive:fe,"allow-maximum":"","init-win-options":{width:"400px",height:"500px"}},{titleBarLeft:$((()=>[Y,A(" "+R(_(ne)("common.style_editor"))+" (scss) ",1)])),titleBarRightControls:$((()=>[g("button",{title:_(ne)("msgs.select_an_element_in")+" (ctrl+shift+x)",class:V({active:_(xe)}),onClick:l[0]||(l[0]=I((e=>xe.value=!_(xe)),["stop","prevent"]))},Q,10,H),g("button",{onClick:l[1]||(l[1]=e=>me.value=!_(me)),title:_(ne)("actions.add_tool_codes")},X,8,W),g("button",{title:_(ne)("actions.beautify_code")+" (ctrl+shift+f)",onClick:we},ee,8,Z),g("button",{title:_(ne)("actions.copy_code")+" (ctrl+a ctrl+c)",onClick:Ce},te,8,le)])),default:$((()=>[j(L,{name:"mc-fade"},{default:$((()=>{var e;return[E(g("div",{class:"code-mc-error-tip-button font-code",onClick:ge},R(null==(e=_(ye))?void 0:e.message),513),[[T,_(ye)]])]})),_:1}),g("div",ae,[j(U,{visible:_(me),"onUpdate:visible":l[2]||(l[2]=e=>B(me)?me.value=e:null),options:_(je),title:`${_(ne)("actions.add_tool_codes")} (alt+\`)`,class:"font-code",style:{top:"2px",right:"2px",position:"absolute","z-index":"999"}},null,8,["visible","options","title"]),_(d)?(f(),y("div",se,[j(F,{modelValue:_(Re),"onUpdate:modelValue":l[3]||(l[3]=e=>B(Re)?Re.value=e:null),options:_(Ae),horizontal:""},null,8,["modelValue","options"])])):k("",!0),g("div",oe,[_(Re)===_(x).GLOBAL?(f(),S(q,{key:0,ref_key:"vueMonacoRef",ref:de,modelValue:_(re),"onUpdate:modelValue":l[4]||(l[4]=e=>B(re)?re.value=e:null),language:"scss","debounce-ms":500,"show-line-numbers":""},null,8,["modelValue"])):_(Re)===_(x).VARIABLES?(f(),S(q,{key:1,ref_key:"vueMonacoRef",ref:de,modelValue:_(ce),"onUpdate:modelValue":l[5]||(l[5]=e=>B(ce)?ce.value=e:null),language:"scss","debounce-ms":500,"show-line-numbers":""},null,8,["modelValue"])):(f(),S(q,{key:2,ref_key:"vueMonacoRef",ref:de,modelValue:_(pe),"onUpdate:modelValue":l[6]||(l[6]=e=>B(pe)?pe.value=e:null),language:"scss","debounce-ms":500,"show-line-numbers":""},null,8,["modelValue"]))])])])),_:1},8,["visible"])],64))}});export{ne as default};
