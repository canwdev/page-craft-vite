import{d as e,o as t,c as l,a as s,r as n,E as a,e as o,y as i,p as r,a5 as c,z as h,R as u,w as d,s as v,x as p,ak as m}from"./index-B89s4h30.js";import{n as g,t as f,f as _,s as w}from"./humanfs-api-DpvoJ6Sz.js";import{Q as x}from"./index-CId89Rxb.js";import{u as y}from"./file-history-CcD9OJCy.js";const b={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 20 20"},S=[s("g",{fill:"none"},[s("path",{d:"M9.159 16.367a.5.5 0 1 0 .674-.739l-6.168-5.63h13.831a.5.5 0 0 0 0-1H3.668l6.165-5.629a.5.5 0 0 0-.674-.738L2.243 8.945a.746.746 0 0 0-.24.631a.746.746 0 0 0 .24.477l6.916 6.314z",fill:"currentColor"})],-1)],E=e({name:"ArrowLeft20Regular",render:function(e,s){return t(),l("svg",b,S)}}),A={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 20 20"},L=[s("g",{fill:"none"},[s("path",{d:"M10.837 2.63a.5.5 0 0 0-.674.74L16.33 9H2.5a.5.5 0 0 0 0 1h13.828l-6.165 5.628a.5.5 0 0 0 .674.739l6.916-6.314a.747.747 0 0 0 0-1.108L10.837 2.63z",fill:"currentColor"})],-1)],M=e({name:"ArrowRight20Regular",render:function(e,s){return t(),l("svg",A,L)}}),k={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 16 16"},C=[s("g",{fill:"none"},[s("path",{d:"M8.854 10.854l-3 3a.5.5 0 0 1-.708 0l-3-3a.5.5 0 0 1 .708-.708L5 12.293V2.5a.5.5 0 0 1 1 0v9.793l2.146-2.147a.5.5 0 0 1 .708.708zM8.5 3a.5.5 0 0 0 0 1h5a.5.5 0 0 0 0-1h-5zm0 2a.5.5 0 0 0 0 1h3a.5.5 0 0 0 0-1h-3zm0 2a.5.5 0 0 0 0 1h1a.5.5 0 0 0 0-1h-1z",fill:"currentColor"})],-1)],R=e({name:"ArrowSortDownLines16Regular",render:function(e,s){return t(),l("svg",k,C)}}),T={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 20 20"},z=[s("g",{fill:"none"},[s("path",{d:"M9.885 3.75a6.25 6.25 0 0 0-3.628 11.256a.75.75 0 0 1-.9 1.2a7.75 7.75 0 0 1 3.99-13.93l-.584-.586A.75.75 0 0 1 9.823.63l2.122 2.121a.75.75 0 0 1 0 1.06L9.823 5.934a.75.75 0 0 1-1.06-1.06L9.885 3.75zm.23 12.498a6.25 6.25 0 0 0 3.628-11.256a.75.75 0 0 1 .9-1.2a7.75 7.75 0 0 1-3.99 13.93l.584.585a.75.75 0 1 1-1.06 1.061l-2.122-2.121a.75.75 0 0 1 0-1.06l2.122-2.122a.75.75 0 1 1 1.06 1.06l-1.122 1.123z",fill:"currentColor"})],-1)],H=e({name:"ArrowSync20Filled",render:function(e,s){return t(),l("svg",T,z)}}),P={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 20 20"},B=[s("g",{fill:"none"},[s("path",{d:"M3.132 9.16a.5.5 0 1 0 .738.675l5.631-6.168v13.831a.5.5 0 1 0 1 0V3.67l5.628 6.165a.5.5 0 1 0 .739-.674l-6.314-6.916a.746.746 0 0 0-.632-.24a.746.746 0 0 0-.476.24L3.132 9.16z",fill:"currentColor"})],-1)],D=e({name:"ArrowUp20Regular",render:function(e,s){return t(),l("svg",P,B)}}),V={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 20 20"},F=[s("g",{fill:"none"},[s("path",{d:"M5.92 2.228a.5.5 0 0 0-.84.544L9.405 9.43L7.48 12.39a3 3 0 1 0 .779.636L10 10.348l1.74 2.68a3 3 0 1 0 .779-.636L5.92 2.227zM14 17a2 2 0 1 1 0-4a2 2 0 0 1 0 4zM4 15a2 2 0 1 1 4 0a2 2 0 0 1-4 0zm7.192-6.489l-.596-.918l3.485-5.365a.5.5 0 0 1 .838.544l-3.727 5.74z",fill:"currentColor"})],-1)],j=e({name:"Cut20Regular",render:function(e,s){return t(),l("svg",V,F)}}),O={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 16 16"},K=[s("g",{fill:"none"},[s("path",{d:"M6.5 7v4a.5.5 0 0 0 1 0V7a.5.5 0 0 0-1 0zM9 6.5a.5.5 0 0 1 .5.5v4a.5.5 0 0 1-1 0V7a.5.5 0 0 1 .5-.5zM10 4h3a.5.5 0 0 1 0 1h-.553l-.752 6.776A2.5 2.5 0 0 1 9.21 14H6.79a2.5 2.5 0 0 1-2.485-2.224L3.552 5H3a.5.5 0 0 1 0-1h3a2 2 0 1 1 4 0zM8 3a1 1 0 0 0-1 1h2a1 1 0 0 0-1-1zM4.559 5l.74 6.666A1.5 1.5 0 0 0 6.79 13h2.42a1.5 1.5 0 0 0 1.49-1.334L11.442 5H4.56z",fill:"currentColor"})],-1)],q=e({name:"Delete16Regular",render:function(e,s){return t(),l("svg",O,K)}}),W={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 16 16"},$=[s("g",{fill:"none"},[s("path",{d:"M2 5v6a2 2 0 0 0 2 2h8a2 2 0 0 0 2-2V6a2 2 0 0 0-2-2H7.175l-1.113-.89A.5.5 0 0 0 5.75 3H4a2 2 0 0 0-2 2zm1 0a1 1 0 0 1 1-1h1.575l.868.694l-.886.806H3V5zm4.593 0H12a1 1 0 0 1 1 1v5a1 1 0 0 1-1 1H4a1 1 0 0 1-1-1V6.5h2.75a.5.5 0 0 0 .336-.13L7.593 5z",fill:"currentColor"})],-1)],I=e({name:"Folder16Regular",render:function(e,s){return t(),l("svg",W,$)}}),U={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 16 16"},X=[s("g",{fill:"none"},[s("path",{d:"M2 4v6a2 2 0 0 0 2 2h1.207a5.48 5.48 0 0 1-.185-1H4a1 1 0 0 1-1-1V5.5h2.75a.5.5 0 0 0 .336-.13L7.593 4H12a1 1 0 0 1 1 1v.6c.358.183.693.404 1 .657V5a2 2 0 0 0-2-2H7.175l-1.113-.89A.5.5 0 0 0 5.75 2H4a2 2 0 0 0-2 2zm1 0a1 1 0 0 1 1-1h1.575l.868.695l-.886.805H3V4zm7.5 11a4.5 4.5 0 1 0 0-9a4.5 4.5 0 0 0 0 9zm0-7a.5.5 0 0 1 .5.5V10h1.5a.5.5 0 0 1 0 1H11v1.5a.5.5 0 0 1-1 0V11H8.5a.5.5 0 0 1 0-1H10V8.5a.5.5 0 0 1 .5-.5z",fill:"currentColor"})],-1)],Y=e({name:"FolderAdd16Regular",render:function(e,s){return t(),l("svg",U,X)}}),N={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 16 16"},Q=[s("g",{fill:"none"},[s("path",{d:"M6.5 2a.5.5 0 0 0 0 1h1v10h-1a.5.5 0 0 0 0 1h3a.5.5 0 0 0 0-1h-1V3h1a.5.5 0 0 0 0-1h-3zM4 4h2.5v1H4a1 1 0 0 0-1 1v3.997a1 1 0 0 0 1 1h2.5v1H4a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2zm8 6.997H9.5v1H12a2 2 0 0 0 2-2V6a2 2 0 0 0-2-2H9.5v1H12a1 1 0 0 1 1 1v3.997a1 1 0 0 1-1 1z",fill:"currentColor"})],-1)],G=e({name:"Rename16Regular",render:function(e,s){return t(),l("svg",N,Q)}}),J={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 24 24"},Z=[s("g",{fill:"none"},[s("path",{d:"M20.496 5.627A2.25 2.25 0 0 1 22 7.75v10A4.25 4.25 0 0 1 17.75 22h-10a2.25 2.25 0 0 1-2.123-1.504l2.097.004H17.75a2.75 2.75 0 0 0 2.75-2.75v-10l-.004-.051V5.627zM17.246 2a2.25 2.25 0 0 1 2.25 2.25v12.997a2.25 2.25 0 0 1-2.25 2.25H4.25A2.25 2.25 0 0 1 2 17.247V4.25A2.25 2.25 0 0 1 4.25 2h12.997zm0 1.5H4.25a.75.75 0 0 0-.75.75v12.997c0 .414.336.75.75.75h12.997a.75.75 0 0 0 .75-.75V4.25a.75.75 0 0 0-.75-.75zm-7.665 7.858L13.47 7.47a.75.75 0 0 1 1.133.976l-.073.084l-4.5 4.5a.75.75 0 0 1-1.056.004L8.9 12.95l-1.5-2a.75.75 0 0 1 1.127-.984l.073.084l.981 1.308L13.47 7.47L9.58 11.358z",fill:"currentColor"})],-1)],ee=e({name:"SelectAllOn24Regular",render:function(e,s){return t(),l("svg",J,Z)}}),te={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 20 20"},le=[s("g",{fill:"none"},[s("path",{d:"M9.104 2.9a1 1 0 0 1 1.794 0l1.93 3.91l4.317.628a1 1 0 0 1 .554 1.706l-3.124 3.044l.738 4.3a1 1 0 0 1-1.451 1.054l-3.86-2.03l-3.862 2.03a1 1 0 0 1-1.45-1.055l.737-4.299l-3.124-3.044a1 1 0 0 1 .554-1.706l4.317-.627l1.93-3.912z",fill:"currentColor"})],-1)],se=e({name:"Star20Filled",render:function(e,s){return t(),l("svg",te,le)}}),ne={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 20 20"},ae=[s("g",{fill:"none"},[s("path",{d:"M9.104 2.9a1 1 0 0 1 1.794 0l1.93 3.91l4.317.628a1 1 0 0 1 .554 1.706l-3.124 3.044l.738 4.3a1 1 0 0 1-1.451 1.054l-3.86-2.03l-3.862 2.03a1 1 0 0 1-1.45-1.055l.737-4.299l-3.124-3.044a1 1 0 0 1 .554-1.706l4.317-.627l1.93-3.912zm.897.442l-1.93 3.911a1 1 0 0 1-.753.547L3 8.428l3.124 3.044a1 1 0 0 1 .287.885l-.737 4.3l3.86-2.03a1 1 0 0 1 .931 0l3.861 2.03l-.737-4.3a1 1 0 0 1 .287-.885l3.124-3.044l-4.317-.628a1 1 0 0 1-.752-.547l-1.93-3.911z",fill:"currentColor"})],-1)],oe=e({name:"Star20Regular",render:function(e,s){return t(),l("svg",ne,ae)}}),ie=({getListFn:e,openEntryFn:t})=>{const l=n([]),s=a("mc_explorer_base_path","/",localStorage,{listenToStorageChanges:!1}),i=o((()=>{let e=g(s.value);return/\/$/gi.test(e)||(e+="/"),e})),r=n(!1),c=async()=>{try{s.value=i.value,r.value=!0,s.value||(s.value="/"),l.value=await e()}catch(t){console.error(t),l.value=[]}finally{r.value=!1}},h=n([]),u=n([]),d=(e,t=i.value)=>{const l=e[e.length-1];(!l||l&&l!==t)&&e.push(t)},v=o((()=>{const e=s.value.split("/").filter((e=>!!e));return p.value?e.length>0:e.length>1})),p=o((()=>/^\//g.test(s.value))),m=async(e,t=!0)=>{s.value=e,x.value="",await c(),t&&d(h.value)},_=a("mc_explorer_component_dir_star_list",[]),w=o((()=>_.value.includes(i.value))),x=n(""),y=o((()=>{const e=x.value.toLowerCase();return l.value.filter((t=>t.name.toLowerCase().includes(e)))}));return{isLoading:r,filteredFiles:y,handleOpen:async e=>{const l=g(s.value+"/"+e.name);e.isDirectory?await m(l):await t({item:e,path:l})},handleRefresh:c,basePathNormalized:i,starList:_,handleOpenPath:m,backHistory:h,goBack:async()=>{const e=h.value[h.value.length-2];e&&(h.value.pop(),d(u.value),await m(e,!1))},forwardHistory:u,goForward:async()=>{const e=u.value.pop();e&&(d(h.value,e),await m(e,!1))},allowUp:v,goUp:async()=>{const e=s.value.split("/").filter((e=>!!e));if(e.pop(),!e.length&&!p.value)return void(await c());let t=e.join("/")+"/";p.value&&(t="/"+t),await m(t)},basePath:s,toggleStar:()=>{_.value=f([..._.value],i.value)},isStared:w,filterText:x}},re=(e={})=>{const{getExtraSize:t}=e,l=n(!1),s=n(0),a=n(0),r=n(0),c=n(0),h=n(),u=()=>{setTimeout((()=>{if(!h.value||!h.value.quickRootRef)return;let e=h.value.quickRootRef.offsetWidth,l=h.value.quickRootRef.offsetHeight;if(t){const{width:s,height:n}=t();e+=s,l+=n}r.value=e,c.value=l}),10)};i(l,(e=>{e&&u()}));const d=o((()=>{let e=s.value,t=a.value;const l=window.innerWidth,n=window.innerHeight,o=l-(e+r.value);o<0&&(e+=o),e<s.value&&(e=s.value-r.value);const i=n-(t+c.value);return i<0&&(t+=i),t<a.value&&(t=a.value-c.value),{position:"fixed",left:e+"px",top:t+"px",transform:"none"}}));return{isShow:l,ctxMenuStyle:d,xRef:s,yRef:a,menuWidth:r,menuHeight:c,menuRef:h,updateCardSize:u,showMenu:e=>{s.value=e.clientX,a.value=e.clientY,e.preventDefault(),l.value=!0},showMenuByPoint:(e,t)=>{s.value=e,a.value=t,l.value=!0}}},ce=e({__name:"QuickContextMenu",props:{options:{}},setup(e,{expose:l}){const{menuRef:s,ctxMenuStyle:n,showMenu:a,isShow:o}=re();return l({showMenu:a,isShow:o}),(e,l)=>(t(),r(x,c({ref_key:"menuRef",ref:s,visible:h(o),"onUpdate:visible":l[0]||(l[0]=e=>u(o)?o.value=e:null),options:e.options,onClick:l[1]||(l[1]=d((()=>{}),["stop"])),style:h(n)},e.$attrs,{"show-index":!1}),null,16,["visible","options","style"]))}});
/*! @viselect/vanilla v3.5.0 MIT | https://github.com/Simonwep/selection/tree/master/packages/vanilla */
var he=Object.defineProperty,ue=(e,t,l)=>(((e,t,l)=>{t in e?he(e,t,{enumerable:!0,configurable:!0,writable:!0,value:l}):e[t]=l})(e,"symbol"!=typeof t?t+"":t,l),l);class de{constructor(){ue(this,"_listeners",new Map),ue(this,"on",this.addEventListener),ue(this,"off",this.removeEventListener),ue(this,"emit",this.dispatchEvent)}addEventListener(e,t){const l=this._listeners.get(e)??new Set;return this._listeners.set(e,l),l.add(t),this}removeEventListener(e,t){var l;return null==(l=this._listeners.get(e))||l.delete(t),this}dispatchEvent(e,...t){let l=!0;for(const s of this._listeners.get(e)??[])l=!1!==s(...t)&&l;return l}unbindAllListeners(){this._listeners.clear()}}const ve=(e,t="px")=>"number"==typeof e?e+t:e;function pe({style:e},t,l){if("object"==typeof t)for(const[s,n]of Object.entries(t))void 0!==n&&(e[s]=ve(n));else void 0!==l&&(e[t]=ve(l))}const me=e=>(t,l,s,n={})=>{t instanceof HTMLCollection||t instanceof NodeList?t=Array.from(t):Array.isArray(t)||(t=[t]),Array.isArray(l)||(l=[l]);for(const a of t)if(a)for(const t of l)a[e](t,s,{capture:!1,...n});return[t,l,s,n]},ge=me("addEventListener"),fe=me("removeEventListener"),_e=e=>{var t;const{clientX:l,clientY:s,target:n}=(null==(t=e.touches)?void 0:t[0])??e;return{x:l,y:s,target:n}};function we(e,t,l="touch"){switch(l){case"center":{const l=t.left+t.width/2,s=t.top+t.height/2;return l>=e.left&&l<=e.right&&s>=e.top&&s<=e.bottom}case"cover":return t.left>=e.left&&t.top>=e.top&&t.right<=e.right&&t.bottom<=e.bottom;case"touch":return e.right>=t.left&&e.left<=t.right&&e.bottom>=t.top&&e.top<=t.bottom}}function xe(e,t=document){const l=Array.isArray(e)?e:[e];let s=[];for(let n=0,a=l.length;n<a;n++){const e=l[n];"string"==typeof e?s=s.concat(Array.from(t.querySelectorAll(e))):e instanceof Element&&s.push(e)}return s}const{abs:ye,max:be,min:Se,ceil:Ee}=Math;class Ae extends de{constructor(e){var t,l,s,n,a;super(),ue(this,"_options"),ue(this,"_selection",{stored:[],selected:[],touched:[],changed:{added:[],removed:[]}}),ue(this,"_area"),ue(this,"_clippingElement"),ue(this,"_targetElement"),ue(this,"_targetRect"),ue(this,"_selectables",[]),ue(this,"_latestElement"),ue(this,"_areaRect",new DOMRect),ue(this,"_areaLocation",{y1:0,x2:0,y2:0,x1:0}),ue(this,"_singleClick",!0),ue(this,"_frame"),ue(this,"_scrollAvailable",!0),ue(this,"_scrollingActive",!1),ue(this,"_scrollSpeed",{x:0,y:0}),ue(this,"_scrollDelta",{x:0,y:0}),ue(this,"disable",this._bindStartEvents.bind(this,!1)),ue(this,"enable",this._bindStartEvents),this._options={selectionAreaClass:"selection-area",selectionContainerClass:void 0,selectables:[],document:window.document,startAreas:["html"],boundaries:["html"],container:"body",...e,behaviour:{overlap:"invert",intersect:"touch",triggers:[0],...e.behaviour,startThreshold:null!=(t=e.behaviour)&&t.startThreshold?"number"==typeof e.behaviour.startThreshold?e.behaviour.startThreshold:{x:10,y:10,...e.behaviour.startThreshold}:{x:10,y:10},scrolling:{speedDivider:10,manualSpeed:750,...null==(l=e.behaviour)?void 0:l.scrolling,startScrollMargins:{x:0,y:0,...null==(n=null==(s=e.behaviour)?void 0:s.scrolling)?void 0:n.startScrollMargins}}},features:{range:!0,touch:!0,...e.features,singleTap:{allow:!0,intersect:"native",...null==(a=e.features)?void 0:a.singleTap}}};for(const c of Object.getOwnPropertyNames(Object.getPrototypeOf(this)))"function"==typeof this[c]&&(this[c]=this[c].bind(this));const{document:o,selectionAreaClass:i,selectionContainerClass:r}=this._options;this._area=o.createElement("div"),this._clippingElement=o.createElement("div"),this._clippingElement.appendChild(this._area),this._area.classList.add(i),r&&this._clippingElement.classList.add(r),pe(this._area,{willChange:"top, left, bottom, right, width, height",top:0,left:0,position:"fixed"}),pe(this._clippingElement,{overflow:"hidden",position:"fixed",transform:"translate3d(0, 0, 0)",pointerEvents:"none",zIndex:"1"}),this._frame=(e=>{let t,l=-1,s=!1;return{next(...n){t=n,s||(s=!0,l=requestAnimationFrame((()=>{e(...t),s=!1})))},cancel(){cancelAnimationFrame(l),s=!1}}})((e=>{this._recalculateSelectionAreaRect(),this._updateElementSelection(),this._emitEvent("move",e),this._redrawSelectionArea()})),this.enable()}_bindStartEvents(e=!0){const{document:t,features:l}=this._options,s=e?ge:fe;s(t,"mousedown",this._onTapStart),l.touch&&s(t,"touchstart",this._onTapStart,{passive:!1})}_onTapStart(e,t=!1){const{x:l,y:s,target:n}=_e(e),{_options:a}=this,{document:o}=this._options,i=n.getBoundingClientRect();if(e instanceof MouseEvent&&!function(e,t){for(const l of t){if("number"==typeof l)return e.button===l;if("object"==typeof l){const t=l.button===e.button,s=l.modifiers.every((t=>{switch(t){case"alt":return e.altKey;case"ctrl":return e.ctrlKey||e.metaKey;case"shift":return e.shiftKey}}));return t&&s}}return!1}(e,a.behaviour.triggers))return;const r=xe(a.startAreas,a.document),c=xe(a.boundaries,a.document);this._targetElement=c.find((e=>we(e.getBoundingClientRect(),i)));const h=e.composedPath();if(!this._targetElement||!r.find((e=>h.includes(e)))||!c.find((e=>h.includes(e)))||!t&&!1===this._emitEvent("beforestart",e))return;this._areaLocation={x1:l,y1:s,x2:0,y2:0};const u=o.scrollingElement??o.body;this._scrollDelta={x:u.scrollLeft,y:u.scrollTop},this._singleClick=!0,this.clearSelection(!1,!0),ge(o,["touchmove","mousemove"],this._delayedTapMove,{passive:!1}),ge(o,["mouseup","touchcancel","touchend"],this._onTapStop),ge(o,"scroll",this._onScroll)}_onSingleTap(e){const{singleTap:{intersect:t},range:l}=this._options.features,s=_e(e);let n;if("native"===t)n=s.target;else if("touch"===t){this.resolveSelectables();const{x:e,y:t}=s;n=this._selectables.find((l=>{const{right:s,left:n,top:a,bottom:o}=l.getBoundingClientRect();return e<s&&e>n&&t<o&&t>a}))}if(!n)return;for(this.resolveSelectables();!this._selectables.includes(n);){if(!n.parentElement)return;n=n.parentElement}const{stored:a}=this._selection;if(this._emitEvent("start",e),e.shiftKey&&l&&this._latestElement){const e=this._latestElement,[t,l]=4&e.compareDocumentPosition(n)?[n,e]:[e,n],s=[...this._selectables.filter((e=>4&e.compareDocumentPosition(t)&&2&e.compareDocumentPosition(l))),t,l];this.select(s),this._latestElement=e}else a.includes(n)&&(1===a.length||e.ctrlKey||a.every((e=>this._selection.stored.includes(e))))?this.deselect(n):(this.select(n),this._latestElement=n);this._emitEvent("stop",e)}_delayedTapMove(e){const{container:t,document:l,behaviour:{startThreshold:s}}=this._options,{x1:n,y1:a}=this._areaLocation,{x:o,y:i}=_e(e);if("number"==typeof s&&ye(o+i-(n+a))>=s||"object"==typeof s&&ye(o-n)>=s.x||ye(i-a)>=s.y){if(fe(l,["mousemove","touchmove"],this._delayedTapMove,{passive:!1}),!1===this._emitEvent("beforedrag",e))return void fe(l,["mouseup","touchcancel","touchend"],this._onTapStop);ge(l,["mousemove","touchmove"],this._onTapMove,{passive:!1}),pe(this._area,"display","block"),xe(t,l)[0].appendChild(this._clippingElement),this.resolveSelectables(),this._singleClick=!1,this._targetRect=this._targetElement.getBoundingClientRect(),this._scrollAvailable=this._targetElement.scrollHeight!==this._targetElement.clientHeight||this._targetElement.scrollWidth!==this._targetElement.clientWidth,this._scrollAvailable&&(ge(this._targetElement,"wheel",this._manualScroll,{passive:!1}),this._selectables=this._selectables.filter((e=>this._targetElement.contains(e)))),this._setupSelectionArea(),this._emitEvent("start",e),this._onTapMove(e)}this._handleMoveEvent(e)}_setupSelectionArea(){const{_clippingElement:e,_targetElement:t,_area:l}=this,s=this._targetRect=t.getBoundingClientRect();this._scrollAvailable?(pe(e,{top:s.top,left:s.left,width:s.width,height:s.height}),pe(l,{marginTop:-s.top,marginLeft:-s.left})):(pe(e,{top:0,left:0,width:"100%",height:"100%"}),pe(l,{marginTop:0,marginLeft:0}))}_onTapMove(e){const{x:t,y:l}=_e(e),{_scrollSpeed:s,_areaLocation:n,_options:a,_frame:o}=this,{speedDivider:i}=a.behaviour.scrolling,r=this._targetElement;if(n.x2=t,n.y2=l,this._scrollAvailable&&!this._scrollingActive&&(s.y||s.x)){this._scrollingActive=!0;const t=()=>{if(!s.x&&!s.y)return void(this._scrollingActive=!1);const{scrollTop:l,scrollLeft:a}=r;s.y&&(r.scrollTop+=Ee(s.y/i),n.y1-=r.scrollTop-l),s.x&&(r.scrollLeft+=Ee(s.x/i),n.x1-=r.scrollLeft-a),o.next(e),requestAnimationFrame(t)};requestAnimationFrame(t)}else o.next(e);this._handleMoveEvent(e)}_handleMoveEvent(e){const{features:t}=this._options;(t.touch&&matchMedia("(hover: none), (pointer: coarse)").matches||this._scrollAvailable&&"safari"in window)&&e.preventDefault()}_onScroll(){const{_scrollDelta:e,_options:{document:t}}=this,{scrollTop:l,scrollLeft:s}=t.scrollingElement??t.body;this._areaLocation.x1+=e.x-s,this._areaLocation.y1+=e.y-l,e.x=s,e.y=l,this._setupSelectionArea(),this._frame.next(null)}_manualScroll(e){const{manualSpeed:t}=this._options.behaviour.scrolling,l=e.deltaY?e.deltaY>0?1:-1:0,s=e.deltaX?e.deltaX>0?1:-1:0;this._scrollSpeed.y+=l*t,this._scrollSpeed.x+=s*t,this._onTapMove(e),e.preventDefault()}_recalculateSelectionAreaRect(){const{_scrollSpeed:e,_areaLocation:t,_areaRect:l,_targetElement:s,_options:n}=this,{scrollTop:a,scrollHeight:o,clientHeight:i,scrollLeft:r,scrollWidth:c,clientWidth:h}=s,u=this._targetRect,{x1:d,y1:v}=t;let{x2:p,y2:m}=t;const{behaviour:{scrolling:{startScrollMargins:g}}}=n;p<u.left+g.x?(e.x=r?-ye(u.left-p+g.x):0,p=p<u.left?u.left:p):p>u.right-g.x?(e.x=c-r-h?ye(u.left+u.width-p-g.x):0,p=p>u.right?u.right:p):e.x=0,m<u.top+g.y?(e.y=a?-ye(u.top-m+g.y):0,m=m<u.top?u.top:m):m>u.bottom-g.y?(e.y=o-a-i?ye(u.top+u.height-m-g.y):0,m=m>u.bottom?u.bottom:m):e.y=0;const f=Se(d,p),_=Se(v,m),w=be(d,p),x=be(v,m);l.x=f,l.y=_,l.width=w-f,l.height=x-_}_redrawSelectionArea(){const{x:e,y:t,width:l,height:s}=this._areaRect,{style:n}=this._area;n.left=`${e}px`,n.top=`${t}px`,n.width=`${l}px`,n.height=`${s}px`}_onTapStop(e,t){var l;const{document:s,features:n}=this._options,{_singleClick:a}=this;fe(s,["mousemove","touchmove"],this._delayedTapMove),fe(s,["touchmove","mousemove"],this._onTapMove),fe(s,["mouseup","touchcancel","touchend"],this._onTapStop),fe(s,"scroll",this._onScroll),this._keepSelection(),e&&a&&n.singleTap.allow?this._onSingleTap(e):!a&&!t&&(this._updateElementSelection(),this._emitEvent("stop",e)),this._scrollSpeed.x=0,this._scrollSpeed.y=0,fe(this._targetElement,"wheel",this._manualScroll,{passive:!0}),this._clippingElement.remove(),null==(l=this._frame)||l.cancel(),pe(this._area,"display","none")}_updateElementSelection(){const{_selectables:e,_options:t,_selection:l,_areaRect:s}=this,{stored:n,selected:a,touched:o}=l,{intersect:i,overlap:r}=t.behaviour,c="invert"===r,h=[],u=[],d=[];for(let p=0;p<e.length;p++){const t=e[p];if(we(s,t.getBoundingClientRect(),i)){if(a.includes(t))n.includes(t)&&!o.includes(t)&&o.push(t);else{if(c&&n.includes(t)){d.push(t);continue}u.push(t)}h.push(t)}}c&&u.push(...n.filter((e=>!a.includes(e))));const v="keep"===r;for(let p=0;p<a.length;p++){const e=a[p];!h.includes(e)&&(!v||!n.includes(e))&&d.push(e)}l.selected=h,l.changed={added:u,removed:d},this._latestElement=void 0}_emitEvent(e,t){return this.emit(e,{event:t,store:this._selection,selection:this})}_keepSelection(){const{_options:e,_selection:t}=this,{selected:l,changed:s,touched:n,stored:a}=t,o=l.filter((e=>!a.includes(e)));switch(e.behaviour.overlap){case"drop":t.stored=[...o,...a.filter((e=>!n.includes(e)))];break;case"invert":t.stored=[...o,...a.filter((e=>!s.removed.includes(e)))];break;case"keep":t.stored=[...a,...l.filter((e=>!a.includes(e)))]}}trigger(e,t=!0){this._onTapStart(e,t)}resolveSelectables(){this._selectables=xe(this._options.selectables,this._options.document)}clearSelection(e=!0,t=!1){const{selected:l,stored:s,changed:n}=this._selection;n.added=[],n.removed.push(...l,...e?s:[]),t||(this._emitEvent("move",null),this._emitEvent("stop",null)),this._selection={stored:e?[]:s,selected:[],touched:[],changed:{added:[],removed:[]}}}getSelection(){return this._selection.stored}getSelectionArea(){return this._area}cancel(e=!1){this._onTapStop(null,!e)}destroy(){this.cancel(),this.disable(),this._clippingElement.remove(),super.unbindAllListeners()}select(e,t=!1){const{changed:l,selected:s,stored:n}=this._selection,a=xe(e,this._options.document).filter((e=>!s.includes(e)&&!n.includes(e)));return n.push(...a),s.push(...a),l.added.push(...a),l.removed=[],this._latestElement=void 0,t||(this._emitEvent("move",null),this._emitEvent("stop",null)),a}deselect(e,t=!1){const{selected:l,stored:s,changed:n}=this._selection,a=xe(e,this._options.document).filter((e=>l.includes(e)||s.includes(e)));a.length&&(this._selection.stored=s.filter((e=>!a.includes(e))),this._selection.selected=l.filter((e=>!a.includes(e))),this._selection.changed.added=[],this._selection.changed.removed.push(...a.filter((e=>!n.removed.includes(e)))),this._latestElement=void 0,t||(this._emitEvent("move",null),this._emitEvent("stop",null)))}}ue(Ae,"version","3.5.0");const Le=({filteredFiles:e,basePath:t})=>{const l=n([]),s=o((()=>new Set(l.value)));i(e,(()=>{l.value=[]}));const a=n(),{selectionArea:r}=(({containerRef:e,onStart:t,onStop:l,toggleClass:s="active",selectables:a=[".selectable"]})=>{const o=n();return v((()=>{o.value=new Ae({selectables:a,boundaries:[e.value],features:{touch:!1,singleTap:{allow:!1}},container:e.value}).on("start",(({store:e,event:l})=>{l.ctrlKey||l.metaKey||(o.value.clearSelection(),setTimeout((()=>{t&&t()})))})).on("move",(({store:{changed:{added:e,removed:t}}})=>{for(const l of e)l.classList.add(s);for(const l of t)l.classList.remove(s)})).on("stop",(({store:{stored:e}})=>{setTimeout((()=>{l&&l(e)}))}))})),p((()=>{o.value&&o.value.destroy()})),{selectionArea:o}})({containerRef:a,onStart:()=>{l.value=[]},onStop:t=>{const s={};e.value.forEach((e=>{s[e.name]=e}));const n=[];t.forEach((e=>{const t=e.getAttribute("data-name");t&&s[t]&&n.push(s[t])})),l.value=n}}),c=o((()=>l.value.map((e=>g(t.value+"/"+e.name)))));return{selectedItems:l,selectedItemsSet:s,explorerContentRef:a,toggleSelect:({item:t,event:s,toggle:n=!1})=>{if(s.ctrlKey||s.metaKey||n)l.value=f([...l.value],t);else if(s.shiftKey){let s=0;const n=l.value[0];n&&(s=e.value.findIndex((e=>e.name===n.name)));let a=e.value.findIndex((e=>e.name===t.name));s>a&&([a,s]=[s,a]),l.value=e.value.slice(s,a+1)}else l.value=[t]},toggleSelectAll:()=>{const t=e.value;l.value.length===t.length?l.value=[]:l.value=[...t]},selectedPaths:c,selectionArea:r}},Me=({selectedPaths:e,basePath:t,isLoading:l,emit:s})=>{const n=m({cutPaths:[],copyPaths:[]});return{enablePaste:o((()=>n.cutPaths.length>0||n.copyPaths.length>0)),handleCut:()=>{n.copyPaths=[],n.cutPaths=e.value},handleCopy:()=>{n.cutPaths=[],n.copyPaths=e.value},handlePaste:async()=>{let e=[],a=!1;if(n.cutPaths.length)e=n.cutPaths,a=!0;else{if(!n.copyPaths.length)return;e=n.copyPaths}try{l.value=!0,await _.copyPaste({fromPaths:e,toPath:t.value,isMove:a}),n.cutPaths=[],n.copyPaths=[],s("refresh")}finally{l.value=!1}}}},ke=({emit:e})=>{const t=n(null),{appendHistory:l,historyMenuOptions:s,openedHistory:a}=y("mc_explorer_local_dir3",(async l=>{await w(l),e("refresh"),t.value=l})),i=async()=>{await w(),e("refresh"),t.value=null};return{handleOpenLocalDir:async()=>{const s=await window.showDirectoryPicker();await w(s),e("refresh"),await l(s),t.value=s},localDirHistoryOptions:o((()=>{const e=[...s.value];return t.value&&e.push({label:"✖️ Close Local Folder",props:{onClick:i}}),e}))}};export{R as A,j as C,q as D,Y as F,G as R,ee as S,ce as _,Me as a,ke as b,I as c,ie as d,E as e,M as f,D as g,H as h,se as i,oe as j,re as k,Le as u};
