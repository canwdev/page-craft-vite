import{I as e,T as a,i as s}from"./I18nToolSettings-NIPEfP3Q.js";import{d as o,o as t,m as l,x as i,Q as n,u as r,a as c,r as u,P as p,R as m,S as d,s as v,f as w,U as g,h,V as f,W as y,_ as S,l as b,n as k,q as _,v as T,G as x,H as D,z as O,y as H,B as I,C as z,D as C,E as F,c as N,O as R}from"./index-3hzdRt7D.js";import{D as V,u as $,a as A,b as j,_ as B}from"./use-meta-TxEtYIhD.js";import"./Add-g7S_sgBo.js";import"./use-common-settings-mPnoVtEA.js";const J={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 20 20"},W=[i("g",{fill:"none"},[i("path",{d:"M3 5a2 2 0 0 1 2-2h8.379a2 2 0 0 1 1.414.586l1.621 1.621A2 2 0 0 1 17 6.621V15a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5zm2-1a1 1 0 0 0-1 1v10a1 1 0 0 0 1 1v-4.5A1.5 1.5 0 0 1 6.5 10h7a1.5 1.5 0 0 1 1.5 1.5V16a1 1 0 0 0 1-1V6.621a1 1 0 0 0-.293-.707l-1.621-1.621A1 1 0 0 0 13.379 4H13v2.5A1.5 1.5 0 0 1 11.5 8h-4A1.5 1.5 0 0 1 6 6.5V4H5zm2 0v2.5a.5.5 0 0 0 .5.5h4a.5.5 0 0 0 .5-.5V4H7zm7 12v-4.5a.5.5 0 0 0-.5-.5h-7a.5.5 0 0 0-.5.5V16h8z",fill:"currentColor"})],-1)],E=o({name:"Save20Regular",render:function(e,a){return t(),l("svg",J,W)}}),L={types:[{description:"JSON",accept:{"application/JSON":[".json"]}}]},P=o({name:"VueI18nEditTool",components:{QuickOptions:n,I18nToolSettings:e,TranslateTreeItem:a,DropZone:V,Save20Regular:E},setup(){const{t:e}=r(),a=c(),o=u(p.parseWithRoot()),t=u(!1),{appendHistory:l,historyMenuOptions:i}=m(d.I18N_FILE_HANDLE_HISTORY,(async e=>{n.value=e;const a=await e.getFile();await S(a)})),n=v(),S=async e=>{try{t.value=!0;const a=await f(e),s=JSON.parse(a);o.value=p.parseWithRoot(s)}catch(a){console.error(a),window.$message.error(a.message)}finally{t.value=!1}},b=async()=>{const[e]=await window.showOpenFilePicker(L);await l(e),n.value=e;const a=await e.getFile();await S(a)},k=()=>{n.value=void 0,o.value=p.parseWithRoot()},_=async()=>{try{if(t.value=!0,!n.value)return;const a=await n.value.createWritable(),s=JSON.stringify(y(o.value),null,2);await a.write(s),await a.close(),window.$message.success(e("msgs.saved"))}catch(a){console.error(a),window.$message.error(a.message)}finally{t.value=!1}},T=async()=>{var a;try{t.value=!0,console.log(o.value);const s=JSON.stringify(y(o.value),null,2),l=await window.showSaveFilePicker({suggestedName:null==(a=n.value)?void 0:a.name,...L}),i=await l.createWritable();await i.write(s),await i.close(),window.$message.success(e("msgs.saved"))}catch(s){console.error(s),window.$message.error(s.message)}finally{t.value=!1}},{metaTitle:x}=$();w((()=>{n.value?_():T()})),g((()=>!!n.value));const D=u(!1),O=()=>{o.value=p.parseWithRoot({hello_world:{section_a:{test_str:"This is a test string",test_arr:["line 1","line 2","line 3"],test_number:114514,"":"中English混合"},section_b:{"":"Blur this input and it'll generate the key automatically!"},section_c:{"":"平行、行列"}}})},H=h((()=>[{label:e("common.settings"),props:{onClick:()=>{D.value=!0}}},{label:e("common.tools"),props:{onClick:()=>{a.isShowQuickLaunch=!0}}},n.value?{label:"💻 "+e("actions.close")+" JSON",children:[{label:e(e("msgs.confirm_close")),props:{onClick:k,isBack:!0}}]}:{label:"💻  "+e("actions.open")+" JSON",props:{onClick:()=>{b()}},dropdown:i.value},n.value?{label:"💾 "+e("actions.save"),props:{onClick:()=>{_()}}}:null,{label:e("actions.save_as")+"...",props:{onClick:()=>{T()}}},{label:e("common.demo"),children:[{label:e("msgs.load_demo_this_will"),props:{onClick:O,isBack:!0}}]}].filter(Boolean)));return{metaTitle:x,translateTreeRoot:o,fileHandle:n,handleImport:S,handleSelectFile:b,handleCloseFile:k,handleSaveFile:_,handleExport:T,loadDemo:O,iconTranslate:s,...A({cb:async e=>{try{t.value=!0;for(const a of e.dataTransfer.items)if("file"===a.kind){const e=await a.getAsFileSystemHandle();if("directory"!==e.kind){await l(e),n.value=e;const a=await e.getFile();await S(a)}else window.$message.error("Please drag and drop a json file here!")}}catch(a){console.error(a),window.$message.error(a.message)}finally{t.value=!1}}}),mainStore:a,isShowToolSettings:D,isLoading:t,menuOptions:H}}}),Q={key:0,class:"mc-loading-container position-fixed"},M={class:"vp-bg navbar-wrap",style:{position:"sticky",top:"0","z-index":"100","margin-bottom":"10px"}},U={class:"_container"},Z=i("div",{class:"height-placeholder"},null,-1);const q=S(P,[["render",function(e,a,s,o,n,r){const c=R,u=b("DropZone"),p=B,m=b("QuickOptions"),d=j,v=b("TranslateTreeItem"),w=b("I18nToolSettings");return t(),l("div",{class:"vue-i18n-edit-tool i18n-style",onDragover:a[2]||(a[2]=O(((...a)=>e.fileDragover&&e.fileDragover(...a)),["prevent","stop"])),onDragleave:a[3]||(a[3]=O((a=>e.showDropzone=!1),["prevent","stop"])),onDrop:a[4]||(a[4]=O(((...a)=>e.fileDrop&&e.fileDrop(...a)),["prevent","stop"]))},[k(T,{name:"mc-fade"},{default:_((()=>[e.isLoading?(t(),l("div",Q,[k(c)])):H("",!0)])),_:1}),k(T,{name:"mc-fade"},{default:_((()=>[I(k(u,{"position-fixed":"",text:e.$t("msgs.drag_file_here")},null,8,["text"]),[[z,e.showDropzone]])])),_:1}),i("div",M,[k(d,{subtitle:"",onBack:a[0]||(a[0]=a=>e.$router.push({name:"HomePage"}))},{title:_((()=>[C(F(e.metaTitle),1)])),avatar:_((()=>[k(p,{src:e.iconTranslate,style:{background:"none"}},null,8,["src"])])),extra:_((()=>[k(m,{"is-static":"",options:e.menuOptions,horizontal:"","auto-focus":!1,"item-cls":"vp-button"},null,8,["options"])])),_:1})]),i("div",U,[(t(!0),l(x,null,D(e.translateTreeRoot,((a,s)=>{var o;return t(),N(v,{key:s,item:a,index:s,title:null==(o=e.fileHandle)?void 0:o.name},null,8,["item","index","title"])})),128))]),Z,k(w,{visible:e.isShowToolSettings,"onUpdate:visible":a[1]||(a[1]=a=>e.isShowToolSettings=a)},null,8,["visible"])],32)}]]);export{q as default};
