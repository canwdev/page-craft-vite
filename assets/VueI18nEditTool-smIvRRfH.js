import{_ as N,a as V,u as A,i as L,v as x}from"./file-history-0SnG5qnY.js";import{d as B,c as g,x as k,B as _,R,g as W,h as E,r as D,S as b,L as P,i as j,k as U,U as M,m as K,V as Q,W as F,b as Z,y as c,z as w,A as H,J as G,K as Y,D as O,C as q,F as X,G as ee,H as oe,I as se,e as te}from"./index-wlWCW-WY.js";import{_ as J,u as ae,a as ne,c as le,d as ie,b as re}from"./use-meta-1RFSlfmM.js";const ce={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 20 20"},ue=_("g",{fill:"none"},[_("path",{d:"M3 5a2 2 0 0 1 2-2h8.379a2 2 0 0 1 1.414.586l1.621 1.621A2 2 0 0 1 17 6.621V15a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5zm2-1a1 1 0 0 0-1 1v10a1 1 0 0 0 1 1v-4.5A1.5 1.5 0 0 1 6.5 10h7a1.5 1.5 0 0 1 1.5 1.5V16a1 1 0 0 0 1-1V6.621a1 1 0 0 0-.293-.707l-1.621-1.621A1 1 0 0 0 13.379 4H13v2.5A1.5 1.5 0 0 1 11.5 8h-4A1.5 1.5 0 0 1 6 6.5V4H5zm2 0v2.5a.5.5 0 0 0 .5.5h4a.5.5 0 0 0 .5-.5V4H7zm7 12v-4.5a.5.5 0 0 0-.5-.5h-7a.5.5 0 0 0-.5.5V16h8z",fill:"currentColor"})],-1),pe=[ue],de=B({name:"Save20Regular",render:function(t,r){return g(),k("svg",ce,pe)}}),I={types:[{description:"JSON",accept:{"application/JSON":[".json"]}}]},me=B({name:"VueI18nEditTool",components:{QuickOptions:R,I18nToolSettings:N,TranslateTreeItem:V,DropZone:J,Save20Regular:de},setup(){const{t:e}=W(),t=E(),r=D(b.parseWithRoot()),i=D(!1),{data:d,set:$}=A(P.I18N_FILE_HANDLE_HISTORY,[]),a=j(),u=async s=>{try{i.value=!0;const o=await Q(s),l=JSON.parse(o);r.value=b.parseWithRoot(l)}catch(o){console.error(o),window.$message.error(o.message)}finally{i.value=!1}},f=async s=>{console.log(s);const o=[...d.value];o.push({handle:s,lastOpened:Date.now()}),await $(o.slice(0,5))},h=async()=>{const[s]=await window.showOpenFilePicker(I);await f(s),a.value=s;const o=await s.getFile();await u(o)},T=async s=>{try{i.value=!0;for(const o of s.dataTransfer.items)if(o.kind==="file"){const l=await o.getAsFileSystemHandle();if(l.kind!=="directory"){await f(l),a.value=l;const p=await l.getFile();await u(p)}else window.$message.error("Please drag and drop a json file here!")}}catch(o){console.error(o),window.$message.error(o.message)}finally{i.value=!1}},y=()=>{a.value=void 0,r.value=b.parseWithRoot()},m=async()=>{try{if(i.value=!0,!a.value)return;const s=await a.value.createWritable(),o=JSON.stringify(F(r.value),null,2);await s.write(o),await s.close(),window.$message.success(e("msgs.saved"))}catch(s){console.error(s),window.$message.error(s.message)}finally{i.value=!1}},n=async()=>{var s;try{i.value=!0,console.log(r.value);const o=JSON.stringify(F(r.value),null,2),p=await(await window.showSaveFilePicker({suggestedName:(s=a.value)==null?void 0:s.name,...I})).createWritable();await p.write(o),await p.close(),window.$message.success(e("msgs.saved"))}catch(o){console.error(o),window.$message.error(o.message)}finally{i.value=!1}},{metaTitle:S}=ae();U(()=>{if(a.value){m();return}n()}),M(()=>!!a.value);const v=D(!1),C=()=>{r.value=b.parseWithRoot({hello_world:{section_a:{test_str:"This is a test string",test_arr:["line 1","line 2","line 3"],test_number:114514},section_b:{"":"Blur this input and it'll generate the key automatically!"},section_c:{"":"ä¸­æ–‡ is Supported"}}})},z=K(()=>{const s=()=>{if(d.value.length)return[...d.value.reverse().map(o=>{const{handle:l}=o;return{label:l.name,props:{onClick:async()=>{if(await x(l)){a.value=l;const p=await l.getFile();await u(p)}}}}}),{label:"ðŸ§¹ Clear History",props:{onClick:()=>{d.value=[]}}}]};return[{label:e("common.settings"),props:{onClick:()=>{v.value=!0}}},{label:e("common.tools"),props:{onClick:()=>{t.isShowQuickLaunch=!0}}},a.value?{label:e("actions.close")+" JSON",children:[{label:e("Confirm close JSON? Unsaved contents will be lost."),props:{onClick:y,isBack:!0}}]}:{label:e("actions.open")+" JSON",props:{onClick:()=>{h()}},dropdown:s()},a.value?{label:e("actions.save"),props:{onClick:()=>{m()}}}:null,{label:e("actions.save_as")+"...",props:{onClick:()=>{n()}}},{label:e("common.demo"),children:[{label:e("msgs.load_demo_this_will"),props:{onClick:C,isBack:!0}}]}].filter(Boolean)});return{metaTitle:S,translateTreeRoot:r,fileHandle:a,handleImport:u,handleSelectFile:h,handleCloseFile:y,handleSaveFile:m,handleExport:n,loadDemo:C,iconTranslate:L,...ne({cb:T}),mainStore:t,isShowToolSettings:v,isLoading:i,menuOptions:z}}}),ve={key:0,class:"mc-loading-container position-fixed"},we={class:"vp-panel navbar-wrap",style:{position:"sticky",top:"0","z-index":"100","margin-bottom":"10px"}},ge={class:"_container"},_e=_("div",{class:"height-placeholder"},null,-1);function fe(e,t,r,i,d,$){const a=ie,u=J,f=re,h=R,T=le,y=V,m=N;return g(),k("div",{class:"vue-i18n-edit-tool i18n-style",onDragover:t[2]||(t[2]=O((...n)=>e.fileDragover&&e.fileDragover(...n),["prevent","stop"])),onDragleave:t[3]||(t[3]=O(n=>e.showDropzone=!1,["prevent","stop"])),onDrop:t[4]||(t[4]=O((...n)=>e.fileDrop&&e.fileDrop(...n),["prevent","stop"]))},[c(H,{name:"mc-fade"},{default:w(()=>[e.isLoading?(g(),k("div",ve,[c(a)])):q("",!0)]),_:1}),c(H,{name:"mc-fade"},{default:w(()=>[X(c(u,{"position-fixed":"",text:e.$t("msgs.drag_file_here")},null,8,["text"]),[[ee,e.showDropzone]])]),_:1}),_("div",we,[c(T,{subtitle:"",onBack:t[0]||(t[0]=n=>e.$router.push({name:"HomePage"}))},{title:w(()=>[oe(se(e.metaTitle),1)]),avatar:w(()=>[c(f,{src:e.iconTranslate,style:{background:"none"}},null,8,["src"])]),extra:w(()=>[c(h,{"is-static":"",options:e.menuOptions,horizontal:"","auto-focus":!1,"item-cls":"vp-button"},null,8,["options"])]),_:1})]),_("div",ge,[(g(!0),k(G,null,Y(e.translateTreeRoot,(n,S)=>{var v;return g(),te(y,{key:S,item:n,index:S,title:(v=e.fileHandle)==null?void 0:v.name},null,8,["item","index","title"])}),128))]),_e,c(m,{visible:e.isShowToolSettings,"onUpdate:visible":t[1]||(t[1]=n=>e.isShowToolSettings=n)},null,8,["visible"])],32)}const be=Z(me,[["render",fe]]);export{be as default};
