import{d as z,_ as R,u as O,r as c,s as j,a as B,w as I,o as J,C as w,b as A,c as H,e as X,f as g,h as K,p as U,g as V,i as T,j as $,k as a,l,T as W,m as M,n as L,q as P,t as G,v as Z,x as m,y as q,F as Q,z as Y,A as ee,B as oe,D as ne,E as te,G as se,H as ae,I as le,J as re}from"./index-68d06547.js";import{_ as F,d as ie,u as pe,a as ue,b as ce}from"./use-file-drop-e7ff1ede.js";const de=""+new URL("excel-59df11bd.svg",import.meta.url).href,me=n=>n.tagName.toLowerCase()==="td",_e=z({name:"ExcelCopyTool",components:{FileChooser:R,DropZone:F},setup(){const n=O(),t=c(),y=c(),C=c(!1),i=j(),h=c([]),p=c(0),{metaTitle:x}=B();I(p,()=>{_()});const v=()=>{if(!C.value){const e="XLSX Not Ready!";throw window.$message.error(e),new Error(e)}},d=e=>(h.value=e.SheetNames,e.Sheets[h.value[p.value]]),_=()=>{const e=i.value;if(!e){y.value.innerHTML="";return}const o=window.XLSX.utils.sheet_to_html(d(e));y.value.innerHTML=o},f=async e=>{if(v(),!/\.xlsx$/g.test(e.name)){window.$message.error("Only supports reading xlsx format!");return}const o=new FileReader;i.value=null,o.onload=function(s){const r=s.target.result;p.value=0,i.value=window.XLSX.read(r,{type:"binary"}),_()},o.readAsBinaryString(e)},D=c(!0);J(async()=>{try{await ie("//unpkg.com/xlsx@0.16.9/xlsx.mini.js")}catch(e){window.$message.error(e.message),console.error(e)}window.$message.success("XLSX Ready!"),console.log("XLSX ready",window.XLSX),C.value=!0});const u=c(w.json),S=e=>{let o=e.target;if(!me(o)||!u.value||u.value===w.none||!o.innerText)return;let s=o.innerText;console.log(u.value);let r="";e.ctrlKey&&e.altKey?s=g(s,r=w.json):e.ctrlKey?s=g(s,r=w.text):e.altKey?s=g(s,r=w.html):s=g(s,r=u.value),X(s),window.$message.success(r+" copied!");const N=document.createRange();N.selectNode(o);const E=window.getSelection();E&&(E.removeAllRanges(),E.addRange(N))},k=()=>{if(!i.value){const s="Please open Excel file first!";throw window.$message.error(s),new Error(s)}const e=i.value,o={};return e.SheetNames.forEach(function(s){const r=window.XLSX.utils.sheet_to_row_object_array(e.Sheets[s]);r.length>0&&(o[s]=r)}),o},b=async()=>{const e=k();K(await U(null,"excel_sheet_export"),JSON.stringify(e,null,2),".json")};return A(async()=>{await b()}),{metaTitle:x,iconExcel:de,sheetNames:h,sheetNameIndex:p,handleImport:f,importFileChooserRef:t,loadDemo(){v();const e=[["Name","Value","Num","Time"],["test001",`line1
line2`,123,new Date],["test001",`line1

line3`,-1,new Date]],o=window.XLSX.utils.aoa_to_sheet(e),s=window.XLSX.utils.book_new();window.XLSX.utils.book_append_sheet(s,o,"Sheet1"),p.value=0,i.value=s,_()},tableWrapperRef:y,handleClick:S,copyMode:u,CopyModeOptions:H,dropdownMenuOptions:[{label:"Copy Sheets JSON",props:{onClick:async()=>{const e=k();X(JSON.stringify(e,null,2)),window.$message.success("Sheet JSON Copied!")}}},{label:"Export Sheets JSON",props:{onClick:async()=>{b()}}}],formatMultipleLine:g,...pe({cbFiles:e=>{e.length&&f(e[0])}}),isTrimEmptyLines:D,mainStore:n}}});function fe(n,t,y,C,i,h){const p=F,x=ue,v=oe,d=ne,_=te,f=se,D=ae,u=ce,S=P,k=re,b=le,e=R;return T(),$("div",{class:"excel-copy-tool",onDragover:t[7]||(t[7]=L((...o)=>n.fileDragover&&n.fileDragover(...o),["prevent","stop"])),onDragleave:t[8]||(t[8]=L(o=>n.showDropzone=!1,["prevent","stop"])),onDrop:t[9]||(t[9]=L((...o)=>n.fileDrop&&n.fileDrop(...o),["prevent","stop"]))},[a(W,{name:"mc-fade"},{default:l(()=>[G(a(p,{text:"Drop Excel file here"},null,512),[[Z,n.showDropzone]])]),_:1}),M("div",null,[a(S,{size:"small"},{default:l(()=>[a(u,{subtitle:"",onBack:t[4]||(t[4]=o=>n.$router.push({name:"HomePage"}))},{title:l(()=>[m(q(n.metaTitle),1)]),avatar:l(()=>[a(x,{src:n.iconExcel,style:{background:"none"}},null,8,["src"])]),extra:l(()=>[a(f,null,{default:l(()=>[a(f,{size:"small",align:"center"},{default:l(()=>[a(v,{size:"small",checked:n.isTrimEmptyLines,"onUpdate:checked":t[0]||(t[0]=o=>n.isTrimEmptyLines=o)},{default:l(()=>[m("Trim empty lines")]),_:1},8,["checked"]),a(d,{text:"",onClick:t[1]||(t[1]=o=>n.mainStore.isShowTextTransformer=!0)},{default:l(()=>[m("CopyMode:")]),_:1}),a(_,{size:"small",value:n.copyMode,"onUpdate:value":t[2]||(t[2]=o=>n.copyMode=o),options:n.CopyModeOptions,style:{width:"100px"}},null,8,["value","options"])]),_:1}),a(d,{type:"primary",onClick:t[3]||(t[3]=o=>n.importFileChooserRef.chooseFile()),size:"small"},{default:l(()=>[m(" Open Excel ")]),_:1}),a(D,{options:n.dropdownMenuOptions,placement:"bottom-start","key-field":"label"},{default:l(()=>[a(d,{size:"small"},{default:l(()=>[m("Export")]),_:1})]),_:1},8,["options"]),a(d,{onClick:n.loadDemo,size:"small"},{default:l(()=>[m("Demo")]),_:1},8,["onClick"])]),_:1})]),_:1})]),_:1}),a(S,{class:"sheet-name-card",size:"small"},{default:l(()=>[a(b,{size:"small",type:"card",animated:"",value:n.sheetNameIndex,"onUpdate:value":t[5]||(t[5]=o=>n.sheetNameIndex=o)},{default:l(()=>[(T(!0),$(Q,null,Y(n.sheetNames,(o,s)=>(T(),ee(k,{style:{padding:"0"},name:s,tab:o,key:o},null,8,["name","tab"]))),128))]),_:1},8,["value"])]),_:1})]),M("div",{ref:"tableWrapperRef",class:"excel-table-container",onClick:t[6]||(t[6]=(...o)=>n.handleClick&&n.handleClick(...o))},null,512),a(e,{ref:"importFileChooserRef",accept:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",onSelected:n.handleImport},null,8,["onSelected"])],32)}const ye=V(_e,[["render",fe],["__scopeId","data-v-da13b891"]]);export{ye as default};
