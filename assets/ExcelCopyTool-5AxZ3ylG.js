import{d as U,f as G,g as Z,h as q,r as b,i as V,w as Q,o as Y,j as ee,T as h,k as ne,l as oe,m as te,t as L,n as A,p as se,q as le,v as ae,b as re,c as m,x as I,y as r,z as l,A as P,B as j,e as X,C as R,D as H,E as ie,F as ce,G as ue,H as v,I as S,J as pe,K as de,M as me,N as fe,O as we,P as _e,Q as he}from"./index-wlWCW-WY.js";import{_ as K,u as ge,a as ye,b as ve,c as Se,d as Ce}from"./use-meta-1RFSlfmM.js";import{_ as ke,a as be}from"./Tabs-jyzBSEGS.js";const Le=e=>new Promise((o,x)=>{if(document.getElementById(e))o();else{const u=document.createElement("script");u.src=e,u.id=e,u.onload=function(){this.onerror=this.onload=null,o()},u.onerror=function(f){this.onerror=this.onload=null,x(f)},document.body.appendChild(u)}}),Xe="data:image/svg+xml,%3c?xml%20version='1.0'%20encoding='utf-8'?%3e%3c!--%20Generator:%20Adobe%20Illustrator%2023.0.2,%20SVG%20Export%20Plug-In%20.%20SVG%20Version:%206.00%20Build%200)%20--%3e%3csvg%20version='1.1'%20id='Layer_1'%20xmlns='http://www.w3.org/2000/svg'%20xmlns:xlink='http://www.w3.org/1999/xlink'%20x='0px'%20y='0px'%20viewBox='0%200%2024%2024'%20style='enable-background:new%200%200%2024%2024;'%20xml:space='preserve'%3e%3cstyle%20type='text/css'%3e%20.st0{fill:%2321A366;}%20.st1{fill:none;}%20.st2{fill:%23107C41;}%20.st3{fill:%2333C481;}%20.st4{fill:%23185C37;}%20.st5{opacity:0.5;}%20.st6{fill:%23FFFFFF;}%20%3c/style%3e%3cg%20id='_x32_4_14_'%3e%3cpath%20class='st0'%20d='M16,1H7C6.4,1,6,1.4,6,2v5l10,5l4,1.5l4-1.5V7L16,1z'/%3e%3crect%20y='0'%20class='st1'%20width='24'%20height='24'/%3e%3crect%20x='6'%20y='7'%20class='st2'%20width='10'%20height='5'/%3e%3cpath%20class='st3'%20d='M24,2v5h-8V1h7C23.5,1,24,1.5,24,2z'/%3e%3cpath%20class='st4'%20d='M16,12H6v5v0V22c0,0.6,0.4,1,1,1h16c0.6,0,1-0.4,1-1v-5L16,12z'/%3e%3cpath%20class='st5'%20d='M13.8,6H6v14h7.6c0.7,0,1.4-0.7,1.4-1.4V7.2C15,6.5,14.5,6,13.8,6z'/%3e%3cpath%20id='Back_Plate_49_'%20class='st2'%20d='M12.8,19H1.2C0.5,19,0,18.5,0,17.8L0,6.2C0,5.5,0.5,5,1.2,5h11.7C13.5,5,14,5.5,14,6.2%20v11.7C14,18.5,13.5,19,12.8,19z'/%3e%3cpath%20class='st6'%20d='M3.4,16L6,12L3.6,8h1.9l1.3,2.5C7,10.8,7,11,7.1,11.1h0c0.1-0.2,0.2-0.4,0.3-0.6L8.8,8h1.8l-2.4,4l2.5,4H8.7%20l-1.5-2.8C7.2,13.1,7.1,13,7,12.8h0c0,0.1-0.1,0.2-0.2,0.4L5.3,16H3.4z'/%3e%3crect%20x='16'%20y='12'%20class='st2'%20width='8'%20height='5'/%3e%3c/g%3e%3c/svg%3e",$e=e=>e.tagName.toLowerCase()==="td",Ee=U({name:"ExcelCopyTool",components:{FileChooser:G,DropZone:K},setup(){const{t:e}=Z(),o=q(),x=b(),C=b(),u=b(!1),f=V(null),p=V(),k=b([]),w=b(0),{metaTitle:g}=ge();Q(w,()=>{E()});const N=()=>{if(!u.value){const n="XLSX Not Ready!";throw window.$message.error(n),new Error(n)}},$=n=>(k.value=n.SheetNames,n.Sheets[k.value[w.value]]),E=()=>{const n=p.value;if(!n){C.value.innerHTML="";return}console.log("[renderWorkbook]",n);const a=window.XLSX.utils.sheet_to_html($(n));C.value.innerHTML=a},D=async n=>{if(f.value=null,N(),!/\.xlsx$/g.test(n.name)){window.$message.error("Only supports reading xlsx format!");return}const a=new FileReader;p.value=null,a.onload=function(t){f.value=n;const i=t.target.result;w.value=0,p.value=window.XLSX.read(i,{type:"binary"}),E()},a.readAsBinaryString(n)},M=b(!0),F=async()=>{if(window.XLSX){u.value=!0;return}try{await Le("./lib/xlsx.mini.js")}catch(n){window.$message.error(n.message),console.error(n)}window.$message.success("XLSX Ready!"),console.log("XLSX ready",window.XLSX),u.value=!0};Y(async()=>{await F()});const _=ee("excel_copy_tool_copy_mode",h.HTML),O=n=>{let a=n.target;if(!$e(a)||!_.value||_.value===h.DISABLED||!a.innerText)return;let t=a.innerText;console.log(_.value);let i="";n.ctrlKey&&n.altKey?t=L(t,i=h.JSON):n.ctrlKey?t=L(t,i=h.TEXT):n.altKey?t=L(t,i=h.HTML):t=L(t,i=_.value),A(t),window.$message.success(i+" "+e("msgs.copy_success"));const c=document.createRange();c.selectNode(a);const d=window.getSelection();d&&(d.removeAllRanges(),d.addRange(c))},y=({currentOnly:n=!1}={})=>{const a=c=>{const d=_.value;return d===h.DISABLED||d===h.TEXT?c:c.map(T=>{for(const B in T)typeof T[B]=="string"&&(T[B]=L(T[B],d));return T})};if(!p.value){const c="Please open Excel file first!";throw window.$message.error(c),new Error(c)}if(n){const c=window.XLSX.utils.sheet_to_json($(p.value));return a(c)}const t=p.value,i={};return t.SheetNames.forEach(function(c){const d=window.XLSX.utils.sheet_to_row_object_array(t.Sheets[c]);d.length>0&&(i[c]=a(d))}),i},s=async(n={})=>{var i;const a=y(n);let t=(i=f.value)==null?void 0:i.name;t&&(t=t.substring(0,t.lastIndexOf("."))),se(await le(t,"excel_sheet_export"),JSON.stringify(a,null,2),".json")};ne(async()=>{await s()});const z=()=>{N();const n=window.XLSX.utils.aoa_to_sheet([["Name","Value","Num","Time"],["test001",`line1
line2`,123,new Date],["test001",`line1

line3`,-1,new Date]]),a=window.XLSX.utils.aoa_to_sheet([["Name"],["test002"],["test002"]]),t=window.XLSX.utils.book_new();window.XLSX.utils.book_append_sheet(t,n,"Sheet1"),window.XLSX.utils.book_append_sheet(t,a,"Sheet2"),w.value=0,p.value=t,E()},W=[{label:"Current Sheet",children:[{label:"Export Current Sheet JSON",props:{onClick:async()=>{await s({currentOnly:!0})}}},{label:"Copy Current Sheet JSON",props:{onClick:async()=>{const n=y({currentOnly:!0});await A(JSON.stringify(n,null,2)),window.$message.success("Sheet JSON Copied!")}}},{label:"Print Current Sheet to Console",props:{onClick:async()=>{const n=y({currentOnly:!0});console.log(n),window.$message.success("Print to Console!")}}}]},{label:"All Sheets",children:[{label:"Export All Sheets JSON",props:{onClick:async()=>{await s()}}},{label:"Copy All Sheets JSON",props:{onClick:async()=>{const n=y();await A(JSON.stringify(n,null,2)),window.$message.success("Sheet JSON Copied!")}}},{label:"Print All Sheets to Console",props:{onClick:async()=>{const n=y();console.log(n),window.$message.success("Print to Console!")}}}]}],J=()=>{f.value=null,p.value=null,k.value=[],w.value=0,C.value.innerHTML=""};return oe(()=>{J()}),{metaTitle:g,iconExcel:Xe,sheetNames:k,sheetNameIndex:w,handleImport:D,importFileChooserRef:x,loadDemo:z,tableWrapperElRef:C,handleClick:O,copyMode:_,modTextConvertOptions:te(()=>[{label:"Disabled",value:h.DISABLED},...ae]),dropdownMenuOptions:W,textConvertMultipleLine:L,...ye({cbFiles:n=>{n.length&&D(n[0])}}),isTrimEmptyLines:M,mainStore:o,isReady:u,workbookRef:p,fileRef:f,handleCloseFile:J}}}),Te={key:0,class:"mc-loading-container"};function xe(e,o,x,C,u,f){const p=K,k=ve,w=me,g=fe,N=we,$=_e,E=he,D=Se,M=ie,F=Ce,_=ke,O=be,y=G;return m(),I("div",{class:"excel-copy-tool",onDragover:o[7]||(o[7]=H((...s)=>e.fileDragover&&e.fileDragover(...s),["prevent","stop"])),onDragleave:o[8]||(o[8]=H(s=>e.showDropzone=!1,["prevent","stop"])),onDrop:o[9]||(o[9]=H((...s)=>e.fileDrop&&e.fileDrop(...s),["prevent","stop"]))},[r(P,{name:"mc-fade"},{default:l(()=>[ce(r(p,{"position-fixed":"",text:"Drop Excel file here"},null,512),[[ue,e.showDropzone]])]),_:1}),j("div",null,[r(M,{size:"small"},{default:l(()=>[r(D,{subtitle:"",onBack:o[4]||(o[4]=s=>e.$router.push({name:"HomePage"}))},{title:l(()=>[v(S(e.metaTitle),1)]),avatar:l(()=>[r(k,{src:e.iconExcel,style:{background:"none"}},null,8,["src"])]),extra:l(()=>[r($,null,{default:l(()=>[r($,{size:"small",align:"center"},{default:l(()=>[r(w,{size:"small",checked:e.isTrimEmptyLines,"onUpdate:checked":o[0]||(o[0]=s=>e.isTrimEmptyLines=s)},{default:l(()=>[v(S(e.$t("msgs.trim_empty_lines")),1)]),_:1},8,["checked"]),r(g,{text:"",onClick:o[1]||(o[1]=s=>e.mainStore.isShowTextTransformer=!0)},{default:l(()=>[v(S(e.$t("common.text_transformer"))+":",1)]),_:1}),r(N,{size:"small",value:e.copyMode,"onUpdate:value":o[2]||(o[2]=s=>e.copyMode=s),options:e.modTextConvertOptions,style:{width:"100px"}},null,8,["value","options"])]),_:1}),e.workbookRef?(m(),X(E,{key:0,options:e.dropdownMenuOptions,placement:"bottom-start","key-field":"label",disabled:!e.isReady},{default:l(()=>[r(g,{size:"small"},{default:l(()=>[v(S(e.$t("actions.export")),1)]),_:1})]),_:1},8,["options","disabled"])):R("",!0),e.fileRef?(m(),X(g,{key:2,type:"primary",size:"small",onClick:e.handleCloseFile},{default:l(()=>[v(S(e.$t("actions.close")),1)]),_:1},8,["onClick"])):(m(),X(g,{key:1,type:"primary",disabled:!e.isReady,onClick:o[3]||(o[3]=s=>e.importFileChooserRef.chooseFile()),size:"small"},{default:l(()=>[v(S(e.$t("actions.open")+" Excel"),1)]),_:1},8,["disabled"])),e.fileRef?R("",!0):(m(),X(g,{key:3,onClick:e.loadDemo,size:"small",disabled:!e.isReady},{default:l(()=>[v(S(e.$t("common.demo")),1)]),_:1},8,["onClick","disabled"]))]),_:1})]),_:1})]),_:1}),r(P,{name:"mc-fade"},{default:l(()=>[e.isReady?R("",!0):(m(),I("div",Te,[r(F)]))]),_:1}),e.isReady?(m(),X(M,{key:0,class:"sheet-name-card",size:"small"},{default:l(()=>[r(O,{size:"small",type:"card",animated:"",value:e.sheetNameIndex,"onUpdate:value":o[5]||(o[5]=s=>e.sheetNameIndex=s)},{default:l(()=>[(m(!0),I(pe,null,de(e.sheetNames,(s,z)=>(m(),X(_,{style:{padding:"0"},name:z,tab:s,key:s},null,8,["name","tab"]))),128))]),_:1},8,["value"])]),_:1})):R("",!0)]),j("div",{ref:"tableWrapperElRef",class:"excel-table-container",onClick:o[6]||(o[6]=(...s)=>e.handleClick&&e.handleClick(...s))},null,512),r(y,{ref:"importFileChooserRef",accept:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",onSelected:e.handleImport},null,8,["onSelected"])],32)}const Re=re(Ee,[["render",xe]]);export{Re as default};
