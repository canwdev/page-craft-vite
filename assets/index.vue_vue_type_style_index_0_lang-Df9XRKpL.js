var e=Object.defineProperty,t=(t,i,o)=>((t,i,o)=>i in t?e(t,i,{enumerable:!0,configurable:!0,writable:!0,value:o}):t[i]=o)(t,"symbol"!=typeof i?i+"":i,o);import{s as i,d as o,o as a,p as s,M as n,b as l,n as h,g as d,T as r,_ as u,U as c,r as p,P as v,x as w,F as g,m,e as y,ae as x,K as R,I as f,t as b,N as z,c as M,al as E,a7 as T,J as L,k as _,aA as D,X as S,j as k,w as B,h as I}from"./index-Dcsrw7an.js";const O=Object.freeze({TOP_LEFT:{xRatio:0,yRatio:0,widthRatio:.5,heightRatio:.5},TOP_RIGHT:{xRatio:.5,yRatio:0,widthRatio:.5,heightRatio:.5},LEFT:{xRatio:0,yRatio:0,widthRatio:.5,heightRatio:1},RIGHT:{xRatio:.5,yRatio:0,widthRatio:.5,heightRatio:1},BOTTOM_LEFT:{xRatio:0,yRatio:.5,widthRatio:.5,heightRatio:.5},BOTTOM_RIGHT:{xRatio:.5,yRatio:.5,widthRatio:.5,heightRatio:.5},MAXIMIZE:{xRatio:0,yRatio:0,widthRatio:1,heightRatio:1,maximize:!0}}),C=[O.LEFT,O.MAXIMIZE,O.RIGHT,O.TOP_LEFT,{xRatio:0,yRatio:0,widthRatio:1,heightRatio:.5},O.TOP_RIGHT,{xRatio:.1,yRatio:.1,widthRatio:.8,heightRatio:.8},{xRatio:.2,yRatio:.2,widthRatio:.6,heightRatio:.6},{xRatio:.3,yRatio:.3,widthRatio:.4,heightRatio:.4},O.BOTTOM_LEFT,{xRatio:0,yRatio:.5,widthRatio:1,heightRatio:.5},O.BOTTOM_RIGHT],P=({x:e,y:t})=>t<=0?e<=0?O.TOP_LEFT:e>=window.innerWidth-1?O.TOP_RIGHT:O.MAXIMIZE:e<=0?t>=window.innerHeight-1?O.BOTTOM_LEFT:O.LEFT:e>=window.innerWidth-1?t>=window.innerHeight-1?O.BOTTOM_RIGHT:O.RIGHT:void 0,H="draggable-window-resize";var W=(e=>(e.n="n",e.s="s",e.w="w",e.e="e",e.nw="nw",e.ne="ne",e.se="se",e.sw="sw",e))(W||{});const X=Object.values(W),A=e=>{let t=0,i=0;if("touchstart"==e.type||"touchmove"==e.type||"touchend"==e.type||"touchcancel"==e.type){const o=e.touches[0]||e.changedTouches[0];t=o.pageX,i=o.pageY}else"mousedown"!=e.type&&"mouseup"!=e.type&&"mousemove"!=e.type&&"mouseover"!=e.type&&"mouseout"!=e.type&&"mouseenter"!=e.type&&"mouseleave"!=e.type||(t=e.clientX,i=e.clientY);return{x:t,y:i}},V=new Set;class Z{constructor(e){t(this,"docEl"),t(this,"deltaX"),t(this,"deltaY"),t(this,"options"),t(this,"handleResizeDebounced"),t(this,"prevRect"),t(this,"currentResizeDirection"),t(this,"alignWhenViewPortResize"),t(this,"allowMove"),t(this,"maximized");const{dragHandleEl:o,dragTargetEl:a,onMove:s,autoPosOnResize:n}=e;this.options=e,this.docEl=document.documentElement,this.deltaX=0,this.deltaY=0,this.allowMove=!0,this.maximized=e.maximized||!1,this.alignWhenViewPortResize=e.alignWhenViewPortResize||"start",this.handleDragStart=this.handleDragStart.bind(this),this.handleDragMove=this.handleDragMove.bind(this),this.handleDragStop=this.handleDragStop.bind(this),this.currentResizeDirection=null,this.handleResizeDebounced=i((()=>{if(this.isHidden())return;const{left:e,top:t}=this.setInScreenPosition({x:a.offsetLeft,y:a.offsetTop,isViewPortResize:!0});this.debugLog("handleResizeDebounced",{left:e,top:t}),s&&s({top:t,left:e})}),50,!0,!0),n&&(window.addEventListener("resize",this.handleResizeDebounced),this.handleResizeDebounced()),this.updateZIndex=this.updateZIndex.bind(this),this.handleMouseDown=this.handleMouseDown.bind(this),["mousedown","touchstart"].forEach((e=>{o.addEventListener(e,this.handleDragStart),a.addEventListener(e,this.handleMouseDown)})),this.handleResizeStart=this.handleResizeStart.bind(this),this.handleResizeMove=this.handleResizeMove.bind(this),this.handleResizeStop=this.handleResizeStop.bind(this),this.prevRect=a.getBoundingClientRect(),this.options.resizeable&&X.forEach((e=>{const t=((e,t)=>{const i=document.createElement("div");i.className=H,i.style.position="absolute",i.style.cursor=`${t}-resize`,i.setAttribute("data-direction",String(t)),i.style.userSelect="none";const o=()=>{i.style.width="6px",i.style.height="6px"};switch(t){case"n":i.style.height="6px",i.style.top="-4px",i.style.left="2px",i.style.right="2px";break;case"e":i.style.width="6px",i.style.top="2px",i.style.bottom="2px",i.style.right="-4px";break;case"s":i.style.height="6px",i.style.bottom="-4px",i.style.left="2px",i.style.right="2px";break;case"w":i.style.width="6px",i.style.top="2px",i.style.left="-4px",i.style.bottom="2px";break;case"nw":o(),i.style.top="-4px",i.style.left="-4px";break;case"ne":o(),i.style.right="-4px",i.style.top="-4px";break;case"sw":o(),i.style.left="-4px",i.style.bottom="-4px";break;case"se":o(),i.style.right="-4px",i.style.bottom="-4px"}return e.appendChild(i),i})(a,e);["mousedown","touchstart"].forEach((e=>{t.addEventListener(e,this.handleResizeStart)}))})),setTimeout((()=>{this.updateZIndex()})),V.add(this),this.debugLog("initialized",this)}destroy(){const{dragTargetEl:e,dragHandleEl:t,autoPosOnResize:i,resizeable:o}=this.options;if(["mousedown","touchstart"].forEach((i=>{t.removeEventListener(i,this.handleDragStart),e.removeEventListener(i,this.handleMouseDown)})),i&&window.addEventListener("resize",this.handleResizeDebounced),o){const t=e.querySelector(H);t&&e.removeChild(t)}V.delete(this),this.debugLog("destroyed")}handleDragStart(e){if(!this.allowMove||this.maximized)return;const{docEl:t}=this,{preventNode:i,dragTargetEl:o}=this.options;if(i&&i.contains(e.target))return!1;const a=A(e);return this.deltaX=a.x-o.getBoundingClientRect().left,this.deltaY=a.y-o.getBoundingClientRect().top,["mousemove","touchmove"].forEach((e=>{t.addEventListener(e,this.handleDragMove)})),["mouseup","touchend"].forEach((e=>{t.addEventListener(e,this.handleDragStop)})),o.classList.add("_dragging"),!1}handleDragMove(e){const{deltaX:t,deltaY:i}=this,{dragTargetEl:o,onMove:a,opacify:s}=this.options,n=A(e),l=n.x-t,h=n.y-i;let d,r;if(this.options.allowOut){const{scaleX:e,scaleY:t}=this.fixZoom();d=o.style.left=Math.round(l)*e+"px",r=o.style.top=Math.round(h)*t+"px"}else{const e=this.setInScreenPosition({x:l,y:h});d=e.left,r=e.top}a&&a({pointerX:n.x,pointerY:n.y,top:r,left:d}),s&&(o.style.opacity=String(s))}handleDragStop(e){const{docEl:t}=this,{dragTargetEl:i,opacify:o,onMove:a}=this.options,{x:s,y:n}=e;if(a){const e={moveStop:!0};e.attachLayout=P({x:s,y:n}),a(e)}["mousemove","touchmove"].forEach((e=>{t.removeEventListener(e,this.handleDragMove)})),["mouseup","touchend"].forEach((e=>{t.removeEventListener(e,this.handleDragStop)})),o&&(i.style.opacity="1"),i.classList.remove("_dragging")}handleResizeStart(e){const{docEl:t}=this,{dragTargetEl:i}=this.options,o=A(e);this.deltaX=o.x,this.deltaY=o.y,this.prevRect=i.getBoundingClientRect(),e.target&&(this.currentResizeDirection=e.target.getAttribute("data-direction")||null),["mousemove","touchmove"].forEach((e=>{t.addEventListener(e,this.handleResizeMove)})),["mouseup","touchend"].forEach((e=>{t.addEventListener(e,this.handleResizeStop)})),i.classList.add("_dragging")}handleResizeMove(e){const{deltaX:t,deltaY:i}=this,{dragTargetEl:o}=this.options,a=A(e),s=a.x-t,n=a.y-i,l=this.prevRect,h=()=>{const e=l.top+n;o.style.top=e+"px",o.style.height=l.height-n+"px"},d=()=>{o.style.width=l.width+s+"px"},r=()=>{o.style.height=l.height+n+"px"},u=()=>{l.left,o.style.left=l.left+s+"px",o.style.width=l.width-s+"px"};switch(this.currentResizeDirection){case"n":h();break;case"e":d();break;case"s":r();break;case"w":u();break;case"nw":h(),u();break;case"ne":h(),d();break;case"se":r(),d();break;case"sw":r(),u()}}handleResizeStop(e){const{docEl:t}=this;["mousemove","touchmove"].forEach((e=>{t.removeEventListener(e,this.handleResizeMove)})),["mouseup","touchend"].forEach((e=>{t.removeEventListener(e,this.handleResizeStop)}));const{dragTargetEl:i}=this.options;i.classList.remove("_dragging")}handleMouseDown(e){1!==e.button&&2!==e.button&&this.updateZIndex()}isHidden(){const{dragHandleEl:e}=this.options;return null===e.offsetParent}fixZoom(){const{dragTargetEl:e}=this.options,t=e.getBoundingClientRect();return{scaleX:t.width/e.offsetWidth,scaleY:t.height/e.offsetHeight}}setInScreenPosition({x:e,y:t,isViewPortResize:i=!1}){const{docEl:o}=this,{dragTargetEl:a}=this.options,s=a.getBoundingClientRect(),n=o.clientWidth-s.width,l=o.clientHeight-s.height;if("end"===this.alignWhenViewPortResize&&i)if(this._prevDocWidth){const t=n-this._prevDocWidth;t>0&&(e+=t,this._prevDocWidth=0)}else this._prevDocWidth=n;return{left:a.style.left=Math.round(Math.max(0,Math.min(n,Math.max(0,e))))+"px",top:a.style.top=Math.round(Math.max(0,Math.min(l,Math.max(0,t))))+"px"}}debugLog(e,...t){this.options.isDebug&&console.log(`[draggableWindow] ${e}`,...t)}updateZIndex(e={}){const{preventOnActive:t=!1}=e;if(!t){const{onActive:e}=this.options;e&&e()}if(!this.allowMove&&!this.maximized)return void this.debugLog("[updateZIndex] return");const{dragTargetEl:i}=this.options;let o=-1,a=null;const s=Array.from(V).map((e=>e.options.dragTargetEl)).filter(Boolean);s.forEach((e=>{const t=getComputedStyle(e)["z-index"],i=parseInt(t)||0;i>o&&(o=i,a=e)})),i.classList.contains("_visible")&&(i.classList.add("_active"),i!==a&&(i.style.zIndex=String(o),Array.from(s).forEach((e=>{e!==i&&(e.style.zIndex=parseInt(getComputedStyle(e)["z-index"])-1,e.classList.remove("_active"))}))))}}const Y=u(o({__name:"LayoutPreview",props:{previewData:{}},setup:e=>(e,t)=>(a(),s(r,{name:"fade-scale"},{default:n((()=>[e.previewData?(a(),l("div",{key:0,class:"vp-demo-layout",style:h({top:100*e.previewData.yRatio+"%",left:100*e.previewData.xRatio+"%",width:100*e.previewData.widthRatio+"%",height:100*e.previewData.heightRatio+"%"})},null,4)):d("",!0)])),_:1}))}),[["__scopeId","data-v-bbf1ccec"]]),F=["onMouseover","onClick"],N=u(o({__name:"LayoutHelper",props:{visible:{type:Boolean,default:!1}},emits:["update:visible","setWindowLayout"],setup(e,{emit:t}){const i=t,o=c(e,"visible",i),s=p();return(e,t)=>(a(),l(g,null,[v(r,{name:"fade"},{default:n((()=>[w(o)?(a(),l("div",{key:0,onMouseleave:t[1]||(t[1]=e=>o.value=!1),class:"vp-layout-helper vp-panel"},[(a(!0),l(g,null,m(w(C),((e,n)=>(a(),l("div",{key:n,class:"layout-item",onMouseover:t=>(e=>{o.value?s.value=e:s.value=void 0})(e),onMouseleave:t[0]||(t[0]=e=>s.value=void 0),onClick:t=>(e=>{i("setWindowLayout",e),o.value=!1,setTimeout((()=>{s.value=void 0}))})(e)},[y("div",{style:h({top:100*e.yRatio+"%",left:100*e.xRatio+"%",width:100*e.widthRatio+"%",height:100*e.heightRatio+"%"}),class:"layout-inner"},null,4)],40,F)))),128))],32)):d("",!0)])),_:1}),v(Y,{"preview-data":w(s)},null,8,["preview-data"])],64))}}),[["__scopeId","data-v-95d64bd1"]]),G=(e,t,i)=>{const o=i=>{i?e.value.classList.add(t):e.value.classList.remove(t)};R(i,(e=>{o(e)})),f((()=>{o(i.value)}))},$=["id"],j={class:"vp-window-content"},J={class:"vp-window-title-bar-text text-overflow"},U=[y("svg",{width:"20",height:"20",xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 20 20"},[y("g",{fill:"none"},[y("rect",{x:"3",y:"9.25",width:"14",height:"1.5",rx:".75",fill:"currentColor"})])],-1)],q={key:0,width:"20",height:"20",xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 16 16"},K=[y("g",{fill:"none"},[y("path",{d:"M13.854 2.854a.5.5 0 0 0-.708-.708L10 5.293V3.5a.5.5 0 0 0-1 0v2.9a.6.6 0 0 0 .6.6h2.9a.5.5 0 0 0 0-1h-1.793l3.147-3.146zM6.5 13a.5.5 0 0 1-.5-.5v-1.793l-3.146 3.147a.5.5 0 0 1-.708-.708L5.293 10H3.5a.5.5 0 0 1 0-1h2.9a.6.6 0 0 1 .6.6v2.9a.5.5 0 0 1-.5.5z",fill:"currentColor"})],-1)],Q={key:1,width:"16",height:"16",xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 16 16"},ee=[y("g",{fill:"none"},[y("path",{d:"M8.5 2a.5.5 0 0 0 0 1h3.793L3 12.293V8.5a.5.5 0 0 0-1 0v4.9a.6.6 0 0 0 .6.6h4.9a.5.5 0 0 0 0-1H3.707L13 3.707V7.5a.5.5 0 0 0 1 0V2.6a.6.6 0 0 0-.6-.6H8.5z",fill:"currentColor"})],-1)],te=[y("svg",{width:"20",height:"20",xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 20 20"},[y("g",{fill:"none"},[y("path",{d:"M4.089 4.216l.057-.07a.5.5 0 0 1 .638-.057l.07.057L10 9.293l5.146-5.147a.5.5 0 0 1 .638-.057l.07.057a.5.5 0 0 1 .057.638l-.057.07L10.707 10l5.147 5.146a.5.5 0 0 1 .057.638l-.057.07a.5.5 0 0 1-.638.057l-.07-.057L10 10.707l-5.146 5.147a.5.5 0 0 1-.638.057l-.07-.057a.5.5 0 0 1-.057-.638l.057-.07L9.293 10L4.146 4.854a.5.5 0 0 1-.057-.638l.057-.07l-.057.07z",fill:"currentColor"})])],-1)],ie=o({name:"ViewPortWindow",props:{visible:{type:Boolean},showClose:{type:Boolean,default:!0},allowMaximum:{type:Boolean},maximized:{type:Boolean},allowMinimum:{type:Boolean},minimized:{type:Boolean},allowMove:{type:Boolean,default:!0},allowSnap:{type:Boolean,default:!0},wid:{},initWinOptions:{},initCenter:{type:Boolean,default:!0},transitionName:{default:"fade-scale"},noTitleBar:{type:Boolean},allowOut:{type:Boolean,default:!0},alignWhenViewPortResize:{default:"start"}},emits:["update:visible","resize","onActive","onClose","onRestored","update:minimized","update:maximized"],setup(e,{expose:t,emit:o}){const h=e,u=o,{allowMaximum:g,allowMove:m,noTitleBar:O,allowSnap:C}=b(h),H="vp_window_"+h.wid,W=c(h,"visible",u),X=p(),A=p(),V=p(),F=p(),ie=z(null),oe=c(h,"maximized",u,{passive:!0}),ae=c(h,"minimized",u,{passive:!0});R(ae,(e=>{!e&&W.value&&u("onRestored")})),f((()=>{!ae.value&&W.value&&u("onRestored")}));const se=p(!1),ne=e=>{e?se.value=e:setTimeout((()=>{se.value=e}),300)};G(X,"_visible",W),G(X,"_maximized",oe),G(X,"_transition",se),G(X,"_no_title_bar",O);const le=M((()=>m.value&&!oe.value));G(X,"_allow_move",le);let he={top:"10px",left:"10px",width:"300px",height:"auto",maximized:!1};const de=E({...he});T(de,(()=>{if(oe.value){const e=JSON.parse(localStorage.getItem(H)||"null");e&&localStorage.setItem(H,JSON.stringify({...e,maximized:oe.value}))}else h.wid&&localStorage.setItem(H,JSON.stringify({...de}))}),{deep:Boolean(h.wid),debounce:500}),R(m,(e=>{ie.value.allowMove=e,e&&ie.value.updateZIndex()})),R(oe,(e=>{ie.value.allowMove=!e,ie.value.maximized=e,de.maximized=e})),R(W,(e=>{e&&(ue.value||ce(),ie.value.updateZIndex())})),f((()=>{ie.value=new Z({dragHandleEl:h.noTitleBar?V.value:A.value,dragTargetEl:X.value,allowOut:h.allowOut,preventNode:F.value,onMove:ve,onActive(){u("onActive")},autoPosOnResize:!0,isDebug:!1,resizeable:!0,maximized:de.maximized||!1,alignWhenViewPortResize:h.alignWhenViewPortResize}),oe.value=de.maximized||!1,ie.value.allowMove=m.value,new ResizeObserver((()=>{we()})).observe(X.value),ce()}));const re=(e,t)=>{X.value.style[e]=de[e]=t},ue=p(!1),ce=()=>{if(!W.value)return;let e,t,i={...he};h.initWinOptions&&(i={...i,...h.initWinOptions}),h.wid?(t=JSON.parse(localStorage.getItem(H)||"null"),e=t||i):e=i,re("left",e.left),re("top",e.top),re("width",e.width),re("height",e.height),ue.value=!0,setTimeout((()=>{if(h.initCenter&&!t){const e=X.value.getBoundingClientRect(),t=Math.round(window.innerWidth/2-e.width/2),i=Math.round(window.innerHeight/2-e.height/2);de.left=X.value.style.left=t+"px",de.top=X.value.style.top=i+"px"}else ie.value.handleResizeDebounced()}))},pe=i((e=>{fe.value=P(e)}),150,!0),ve=async e=>{if(e.moveStop)return setTimeout((()=>{fe.value=void 0}),151),await((e=400)=>new Promise((t=>{setTimeout((()=>{const e=X.value.getBoundingClientRect();let i=!1;e.y<0&&(re("top","0px"),i=!0),e.x<=-e.width&&(re("left","0px"),i=!0),i||(e.y>window.innerHeight&&re("top",window.innerHeight-e.height+"px"),e.x>window.innerWidth&&re("left",window.innerWidth-e.width+"px")),t()}),e)})))(0),void(C.value&&e.attachLayout&&xe(e.attachLayout));const{top:t,left:i,pointerX:o,pointerY:a}=e;C.value&&pe({x:o,y:a}),de.top=t,de.left=i},we=i((()=>{if(!W.value||!X.value)return;const e=getComputedStyle(X.value);de.width=e.width,de.height=e.height,u("resize",de)}),100);L((()=>{ie.value&&ie.value.destroy()}));const ge=()=>{g.value&&(ne(!0),oe.value=!oe.value,ne(!1))},me=()=>{W.value=!1,u("onClose")},ye=p(!1),xe=e=>{const{xRatio:t,yRatio:i,widthRatio:o,heightRatio:a,maximize:s}=e;if(s)return void ge();const{innerWidth:n,innerHeight:l}=window,h=Math.ceil(n*t),d=Math.ceil(l*i),r=Math.ceil(n*o),u=Math.ceil(l*a);oe.value&&(oe.value=!1),ne(!0),setTimeout((()=>{re("left",h+"px"),re("top",d+"px"),re("width",r+"px"),re("height",u+"px"),ne(!1)}))},Re=p();((e,t={})=>{const{timeout:i=0,onEnter:o,onOut:a}=t;let s;x(e,"mouseover",(e=>{clearTimeout(s),s=setTimeout((()=>{o&&o(e)}),i)})),x(e,"mouseleave",(e=>{clearTimeout(s),a&&a(e)})),x(e,"click",(()=>{clearTimeout(s)}))})(Re,{timeout:800,onEnter:()=>{ye.value=!0}});const fe=p(void 0);return t({isInit:ue,mVisible:W,handleClose:me,setActive:()=>{ie.value.updateZIndex({preventOnActive:!0})},isMaximized:oe,isMinimized:ae,toggleMaximized:ge,isTransition:se,isShowLayoutHelper:ye,setWindowLayout:xe,setPos:re,layoutPreviewData:fe,focus:()=>{X.value.focus()}}),(e,t)=>(a(),s(r,{name:e.transitionName},{default:n((()=>[_(y("div",{class:"vp-window",ref_key:"rootRef",ref:X,id:e.wid},[v(Y,{"preview-data":w(fe)},null,8,["preview-data"]),v(N,{visible:w(ye),"onUpdate:visible":t[0]||(t[0]=e=>S(ye)?ye.value=e:null),onSetWindowLayout:xe},null,8,["visible"]),y("div",j,[_(y("div",{ref_key:"titleBarRef",ref:A,class:"vp-window-title-bar",onDblclick:ge},[y("div",J,[k(e.$slots,"titleBarLeft")]),y("div",{onDblclick:t[2]||(t[2]=B((()=>{}),["stop"])),ref_key:"titleBarButtonsRef",ref:F,class:"vp-window-controls"},[k(e.$slots,"titleBarRightControls"),k(e.$slots,"titleBarRight",{},(()=>[e.allowMinimum?(a(),l("button",{key:0,onClick:t[1]||(t[1]=e=>ae.value=!0),class:"is-minimize"},U)):d("",!0),w(g)?(a(),l("button",{key:1,ref_key:"mButtonRef",ref:Re,onClick:ge,class:I([w(oe)?"is-restore":"is-maximize"])},[w(oe)?(a(),l("svg",q,K)):(a(),l("svg",Q,ee))],2)):d("",!0),e.showClose?(a(),l("button",{key:2,title:"Close",onClick:me,class:"is-close"},te)):d("",!0)]))],544)],544),[[D,!w(O)]]),y("div",{ref_key:"winBodyRef",ref:V,class:"vp-window-body _bg scrollbar-mini"},[k(e.$slots,"default")],512)])],8,$),[[D,w(ue)&&w(W)]])])),_:3},8,["name"]))}});export{ie as _};
