import{n as e,t,f as s,s as i}from"./humanfs-api-Dvdi9RO8.js";import{r as o,q as l,c as n,I as a,J as r,K as c,al as h}from"./index-D7imv_Md.js";import{u}from"./file-history-CLLvp5b9.js";const d=({getListFn:s,openEntryFn:i})=>{const a=o([]),r=l("mc_explorer_base_path","/",localStorage,{listenToStorageChanges:!1}),c=n((()=>{let t=e(r.value);return/\/$/gi.test(t)||(t+="/"),t})),h=o(!1),u=async()=>{try{r.value=c.value,h.value=!0,r.value||(r.value="/"),a.value=await s()}catch(e){console.error(e),a.value=[]}finally{h.value=!1}},d=o([]),p=o([]),v=(e,t=c.value)=>{const s=e[e.length-1];(!s||s&&s!==t)&&e.push(t)},_=n((()=>{const e=r.value.split("/").filter((e=>!!e));return m.value?e.length>0:e.length>1})),m=n((()=>/^\//g.test(r.value))),f=async(e,t=!0)=>{r.value=e,b.value="",await u(),t&&v(d.value)},g=l("mc_explorer_component_dir_star_list",[]),y=n((()=>g.value.includes(c.value))),b=o(""),E=n((()=>{const e=b.value.toLowerCase();return a.value.filter((t=>t.name.toLowerCase().includes(e)))}));return{isLoading:h,filteredFiles:E,handleOpen:async t=>{const s=e(r.value+"/"+t.name);t.isDirectory?await f(s):await i({item:t,path:s})},handleRefresh:u,basePathNormalized:c,starList:g,handleOpenPath:f,backHistory:d,goBack:async()=>{const e=d.value[d.value.length-2];e&&(d.value.pop(),v(p.value),await f(e,!1))},forwardHistory:p,goForward:async()=>{const e=p.value.pop();e&&(v(d.value,e),await f(e,!1))},allowUp:_,goUp:async()=>{const e=r.value.split("/").filter((e=>!!e));if(e.pop(),!e.length&&!m.value)return void(await u());let t=e.join("/")+"/";m.value&&(t="/"+t),await f(t)},basePath:r,toggleStar:()=>{g.value=t([...g.value],c.value)},isStared:y,filterText:b}};
/*! @viselect/vanilla v3.5.0 MIT | https://github.com/Simonwep/selection/tree/master/packages/vanilla */var p=Object.defineProperty,v=(e,t,s)=>(((e,t,s)=>{t in e?p(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s})(e,"symbol"!=typeof t?t+"":t,s),s);class _{constructor(){v(this,"_listeners",new Map),v(this,"on",this.addEventListener),v(this,"off",this.removeEventListener),v(this,"emit",this.dispatchEvent)}addEventListener(e,t){const s=this._listeners.get(e)??new Set;return this._listeners.set(e,s),s.add(t),this}removeEventListener(e,t){var s;return null==(s=this._listeners.get(e))||s.delete(t),this}dispatchEvent(e,...t){let s=!0;for(const i of this._listeners.get(e)??[])s=!1!==i(...t)&&s;return s}unbindAllListeners(){this._listeners.clear()}}const m=(e,t="px")=>"number"==typeof e?e+t:e;function f({style:e},t,s){if("object"==typeof t)for(const[i,o]of Object.entries(t))void 0!==o&&(e[i]=m(o));else void 0!==s&&(e[t]=m(s))}const g=e=>(t,s,i,o={})=>{t instanceof HTMLCollection||t instanceof NodeList?t=Array.from(t):Array.isArray(t)||(t=[t]),Array.isArray(s)||(s=[s]);for(const l of t)if(l)for(const t of s)l[e](t,i,{capture:!1,...o});return[t,s,i,o]},y=g("addEventListener"),b=g("removeEventListener"),E=e=>{var t;const{clientX:s,clientY:i,target:o}=(null==(t=e.touches)?void 0:t[0])??e;return{x:s,y:i,target:o}};function S(e,t,s="touch"){switch(s){case"center":{const s=t.left+t.width/2,i=t.top+t.height/2;return s>=e.left&&s<=e.right&&i>=e.top&&i<=e.bottom}case"cover":return t.left>=e.left&&t.top>=e.top&&t.right<=e.right&&t.bottom<=e.bottom;case"touch":return e.right>=t.left&&e.left<=t.right&&e.bottom>=t.top&&e.top<=t.bottom}}function x(e,t=document){const s=Array.isArray(e)?e:[e];let i=[];for(let o=0,l=s.length;o<l;o++){const e=s[o];"string"==typeof e?i=i.concat(Array.from(t.querySelectorAll(e))):e instanceof Element&&i.push(e)}return i}const{abs:w,max:T,min:A,ceil:L}=Math;class P extends _{constructor(e){var t,s,i,o,l;super(),v(this,"_options"),v(this,"_selection",{stored:[],selected:[],touched:[],changed:{added:[],removed:[]}}),v(this,"_area"),v(this,"_clippingElement"),v(this,"_targetElement"),v(this,"_targetRect"),v(this,"_selectables",[]),v(this,"_latestElement"),v(this,"_areaRect",new DOMRect),v(this,"_areaLocation",{y1:0,x2:0,y2:0,x1:0}),v(this,"_singleClick",!0),v(this,"_frame"),v(this,"_scrollAvailable",!0),v(this,"_scrollingActive",!1),v(this,"_scrollSpeed",{x:0,y:0}),v(this,"_scrollDelta",{x:0,y:0}),v(this,"disable",this._bindStartEvents.bind(this,!1)),v(this,"enable",this._bindStartEvents),this._options={selectionAreaClass:"selection-area",selectionContainerClass:void 0,selectables:[],document:window.document,startAreas:["html"],boundaries:["html"],container:"body",...e,behaviour:{overlap:"invert",intersect:"touch",triggers:[0],...e.behaviour,startThreshold:null!=(t=e.behaviour)&&t.startThreshold?"number"==typeof e.behaviour.startThreshold?e.behaviour.startThreshold:{x:10,y:10,...e.behaviour.startThreshold}:{x:10,y:10},scrolling:{speedDivider:10,manualSpeed:750,...null==(s=e.behaviour)?void 0:s.scrolling,startScrollMargins:{x:0,y:0,...null==(o=null==(i=e.behaviour)?void 0:i.scrolling)?void 0:o.startScrollMargins}}},features:{range:!0,touch:!0,...e.features,singleTap:{allow:!0,intersect:"native",...null==(l=e.features)?void 0:l.singleTap}}};for(const c of Object.getOwnPropertyNames(Object.getPrototypeOf(this)))"function"==typeof this[c]&&(this[c]=this[c].bind(this));const{document:n,selectionAreaClass:a,selectionContainerClass:r}=this._options;this._area=n.createElement("div"),this._clippingElement=n.createElement("div"),this._clippingElement.appendChild(this._area),this._area.classList.add(a),r&&this._clippingElement.classList.add(r),f(this._area,{willChange:"top, left, bottom, right, width, height",top:0,left:0,position:"fixed"}),f(this._clippingElement,{overflow:"hidden",position:"fixed",transform:"translate3d(0, 0, 0)",pointerEvents:"none",zIndex:"1"}),this._frame=(e=>{let t,s=-1,i=!1;return{next(...o){t=o,i||(i=!0,s=requestAnimationFrame((()=>{e(...t),i=!1})))},cancel(){cancelAnimationFrame(s),i=!1}}})((e=>{this._recalculateSelectionAreaRect(),this._updateElementSelection(),this._emitEvent("move",e),this._redrawSelectionArea()})),this.enable()}_bindStartEvents(e=!0){const{document:t,features:s}=this._options,i=e?y:b;i(t,"mousedown",this._onTapStart),s.touch&&i(t,"touchstart",this._onTapStart,{passive:!1})}_onTapStart(e,t=!1){const{x:s,y:i,target:o}=E(e),{_options:l}=this,{document:n}=this._options,a=o.getBoundingClientRect();if(e instanceof MouseEvent&&!function(e,t){for(const s of t){if("number"==typeof s)return e.button===s;if("object"==typeof s){const t=s.button===e.button,i=s.modifiers.every((t=>{switch(t){case"alt":return e.altKey;case"ctrl":return e.ctrlKey||e.metaKey;case"shift":return e.shiftKey}}));return t&&i}}return!1}(e,l.behaviour.triggers))return;const r=x(l.startAreas,l.document),c=x(l.boundaries,l.document);this._targetElement=c.find((e=>S(e.getBoundingClientRect(),a)));const h=e.composedPath();if(!this._targetElement||!r.find((e=>h.includes(e)))||!c.find((e=>h.includes(e)))||!t&&!1===this._emitEvent("beforestart",e))return;this._areaLocation={x1:s,y1:i,x2:0,y2:0};const u=n.scrollingElement??n.body;this._scrollDelta={x:u.scrollLeft,y:u.scrollTop},this._singleClick=!0,this.clearSelection(!1,!0),y(n,["touchmove","mousemove"],this._delayedTapMove,{passive:!1}),y(n,["mouseup","touchcancel","touchend"],this._onTapStop),y(n,"scroll",this._onScroll)}_onSingleTap(e){const{singleTap:{intersect:t},range:s}=this._options.features,i=E(e);let o;if("native"===t)o=i.target;else if("touch"===t){this.resolveSelectables();const{x:e,y:t}=i;o=this._selectables.find((s=>{const{right:i,left:o,top:l,bottom:n}=s.getBoundingClientRect();return e<i&&e>o&&t<n&&t>l}))}if(!o)return;for(this.resolveSelectables();!this._selectables.includes(o);){if(!o.parentElement)return;o=o.parentElement}const{stored:l}=this._selection;if(this._emitEvent("start",e),e.shiftKey&&s&&this._latestElement){const e=this._latestElement,[t,s]=4&e.compareDocumentPosition(o)?[o,e]:[e,o],i=[...this._selectables.filter((e=>4&e.compareDocumentPosition(t)&&2&e.compareDocumentPosition(s))),t,s];this.select(i),this._latestElement=e}else l.includes(o)&&(1===l.length||e.ctrlKey||l.every((e=>this._selection.stored.includes(e))))?this.deselect(o):(this.select(o),this._latestElement=o);this._emitEvent("stop",e)}_delayedTapMove(e){const{container:t,document:s,behaviour:{startThreshold:i}}=this._options,{x1:o,y1:l}=this._areaLocation,{x:n,y:a}=E(e);if("number"==typeof i&&w(n+a-(o+l))>=i||"object"==typeof i&&w(n-o)>=i.x||w(a-l)>=i.y){if(b(s,["mousemove","touchmove"],this._delayedTapMove,{passive:!1}),!1===this._emitEvent("beforedrag",e))return void b(s,["mouseup","touchcancel","touchend"],this._onTapStop);y(s,["mousemove","touchmove"],this._onTapMove,{passive:!1}),f(this._area,"display","block"),x(t,s)[0].appendChild(this._clippingElement),this.resolveSelectables(),this._singleClick=!1,this._targetRect=this._targetElement.getBoundingClientRect(),this._scrollAvailable=this._targetElement.scrollHeight!==this._targetElement.clientHeight||this._targetElement.scrollWidth!==this._targetElement.clientWidth,this._scrollAvailable&&(y(this._targetElement,"wheel",this._manualScroll,{passive:!1}),this._selectables=this._selectables.filter((e=>this._targetElement.contains(e)))),this._setupSelectionArea(),this._emitEvent("start",e),this._onTapMove(e)}this._handleMoveEvent(e)}_setupSelectionArea(){const{_clippingElement:e,_targetElement:t,_area:s}=this,i=this._targetRect=t.getBoundingClientRect();this._scrollAvailable?(f(e,{top:i.top,left:i.left,width:i.width,height:i.height}),f(s,{marginTop:-i.top,marginLeft:-i.left})):(f(e,{top:0,left:0,width:"100%",height:"100%"}),f(s,{marginTop:0,marginLeft:0}))}_onTapMove(e){const{x:t,y:s}=E(e),{_scrollSpeed:i,_areaLocation:o,_options:l,_frame:n}=this,{speedDivider:a}=l.behaviour.scrolling,r=this._targetElement;if(o.x2=t,o.y2=s,this._scrollAvailable&&!this._scrollingActive&&(i.y||i.x)){this._scrollingActive=!0;const t=()=>{if(!i.x&&!i.y)return void(this._scrollingActive=!1);const{scrollTop:s,scrollLeft:l}=r;i.y&&(r.scrollTop+=L(i.y/a),o.y1-=r.scrollTop-s),i.x&&(r.scrollLeft+=L(i.x/a),o.x1-=r.scrollLeft-l),n.next(e),requestAnimationFrame(t)};requestAnimationFrame(t)}else n.next(e);this._handleMoveEvent(e)}_handleMoveEvent(e){const{features:t}=this._options;(t.touch&&matchMedia("(hover: none), (pointer: coarse)").matches||this._scrollAvailable&&"safari"in window)&&e.preventDefault()}_onScroll(){const{_scrollDelta:e,_options:{document:t}}=this,{scrollTop:s,scrollLeft:i}=t.scrollingElement??t.body;this._areaLocation.x1+=e.x-i,this._areaLocation.y1+=e.y-s,e.x=i,e.y=s,this._setupSelectionArea(),this._frame.next(null)}_manualScroll(e){const{manualSpeed:t}=this._options.behaviour.scrolling,s=e.deltaY?e.deltaY>0?1:-1:0,i=e.deltaX?e.deltaX>0?1:-1:0;this._scrollSpeed.y+=s*t,this._scrollSpeed.x+=i*t,this._onTapMove(e),e.preventDefault()}_recalculateSelectionAreaRect(){const{_scrollSpeed:e,_areaLocation:t,_areaRect:s,_targetElement:i,_options:o}=this,{scrollTop:l,scrollHeight:n,clientHeight:a,scrollLeft:r,scrollWidth:c,clientWidth:h}=i,u=this._targetRect,{x1:d,y1:p}=t;let{x2:v,y2:_}=t;const{behaviour:{scrolling:{startScrollMargins:m}}}=o;v<u.left+m.x?(e.x=r?-w(u.left-v+m.x):0,v=v<u.left?u.left:v):v>u.right-m.x?(e.x=c-r-h?w(u.left+u.width-v-m.x):0,v=v>u.right?u.right:v):e.x=0,_<u.top+m.y?(e.y=l?-w(u.top-_+m.y):0,_=_<u.top?u.top:_):_>u.bottom-m.y?(e.y=n-l-a?w(u.top+u.height-_-m.y):0,_=_>u.bottom?u.bottom:_):e.y=0;const f=A(d,v),g=A(p,_),y=T(d,v),b=T(p,_);s.x=f,s.y=g,s.width=y-f,s.height=b-g}_redrawSelectionArea(){const{x:e,y:t,width:s,height:i}=this._areaRect,{style:o}=this._area;o.left=`${e}px`,o.top=`${t}px`,o.width=`${s}px`,o.height=`${i}px`}_onTapStop(e,t){var s;const{document:i,features:o}=this._options,{_singleClick:l}=this;b(i,["mousemove","touchmove"],this._delayedTapMove),b(i,["touchmove","mousemove"],this._onTapMove),b(i,["mouseup","touchcancel","touchend"],this._onTapStop),b(i,"scroll",this._onScroll),this._keepSelection(),e&&l&&o.singleTap.allow?this._onSingleTap(e):!l&&!t&&(this._updateElementSelection(),this._emitEvent("stop",e)),this._scrollSpeed.x=0,this._scrollSpeed.y=0,b(this._targetElement,"wheel",this._manualScroll,{passive:!0}),this._clippingElement.remove(),null==(s=this._frame)||s.cancel(),f(this._area,"display","none")}_updateElementSelection(){const{_selectables:e,_options:t,_selection:s,_areaRect:i}=this,{stored:o,selected:l,touched:n}=s,{intersect:a,overlap:r}=t.behaviour,c="invert"===r,h=[],u=[],d=[];for(let v=0;v<e.length;v++){const t=e[v];if(S(i,t.getBoundingClientRect(),a)){if(l.includes(t))o.includes(t)&&!n.includes(t)&&n.push(t);else{if(c&&o.includes(t)){d.push(t);continue}u.push(t)}h.push(t)}}c&&u.push(...o.filter((e=>!l.includes(e))));const p="keep"===r;for(let v=0;v<l.length;v++){const e=l[v];!h.includes(e)&&(!p||!o.includes(e))&&d.push(e)}s.selected=h,s.changed={added:u,removed:d},this._latestElement=void 0}_emitEvent(e,t){return this.emit(e,{event:t,store:this._selection,selection:this})}_keepSelection(){const{_options:e,_selection:t}=this,{selected:s,changed:i,touched:o,stored:l}=t,n=s.filter((e=>!l.includes(e)));switch(e.behaviour.overlap){case"drop":t.stored=[...n,...l.filter((e=>!o.includes(e)))];break;case"invert":t.stored=[...n,...l.filter((e=>!i.removed.includes(e)))];break;case"keep":t.stored=[...l,...s.filter((e=>!l.includes(e)))]}}trigger(e,t=!0){this._onTapStart(e,t)}resolveSelectables(){this._selectables=x(this._options.selectables,this._options.document)}clearSelection(e=!0,t=!1){const{selected:s,stored:i,changed:o}=this._selection;o.added=[],o.removed.push(...s,...e?i:[]),t||(this._emitEvent("move",null),this._emitEvent("stop",null)),this._selection={stored:e?[]:i,selected:[],touched:[],changed:{added:[],removed:[]}}}getSelection(){return this._selection.stored}getSelectionArea(){return this._area}cancel(e=!1){this._onTapStop(null,!e)}destroy(){this.cancel(),this.disable(),this._clippingElement.remove(),super.unbindAllListeners()}select(e,t=!1){const{changed:s,selected:i,stored:o}=this._selection,l=x(e,this._options.document).filter((e=>!i.includes(e)&&!o.includes(e)));return o.push(...l),i.push(...l),s.added.push(...l),s.removed=[],this._latestElement=void 0,t||(this._emitEvent("move",null),this._emitEvent("stop",null)),l}deselect(e,t=!1){const{selected:s,stored:i,changed:o}=this._selection,l=x(e,this._options.document).filter((e=>s.includes(e)||i.includes(e)));l.length&&(this._selection.stored=i.filter((e=>!l.includes(e))),this._selection.selected=s.filter((e=>!l.includes(e))),this._selection.changed.added=[],this._selection.changed.removed.push(...l.filter((e=>!o.removed.includes(e)))),this._latestElement=void 0,t||(this._emitEvent("move",null),this._emitEvent("stop",null)))}}v(P,"version","3.5.0");const C=({filteredFiles:s,basePath:i})=>{const l=o([]),h=n((()=>new Set(l.value)));c(s,(()=>{l.value=[]}));const u=o(),{selectionArea:d}=(({containerRef:e,onStart:t,onStop:s,toggleClass:i="active",selectables:l=[".selectable"]})=>{const n=o();return a((()=>{n.value=new P({selectables:l,boundaries:[e.value],features:{touch:!1,singleTap:{allow:!1}},container:e.value}).on("start",(({store:e,event:s})=>{s.ctrlKey||s.metaKey||(n.value.clearSelection(),setTimeout((()=>{t&&t()})))})).on("move",(({store:{changed:{added:e,removed:t}}})=>{for(const s of e)s.classList.add(i);for(const s of t)s.classList.remove(i)})).on("stop",(({store:{stored:e}})=>{setTimeout((()=>{s&&s(e)}))}))})),r((()=>{n.value&&n.value.destroy()})),{selectionArea:n}})({containerRef:u,onStart:()=>{l.value=[]},onStop:e=>{const t={};s.value.forEach((e=>{t[e.name]=e}));const i=[];e.forEach((e=>{const s=e.getAttribute("data-name");s&&t[s]&&i.push(t[s])})),l.value=i}}),p=n((()=>l.value.map((t=>e(i.value+"/"+t.name)))));return{selectedItems:l,selectedItemsSet:h,explorerContentRef:u,toggleSelect:({item:e,event:i,toggle:o=!1})=>{if(i.ctrlKey||i.metaKey||o)l.value=t([...l.value],e);else if(i.shiftKey){let t=0;const i=l.value[0];i&&(t=s.value.findIndex((e=>e.name===i.name)));let o=s.value.findIndex((t=>t.name===e.name));t>o&&([o,t]=[t,o]),l.value=s.value.slice(t,o+1)}else l.value=[e]},toggleSelectAll:()=>{const e=s.value;l.value.length===e.length?l.value=[]:l.value=[...e]},selectedPaths:p,selectionArea:d}},M=({selectedPaths:e,basePath:t,isLoading:i,emit:o})=>{const l=h({cutPaths:[],copyPaths:[]});return{enablePaste:n((()=>l.cutPaths.length>0||l.copyPaths.length>0)),handleCut:()=>{l.copyPaths=[],l.cutPaths=e.value},handleCopy:()=>{l.cutPaths=[],l.copyPaths=e.value},handlePaste:async()=>{let e=[],n=!1;if(l.cutPaths.length)e=l.cutPaths,n=!0;else{if(!l.copyPaths.length)return;e=l.copyPaths}try{i.value=!0,await s.copyPaste({fromPaths:e,toPath:t.value,isMove:n}),l.cutPaths=[],l.copyPaths=[],o("refresh")}finally{i.value=!1}}}},R=({emit:e})=>{const t=o(null),{appendHistory:s,historyMenuOptions:l,openedHistory:a}=u("mc_explorer_local_dir3",(async s=>{await i(s),e("refresh"),t.value=s})),r=async()=>{await i(),e("refresh"),t.value=null};return{handleOpenLocalDir:async()=>{const o=await window.showDirectoryPicker();await i(o),e("refresh"),await s(o),t.value=o},localDirHistoryOptions:n((()=>{const e=[...l.value];return t.value&&e.push({label:"✖️ Close Local Folder",props:{onClick:r}}),e}))}};export{M as a,R as b,d as c,C as u};
