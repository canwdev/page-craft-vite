import{u as t,O as e,c as o}from"./ai-settings-DzpbuIZi.js";import{u as s}from"./index-B89s4h30.js";const r=()=>{const r=t(),n=s(),a=()=>{n.isShowSettings=!0,setTimeout((()=>{const t=document.querySelector('.system-settings .c-panel-item[data-key="ai"]');t&&(t.scrollIntoView({behavior:"smooth"}),(async(t,e=3)=>{const o=t.style.backgroundColor;t.style.transition="background-color 0.5s ease";const s=async e=>{t.style.backgroundColor=e,await new Promise((t=>setTimeout(t,300))),t.style.backgroundColor=o,await new Promise((t=>setTimeout(t,300)))};for(let r=0;r<e;r++)await s("var(--primary)");t.style.backgroundColor=o,t.style.transition=""})(t))}),800)},i=async(t={},o)=>{var s,n;const i=r.openAiApiProxy||"https://api.openai.com/v1";t={model:r.model,stream:r.stream,...t};const c=await fetch(`${i}/chat/completions`,{method:"POST",headers:{Authorization:`Bearer ${r.openAiApiKey}`,"Content-Type":"application/json"},body:JSON.stringify(t)}),l=e[c.status];if(l){401===c.status&&a();const t=await c.json();throw new Error(`${l}\n\n${t.error.message}`)}if(!c.ok)throw new Error(`HTTP error! status: ${c.status}`);if(t.stream&&"function"==typeof o){const t=c.body.getReader(),e=new TextDecoder("utf-8");let r="";for(;;){const{done:r,value:a}=await t.read();if(r)break;const i=e.decode(a,{stream:!0}).split("\n").filter((t=>""!==t.trim()));for(const t of i)if(t.startsWith("data: ")){const e=t.replace("data: ","");if("[DONE]"!==e)try{const t=null==(n=null==(s=JSON.parse(e).choices[0])?void 0:s.delta)?void 0:n.content;t&&o(t)}catch(u){console.error("Error parsing JSON:",u),console.error("JSON:",e)}}}return r}return await c.json()};return{requestChatCompletion:i,requestAiChatMessage:async t=>{var e;return((null==(e=(await i({messages:t,stream:!1})).choices[0])?void 0:e.message)||{}).content||""},canUseVision:t=>{var e;return(null==(e=o.find((e=>e.value===t)))?void 0:e.vision)||!1}}},n=(t,e,o)=>[{role:"system",content:`你是一个后台翻译服务，负责翻译多语言文案，帮我翻译并只返回json内容，不需要markdown格式。json格式为：\`${JSON.stringify(t)}\``},{role:"user",content:`翻译内容(${e}):\n\`${o}\``}],a=(t,e)=>[{content:"你是一名擅长会话的助理，你需要将用户的会话总结为 10 个字以内的标题",role:"system"},{content:`${t.map((t=>`${t.role}:${t.content}`)).join("\n")}\n\n请总结上述对话为10个字以内的标题，不需要包含标点符号，输出语言为：${e}`,role:"user"}];export{a,n as t,r as u};
