import{d as e,U as t,V as a,D as s,u as o,r as i,aK as n,a9 as l,M as r,aL as c,aM as u,_ as m,i as p,k as d,o as v,b as w,O as g,L as f,T as h,e as y,F as S,m as b,w as _,Y as j,aA as D,f as k,p as T,g as $,ac as x}from"./index-D7imv_Md.js";/* empty css                   *//* empty css                      *//* empty css                        */import{I as F,T as O}from"./I18nToolSettings-DP12AL1N.js";import{D as C,u as I}from"./use-file-drop-D66jDkLh.js";import{a as N,u as H}from"./use-beforeunload-walRddPp.js";import{u as J}from"./file-history-CLLvp5b9.js";import{C as L}from"./CommonNavbar-BfH5DtYm.js";/* empty css                  */import"./use-model-wrapper-B0P8Zqss.js";import"./index-BR_HEkHY.js";import"./index-CP_TvyA7.js";import"./index.vue_vue_type_script_setup_true_lang-B7mdx2Oz.js";import"./RectSwitch-DEmfWnCV.js";import"./use-common-settings-DTmbioT3.js";import"./useIDBKeyval-BIf4fra4.js";const R={types:[{description:"JSON",accept:{"application/JSON":[".json"]}}]},E=e({name:"VueI18nEditTool",components:{DropdownMenu:t,CommonNavbar:L,QuickOptions:a,I18nToolSettings:F,TranslateTreeItem:O,DropZone:C},setup(){const{t:e}=s(),t=o(),a=i(n.parseWithRoot()),m=i(!1),{appendHistory:p,historyMenuOptions:d}=J(l.I18N_FILE_HANDLE_HISTORY,(async e=>{v.value=e;const t=await e.getFile();await w(t)})),v=r(),w=async e=>{try{m.value=!0;const t=await c(e),s=JSON.parse(t);a.value=n.parseWithRoot(s)}catch(t){console.error(t),window.$message.error(t.message)}finally{m.value=!1}},g=async()=>{try{if(m.value=!0,!v.value)return;const t=await v.value.createWritable(),s=JSON.stringify(u(a.value),null,2);await t.write(s),await t.close(),window.$message.success(e("msgs.saved"))}catch(t){console.error(t),window.$message.error(t.message)}finally{m.value=!1}},f=async()=>{var t;try{m.value=!0,console.log(a.value);const s=JSON.stringify(u(a.value),null,2),o=await window.showSaveFilePicker({suggestedName:null==(t=v.value)?void 0:t.name,...R}),i=await o.createWritable();await i.write(s),await i.close(),window.$message.success(e("msgs.saved"))}catch(s){console.error(s),window.$message.error(s.message)}finally{m.value=!1}};N((()=>{v.value?g():f()})),H((()=>!!v.value));const h=i(!1);return{translateTreeRoot:a,fileHandle:v,handleImport:w,handleSelectFile:async()=>{const[e]=await window.showOpenFilePicker(R);await p(e),v.value=e;const t=await e.getFile();await w(t)},handleCloseFile:()=>{v.value=void 0,a.value=n.parseWithRoot()},handleSaveFile:g,handleExport:f,loadDemo:()=>{a.value=n.parseWithRoot({hello_world:{section_a:{test_str:"This is a test string",test_arr:["line 1","line 2","line 3"],test_number:114514,"":"ä¸­Englishæ··åˆ"},section_b:{"":"Blur this input and it'll generate the key automatically!"},section_c:{"":"å¹³è¡Œã€è¡Œåˆ—"}}})},...I({cb:async e=>{try{m.value=!0;for(const t of e.dataTransfer.items)if("file"===t.kind){const e=await t.getAsFileSystemHandle();if("directory"!==e.kind){await p(e),v.value=e;const t=await e.getFile();await w(t)}else window.$message.error("Please drag and drop a json file here!")}}catch(t){console.error(t),window.$message.error(t.message)}finally{m.value=!1}}}),mainStore:t,isShowToolSettings:h,isLoading:m,historyMenuOptions:d}}}),M={class:"flex-row-center-gap"},W={class:"vp-button"},z={class:"vp-button"},A={class:"scroll-content scrollbar-mini"},K={class:"i18n-container"},P=y("div",{class:"height-placeholder"},null,-1);const Q=m(E,[["render",function(e,t,a,s,o,i){const n=p("DropZone"),l=x,r=p("DropdownMenu"),c=p("CommonNavbar"),u=p("TranslateTreeItem"),m=p("I18nToolSettings"),F=j;return d((v(),w("div",{class:"vue-i18n-edit-tool i18n-style",onDragover:t[8]||(t[8]=_(((...t)=>e.fileDragover&&e.fileDragover(...t)),["prevent","stop"])),onDragleave:t[9]||(t[9]=_((t=>e.showDropzone=!1),["prevent","stop"])),onDrop:t[10]||(t[10]=_(((...t)=>e.fileDrop&&e.fileDrop(...t)),["prevent","stop"]))},[g(h,{name:"mc-fade"},{default:f((()=>[d(g(n,{"position-fixed":"",text:e.$t("msgs.drag_file_here")},null,8,["text"]),[[D,e.showDropzone]])])),_:1}),g(c,null,{extra:f((()=>[y("div",M,[y("button",{class:"vp-button",onClick:t[0]||(t[0]=t=>e.isShowToolSettings=!0)},k(e.$t("common.settings")),1),y("button",{class:"vp-button",onClick:t[1]||(t[1]=t=>e.mainStore.isShowQuickLaunch=!e.mainStore.isShowQuickLaunch)},k(e.$t("common.toolbox")),1),e.fileHandle?(v(),T(l,{key:0,onConfirm:t[2]||(t[2]=t=>e.handleCloseFile()),title:e.$t("msgs.confirm_close")},{reference:f((()=>[y("button",W,"ðŸ’» "+k(e.$t("actions.close"))+" JSON",1)])),_:1},8,["title"])):(v(),T(r,{key:1,options:e.historyMenuOptions},{default:f((()=>[y("button",{class:"vp-button primary",onClick:t[3]||(t[3]=t=>e.handleSelectFile())}," ðŸ’» "+k(e.$t("actions.open"))+" JSON ",1)])),_:1},8,["options"])),e.fileHandle?(v(),w("button",{key:2,class:"vp-button primary",onClick:t[4]||(t[4]=t=>e.handleSaveFile())}," ðŸ’¾ "+k(e.$t("actions.save")),1)):$("",!0),y("button",{class:"vp-button",onClick:t[5]||(t[5]=t=>e.handleExport())},k(e.$t("actions.save_as"))+" ...",1),g(l,{onConfirm:t[6]||(t[6]=t=>e.loadDemo()),title:e.$t("msgs.load_demo_this_will")},{reference:f((()=>[y("button",z,k(e.$t("common.demo")),1)])),_:1},8,["title"])])])),_:1}),y("div",A,[y("div",K,[(v(!0),w(S,null,b(e.translateTreeRoot,((t,a)=>{var s;return v(),T(u,{key:a,item:t,index:a,title:null==(s=e.fileHandle)?void 0:s.name},null,8,["item","index","title"])})),128)),P])]),g(m,{visible:e.isShowToolSettings,"onUpdate:visible":t[7]||(t[7]=t=>e.isShowToolSettings=t)},null,8,["visible"])],32)),[[F,e.isLoading]])}]]);export{Q as default};
