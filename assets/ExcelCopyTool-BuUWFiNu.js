import{d as e,f as o,g as s,h as t,i as n,s as a,w as l,o as i,j as r,T as c,k as d,l as u,m,t as p,n as w,p as h,q as f,v as y,_,r as v,a as g,c as C,b as S,x as b,y as x,e as k,z as X,A as L,B as D,C as N,D as T,E,G as R,H as O,F as j,I as $,J as z,K as F,L as A,N as I,O as J,P as M}from"./index-DyP2wrK1.js";import{D as P,u as B}from"./use-file-drop-DqPgQeaM.js";import{C as H}from"./CommonNavbar-C_V8SAgV.js";import{_ as K,a as U}from"./Tabs-cevhg49F.js";const W=e=>new Promise(((o,s)=>{if(document.getElementById(e))o();else{const t=document.createElement("script");t.src=e,t.id=e,t.onload=function(){this.onerror=this.onload=null,o()},t.onerror=function(e){this.onerror=this.onload=null,s(e)},document.body.appendChild(t)}}));window.demo_aoa_to_sheet=[["Name","Value","Num","Time","âœ¨Tips"],["test001","line1\nline2",123,new Date,"You can set window.json_to_sheet = [] to generate table!"],["test001","line1\n\nline3",-1,new Date,"window.json_to_sheet"]],window.demo_json_to_sheet=[{region:"DE",product_name:"Test1",code:"123456",url:"http://localhost:8080",tips:"âœ¨ You can set window.demo_json_to_sheet = [] to generate table!"},{region:"FR",product_name:"Test2",code:"7890",url:"https://example.com",tips:"window.demo_json_to_sheet"}];const Y=e({name:"ExcelCopyTool",components:{CommonNavbar:H,FileChooser:o,DropZone:P},setup(){const{t:e}=s(),o=t(),_=n(),v=n(),g=n(!1),C=a(null),S=a(),b=n([]),x=n(0);l(x,(()=>{L()}));const k=()=>{if(!g.value){const e="XLSX Not Ready!";throw window.$message.error(e),new Error(e)}},X=e=>(b.value=e.SheetNames,e.Sheets[b.value[x.value]]),L=()=>{const e=S.value;if(!e)return void(v.value.innerHTML="");console.log("[renderWorkbook]",e);const o=window.XLSX.utils.sheet_to_html(X(e));v.value.innerHTML=o},D=async e=>{if(C.value=null,k(),!/\.xlsx$/g.test(e.name))return void window.$message.error("Only supports reading xlsx format!");const o=new FileReader;S.value=null,o.onload=function(o){C.value=e;const s=o.target.result;x.value=0,S.value=window.XLSX.read(s,{type:"binary"}),L()},o.readAsBinaryString(e)},N=n(!0);i((async()=>{await(async()=>{if(window.XLSX)g.value=!0;else{try{await W("./lib/xlsx.mini.js")}catch(e){window.$message.error(e.message),console.error(e)}window.$message.success("XLSX Ready!"),console.log("XLSX ready",window.XLSX),g.value=!0}})()}));const T=r("excel_copy_tool_copy_mode",c.HTML,localStorage,{listenToStorageChanges:!1}),E=({currentOnly:e=!1}={})=>{const o=e=>{const o=T.value;return o===c.DISABLED||o===c.TEXT?e:e.map((e=>{for(const s in e)"string"==typeof e[s]&&(e[s]=p(e[s],o));return e}))};if(!S.value){const e="Please open Excel file first!";throw window.$message.error(e),new Error(e)}if(e){const e=window.XLSX.utils.sheet_to_json(X(S.value));return o(e)}const s=S.value,t={};return s.SheetNames.forEach((function(e){const n=window.XLSX.utils.sheet_to_row_object_array(s.Sheets[e]);n.length>0&&(t[e]=o(n))})),t},R=async(e={})=>{var o;const s=E(e);let t=null==(o=C.value)?void 0:o.name;t&&(t=t.substring(0,t.lastIndexOf("."))),h(await f(t,"excel_sheet_export"),JSON.stringify(s,null,2),".json")};d((async()=>{await R()}));const O=[{label:"ðŸ§© Current Sheet",children:[{label:"ðŸ“¤ Export JSON",props:{onClick:async()=>{await R({currentOnly:!0})}}},{label:"ðŸ“‹ Copy JSON",props:{onClick:async()=>{const e=E({currentOnly:!0});await w(JSON.stringify(e,null,2)),window.$message.success("Sheet JSON Copied!")}}},{label:"ðŸ’» Print to Console",props:{onClick:async()=>{const e=E({currentOnly:!0});console.log(e),window.$message.success("Print to Console!")}}}]},{label:"ðŸ“— All Sheets",children:[{label:"ðŸ“¤ Export All JSON",props:{onClick:async()=>{await R()}}},{label:"ðŸ“‹ Copy All JSON",props:{onClick:async()=>{const e=E();await w(JSON.stringify(e,null,2)),window.$message.success("Sheet JSON Copied!")}}},{label:"ðŸ’» Print All to Console",props:{onClick:async()=>{const e=E();console.log(e),window.$message.success("Print to Console!")}}}]}],j=()=>{C.value=null,S.value=null,b.value=[],x.value=0,v.value.innerHTML=""};return u((()=>{j()})),{sheetNames:b,sheetNameIndex:x,handleImport:D,importFileChooserRef:_,loadDemo:()=>{k();const e=window.XLSX.utils.aoa_to_sheet(window.demo_aoa_to_sheet),o=window.XLSX.utils.json_to_sheet(window.demo_json_to_sheet),s=window.XLSX.utils.book_new();window.XLSX.utils.book_append_sheet(s,e,"aoa_to_sheet"),window.XLSX.utils.book_append_sheet(s,o,"json_to_sheet"),x.value=0,S.value=s,L()},tableWrapperElRef:v,handleClick:o=>{let s=o.target;if(!(e=>"td"===e.tagName.toLowerCase())(s)||!T.value||T.value===c.DISABLED)return;if(!s.innerText)return;let t=s.innerText;console.log(T.value);let n="";t=o.ctrlKey&&o.altKey?p(t,n=c.JSON):o.ctrlKey?p(t,n=c.TEXT):o.altKey?p(t,n=c.HTML):p(t,n=T.value),w(t),window.$message.success(n+" "+e("msgs.copy_success"));const a=document.createRange();a.selectNode(s);const l=window.getSelection();l&&(l.removeAllRanges(),l.addRange(a))},copyMode:T,modTextConvertOptions:m((()=>[{label:"Disabled",value:c.DISABLED},...y])),dropdownMenuOptions:O,textConvertMultipleLine:p,...B({cbFiles:e=>{e.length&&D(e[0])}}),isTrimEmptyLines:N,mainStore:o,isReady:g,workbookRef:S,fileRef:C,handleCloseFile:j}}}),Z={key:0,class:"mc-loading-container"};const q=_(Y,[["render",function(e,o,s,t,n,a){const l=v("DropZone"),i=z,r=F,c=A,d=I,u=J,m=v("CommonNavbar"),p=M,w=K,h=U,f=N,y=v("FileChooser");return g(),C("div",{class:"excel-copy-tool",onDragover:o[6]||(o[6]=D(((...o)=>e.fileDragover&&e.fileDragover(...o)),["prevent","stop"])),onDragleave:o[7]||(o[7]=D((o=>e.showDropzone=!1),["prevent","stop"])),onDrop:o[8]||(o[8]=D(((...o)=>e.fileDrop&&e.fileDrop(...o)),["prevent","stop"]))},[S(x,{name:"mc-fade"},{default:b((()=>[T(S(l,{"position-fixed":"",text:"Drop Excel file here"},null,512),[[E,e.showDropzone]])])),_:1}),k("div",null,[S(m,null,{extra:b((()=>[S(d,null,{default:b((()=>[S(d,{size:"small",align:"center"},{default:b((()=>[S(i,{size:"small",checked:e.isTrimEmptyLines,"onUpdate:checked":o[0]||(o[0]=o=>e.isTrimEmptyLines=o)},{default:b((()=>[R(O(e.$t("msgs.trim_empty_lines")),1)])),_:1},8,["checked"]),S(r,{text:"",onClick:o[1]||(o[1]=o=>e.mainStore.isShowTextTransformer=!0)},{default:b((()=>[R(O(e.$t("common.text_transformer"))+":",1)])),_:1}),S(c,{size:"small",value:e.copyMode,"onUpdate:value":o[2]||(o[2]=o=>e.copyMode=o),options:e.modTextConvertOptions,style:{width:"100px"}},null,8,["value","options"])])),_:1}),e.workbookRef?(g(),X(u,{key:0,options:e.dropdownMenuOptions,placement:"bottom-start","key-field":"label",disabled:!e.isReady},{default:b((()=>[S(r,{size:"small"},{default:b((()=>[R("ðŸ’» "+O(e.$t("actions.export")),1)])),_:1})])),_:1},8,["options","disabled"])):L("",!0),e.fileRef?(g(),X(r,{key:2,type:"primary",size:"small",onClick:e.handleCloseFile},{default:b((()=>[R(O(e.$t("actions.close")),1)])),_:1},8,["onClick"])):(g(),X(r,{key:1,type:"primary",disabled:!e.isReady,onClick:o[3]||(o[3]=o=>e.importFileChooserRef.chooseFile()),size:"small"},{default:b((()=>[R(O(e.$t("actions.open")+" Excel"),1)])),_:1},8,["disabled"])),e.fileRef?L("",!0):(g(),X(r,{key:3,onClick:e.loadDemo,size:"small",disabled:!e.isReady},{default:b((()=>[R(O(e.$t("common.demo")),1)])),_:1},8,["onClick","disabled"]))])),_:1})])),_:1}),S(x,{name:"mc-fade"},{default:b((()=>[e.isReady?L("",!0):(g(),C("div",Z,[S(p)]))])),_:1}),e.isReady?(g(),X(f,{key:0,class:"sheet-name-card",size:"small"},{default:b((()=>[S(h,{size:"small",type:"card",animated:"",value:e.sheetNameIndex,"onUpdate:value":o[4]||(o[4]=o=>e.sheetNameIndex=o)},{default:b((()=>[(g(!0),C(j,null,$(e.sheetNames,((e,o)=>(g(),X(w,{style:{padding:"0"},name:o,tab:e,key:e},null,8,["name","tab"])))),128))])),_:1},8,["value"])])),_:1})):L("",!0)]),k("div",{ref:"tableWrapperElRef",class:"excel-table-container vp-bg",onClick:o[5]||(o[5]=(...o)=>e.handleClick&&e.handleClick(...o))},null,512),S(y,{ref:"importFileChooserRef",accept:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",onSelected:e.handleImport},null,8,["onSelected"])],32)}]]);export{q as default};
