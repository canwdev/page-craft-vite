import{ct as e,s as l,av as t,P as s,a9 as a,d as o,t as n,r as i,N as u,ax as c,ay as r,ao as p,az as d,ah as m,c as v,e as y,o as f,F as g,f as b,n as h,I as w,Y as C,p as _,g as x,U as S,y as k,Q as j,T as A,k as R,h as L,aH as $,a2 as V,a1 as E,w as I,i as B,V as T,a3 as U,S as P,cu as M}from"./index-BJklM7uy.js";import{k as N,l as O}from"./index.vue_vue_type_style_index_0_lang-CaxFaCA6.js";import{T as F}from"./TabLayout-r0pFeegw.js";import{V as K,m as G}from"./index-BB5hC_Ln.js";import{u as q}from"./use-remote-options-Ev17mjgO.js";import{m as z}from"./CraftPage-n-odtKRr.js";/* empty css                  *//* empty css                        *//* empty css                        *//* empty css                   *//* empty css                    */import"./enum-CdO7LyZZ.js";import"./use-beforeunload-cpGEAtLA.js";import"./index-BVPZ2aTg.js";import"./index-vcidOvW8.js";import"./use-model-wrapper-Cm8bqa9M.js";import"./index.vue_vue_type_style_index_0_lang-B7OiTwk5.js";import"./set-Clims6tx.js";import"./QuickContextMenu.vue_vue_type_script_setup_true_lang-DIpGAXu5.js";/* empty css                      */import"./use-navigation-B_J1vU-v.js";import"./file-history-DSZQkfOk.js";import"./useIDBKeyval-vbfvgNrE.js";/* empty css                   */var J=(e=>(e.GLOBAL="global",e.VARIABLES="variables",e.CURRENT="current",e))(J||{});const D=o({__name:"ElementByPoint",props:{parentClass:{default:void 0}},emits:["select"],setup(e,{emit:l}){const t=e,{parentClass:s}=n(t),a=l,o=i(null);u((()=>{s.value&&(o.value=document.querySelector(s.value))}));const{x:w,y:C}=c({type:"client"}),{element:_}=r({x:w,y:C}),x=p(d(_));m("scroll",x.update,!0);const S=v((()=>!(o.value&&!o.value.contains(_.value)||o.value===_.value))),k=v((()=>_.value&&S.value?{display:"block",width:`${x.width}px`,height:`${x.height}px`,left:`${x.left}px`,top:`${x.top}px`,transition:"all 0.05s linear"}:{display:"none"})),j=v((()=>({transform:`translate(calc(${w.value}px - 50%), calc(${C.value}px - 50%))`,color:S.value?"white":"grey"})));return m("click",(e=>{S.value&&(e.stopPropagation(),e.preventDefault(),a("select",_.value))}),{capture:!0}),(e,l)=>(f(),y(g,null,[b("div",{style:h(k.value),class:"mc-element-by-point-box"},null,4),b("div",{style:h(j.value),class:"mc-element-by-point-pointer"},null,4)],64))}}),Y=["title"],Q=["title"],H=["title"],X=["title"],W={class:"style-editor-inner"},Z={key:0,class:"style-editor-action-bar"},ee={class:"code-editor-placeholder"},le=o({__name:"index",props:{visible:{type:Boolean,default:!1},selecting:{type:Boolean,default:!1},selectingParentClass:{default:void 0},showTabs:{type:Boolean,default:!1},styleCode:{default:""}},emits:["update:visible","update:selecting","onFormat","onInsertCode","update:styleCode"],setup(o,{expose:c,emit:r}){const p=o,{showTabs:d}=n(p),h=r,{t:le}=w(),te=C(p,"visible",h),se=e(),{globalStyleCode:ae}=(()=>{const o=e(),n=l(t.GLOBAL_STYLE,"");s(n,(e=>{i()}));const i=async()=>{try{o.globalCSS=n.value?await a(n.value):""}catch(e){window.$message.error(e.message)}};return{globalStyleCode:n}})(),oe=l(t.VARIABLES_STYLE,""),ne=C(p,"styleCode",h,{passive:!0});s(ne,(()=>{ve()}));const ie=i(),ue=i(!1),ce=()=>{const e=ie.value.getInstance();null==e||e.layout()},re=()=>{ue.value||setTimeout((()=>{ie.value.getInstance().focus()}),100)};s(te,(e=>{e&&(ce(),re())})),s(ue,(e=>{e||re()}));const pe=i(),de=()=>{console.warn(pe.value.message,{...pe.value}),setTimeout((()=>{pe.value=null}),500)},me=i(""),ve=async(e=!1)=>{try{const l=oe.value+"\n"+ne.value;if(me.value===l&&!e)return;me.value=l;const t=l?await a(l):"";se.currentCSS=t,pe.value=""}catch(l){pe.value=l}};s(oe,(()=>{ve()}),{immediate:!0}),N("PlaygroundPageStyleSync",(()=>{ve(!0)}));const ye=async()=>{var e;const l=ie.value.getInstance(),t=l.getValue();if(t.trim()){const s=O(t);if(t.trim()!==s.trim()){const t=null==(e=l.getModel())?void 0:e.getFullModelRange();t?l.executeEdits(null,[{text:s,range:t}]):ne.value=s}}l.focus(),h("onFormat")},fe=()=>{const e=ie.value.getInstance().getValue();window.$qlUtils.copy(e)},ge=C(p,"selecting",h,{passive:!0}),be=e=>{ge.value&&(he({el:e}),ge.value=!1)},he=({el:e,code:l="",isAppend:t=!1})=>{P((()=>{if(e){let t=M(e);if(!t)return;l=`\n${t} {\n\n}\n`}l&&we(l,t)}))},we=(e,l=!1)=>{if(h("onInsertCode"),l)return void(ne.value=ne.value+"\n"+e);const t=ie.value.getInstance(),s=t.getSelection();t.executeEdits("",[{range:new G.Range((null==s?void 0:s.startLineNumber)||0,(null==s?void 0:s.startColumn)||0,(null==s?void 0:s.endLineNumber)||0,(null==s?void 0:s.endColumn)||0),text:e,forceMoveMarkers:!0}]),setTimeout((()=>{t.focus()}),100)},{snippetsOptions:Ce,updateEditorAutoComplete:_e}=(({insertCode:e,vueMonacoRef:s})=>{const a=l(t.CUSTOM_SNIPPETS,[]),o=()=>{z.$monacoScssSnippetsCustom=[],i(a.value)};u((()=>{o()}));const n=(l,t)=>{const s={label:l.label,props:{}};if(l.code||l.snippet){t&&t(l);const a=l.snippet||l.code;s.props.onClick=async()=>{e(a)},s.props.onContextmenu=async()=>{window.$qlUtils.copy(a)}}return s},i=(e=[],l=[])=>(e.forEach((e=>{l.push({children:e.children?c(e.children):void 0,...n(e,(e=>{e.snippet&&z.$monacoScssSnippetsCustom.push({label:e.label,snippet:e.snippet})}))})})),l),c=(e=[],l=[])=>(e.forEach((e=>{l.push({children:e.children?c(e.children):void 0,...n(e)})})),l),{options:r}=q({fetchFn:async()=>{const e=await fetch("./resources/scss-snippets.json");return await e.json()},mapFn:e=>n(e,(e=>{e.snippet&&z.$monacoScssSnippets.push({label:e.label,snippet:e.snippet})}))});return{snippetsOptions:v((()=>{const e=[...r.value,{label:"⚙️ Manage",children:[{label:"➕ Add custom snippet",props:{onClick:async()=>{const e=s.value.getInstance(),l=e.getSelection(),t=e.getModel().getValueInRange(l).trim();if(!t)return void window.$message.error("Please select code first!");const n=/\.(\w|-)+/g.exec(t)||[];console.log(n);const i=await window.$mcUtils.showInputPrompt({title:"Input snippet label",value:n[0]||""});i?(a.value.push({label:i,snippet:t}),o()):window.$message.error("Please input label!")}}},{label:"📥 Import JSON...",props:{onClick:async()=>{const e=await window.$mcUtils.handleImportJson();a.value=e||[],window.$message.success("Import success!")}}},{label:"📤 Export JSON...",props:{onClick:async()=>{window.$mcUtils.handleExportFile(await window.$mcUtils.promptGetFileName("ScssSnippets"),JSON.stringify(a.value,null,2),".json")}}},{label:"❌ Clear All...",children:[{label:"✅ Confirm Clear All Custom Snippets",props:{onClick:()=>{a.value=[],o()}}},{label:"❎ Cancel",props:{isBack:1}}]}]}];return a.value.length&&e.push({label:"🔮 Custom",children:[...c(a.value)]}),e})),updateEditorAutoComplete:e=>{const l=new Set,t=/\.(\w|-)+/g,s=/\$[\w-]+/g;let a;for(;null!==(a=t.exec(e));)l.add(a[0]);for(;null!==(a=s.exec(e));)l.add(a[0]);z.$monacoScssVariables=Array.from(l)}}})({insertCode:we,vueMonacoRef:ie}),xe=i([{label:le("common.global_style"),value:J.GLOBAL},{label:le("common.variables"),value:J.VARIABLES},{label:le("actions.current"),value:J.CURRENT}]),Se=l(t.CURRENT_TAB,J.CURRENT,localStorage,{listenToStorageChanges:!1});s(d,(e=>{e||(Se.value=J.GLOBAL)}),{immediate:!0}),s((()=>Se),(e=>{_e(ae.value+oe.value)}),{immediate:!0});const ke=e=>{const l=e.key.toLowerCase();e.ctrlKey&&e.shiftKey&&"f"===l&&ye()};return m(document,"keydown",(e=>{if(!te.value)return;const l=e.key.toLowerCase();e.ctrlKey&&e.shiftKey&&"x"===l?ge.value=!ge.value:e.altKey&&"`"===l&&(ue.value=!ue.value)})),c({handleAddStyle:he}),(e,l)=>(f(),y(g,null,[k(ge)?(f(),_(D,{key:0,onSelect:be,"parent-class":k(Se)===k(J).CURRENT?e.selectingParentClass:void 0},null,8,["parent-class"])):x("",!0),S(U,{class:"mc-style-editor-dialog",visible:k(te),"onUpdate:visible":l[7]||(l[7]=e=>E(te)?te.value=e:null),onResize:ce,wid:"style_editor",onKeyup:ke,onOnActive:re,"allow-maximum":"","init-win-options":{width:"400px",height:"500px"}},{titleBarLeft:j((()=>[l[8]||(l[8]=b("span",{class:"mdi mdi-format-paint"},null,-1)),T(" "+L(k(le)("common.style_editor"))+" (scss) ",1)])),titleBarRightControls:j((()=>[b("button",{title:k(le)("msgs.select_an_element_in")+" (ctrl+shift+x)",class:B({active:k(ge)}),onClick:l[0]||(l[0]=I((e=>ge.value=!k(ge)),["stop","prevent"]))},l[9]||(l[9]=[b("span",{class:"mdi mdi-button-cursor"},null,-1)]),10,Y),b("button",{onClick:l[1]||(l[1]=e=>ue.value=!k(ue)),class:B({active:k(ue)}),title:k(le)("actions.add_tool_codes")},l[10]||(l[10]=[b("span",{class:"mdi mdi-menu"},null,-1)]),10,Q),b("button",{title:k(le)("actions.beautify_code")+" (ctrl+shift+f)",onClick:ye},l[11]||(l[11]=[b("span",{class:"mdi mdi-code-braces"},null,-1)]),8,H),b("button",{title:k(le)("actions.copy_code")+" (ctrl+a ctrl+c)",onClick:fe},l[12]||(l[12]=[b("span",{class:"mdi mdi-content-copy"},null,-1)]),8,X)])),default:j((()=>[S(A,{name:"mc-fade"},{default:j((()=>{var e;return[R(b("div",{class:"code-mc-error-tip-button font-code",onClick:de},L(null==(e=k(pe))?void 0:e.message),513),[[$,k(pe)]])]})),_:1}),b("div",W,[S(A,{name:"fade-down"},{default:j((()=>[S(V,{visible:k(ue),"onUpdate:visible":l[2]||(l[2]=e=>E(ue)?ue.value=e:null),options:k(Ce),title:`${k(le)("actions.add_tool_codes")} (alt+\`)`,class:"font-code vp-panel style-qo","is-static":""},null,8,["visible","options","title"])])),_:1}),k(d)?(f(),y("div",Z,[S(F,{modelValue:k(Se),"onUpdate:modelValue":l[3]||(l[3]=e=>E(Se)?Se.value=e:null),options:k(xe),horizontal:""},null,8,["modelValue","options"])])):x("",!0),b("div",ee,[k(Se)===k(J).GLOBAL?(f(),_(K,{key:0,ref_key:"vueMonacoRef",ref:ie,modelValue:k(ae),"onUpdate:modelValue":l[4]||(l[4]=e=>E(ae)?ae.value=e:null),language:"scss","debounce-ms":500,"show-line-numbers":""},null,8,["modelValue"])):k(Se)===k(J).VARIABLES?(f(),_(K,{key:1,ref_key:"vueMonacoRef",ref:ie,modelValue:k(oe),"onUpdate:modelValue":l[5]||(l[5]=e=>E(oe)?oe.value=e:null),language:"scss","debounce-ms":500,"show-line-numbers":""},null,8,["modelValue"])):(f(),_(K,{key:2,ref_key:"vueMonacoRef",ref:ie,modelValue:k(ne),"onUpdate:modelValue":l[6]||(l[6]=e=>E(ne)?ne.value=e:null),language:"scss","debounce-ms":500,"show-line-numbers":""},null,8,["modelValue"]))])])])),_:1},8,["visible"])],64))}});export{le as default};
