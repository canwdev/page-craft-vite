import{I as e,T as a}from"./I18nToolSettings-DlDrR_Ss.js";import{d as o,o as s,c as i,a as t,M as l,u as n,r,aB as c,a6 as p,A as m,e as u,aC as d,aD as v,_ as w,i as g,k as h,l as f,T as y,F as j,m as S,w as _,g as b,W as k,ax as x,p as T}from"./index-B89s4h30.js";import{D,u as C}from"./use-file-drop-D4Up82Zq.js";import{a as N,u as O}from"./use-beforeunload-DhEVE0TE.js";import{Q as I}from"./index-CId89Rxb.js";import{u as F}from"./file-history-CcD9OJCy.js";import{C as R}from"./CommonNavbar-Bmqp30Gi.js";import{_ as A}from"./Spin-vXsTXf9u.js";import"./index-CIFTqndj.js";import"./use-model-wrapper-J3pz5QVG.js";import"./Copy20Regular-CcmTPlKK.js";import"./Add-CdLIh76Z.js";import"./Popconfirm-CCR6QIiH.js";import"./Popover-BFHkdWDY.js";import"./Icon-orbADp6I.js";import"./index-BX-tTlRM.js";import"./Tooltip-Bw7zg8Ht.js";import"./index-Ccfj9-BI.js";import"./VueRender.vue_vue_type_script_lang-CDgLsD0B.js";import"./AdvancedNumberInput-CuUGLofi.js";import"./Select-BnUyjwsW.js";import"./Tag-DedM7ulB.js";import"./use-common-settings-CsX-fdEk.js";import"./Dropdown-CpTLPpia.js";import"./useIDBKeyval-qkNoX_jN.js";import"./utils-qyy2zKdG.js";const H={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 20 20"},V=[t("g",{fill:"none"},[t("path",{d:"M3 5a2 2 0 0 1 2-2h8.379a2 2 0 0 1 1.414.586l1.621 1.621A2 2 0 0 1 17 6.621V15a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5zm2-1a1 1 0 0 0-1 1v10a1 1 0 0 0 1 1v-4.5A1.5 1.5 0 0 1 6.5 10h7a1.5 1.5 0 0 1 1.5 1.5V16a1 1 0 0 0 1-1V6.621a1 1 0 0 0-.293-.707l-1.621-1.621A1 1 0 0 0 13.379 4H13v2.5A1.5 1.5 0 0 1 11.5 8h-4A1.5 1.5 0 0 1 6 6.5V4H5zm2 0v2.5a.5.5 0 0 0 .5.5h4a.5.5 0 0 0 .5-.5V4H7zm7 12v-4.5a.5.5 0 0 0-.5-.5h-7a.5.5 0 0 0-.5.5V16h8z",fill:"currentColor"})],-1)],B=o({name:"Save20Regular",render:function(e,a){return s(),i("svg",H,V)}}),J={types:[{description:"JSON",accept:{"application/JSON":[".json"]}}]},$=o({name:"VueI18nEditTool",components:{CommonNavbar:R,QuickOptions:I,I18nToolSettings:e,TranslateTreeItem:a,DropZone:D,Save20Regular:B},setup(){const{t:e}=l(),a=n(),o=r(c.parseWithRoot()),s=r(!1),{appendHistory:i,historyMenuOptions:t}=F(p.I18N_FILE_HANDLE_HISTORY,(async e=>{w.value=e;const a=await e.getFile();await g(a)})),w=m(),g=async e=>{try{s.value=!0;const a=await d(e),i=JSON.parse(a);o.value=c.parseWithRoot(i)}catch(a){console.error(a),window.$message.error(a.message)}finally{s.value=!1}},h=async()=>{const[e]=await window.showOpenFilePicker(J);await i(e),w.value=e;const a=await e.getFile();await g(a)},f=()=>{w.value=void 0,o.value=c.parseWithRoot()},y=async()=>{try{if(s.value=!0,!w.value)return;const a=await w.value.createWritable(),i=JSON.stringify(v(o.value),null,2);await a.write(i),await a.close(),window.$message.success(e("msgs.saved"))}catch(a){console.error(a),window.$message.error(a.message)}finally{s.value=!1}},j=async()=>{var a;try{s.value=!0,console.log(o.value);const i=JSON.stringify(v(o.value),null,2),t=await window.showSaveFilePicker({suggestedName:null==(a=w.value)?void 0:a.name,...J}),l=await t.createWritable();await l.write(i),await l.close(),window.$message.success(e("msgs.saved"))}catch(i){console.error(i),window.$message.error(i.message)}finally{s.value=!1}};N((()=>{w.value?y():j()})),O((()=>!!w.value));const S=r(!1),_=()=>{o.value=c.parseWithRoot({hello_world:{section_a:{test_str:"This is a test string",test_arr:["line 1","line 2","line 3"],test_number:114514,"":"中English混合"},section_b:{"":"Blur this input and it'll generate the key automatically!"},section_c:{"":"平行、行列"}}})},b=u((()=>[{label:e("common.settings"),props:{onClick:()=>{S.value=!0}}},{label:e("common.toolbox"),props:{onClick:()=>{a.isShowQuickLaunch=!a.isShowQuickLaunch}}},w.value?{label:"💻 "+e("actions.close")+" JSON",children:[{label:e(e("msgs.confirm_close")),props:{onClick:f,isBack:!0}}]}:{label:"💻  "+e("actions.open")+" JSON",props:{onClick:()=>{h()}},dropdown:t.value},w.value?{label:"💾 "+e("actions.save"),props:{onClick:()=>{y()}}}:null,{label:e("actions.save_as")+"...",props:{onClick:()=>{j()}}},{label:e("common.demo"),children:[{label:e("msgs.load_demo_this_will"),props:{onClick:_,isBack:!0}}]}].filter(Boolean)));return{translateTreeRoot:o,fileHandle:w,handleImport:g,handleSelectFile:h,handleCloseFile:f,handleSaveFile:y,handleExport:j,loadDemo:_,...C({cb:async e=>{try{s.value=!0;for(const a of e.dataTransfer.items)if("file"===a.kind){const e=await a.getAsFileSystemHandle();if("directory"!==e.kind){await i(e),w.value=e;const a=await e.getFile();await g(a)}else window.$message.error("Please drag and drop a json file here!")}}catch(a){console.error(a),window.$message.error(a.message)}finally{s.value=!1}}}),mainStore:a,isShowToolSettings:S,isLoading:s,menuOptions:b}}}),z={key:0,class:"mc-loading-container position-fixed"},W={class:"scroll-content _scrollbar_mini"},L={class:"i18n-container"},P=t("div",{class:"height-placeholder"},null,-1);const Q=w($,[["render",function(e,a,o,l,n,r){const c=A,p=g("DropZone"),m=g("QuickOptions"),u=g("CommonNavbar"),d=g("TranslateTreeItem"),v=g("I18nToolSettings");return s(),i("div",{class:"vue-i18n-edit-tool i18n-style",onDragover:a[1]||(a[1]=_(((...a)=>e.fileDragover&&e.fileDragover(...a)),["prevent","stop"])),onDragleave:a[2]||(a[2]=_((a=>e.showDropzone=!1),["prevent","stop"])),onDrop:a[3]||(a[3]=_(((...a)=>e.fileDrop&&e.fileDrop(...a)),["prevent","stop"]))},[h(y,{name:"mc-fade"},{default:f((()=>[e.isLoading?(s(),i("div",z,[h(c)])):b("",!0)])),_:1}),h(y,{name:"mc-fade"},{default:f((()=>[k(h(p,{"position-fixed":"",text:e.$t("msgs.drag_file_here")},null,8,["text"]),[[x,e.showDropzone]])])),_:1}),h(u,null,{extra:f((()=>[h(m,{"is-static":"",options:e.menuOptions,horizontal:"","auto-focus":!1,"item-cls":"vp-button"},null,8,["options"])])),_:1}),t("div",W,[t("div",L,[(s(!0),i(j,null,S(e.translateTreeRoot,((a,o)=>{var i;return s(),T(d,{key:o,item:a,index:o,title:null==(i=e.fileHandle)?void 0:i.name},null,8,["item","index","title"])})),128)),P])]),h(v,{visible:e.isShowToolSettings,"onUpdate:visible":a[0]||(a[0]=a=>e.isShowToolSettings=a)},null,8,["visible"])],32)}]]);export{Q as default};
