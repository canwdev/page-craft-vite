import{d as e,f as s,g as t,h as o,i as l,s as a,w as n,o as i,j as r,T as c,k as d,l as u,m as p,t as m,n as w,p as h,q as y,v as _,_ as f,r as v,a as g,c as x,b as C,x as S,y as b,e as k,z as L,A as X,B as T,C as D,D as E,E as N,G as R,H as O,F as z,I as F,J as $,K as j,L as M,N as A,O as H,P as I}from"./index-L-jpUM2t.js";import{D as J,u as B,a as P,_ as V,b as K}from"./use-meta-9NWuYLoe.js";import{_ as G,a as U}from"./Tabs-4arHbMgX.js";import"./Add-4mJ1ioF5.js";const W=e=>new Promise(((s,t)=>{if(document.getElementById(e))s();else{const o=document.createElement("script");o.src=e,o.id=e,o.onload=function(){this.onerror=this.onload=null,s()},o.onerror=function(e){this.onerror=this.onload=null,t(e)},document.body.appendChild(o)}}));window.demo_aoa_to_sheet=[["Name","Value","Num","Time","âœ¨Tips"],["test001","line1\nline2",123,new Date,"You can set window.json_to_sheet = [] to generate table!"],["test001","line1\n\nline3",-1,new Date,"window.json_to_sheet"]],window.demo_json_to_sheet=[{region:"DE",product_name:"Test1",code:"123456",url:"http://localhost:8080",tips:"âœ¨ You can set window.demo_json_to_sheet = [] to generate table!"},{region:"FR",product_name:"Test2",code:"7890",url:"https://example.com",tips:"window.demo_json_to_sheet"}];const Y=e({name:"ExcelCopyTool",components:{FileChooser:s,DropZone:J},setup(){const{t:e}=t(),s=o(),f=l(),v=l(),g=l(!1),x=a(null),C=a(),S=l([]),b=l(0),{metaTitle:k}=B();n(b,(()=>{T()}));const L=()=>{if(!g.value){const e="XLSX Not Ready!";throw window.$message.error(e),new Error(e)}},X=e=>(S.value=e.SheetNames,e.Sheets[S.value[b.value]]),T=()=>{const e=C.value;if(!e)return void(v.value.innerHTML="");console.log("[renderWorkbook]",e);const s=window.XLSX.utils.sheet_to_html(X(e));v.value.innerHTML=s},D=async e=>{if(x.value=null,L(),!/\.xlsx$/g.test(e.name))return void window.$message.error("Only supports reading xlsx format!");const s=new FileReader;C.value=null,s.onload=function(s){x.value=e;const t=s.target.result;b.value=0,C.value=window.XLSX.read(t,{type:"binary"}),T()},s.readAsBinaryString(e)},E=l(!0);i((async()=>{await(async()=>{if(window.XLSX)g.value=!0;else{try{await W("./lib/xlsx.mini.js")}catch(e){window.$message.error(e.message),console.error(e)}window.$message.success("XLSX Ready!"),console.log("XLSX ready",window.XLSX),g.value=!0}})()}));const N=r("excel_copy_tool_copy_mode",c.HTML,localStorage,{listenToStorageChanges:!1}),R=({currentOnly:e=!1}={})=>{const s=e=>{const s=N.value;return s===c.DISABLED||s===c.TEXT?e:e.map((e=>{for(const t in e)"string"==typeof e[t]&&(e[t]=m(e[t],s));return e}))};if(!C.value){const e="Please open Excel file first!";throw window.$message.error(e),new Error(e)}if(e){const e=window.XLSX.utils.sheet_to_json(X(C.value));return s(e)}const t=C.value,o={};return t.SheetNames.forEach((function(e){const l=window.XLSX.utils.sheet_to_row_object_array(t.Sheets[e]);l.length>0&&(o[e]=s(l))})),o},O=async(e={})=>{var s;const t=R(e);let o=null==(s=x.value)?void 0:s.name;o&&(o=o.substring(0,o.lastIndexOf("."))),h(await y(o,"excel_sheet_export"),JSON.stringify(t,null,2),".json")};d((async()=>{await O()}));const z=[{label:"ðŸ§© Current Sheet",children:[{label:"ðŸ“¤ Export JSON",props:{onClick:async()=>{await O({currentOnly:!0})}}},{label:"ðŸ“‹ Copy JSON",props:{onClick:async()=>{const e=R({currentOnly:!0});await w(JSON.stringify(e,null,2)),window.$message.success("Sheet JSON Copied!")}}},{label:"ðŸ’» Print to Console",props:{onClick:async()=>{const e=R({currentOnly:!0});console.log(e),window.$message.success("Print to Console!")}}}]},{label:"ðŸ“— All Sheets",children:[{label:"ðŸ“¤ Export All JSON",props:{onClick:async()=>{await O()}}},{label:"ðŸ“‹ Copy All JSON",props:{onClick:async()=>{const e=R();await w(JSON.stringify(e,null,2)),window.$message.success("Sheet JSON Copied!")}}},{label:"ðŸ’» Print All to Console",props:{onClick:async()=>{const e=R();console.log(e),window.$message.success("Print to Console!")}}}]}],F=()=>{x.value=null,C.value=null,S.value=[],b.value=0,v.value.innerHTML=""};return u((()=>{F()})),{metaTitle:k,iconExcel:"data:image/svg+xml,%3c?xml%20version='1.0'%20encoding='utf-8'?%3e%3c!--%20Generator:%20Adobe%20Illustrator%2023.0.2,%20SVG%20Export%20Plug-In%20.%20SVG%20Version:%206.00%20Build%200)%20--%3e%3csvg%20version='1.1'%20id='Layer_1'%20xmlns='http://www.w3.org/2000/svg'%20xmlns:xlink='http://www.w3.org/1999/xlink'%20x='0px'%20y='0px'%20viewBox='0%200%2024%2024'%20style='enable-background:new%200%200%2024%2024;'%20xml:space='preserve'%3e%3cstyle%20type='text/css'%3e%20.st0{fill:%2321A366;}%20.st1{fill:none;}%20.st2{fill:%23107C41;}%20.st3{fill:%2333C481;}%20.st4{fill:%23185C37;}%20.st5{opacity:0.5;}%20.st6{fill:%23FFFFFF;}%20%3c/style%3e%3cg%20id='_x32_4_14_'%3e%3cpath%20class='st0'%20d='M16,1H7C6.4,1,6,1.4,6,2v5l10,5l4,1.5l4-1.5V7L16,1z'/%3e%3crect%20y='0'%20class='st1'%20width='24'%20height='24'/%3e%3crect%20x='6'%20y='7'%20class='st2'%20width='10'%20height='5'/%3e%3cpath%20class='st3'%20d='M24,2v5h-8V1h7C23.5,1,24,1.5,24,2z'/%3e%3cpath%20class='st4'%20d='M16,12H6v5v0V22c0,0.6,0.4,1,1,1h16c0.6,0,1-0.4,1-1v-5L16,12z'/%3e%3cpath%20class='st5'%20d='M13.8,6H6v14h7.6c0.7,0,1.4-0.7,1.4-1.4V7.2C15,6.5,14.5,6,13.8,6z'/%3e%3cpath%20id='Back_Plate_49_'%20class='st2'%20d='M12.8,19H1.2C0.5,19,0,18.5,0,17.8L0,6.2C0,5.5,0.5,5,1.2,5h11.7C13.5,5,14,5.5,14,6.2%20v11.7C14,18.5,13.5,19,12.8,19z'/%3e%3cpath%20class='st6'%20d='M3.4,16L6,12L3.6,8h1.9l1.3,2.5C7,10.8,7,11,7.1,11.1h0c0.1-0.2,0.2-0.4,0.3-0.6L8.8,8h1.8l-2.4,4l2.5,4H8.7%20l-1.5-2.8C7.2,13.1,7.1,13,7,12.8h0c0,0.1-0.1,0.2-0.2,0.4L5.3,16H3.4z'/%3e%3crect%20x='16'%20y='12'%20class='st2'%20width='8'%20height='5'/%3e%3c/g%3e%3c/svg%3e",sheetNames:S,sheetNameIndex:b,handleImport:D,importFileChooserRef:f,loadDemo:()=>{L();const e=window.XLSX.utils.aoa_to_sheet(window.demo_aoa_to_sheet),s=window.XLSX.utils.json_to_sheet(window.demo_json_to_sheet),t=window.XLSX.utils.book_new();window.XLSX.utils.book_append_sheet(t,e,"aoa_to_sheet"),window.XLSX.utils.book_append_sheet(t,s,"json_to_sheet"),b.value=0,C.value=t,T()},tableWrapperElRef:v,handleClick:s=>{let t=s.target;if(!(e=>"td"===e.tagName.toLowerCase())(t)||!N.value||N.value===c.DISABLED)return;if(!t.innerText)return;let o=t.innerText;console.log(N.value);let l="";o=s.ctrlKey&&s.altKey?m(o,l=c.JSON):s.ctrlKey?m(o,l=c.TEXT):s.altKey?m(o,l=c.HTML):m(o,l=N.value),w(o),window.$message.success(l+" "+e("msgs.copy_success"));const a=document.createRange();a.selectNode(t);const n=window.getSelection();n&&(n.removeAllRanges(),n.addRange(a))},copyMode:N,modTextConvertOptions:p((()=>[{label:"Disabled",value:c.DISABLED},..._])),dropdownMenuOptions:z,textConvertMultipleLine:m,...P({cbFiles:e=>{e.length&&D(e[0])}}),isTrimEmptyLines:E,mainStore:s,isReady:g,workbookRef:C,fileRef:x,handleCloseFile:F}}}),Z={key:0,class:"mc-loading-container"};const q=f(Y,[["render",function(e,s,t,o,l,a){const n=v("DropZone"),i=V,r=$,c=j,d=M,u=A,p=H,m=K,w=D,h=I,y=G,_=U,f=v("FileChooser");return g(),x("div",{class:"excel-copy-tool",onDragover:s[7]||(s[7]=T(((...s)=>e.fileDragover&&e.fileDragover(...s)),["prevent","stop"])),onDragleave:s[8]||(s[8]=T((s=>e.showDropzone=!1),["prevent","stop"])),onDrop:s[9]||(s[9]=T(((...s)=>e.fileDrop&&e.fileDrop(...s)),["prevent","stop"]))},[C(b,{name:"mc-fade"},{default:S((()=>[E(C(n,{"position-fixed":"",text:"Drop Excel file here"},null,512),[[N,e.showDropzone]])])),_:1}),k("div",null,[C(w,{size:"small"},{default:S((()=>[C(m,{subtitle:"",onBack:s[4]||(s[4]=s=>e.$router.push({name:"HomePage"}))},{title:S((()=>[R(O(e.metaTitle),1)])),avatar:S((()=>[C(i,{src:e.iconExcel,style:{background:"none"}},null,8,["src"])])),extra:S((()=>[C(u,null,{default:S((()=>[C(u,{size:"small",align:"center"},{default:S((()=>[C(r,{size:"small",checked:e.isTrimEmptyLines,"onUpdate:checked":s[0]||(s[0]=s=>e.isTrimEmptyLines=s)},{default:S((()=>[R(O(e.$t("msgs.trim_empty_lines")),1)])),_:1},8,["checked"]),C(c,{text:"",onClick:s[1]||(s[1]=s=>e.mainStore.isShowTextTransformer=!0)},{default:S((()=>[R(O(e.$t("common.text_transformer"))+":",1)])),_:1}),C(d,{size:"small",value:e.copyMode,"onUpdate:value":s[2]||(s[2]=s=>e.copyMode=s),options:e.modTextConvertOptions,style:{width:"100px"}},null,8,["value","options"])])),_:1}),e.workbookRef?(g(),L(p,{key:0,options:e.dropdownMenuOptions,placement:"bottom-start","key-field":"label",disabled:!e.isReady},{default:S((()=>[C(c,{size:"small"},{default:S((()=>[R("ðŸ’» "+O(e.$t("actions.export")),1)])),_:1})])),_:1},8,["options","disabled"])):X("",!0),e.fileRef?(g(),L(c,{key:2,type:"primary",size:"small",onClick:e.handleCloseFile},{default:S((()=>[R(O(e.$t("actions.close")),1)])),_:1},8,["onClick"])):(g(),L(c,{key:1,type:"primary",disabled:!e.isReady,onClick:s[3]||(s[3]=s=>e.importFileChooserRef.chooseFile()),size:"small"},{default:S((()=>[R(O(e.$t("actions.open")+" Excel"),1)])),_:1},8,["disabled"])),e.fileRef?X("",!0):(g(),L(c,{key:3,onClick:e.loadDemo,size:"small",disabled:!e.isReady},{default:S((()=>[R(O(e.$t("common.demo")),1)])),_:1},8,["onClick","disabled"]))])),_:1})])),_:1})])),_:1}),C(b,{name:"mc-fade"},{default:S((()=>[e.isReady?X("",!0):(g(),x("div",Z,[C(h)]))])),_:1}),e.isReady?(g(),L(w,{key:0,class:"sheet-name-card",size:"small"},{default:S((()=>[C(_,{size:"small",type:"card",animated:"",value:e.sheetNameIndex,"onUpdate:value":s[5]||(s[5]=s=>e.sheetNameIndex=s)},{default:S((()=>[(g(!0),x(z,null,F(e.sheetNames,((e,s)=>(g(),L(y,{style:{padding:"0"},name:s,tab:e,key:e},null,8,["name","tab"])))),128))])),_:1},8,["value"])])),_:1})):X("",!0)]),k("div",{ref:"tableWrapperElRef",class:"excel-table-container",onClick:s[6]||(s[6]=(...s)=>e.handleClick&&e.handleClick(...s))},null,512),C(f,{ref:"importFileChooserRef",accept:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",onSelected:e.handleImport},null,8,["onSelected"])],32)}]]);export{q as default};
