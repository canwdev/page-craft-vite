import{d as e,f as s,g as l,h as t,r as a,i as o,w as n,o as i,j as r,T as c,k as d,l as u,m as p,t as m,n as h,p as w,q as y,v as f,b as v,c as g,x,y as _,z as C,A as S,B as b,e as k,C as L,D as X,E,F as T,G as N,H as D,I as R,J as O,K as z,M,N as $,O as F,P as H,Q as I}from"./index-jDD-Lpv5.js";import{_ as A,u as J,a as B,b as P,c as j,d as V}from"./use-meta-468ENP1I.js";import{_ as K,a as G}from"./Tabs-JGL29cox.js";const U=e=>new Promise(((s,l)=>{if(document.getElementById(e))s();else{const t=document.createElement("script");t.src=e,t.id=e,t.onload=function(){this.onerror=this.onload=null,s()},t.onerror=function(e){this.onerror=this.onload=null,l(e)},document.body.appendChild(t)}})),W=e({name:"ExcelCopyTool",components:{FileChooser:s,DropZone:A},setup(){const{t:e}=l(),s=t(),v=a(),g=a(),x=a(!1),_=o(null),C=o(),S=a([]),b=a(0),{metaTitle:k}=J();n(b,(()=>{E()}));const L=()=>{if(!x.value){const e="XLSX Not Ready!";throw window.$message.error(e),new Error(e)}},X=e=>(S.value=e.SheetNames,e.Sheets[S.value[b.value]]),E=()=>{const e=C.value;if(!e)return void(g.value.innerHTML="");console.log("[renderWorkbook]",e);const s=window.XLSX.utils.sheet_to_html(X(e));g.value.innerHTML=s},T=async e=>{if(_.value=null,L(),!/\.xlsx$/g.test(e.name))return void window.$message.error("Only supports reading xlsx format!");const s=new FileReader;C.value=null,s.onload=function(s){_.value=e;const l=s.target.result;b.value=0,C.value=window.XLSX.read(l,{type:"binary"}),E()},s.readAsBinaryString(e)},N=a(!0);i((async()=>{await(async()=>{if(window.XLSX)x.value=!0;else{try{await U("./lib/xlsx.mini.js")}catch(e){window.$message.error(e.message),console.error(e)}window.$message.success("XLSX Ready!"),console.log("XLSX ready",window.XLSX),x.value=!0}})()}));const D=r("excel_copy_tool_copy_mode",c.HTML),R=({currentOnly:e=!1}={})=>{const s=e=>{const s=D.value;return s===c.DISABLED||s===c.TEXT?e:e.map((e=>{for(const l in e)"string"==typeof e[l]&&(e[l]=m(e[l],s));return e}))};if(!C.value){const e="Please open Excel file first!";throw window.$message.error(e),new Error(e)}if(e){const e=window.XLSX.utils.sheet_to_json(X(C.value));return s(e)}const l=C.value,t={};return l.SheetNames.forEach((function(e){const a=window.XLSX.utils.sheet_to_row_object_array(l.Sheets[e]);a.length>0&&(t[e]=s(a))})),t},O=async(e={})=>{var s;const l=R(e);let t=null==(s=_.value)?void 0:s.name;t&&(t=t.substring(0,t.lastIndexOf("."))),w(await y(t,"excel_sheet_export"),JSON.stringify(l,null,2),".json")};d((async()=>{await O()}));const z=[{label:"ðŸ§© Current Sheet",children:[{label:"ðŸ“¤ Export JSON",props:{onClick:async()=>{await O({currentOnly:!0})}}},{label:"ðŸ“‹ Copy JSON",props:{onClick:async()=>{const e=R({currentOnly:!0});await h(JSON.stringify(e,null,2)),window.$message.success("Sheet JSON Copied!")}}},{label:"ðŸ’» Print to Console",props:{onClick:async()=>{const e=R({currentOnly:!0});console.log(e),window.$message.success("Print to Console!")}}}]},{label:"ðŸ“— All Sheets",children:[{label:"ðŸ“¤ Export All JSON",props:{onClick:async()=>{await O()}}},{label:"ðŸ“‹ Copy All JSON",props:{onClick:async()=>{const e=R();await h(JSON.stringify(e,null,2)),window.$message.success("Sheet JSON Copied!")}}},{label:"ðŸ’» Print All to Console",props:{onClick:async()=>{const e=R();console.log(e),window.$message.success("Print to Console!")}}}]}],M=()=>{_.value=null,C.value=null,S.value=[],b.value=0,g.value.innerHTML=""};return u((()=>{M()})),{metaTitle:k,iconExcel:"data:image/svg+xml,%3c?xml%20version='1.0'%20encoding='utf-8'?%3e%3c!--%20Generator:%20Adobe%20Illustrator%2023.0.2,%20SVG%20Export%20Plug-In%20.%20SVG%20Version:%206.00%20Build%200)%20--%3e%3csvg%20version='1.1'%20id='Layer_1'%20xmlns='http://www.w3.org/2000/svg'%20xmlns:xlink='http://www.w3.org/1999/xlink'%20x='0px'%20y='0px'%20viewBox='0%200%2024%2024'%20style='enable-background:new%200%200%2024%2024;'%20xml:space='preserve'%3e%3cstyle%20type='text/css'%3e%20.st0{fill:%2321A366;}%20.st1{fill:none;}%20.st2{fill:%23107C41;}%20.st3{fill:%2333C481;}%20.st4{fill:%23185C37;}%20.st5{opacity:0.5;}%20.st6{fill:%23FFFFFF;}%20%3c/style%3e%3cg%20id='_x32_4_14_'%3e%3cpath%20class='st0'%20d='M16,1H7C6.4,1,6,1.4,6,2v5l10,5l4,1.5l4-1.5V7L16,1z'/%3e%3crect%20y='0'%20class='st1'%20width='24'%20height='24'/%3e%3crect%20x='6'%20y='7'%20class='st2'%20width='10'%20height='5'/%3e%3cpath%20class='st3'%20d='M24,2v5h-8V1h7C23.5,1,24,1.5,24,2z'/%3e%3cpath%20class='st4'%20d='M16,12H6v5v0V22c0,0.6,0.4,1,1,1h16c0.6,0,1-0.4,1-1v-5L16,12z'/%3e%3cpath%20class='st5'%20d='M13.8,6H6v14h7.6c0.7,0,1.4-0.7,1.4-1.4V7.2C15,6.5,14.5,6,13.8,6z'/%3e%3cpath%20id='Back_Plate_49_'%20class='st2'%20d='M12.8,19H1.2C0.5,19,0,18.5,0,17.8L0,6.2C0,5.5,0.5,5,1.2,5h11.7C13.5,5,14,5.5,14,6.2%20v11.7C14,18.5,13.5,19,12.8,19z'/%3e%3cpath%20class='st6'%20d='M3.4,16L6,12L3.6,8h1.9l1.3,2.5C7,10.8,7,11,7.1,11.1h0c0.1-0.2,0.2-0.4,0.3-0.6L8.8,8h1.8l-2.4,4l2.5,4H8.7%20l-1.5-2.8C7.2,13.1,7.1,13,7,12.8h0c0,0.1-0.1,0.2-0.2,0.4L5.3,16H3.4z'/%3e%3crect%20x='16'%20y='12'%20class='st2'%20width='8'%20height='5'/%3e%3c/g%3e%3c/svg%3e",sheetNames:S,sheetNameIndex:b,handleImport:T,importFileChooserRef:v,loadDemo:()=>{L();const e=window.XLSX.utils.aoa_to_sheet([["Name","Value","Num","Time"],["test001","line1\nline2",123,new Date],["test001","line1\n\nline3",-1,new Date]]),s=window.XLSX.utils.aoa_to_sheet([["Name"],["test002"],["test002"]]),l=window.XLSX.utils.book_new();window.XLSX.utils.book_append_sheet(l,e,"Sheet1"),window.XLSX.utils.book_append_sheet(l,s,"Sheet2"),b.value=0,C.value=l,E()},tableWrapperElRef:g,handleClick:s=>{let l=s.target;if(!(e=>"td"===e.tagName.toLowerCase())(l)||!D.value||D.value===c.DISABLED)return;if(!l.innerText)return;let t=l.innerText;console.log(D.value);let a="";t=s.ctrlKey&&s.altKey?m(t,a=c.JSON):s.ctrlKey?m(t,a=c.TEXT):s.altKey?m(t,a=c.HTML):m(t,a=D.value),h(t),window.$message.success(a+" "+e("msgs.copy_success"));const o=document.createRange();o.selectNode(l);const n=window.getSelection();n&&(n.removeAllRanges(),n.addRange(o))},copyMode:D,modTextConvertOptions:p((()=>[{label:"Disabled",value:c.DISABLED},...f])),dropdownMenuOptions:z,textConvertMultipleLine:m,...B({cbFiles:e=>{e.length&&T(e[0])}}),isTrimEmptyLines:N,mainStore:s,isReady:x,workbookRef:C,fileRef:_,handleCloseFile:M}}}),q={key:0,class:"mc-loading-container"};const Q=v(W,[["render",function(e,l,t,a,o,n){const i=A,r=P,c=M,d=$,u=F,p=H,m=I,h=j,w=E,y=V,f=K,v=G,J=s;return g(),x("div",{class:"excel-copy-tool",onDragover:l[7]||(l[7]=X(((...s)=>e.fileDragover&&e.fileDragover(...s)),["prevent","stop"])),onDragleave:l[8]||(l[8]=X((s=>e.showDropzone=!1),["prevent","stop"])),onDrop:l[9]||(l[9]=X(((...s)=>e.fileDrop&&e.fileDrop(...s)),["prevent","stop"]))},[_(S,{name:"mc-fade"},{default:C((()=>[T(_(i,{"position-fixed":"",text:"Drop Excel file here"},null,512),[[N,e.showDropzone]])])),_:1}),b("div",null,[_(w,{size:"small"},{default:C((()=>[_(h,{subtitle:"",onBack:l[4]||(l[4]=s=>e.$router.push({name:"HomePage"}))},{title:C((()=>[D(R(e.metaTitle),1)])),avatar:C((()=>[_(r,{src:e.iconExcel,style:{background:"none"}},null,8,["src"])])),extra:C((()=>[_(p,null,{default:C((()=>[_(p,{size:"small",align:"center"},{default:C((()=>[_(c,{size:"small",checked:e.isTrimEmptyLines,"onUpdate:checked":l[0]||(l[0]=s=>e.isTrimEmptyLines=s)},{default:C((()=>[D(R(e.$t("msgs.trim_empty_lines")),1)])),_:1},8,["checked"]),_(d,{text:"",onClick:l[1]||(l[1]=s=>e.mainStore.isShowTextTransformer=!0)},{default:C((()=>[D(R(e.$t("common.text_transformer"))+":",1)])),_:1}),_(u,{size:"small",value:e.copyMode,"onUpdate:value":l[2]||(l[2]=s=>e.copyMode=s),options:e.modTextConvertOptions,style:{width:"100px"}},null,8,["value","options"])])),_:1}),e.workbookRef?(g(),k(m,{key:0,options:e.dropdownMenuOptions,placement:"bottom-start","key-field":"label",disabled:!e.isReady},{default:C((()=>[_(d,{size:"small"},{default:C((()=>[D("ðŸ’» "+R(e.$t("actions.export")),1)])),_:1})])),_:1},8,["options","disabled"])):L("",!0),e.fileRef?(g(),k(d,{key:2,type:"primary",size:"small",onClick:e.handleCloseFile},{default:C((()=>[D(R(e.$t("actions.close")),1)])),_:1},8,["onClick"])):(g(),k(d,{key:1,type:"primary",disabled:!e.isReady,onClick:l[3]||(l[3]=s=>e.importFileChooserRef.chooseFile()),size:"small"},{default:C((()=>[D(R(e.$t("actions.open")+" Excel"),1)])),_:1},8,["disabled"])),e.fileRef?L("",!0):(g(),k(d,{key:3,onClick:e.loadDemo,size:"small",disabled:!e.isReady},{default:C((()=>[D(R(e.$t("common.demo")),1)])),_:1},8,["onClick","disabled"]))])),_:1})])),_:1})])),_:1}),_(S,{name:"mc-fade"},{default:C((()=>[e.isReady?L("",!0):(g(),x("div",q,[_(y)]))])),_:1}),e.isReady?(g(),k(w,{key:0,class:"sheet-name-card",size:"small"},{default:C((()=>[_(v,{size:"small",type:"card",animated:"",value:e.sheetNameIndex,"onUpdate:value":l[5]||(l[5]=s=>e.sheetNameIndex=s)},{default:C((()=>[(g(!0),x(O,null,z(e.sheetNames,((e,s)=>(g(),k(f,{style:{padding:"0"},name:s,tab:e,key:e},null,8,["name","tab"])))),128))])),_:1},8,["value"])])),_:1})):L("",!0)]),b("div",{ref:"tableWrapperElRef",class:"excel-table-container",onClick:l[6]||(l[6]=(...s)=>e.handleClick&&e.handleClick(...s))},null,512),_(J,{ref:"importFileChooserRef",accept:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",onSelected:e.handleImport},null,8,["onSelected"])],32)}]]);export{Q as default};
