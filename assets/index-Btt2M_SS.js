import{d as e,o as l,c as a,a as t,dU as s,E as o,ao as n,y as i,a3 as r,t as u,r as c,s as p,ai as d,aj as m,ak as v,al as h,aa as w,e as g,n as f,F as y,M as x,Q as b,dV as C,z as k,p as S,g as V,k as j,l as _,a1 as z,f as A,h as R,w as B,T as L,W as M,ax as $,R as I,B as E,dW as T}from"./index-B_8g2bxo.js";import{l as U,k as P}from"./index-DvO0znUF.js";import{V as H}from"./index-Byyymg_I.js";import{T as N}from"./TabLayout-yNuUsb_S.js";import{V as O,m as F}from"./index-B6cBd3b0.js";import{Q as G}from"./index-Bi2kEi3J.js";import{u as K}from"./use-remote-options-BE_XYDkf.js";import{m as q}from"./CraftPage-C2kj9zmh.js";import{C as D}from"./Copy20Regular-sZkODe5h.js";import{N as J}from"./Icon-CMxllykI.js";import"./FileChooser-X9fYpU-s.js";import"./index-BWzdhM7Z.js";import"./index-CdL_N0M1.js";import"./set-CUTijDv3.js";import"./AdvancedNumberInput-CDufGYGU.js";import"./Popover-BKGBJvpF.js";import"./VueRender.vue_vue_type_script_lang-B7jagunM.js";import"./Dropdown-CsBF2fzf.js";import"./Select-B9LExM5-.js";import"./Tag-DZeuv2Mx.js";import"./Checkbox-BMCJIerk.js";import"./use-beforeunload-CnEAWhnx.js";import"./humanfs-api-DpvoJ6Sz.js";import"./index-vcidOvW8.js";import"./use-model-wrapper-C3eqSSDB.js";import"./ButtonGroup-BslXupHZ.js";import"./use-local-dir-D7_ExQWw.js";import"./file-history-B7sFIa91.js";import"./useIDBKeyval-CyjVMSV3.js";import"./Spin-DKTdphx2.js";import"./Popconfirm-B4HoFWuD.js";const W={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 20 20"},Q=[t("g",{fill:"none"},[t("path",{d:"M15 3a.5.5 0 0 0-1 0v2h-2a.5.5 0 0 0 0 1h2v2a.5.5 0 0 0 1 0V6h2a.5.5 0 0 0 0-1h-2V3zM4.5 17A1.5 1.5 0 0 1 3 15.5v-11A1.5 1.5 0 0 1 4.5 3H9a1.5 1.5 0 0 1 1.5 1.5v5h5A1.5 1.5 0 0 1 17 11v4.5a1.5 1.5 0 0 1-1.5 1.5h-11zm6-6.5V16h5a.5.5 0 0 0 .5-.5V11a.5.5 0 0 0-.5-.5h-5zm-1 5.5v-5.5H4v5a.5.5 0 0 0 .5.5h5zm0-11.5A.5.5 0 0 0 9 4H4.5a.5.5 0 0 0-.5.5v5h5.5v-5z",fill:"currentColor"})],-1)],Y=e({name:"AppsAddIn20Regular",render:function(e,t){return l(),a("svg",W,Q)}}),X={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 20 20"},Z=[t("g",{fill:"none"},[t("path",{d:"M7.5 2a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2a.5.5 0 0 1 .5-.5zM3.61 3.61a.5.5 0 0 1 .708 0l1.414 1.415a.5.5 0 1 1-.707.707L3.611 4.318a.5.5 0 0 1 0-.707zm7.78 0a.5.5 0 0 1 0 .708L9.974 5.732a.5.5 0 1 1-.707-.707l1.414-1.414a.5.5 0 0 1 .707 0zM2 7.5a.5.5 0 0 1 .5-.5h2a.5.5 0 0 1 0 1h-2a.5.5 0 0 1-.5-.5zm6.64-.2A1 1 0 0 0 7 8.067v9.101c0 .924 1.145 1.354 1.753.659l2.026-2.316A1.5 1.5 0 0 1 11.908 15h3.211c.935 0 1.359-1.17.64-1.768L8.64 7.299zM8 17.17V8.067L15.119 14h-3.211a2.5 2.5 0 0 0-1.882.854L8 17.169z",fill:"currentColor"})],-1)],ee=e({name:"CursorClick20Regular",render:function(e,t){return l(),a("svg",X,Z)}}),le={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 20 20"},ae=[t("g",{fill:"none"},[t("path",{d:"M2 6a2 2 0 0 1 2-2h12a2 2 0 0 1 2 2v7a2 2 0 0 1-1.164 1.818a1.497 1.497 0 0 0-.275-.379l-.446-.446A1 1 0 0 0 17 13V6a1 1 0 0 0-1-1H4a1 1 0 0 0-1 1v7a1 1 0 0 0 1 1h5v1H4a2 2 0 0 1-2-2V6zm8.854 4.146A.5.5 0 0 0 10 10.5v7a.5.5 0 0 0 .91.287l1.571-2.245l2.943.452a.5.5 0 0 0 .43-.848l-5-5zM11 15.915v-4.207l3.066 3.067l-1.74-.268a.5.5 0 0 0-.486.207l-.84 1.2z",fill:"currentColor"})],-1)],te=e({name:"CursorHover20Regular",render:function(e,t){return l(),a("svg",le,ae)}}),se={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 20 20"},oe=[t("g",{fill:"none"},[t("path",{d:"M5.5 1.999a.5.5 0 0 0-.5.5v8.504a2 2 0 0 0 2 2h1.004v2.998a2 2 0 1 0 4 0v-2.998H13a2 2 0 0 0 2-2V2.5a.5.5 0 0 0-.5-.5h-9zm.5 8.004h8v1a1 1 0 0 1-1 1h-1.496a.5.5 0 0 0-.5.5v3.498a1 1 0 1 1-2 0v-3.498a.5.5 0 0 0-.5-.5H7a1 1 0 0 1-1-1v-1zm8-1H6V3h4v1.5a.5.5 0 0 0 1 0v-1.5h1v2.502a.5.5 0 0 0 1 0V3h1v6.004z",fill:"currentColor"})],-1)],ne=e({name:"PaintBrush20Regular",render:function(e,t){return l(),a("svg",se,oe)}}),ie={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 20 20"},re=[t("g",{fill:"none"},[t("path",{d:"M16.5 2a.5.5 0 0 1 .5.5V3h.5a.5.5 0 0 1 0 1H17v.5a.5.5 0 0 1-1 0V4h-.5a.5.5 0 1 1 0-1h.5v-.5a.5.5 0 0 1 .5-.5zm-10 4a.5.5 0 0 0 0-1H6v-.5a.5.5 0 0 0-1 0V5h-.5a.5.5 0 0 0 0 1H5v.5a.5.5 0 0 0 1 0V6h.5zm9 9a.5.5 0 0 0 0-1H15v-.5a.5.5 0 0 0-1 0v.5h-.5a.5.5 0 1 0 0 1h.5v.5a.5.5 0 1 0 1 0V15h.5zm-2.066-8.434a1.914 1.914 0 0 0-2.707 0l-8.166 8.166a1.914 1.914 0 1 0 2.707 2.707l8.166-8.166a1.914 1.914 0 0 0 0-2.707zm-2 .707a.914.914 0 0 1 1.293 1.293l-.477.477l-1.293-1.293l.477-.477zM10.25 8.457l1.293 1.293l-6.982 6.982a.914.914 0 0 1-1.293-1.292l6.982-6.983z",fill:"currentColor"})],-1)],ue=e({name:"Wand20Regular",render:function(e,t){return l(),a("svg",ie,re)}}),ce=e({__name:"ElementByPoint",props:{parentClass:{default:void 0}},emits:["select"],setup(e,{emit:s}){const o=e,{parentClass:n}=u(o),i=s,r=c(null);p((()=>{n.value&&(r.value=document.querySelector(n.value))}));const{x:x,y:b}=d({type:"client"}),{element:C}=m({x:x,y:b}),k=v(h(C));w("scroll",k.update,!0);const S=g((()=>!(r.value&&!r.value.contains(C.value)||r.value===C.value))),V=g((()=>C.value&&S.value?{display:"block",width:`${k.width}px`,height:`${k.height}px`,left:`${k.left}px`,top:`${k.top}px`,transition:"all 0.05s linear"}:{display:"none"})),j=g((()=>({transform:`translate(calc(${x.value}px - 50%), calc(${b.value}px - 50%))`,color:S.value?"white":"grey"})));return w("click",(e=>{S.value&&(e.stopPropagation(),e.preventDefault(),i("select",C.value))}),{capture:!0}),(e,s)=>(l(),a(y,null,[t("div",{style:f(V.value),class:"mc-element-by-point-box"},null,4),t("div",{style:f(j.value),class:"mc-element-by-point-pointer"},null,4)],64))}}),pe=["title"],de=["title"],me=["title"],ve=["title"],he={class:"style-editor-inner"},we={key:0,class:"style-editor-action-bar"},ge={class:"code-editor-placeholder"},fe=e({__name:"index",props:{visible:{type:Boolean,default:!1},selecting:{type:Boolean,default:!1},selectingParentClass:{default:void 0},showTabs:{type:Boolean,default:!1},styleCode:{default:""}},emits:["update:visible","update:selecting","onFormat","onInsertCode","update:styleCode"],setup(e,{expose:d,emit:m}){const v=e,{showTabs:h}=u(v),f=m,{t:W}=x(),Q=b(v,"visible",f),X=s(),{globalStyleCode:Z}=(()=>{const e=s(),l=o(n.GLOBAL_STYLE,"");i(l,(e=>{a()}));const a=async()=>{try{e.globalCSS=l.value?await r(l.value):""}catch(a){window.$message.error(a.message)}};return{globalStyleCode:l}})(),le=o(n.VARIABLES_STYLE,""),ae=b(v,"styleCode",f,{passive:!0});i(ae,(()=>{be()}));const se=c(),oe=c(!1),ie=()=>{const e=se.value.getInstance();null==e||e.layout()},re=()=>{oe.value||setTimeout((()=>{se.value.getInstance().focus()}),100)};i(Q,(e=>{e&&(ie(),re())})),i(oe,(e=>{e||re()}));const fe=c(),ye=()=>{console.warn(fe.value.message,{...fe.value}),setTimeout((()=>{fe.value=null}),500)},xe=c(""),be=async(e=!1)=>{try{const l=le.value+"\n"+ae.value;if(xe.value===l&&!e)return;xe.value=l;const a=l?await r(l):"";X.currentCSS=a,fe.value=""}catch(l){fe.value=l}};i(le,(()=>{be()}),{immediate:!0}),U("PlaygroundPageStyleSync",(()=>{be(!0)}));const Ce=async()=>{var e;const l=se.value.getInstance(),a=l.getValue();if(a.trim()){const t=P(a);if(a.trim()!==t.trim()){const a=null==(e=l.getModel())?void 0:e.getFullModelRange();a?l.executeEdits(null,[{text:t,range:a}]):ae.value=t}}l.focus(),f("onFormat")},ke=()=>{const e=se.value.getInstance().getValue();window.$qlUtils.copy(e)},Se=b(v,"selecting",f,{passive:!0}),Ve=e=>{Se.value&&(je({el:e}),Se.value=!1)},je=({el:e,code:l="",isAppend:a=!1})=>{E((()=>{if(e){let a=T(e);if(!a)return;l=`\n${a} {\n\n}\n`}l&&_e(l,a)}))},_e=(e,l=!1)=>{if(f("onInsertCode"),l)return void(ae.value=ae.value+"\n"+e);const a=se.value.getInstance(),t=a.getSelection();a.executeEdits("",[{range:new F.Range((null==t?void 0:t.startLineNumber)||0,(null==t?void 0:t.startColumn)||0,(null==t?void 0:t.endLineNumber)||0,(null==t?void 0:t.endColumn)||0),text:e,forceMoveMarkers:!0}]),setTimeout((()=>{a.focus()}),100)},{snippetsOptions:ze,updateEditorAutoComplete:Ae}=(({insertCode:e,vueMonacoRef:l})=>{const a=o(n.CUSTOM_SNIPPETS,[]),t=()=>{q.$monacoScssSnippetsCustom=[],i(a.value)};p((()=>{t()}));const s=(l,a)=>{const t={label:l.label,props:{}};if(l.code||l.snippet){a&&a(l);const s=l.snippet||l.code;t.props.onClick=async()=>{e(s)},t.props.onContextmenu=async()=>{window.$qlUtils.copy(s)}}return t},i=(e=[],l=[])=>(e.forEach((e=>{l.push({children:e.children?r(e.children):void 0,...s(e,(e=>{e.snippet&&q.$monacoScssSnippetsCustom.push({label:e.label,snippet:e.snippet})}))})})),l),r=(e=[],l=[])=>(e.forEach((e=>{l.push({children:e.children?r(e.children):void 0,...s(e)})})),l),{options:u}=K({fetchFn:async()=>{const e=await fetch("./scss-snippets.json");return await e.json()},mapFn:e=>s(e,(e=>{e.snippet&&q.$monacoScssSnippets.push({label:e.label,snippet:e.snippet})}))});return{snippetsOptions:g((()=>{const e=[...u.value,{label:"⚙️ Manage",children:[{label:"➕ Add custom snippet",props:{onClick:async()=>{const e=l.value.getInstance(),s=e.getSelection();let o=e.getModel().getValueInRange(s).trim();if(!o)return void window.$message.error("Please select code first!");let n=/\.(\w|-)+/g.exec(o)||[];console.log(n);let i=await window.$mcUtils.showInputPrompt({title:"Input snippet label",value:n[0]||""});i?(a.value.push({label:i,snippet:o}),t()):window.$message.error("Please input label!")}}},{label:"📥 Import JSON...",props:{onClick:async()=>{const e=await window.$mcUtils.handleImportJson();a.value=e||[],window.$message.success("Import success!")}}},{label:"📤 Export JSON...",props:{onClick:async()=>{window.$mcUtils.handleExportFile(await window.$mcUtils.promptGetFileName("ScssSnippets"),JSON.stringify(a.value,null,2),".json")}}},{label:"❌ Clear All...",children:[{label:"✅ Confirm Clear All Custom Snippets",props:{onClick:()=>{a.value=[],t()}}},{label:"❎ Cancel",props:{isBack:1}}]}]}];return a.value.length&&e.push({label:"🔮 Custom",children:[...r(a.value)]}),e})),updateEditorAutoComplete:e=>{const l=new Set;let a,t=/\.(\w|-)+/g,s=/\$[\w-]+/g;for(;null!==(a=t.exec(e));)l.add(a[0]);for(;null!==(a=s.exec(e));)l.add(a[0]);q.$monacoScssVariables=Array.from(l)}}})({insertCode:_e,vueMonacoRef:se}),Re=c([{label:W("common.global_style"),value:C.GLOBAL},{label:W("common.variables"),value:C.VARIABLES},{label:W("actions.current"),value:C.CURRENT}]),Be=o(n.CURRENT_TAB,C.CURRENT,localStorage,{listenToStorageChanges:!1});i(h,(e=>{e||(Be.value=C.GLOBAL)}),{immediate:!0}),i((()=>Be),(e=>{Ae(Z.value+le.value)}),{immediate:!0});const Le=e=>{const l=e.key.toLowerCase();e.ctrlKey&&e.shiftKey&&"f"===l&&Ce()};return w(document,"keydown",(e=>{if(!Q.value)return;const l=e.key.toLowerCase();e.ctrlKey&&e.shiftKey&&"x"===l?Se.value=!Se.value:e.altKey&&"`"===l&&(oe.value=!oe.value)})),d({handleAddStyle:je}),(e,s)=>{const o=J;return l(),a(y,null,[k(Se)?(l(),S(ce,{key:0,onSelect:Ve,"parent-class":k(Be)===k(C).CURRENT?e.selectingParentClass:void 0},null,8,["parent-class"])):V("",!0),j(H,{class:"mc-style-editor-dialog",visible:k(Q),"onUpdate:visible":s[7]||(s[7]=e=>I(Q)?Q.value=e:null),onResize:ie,wid:"style_editor",onKeyup:Le,onOnActive:re,"allow-maximum":"","init-win-options":{width:"400px",height:"500px"}},{titleBarLeft:_((()=>[j(o,{class:"window-icon",size:"18"},{default:_((()=>[j(k(ne))])),_:1}),z(A(k(W)("common.style_editor"))+" (scss) ",1)])),titleBarRightControls:_((()=>[t("button",{title:k(W)("msgs.select_an_element_in")+" (ctrl+shift+x)",class:R({active:k(Se)}),onClick:s[0]||(s[0]=B((e=>Se.value=!k(Se)),["stop","prevent"]))},[j(o,{size:"20"},{default:_((()=>[k(Se)?(l(),S(k(ee),{key:1})):(l(),S(k(te),{key:0}))])),_:1})],10,pe),t("button",{onClick:s[1]||(s[1]=e=>oe.value=!k(oe)),title:k(W)("actions.add_tool_codes")},[j(o,{size:"20"},{default:_((()=>[j(k(Y))])),_:1})],8,de),t("button",{title:k(W)("actions.beautify_code")+" (ctrl+shift+f)",onClick:Ce},[j(o,{size:"20"},{default:_((()=>[j(k(ue))])),_:1})],8,me),t("button",{title:k(W)("actions.copy_code")+" (ctrl+a ctrl+c)",onClick:ke},[j(o,{size:"20"},{default:_((()=>[j(k(D))])),_:1})],8,ve)])),default:_((()=>[j(L,{name:"mc-fade"},{default:_((()=>{var e;return[M(t("div",{class:"code-mc-error-tip-button font-code",onClick:ye},A(null==(e=k(fe))?void 0:e.message),513),[[$,k(fe)]])]})),_:1}),t("div",he,[j(G,{visible:k(oe),"onUpdate:visible":s[2]||(s[2]=e=>I(oe)?oe.value=e:null),options:k(ze),title:`${k(W)("actions.add_tool_codes")} (alt+\`)`,class:"font-code",style:{top:"2px",right:"2px"}},null,8,["visible","options","title"]),k(h)?(l(),a("div",we,[j(N,{modelValue:k(Be),"onUpdate:modelValue":s[3]||(s[3]=e=>I(Be)?Be.value=e:null),"tab-list":k(Re),horizontal:""},null,8,["modelValue","tab-list"])])):V("",!0),t("div",ge,[k(Be)===k(C).GLOBAL?(l(),S(O,{key:0,ref_key:"vueMonacoRef",ref:se,modelValue:k(Z),"onUpdate:modelValue":s[4]||(s[4]=e=>I(Z)?Z.value=e:null),language:"scss","debounce-ms":500,"show-line-numbers":""},null,8,["modelValue"])):k(Be)===k(C).VARIABLES?(l(),S(O,{key:1,ref_key:"vueMonacoRef",ref:se,modelValue:k(le),"onUpdate:modelValue":s[5]||(s[5]=e=>I(le)?le.value=e:null),language:"scss","debounce-ms":500,"show-line-numbers":""},null,8,["modelValue"])):(l(),S(O,{key:2,ref_key:"vueMonacoRef",ref:se,modelValue:k(ae),"onUpdate:modelValue":s[6]||(s[6]=e=>I(ae)?ae.value=e:null),language:"scss","debounce-ms":500,"show-line-numbers":""},null,8,["modelValue"]))])])])),_:1},8,["visible"])],64)}}});export{fe as default};
