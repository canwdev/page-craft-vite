import{r as e,A as t,cL as n,cM as r,cp as a}from"./index-B89s4h30.js";function o(e){return new Promise(((t,n)=>{e.oncomplete=e.onsuccess=()=>t(e.result),e.onabort=e.onerror=()=>n(e.error)}))}let c;function s(){return c||(c=function(e,t){const n=indexedDB.open(e);n.onupgradeneeded=()=>n.result.createObjectStore(t);const r=o(n);return(e,n)=>r.then((r=>n(r.transaction(t,e).objectStore(t))))}("keyval-store","keyval")),c}function u(c,u,i={}){const{flush:l="pre",deep:d=!0,shallow:f=!1,onError:p=(e=>{console.error(e)}),writeDefaults:w=!0}=i,h=e(!1),y=(f?t:e)(u),v=n(u);async function m(){try{null==y.value?await function(e,t=s()){return t("readwrite",(t=>(t.delete(e),o(t.transaction))))}(c):await function(e,t,n=s()){return n("readwrite",(n=>new Promise(((r,a)=>{n.get(e).onsuccess=function(){try{n.put(t(this.result),e),r(o(n.transaction))}catch(c){a(c)}}}))))}(c,(()=>a(y.value)))}catch(e){p(e)}}!async function(){try{const e=await function(e,t=s()){return t("readonly",(t=>o(t.get(e))))}(c);void 0===e?null!=v&&w&&await function(e,t,n=s()){return n("readwrite",(n=>(n.put(t,e),o(n.transaction))))}(c,v):y.value=e}catch(e){p(e)}h.value=!0}();const{pause:b,resume:g}=r(y,(()=>m()),{flush:l,deep:d});return{set:async function(e){b(),y.value=e,await m(),g()},isFinished:h,data:y}}export{u};
