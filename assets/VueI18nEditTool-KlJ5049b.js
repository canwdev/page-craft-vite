import{I as e,T as a,i as s}from"./translate-eRZ3_q_G.js";import{d as o,o as t,m as l,x as i,Q as n,u as r,a as c,r as u,O as d,P as p,R as v,s as m,f as w,S as g,h,U as f,V as y,l as b,n as S,q as k,v as _,F as x,G as T,z as D,y as O,B as F,C as H,D as N,E as C,c as R,N as z}from"./index-fLfpLBqe.js";import{D as V,u as $,a as I,b as A,_ as B}from"./use-meta-dAi9WjwJ.js";const J={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 20 20"},E=[i("g",{fill:"none"},[i("path",{d:"M3 5a2 2 0 0 1 2-2h8.379a2 2 0 0 1 1.414.586l1.621 1.621A2 2 0 0 1 17 6.621V15a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5zm2-1a1 1 0 0 0-1 1v10a1 1 0 0 0 1 1v-4.5A1.5 1.5 0 0 1 6.5 10h7a1.5 1.5 0 0 1 1.5 1.5V16a1 1 0 0 0 1-1V6.621a1 1 0 0 0-.293-.707l-1.621-1.621A1 1 0 0 0 13.379 4H13v2.5A1.5 1.5 0 0 1 11.5 8h-4A1.5 1.5 0 0 1 6 6.5V4H5zm2 0v2.5a.5.5 0 0 0 .5.5h4a.5.5 0 0 0 .5-.5V4H7zm7 12v-4.5a.5.5 0 0 0-.5-.5h-7a.5.5 0 0 0-.5.5V16h8z",fill:"currentColor"})],-1)],W=o({name:"Save20Regular",render:function(e,a){return t(),l("svg",J,E)}}),j={types:[{description:"JSON",accept:{"application/JSON":[".json"]}}]},L=o({name:"VueI18nEditTool",components:{QuickOptions:n,I18nToolSettings:e,TranslateTreeItem:a,DropZone:V,Save20Regular:W},setup(){const{t:e}=r(),a=c(),o=u(d.parseWithRoot()),t=u(!1),{appendHistory:l,historyMenuOptions:i}=p(v.I18N_FILE_HANDLE_HISTORY,(async e=>{n.value=e;const a=await e.getFile();await b(a)})),n=m(),b=async e=>{try{t.value=!0;const a=await f(e),s=JSON.parse(a);o.value=d.parseWithRoot(s)}catch(a){console.error(a),window.$message.error(a.message)}finally{t.value=!1}},S=async()=>{const[e]=await window.showOpenFilePicker(j);await l(e),n.value=e;const a=await e.getFile();await b(a)},k=()=>{n.value=void 0,o.value=d.parseWithRoot()},_=async()=>{try{if(t.value=!0,!n.value)return;const a=await n.value.createWritable(),s=JSON.stringify(y(o.value),null,2);await a.write(s),await a.close(),window.$message.success(e("msgs.saved"))}catch(a){console.error(a),window.$message.error(a.message)}finally{t.value=!1}},x=async()=>{var a;try{t.value=!0,console.log(o.value);const s=JSON.stringify(y(o.value),null,2),l=await window.showSaveFilePicker({suggestedName:null==(a=n.value)?void 0:a.name,...j}),i=await l.createWritable();await i.write(s),await i.close(),window.$message.success(e("msgs.saved"))}catch(s){console.error(s),window.$message.error(s.message)}finally{t.value=!1}},{metaTitle:T}=$();w((()=>{n.value?_():x()})),g((()=>!!n.value));const D=u(!1),O=()=>{o.value=d.parseWithRoot({hello_world:{section_a:{test_str:"This is a test string",test_arr:["line 1","line 2","line 3"],test_number:114514,"":"中English混合"},section_b:{"":"Blur this input and it'll generate the key automatically!"},section_c:{"":"平行、行列"}}})},F=h((()=>[{label:e("common.settings"),props:{onClick:()=>{D.value=!0}}},{label:e("common.tools"),props:{onClick:()=>{a.isShowQuickLaunch=!0}}},n.value?{label:"💻 "+e("actions.close")+" JSON",children:[{label:e(e("msgs.confirm_close")),props:{onClick:k,isBack:!0}}]}:{label:"💻  "+e("actions.open")+" JSON",props:{onClick:()=>{S()}},dropdown:i.value},n.value?{label:"💾 "+e("actions.save"),props:{onClick:()=>{_()}}}:null,{label:e("actions.save_as")+"...",props:{onClick:()=>{x()}}},{label:e("common.demo"),children:[{label:e("msgs.load_demo_this_will"),props:{onClick:O,isBack:!0}}]}].filter(Boolean)));return{metaTitle:T,translateTreeRoot:o,fileHandle:n,handleImport:b,handleSelectFile:S,handleCloseFile:k,handleSaveFile:_,handleExport:x,loadDemo:O,iconTranslate:s,...I({cb:async e=>{try{t.value=!0;for(const a of e.dataTransfer.items)if("file"===a.kind){const e=await a.getAsFileSystemHandle();if("directory"!==e.kind){await l(e),n.value=e;const a=await e.getFile();await b(a)}else window.$message.error("Please drag and drop a json file here!")}}catch(a){console.error(a),window.$message.error(a.message)}finally{t.value=!1}}}),mainStore:a,isShowToolSettings:D,isLoading:t,menuOptions:F}}}),P={key:0,class:"mc-loading-container position-fixed"},Q={class:"vp-bg navbar-wrap",style:{position:"sticky",top:"0","z-index":"100","margin-bottom":"10px"}},M={class:"_container"},U=i("div",{class:"height-placeholder"},null,-1);const q=b(L,[["render",function(s,o,r,c,u,d){const p=z,v=V,m=B,w=n,g=A,h=a,f=e;return t(),l("div",{class:"vue-i18n-edit-tool i18n-style",onDragover:o[2]||(o[2]=D(((...e)=>s.fileDragover&&s.fileDragover(...e)),["prevent","stop"])),onDragleave:o[3]||(o[3]=D((e=>s.showDropzone=!1),["prevent","stop"])),onDrop:o[4]||(o[4]=D(((...e)=>s.fileDrop&&s.fileDrop(...e)),["prevent","stop"]))},[S(_,{name:"mc-fade"},{default:k((()=>[s.isLoading?(t(),l("div",P,[S(p)])):O("",!0)])),_:1}),S(_,{name:"mc-fade"},{default:k((()=>[F(S(v,{"position-fixed":"",text:s.$t("msgs.drag_file_here")},null,8,["text"]),[[H,s.showDropzone]])])),_:1}),i("div",Q,[S(g,{subtitle:"",onBack:o[0]||(o[0]=e=>s.$router.push({name:"HomePage"}))},{title:k((()=>[N(C(s.metaTitle),1)])),avatar:k((()=>[S(m,{src:s.iconTranslate,style:{background:"none"}},null,8,["src"])])),extra:k((()=>[S(w,{"is-static":"",options:s.menuOptions,horizontal:"","auto-focus":!1,"item-cls":"vp-button"},null,8,["options"])])),_:1})]),i("div",M,[(t(!0),l(x,null,T(s.translateTreeRoot,((e,a)=>{var o;return t(),R(h,{key:a,item:e,index:a,title:null==(o=s.fileHandle)?void 0:o.name},null,8,["item","index","title"])})),128))]),U,S(f,{visible:s.isShowToolSettings,"onUpdate:visible":o[1]||(o[1]=e=>s.isShowToolSettings=e)},null,8,["visible"])],32)}]]);export{q as default};
