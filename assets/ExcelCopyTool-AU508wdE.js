import{d as U,f as G,g as Z,h as q,r as C,i as V,j as Q,w as Y,o as ee,k as ne,T as f,l as oe,m as se,n as te,t as k,p as A,q as le,v as ae,x as re,b as ie,c as d,y as B,z as r,A as l,B as P,C as j,e as b,D as R,E as H,F as ce,G as ue,H as pe,I as g,J as y,K as de,M as me,N as _e,O as fe,P as we,Q as he,R as ge}from"./index-mqCekWp6.js";import{_ as K,u as ye,d as ve,a as Se,b as Ce,c as ke}from"./use-file-drop-_vTAKkSC.js";import{_ as be,a as Le}from"./Tabs-3KK-tLhu.js";const Xe="data:image/svg+xml,%3c?xml%20version='1.0'%20encoding='utf-8'?%3e%3c!--%20Generator:%20Adobe%20Illustrator%2023.0.2,%20SVG%20Export%20Plug-In%20.%20SVG%20Version:%206.00%20Build%200)%20--%3e%3csvg%20version='1.1'%20id='Layer_1'%20xmlns='http://www.w3.org/2000/svg'%20xmlns:xlink='http://www.w3.org/1999/xlink'%20x='0px'%20y='0px'%20viewBox='0%200%2024%2024'%20style='enable-background:new%200%200%2024%2024;'%20xml:space='preserve'%3e%3cstyle%20type='text/css'%3e%20.st0{fill:%2321A366;}%20.st1{fill:none;}%20.st2{fill:%23107C41;}%20.st3{fill:%2333C481;}%20.st4{fill:%23185C37;}%20.st5{opacity:0.5;}%20.st6{fill:%23FFFFFF;}%20%3c/style%3e%3cg%20id='_x32_4_14_'%3e%3cpath%20class='st0'%20d='M16,1H7C6.4,1,6,1.4,6,2v5l10,5l4,1.5l4-1.5V7L16,1z'/%3e%3crect%20y='0'%20class='st1'%20width='24'%20height='24'/%3e%3crect%20x='6'%20y='7'%20class='st2'%20width='10'%20height='5'/%3e%3cpath%20class='st3'%20d='M24,2v5h-8V1h7C23.5,1,24,1.5,24,2z'/%3e%3cpath%20class='st4'%20d='M16,12H6v5v0V22c0,0.6,0.4,1,1,1h16c0.6,0,1-0.4,1-1v-5L16,12z'/%3e%3cpath%20class='st5'%20d='M13.8,6H6v14h7.6c0.7,0,1.4-0.7,1.4-1.4V7.2C15,6.5,14.5,6,13.8,6z'/%3e%3cpath%20id='Back_Plate_49_'%20class='st2'%20d='M12.8,19H1.2C0.5,19,0,18.5,0,17.8L0,6.2C0,5.5,0.5,5,1.2,5h11.7C13.5,5,14,5.5,14,6.2%20v11.7C14,18.5,13.5,19,12.8,19z'/%3e%3cpath%20class='st6'%20d='M3.4,16L6,12L3.6,8h1.9l1.3,2.5C7,10.8,7,11,7.1,11.1h0c0.1-0.2,0.2-0.4,0.3-0.6L8.8,8h1.8l-2.4,4l2.5,4H8.7%20l-1.5-2.8C7.2,13.1,7.1,13,7,12.8h0c0,0.1-0.1,0.2-0.2,0.4L5.3,16H3.4z'/%3e%3crect%20x='16'%20y='12'%20class='st2'%20width='8'%20height='5'/%3e%3c/g%3e%3c/svg%3e",Te=e=>e.tagName.toLowerCase()==="td",$e=U({name:"ExcelCopyTool",components:{FileChooser:G,DropZone:K},setup(){const{t:e}=Z(),s=q(),I=C(),L=C(),X=C(!1),v=V(null),u=V(),S=C([]),m=C(0),{metaTitle:w}=Q();Y(m,()=>{$()});const N=()=>{if(!X.value){const n="XLSX Not Ready!";throw window.$message.error(n),new Error(n)}},T=n=>(S.value=n.SheetNames,n.Sheets[S.value[m.value]]),$=()=>{const n=u.value;if(!n){L.value.innerHTML="";return}console.log("[renderWorkbook]",n);const a=window.XLSX.utils.sheet_to_html(T(n));L.value.innerHTML=a},D=async n=>{if(v.value=null,N(),!/\.xlsx$/g.test(n.name)){window.$message.error("Only supports reading xlsx format!");return}const a=new FileReader;u.value=null,a.onload=function(o){v.value=n;const i=o.target.result;m.value=0,u.value=window.XLSX.read(i,{type:"binary"}),$()},a.readAsBinaryString(n)},E=C(!0),M=async()=>{if(window.XLSX){X.value=!0;return}try{await ve("//unpkg.com/xlsx@0.16.9/xlsx.mini.js")}catch(n){window.$message.error(n.message),console.error(n)}window.$message.success("XLSX Ready!"),console.log("XLSX ready",window.XLSX),X.value=!0};ee(async()=>{await M()});const _=ne("excel_copy_tool_copy_mode",f.HTML),F=n=>{let a=n.target;if(!Te(a)||!_.value||_.value===f.DISABLED||!a.innerText)return;let o=a.innerText;console.log(_.value);let i="";n.ctrlKey&&n.altKey?o=k(o,i=f.JSON):n.ctrlKey?o=k(o,i=f.TEXT):n.altKey?o=k(o,i=f.HTML):o=k(o,i=_.value),A(o),window.$message.success(i+" "+e("msgs.copy_success"));const c=document.createRange();c.selectNode(a);const p=window.getSelection();p&&(p.removeAllRanges(),p.addRange(c))},h=({currentOnly:n=!1}={})=>{const a=c=>{const p=_.value;return p===f.DISABLED||p===f.TEXT?c:c.map(x=>{for(const z in x)typeof x[z]=="string"&&(x[z]=k(x[z],p));return x})};if(!u.value){const c="Please open Excel file first!";throw window.$message.error(c),new Error(c)}if(n){const c=window.XLSX.utils.sheet_to_json(T(u.value));return a(c)}const o=u.value,i={};return o.SheetNames.forEach(function(c){const p=window.XLSX.utils.sheet_to_row_object_array(o.Sheets[c]);p.length>0&&(i[c]=a(p))}),i},t=async(n={})=>{var i;const a=h(n);let o=(i=v.value)==null?void 0:i.name;o&&(o=o.substring(0,o.lastIndexOf("."))+".json"),le(await ae(o,"excel_sheet_export"),JSON.stringify(a,null,2),".json")};oe(async()=>{await t()});const O=()=>{N();const n=window.XLSX.utils.aoa_to_sheet([["Name","Value","Num","Time"],["test001",`line1
line2`,123,new Date],["test001",`line1

line3`,-1,new Date]]),a=window.XLSX.utils.aoa_to_sheet([["Name"],["test002"],["test002"]]),o=window.XLSX.utils.book_new();window.XLSX.utils.book_append_sheet(o,n,"Sheet1"),window.XLSX.utils.book_append_sheet(o,a,"Sheet2"),m.value=0,u.value=o,$()},W=[{label:"Current Sheet",children:[{label:"Export Current Sheet JSON",props:{onClick:async()=>{await t({currentOnly:!0})}}},{label:"Copy Current Sheet JSON",props:{onClick:async()=>{const n=h({currentOnly:!0});await A(JSON.stringify(n,null,2)),window.$message.success("Sheet JSON Copied!")}}},{label:"Print Current Sheet to Console",props:{onClick:async()=>{const n=h({currentOnly:!0});console.log(n),window.$message.success("Print to Console!")}}}]},{label:"All Sheets",children:[{label:"Export All Sheets JSON",props:{onClick:async()=>{await t()}}},{label:"Copy All Sheets JSON",props:{onClick:async()=>{const n=h();await A(JSON.stringify(n,null,2)),window.$message.success("Sheet JSON Copied!")}}},{label:"Print All Sheets to Console",props:{onClick:async()=>{const n=h();console.log(n),window.$message.success("Print to Console!")}}}]}],J=()=>{v.value=null,u.value=null,S.value=[],m.value=0,L.value.innerHTML=""};return se(()=>{J()}),{metaTitle:w,iconExcel:Xe,sheetNames:S,sheetNameIndex:m,handleImport:D,importFileChooserRef:I,loadDemo:O,tableWrapperElRef:L,handleClick:F,copyMode:_,modTextConvertOptions:te(()=>[{label:"Disabled",value:f.DISABLED},...re]),dropdownMenuOptions:W,textConvertMultipleLine:k,...ye({cbFiles:n=>{n.length&&D(n[0])}}),isTrimEmptyLines:E,mainStore:s,isReady:X,workbookRef:u,fileRef:v,handleCloseFile:J}}}),xe={key:0,class:"mc-loading-container"};function Ne(e,s,I,L,X,v){const u=K,S=Se,m=_e,w=fe,N=we,T=he,$=ge,D=Ce,E=ce,M=ke,_=be,F=Le,h=G;return d(),B("div",{class:"excel-copy-tool",onDragover:s[7]||(s[7]=H((...t)=>e.fileDragover&&e.fileDragover(...t),["prevent","stop"])),onDragleave:s[8]||(s[8]=H(t=>e.showDropzone=!1,["prevent","stop"])),onDrop:s[9]||(s[9]=H((...t)=>e.fileDrop&&e.fileDrop(...t),["prevent","stop"]))},[r(P,{name:"mc-fade"},{default:l(()=>[ue(r(u,{"position-fixed":"",text:"Drop Excel file here"},null,512),[[pe,e.showDropzone]])]),_:1}),j("div",null,[r(E,{size:"small"},{default:l(()=>[r(D,{subtitle:"",onBack:s[4]||(s[4]=t=>e.$router.push({name:"HomePage"}))},{title:l(()=>[g(y(e.metaTitle),1)]),avatar:l(()=>[r(S,{src:e.iconExcel,style:{background:"none"}},null,8,["src"])]),extra:l(()=>[r(T,null,{default:l(()=>[r(T,{size:"small",align:"center"},{default:l(()=>[r(m,{size:"small",checked:e.isTrimEmptyLines,"onUpdate:checked":s[0]||(s[0]=t=>e.isTrimEmptyLines=t)},{default:l(()=>[g(y(e.$t("msgs.trim_empty_lines")),1)]),_:1},8,["checked"]),r(w,{text:"",onClick:s[1]||(s[1]=t=>e.mainStore.isShowTextTransformer=!0)},{default:l(()=>[g(y(e.$t("common.text_transformer"))+":",1)]),_:1}),r(N,{size:"small",value:e.copyMode,"onUpdate:value":s[2]||(s[2]=t=>e.copyMode=t),options:e.modTextConvertOptions,style:{width:"100px"}},null,8,["value","options"])]),_:1}),e.workbookRef?(d(),b($,{key:0,options:e.dropdownMenuOptions,placement:"bottom-start","key-field":"label",disabled:!e.isReady},{default:l(()=>[r(w,{size:"small"},{default:l(()=>[g(y(e.$t("actions.export")),1)]),_:1})]),_:1},8,["options","disabled"])):R("",!0),e.fileRef?(d(),b(w,{key:2,type:"primary",size:"small",onClick:e.handleCloseFile},{default:l(()=>[g(y(e.$t("actions.close")),1)]),_:1},8,["onClick"])):(d(),b(w,{key:1,type:"primary",disabled:!e.isReady,onClick:s[3]||(s[3]=t=>e.importFileChooserRef.chooseFile()),size:"small"},{default:l(()=>[g(y(e.$t("actions.open_excel")),1)]),_:1},8,["disabled"])),e.fileRef?R("",!0):(d(),b(w,{key:3,onClick:e.loadDemo,size:"small",disabled:!e.isReady},{default:l(()=>[g(y(e.$t("common.demo")),1)]),_:1},8,["onClick","disabled"]))]),_:1})]),_:1})]),_:1}),r(P,{name:"mc-fade"},{default:l(()=>[e.isReady?R("",!0):(d(),B("div",xe,[r(M)]))]),_:1}),e.isReady?(d(),b(E,{key:0,class:"sheet-name-card",size:"small"},{default:l(()=>[r(F,{size:"small",type:"card",animated:"",value:e.sheetNameIndex,"onUpdate:value":s[5]||(s[5]=t=>e.sheetNameIndex=t)},{default:l(()=>[(d(!0),B(de,null,me(e.sheetNames,(t,O)=>(d(),b(_,{style:{padding:"0"},name:O,tab:t,key:t},null,8,["name","tab"]))),128))]),_:1},8,["value"])]),_:1})):R("",!0)]),j("div",{ref:"tableWrapperElRef",class:"excel-table-container",onClick:s[6]||(s[6]=(...t)=>e.handleClick&&e.handleClick(...t))},null,512),r(h,{ref:"importFileChooserRef",accept:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",onSelected:e.handleImport},null,8,["onSelected"])],32)}const Me=ie($e,[["render",Ne]]);export{Me as default};
