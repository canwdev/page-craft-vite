import{d as e,$ as a,I as t,u as s,r as o,aN as n,R as i,aO as l,aP as r,A as c,G as m,aF as u,aQ as p,_ as d,k as v,Z as w,e as g,U as f,f as h,Q as y,q as _,aH as b,T as S,p as j,g as k,h as D,ag as N,F as T,m as $,w as I,o as x}from"./index-BJklM7uy.js";/* empty css                   *//* empty css                      *//* empty css                   */import{T as F}from"./TranslateTreeItem-DuDlOCEU.js";import{D as O,u as C}from"./use-file-drop-FX8JCuIK.js";import{a as H,u as R}from"./use-beforeunload-cpGEAtLA.js";import{I as E}from"./I18nToolSettings-lnRiPKNX.js";import{u as J}from"./file-history-DSZQkfOk.js";import{C as L}from"./CommonNavbar-BN_veBGg.js";/* empty css                  *//* empty css                        */import"./use-model-wrapper-Cm8bqa9M.js";import"./i18n-tool-settings-CZ9O6yuA.js";import"./index-BB5hC_Ln.js";import"./enum-wriI_ogO.js";import"./index.vue_vue_type_script_setup_true_lang-CqCeVzfa.js";/* empty css                        */import"./RectSwitch-Dpia0p_L.js";import"./useIDBKeyval-vbfvgNrE.js";const M={types:[{description:"JSON",accept:{"application/JSON":[".json"]}}]},P=e({name:"VueI18nEditTool",components:{DropdownMenu:a,CommonNavbar:L,I18nToolSettings:E,TranslateTreeItem:F,DropZone:O},setup(){const{t:e}=t(),a=s(),d=o(n.parseWithRoot()),v=o(!1),{appendHistory:w,historyMenuOptions:g}=J(p.I18N_FILE_HANDLE_HISTORY,(async e=>{f.value=e;const a=await e.getFile();await h(a)})),f=i(),h=async e=>{try{v.value=!0;const a=await l(e),t=JSON.parse(a);d.value=n.parseWithRoot(t)}catch(a){console.error(a),window.$message.error(a.message)}finally{v.value=!1}},y=async()=>{try{if(v.value=!0,!f.value)return;const a=await f.value.createWritable(),t=JSON.stringify(r(d.value),null,2);await a.write(t),await a.close(),window.$message.success(e("msgs.saved"))}catch(a){console.error(a),window.$message.error(a.message)}finally{v.value=!1}},_=async()=>{var a;try{v.value=!0,console.log(d.value);const t=JSON.stringify(r(d.value),null,2),s=await window.showSaveFilePicker({suggestedName:null==(a=f.value)?void 0:a.name,...M}),o=await s.createWritable();await o.write(t),await o.close(),window.$message.success(e("msgs.saved"))}catch(t){console.error(t),window.$message.error(t.message)}finally{v.value=!1}};H((()=>{f.value?y():_()})),R((()=>!!f.value));return{translateTreeRoot:d,fileHandle:f,handleImport:h,handleSelectFile:async()=>{const[e]=await window.showOpenFilePicker(M);await w(e),f.value=e;const a=await e.getFile();await h(a)},handleCloseFile:()=>{f.value=void 0,d.value=n.parseWithRoot()},handleSaveFile:y,handleExport:_,loadDemo:()=>{d.value=n.parseWithRoot({hello_world:{section_a:{test_str:"This is a test string",test_arr:["line 1","line 2","line 3"],test_number:114514,"":"ä¸­Englishæ··åˆ"},section_b:{"":"Blur this input and it'll generate the key automatically!"},section_c:{"":"å¹³è¡Œã€è¡Œåˆ—"}}})},...C({cb:async e=>{try{v.value=!0;for(const a of e.dataTransfer.items)if("file"===a.kind){const e=await a.getAsFileSystemHandle();if("directory"!==e.kind){await w(e),f.value=e;const a=await e.getFile();await h(a)}else window.$message.error("Please drag and drop a json file here!")}}catch(a){console.error(a),window.$message.error(a.message)}finally{v.value=!1}}}),mainStore:a,isLoading:v,historyMenuOptions:g,handleSettings:()=>{c.emit(m.OPEN_SETTINGS,u.I18N)}}}}),W={class:"flex-row-center-gap"},A={class:"vp-button"},Q={class:"vp-button"},G={class:"scroll-content scrollbar-mini"},Z={class:"i18n-container"};const z=d(P,[["render",function(e,a,t,s,o,n){const i=_("DropZone"),l=N,r=_("DropdownMenu"),c=_("CommonNavbar"),m=_("TranslateTreeItem"),u=w;return v((x(),g("div",{class:"vue-i18n-edit-tool i18n-style",onDragover:a[7]||(a[7]=I(((...a)=>e.fileDragover&&e.fileDragover(...a)),["prevent","stop"])),onDragleave:a[8]||(a[8]=I((a=>e.showDropzone=!1),["prevent","stop"])),onDrop:a[9]||(a[9]=I(((...a)=>e.fileDrop&&e.fileDrop(...a)),["prevent","stop"]))},[f(S,{name:"mc-fade"},{default:y((()=>[v(f(i,{"position-fixed":"",text:e.$t("msgs.drag_file_here")},null,8,["text"]),[[b,e.showDropzone]])])),_:1}),f(c,null,{extra:y((()=>[h("div",W,[h("button",{class:"vp-button",onClick:a[0]||(a[0]=a=>e.handleSettings())},D(e.$t("common.settings")),1),h("button",{class:"vp-button",onClick:a[1]||(a[1]=a=>e.mainStore.isShowQuickLaunch=!e.mainStore.isShowQuickLaunch)},D(e.$t("common.toolbox")),1),e.fileHandle?(x(),j(l,{key:0,onConfirm:a[2]||(a[2]=a=>e.handleCloseFile()),title:e.$t("msgs.confirm_close")},{reference:y((()=>[h("button",A,"ðŸ’» "+D(e.$t("actions.close"))+" JSON",1)])),_:1},8,["title"])):(x(),j(r,{key:1,options:e.historyMenuOptions},{default:y((()=>[h("button",{class:"vp-button primary",onClick:a[3]||(a[3]=a=>e.handleSelectFile())}," ðŸ’» "+D(e.$t("actions.open"))+" JSON ",1)])),_:1},8,["options"])),e.fileHandle?(x(),g("button",{key:2,class:"vp-button primary",onClick:a[4]||(a[4]=a=>e.handleSaveFile())}," ðŸ’¾ "+D(e.$t("actions.save")),1)):k("",!0),h("button",{class:"vp-button",onClick:a[5]||(a[5]=a=>e.handleExport())},D(e.$t("actions.save_as"))+" ...",1),f(l,{onConfirm:a[6]||(a[6]=a=>e.loadDemo()),title:e.$t("msgs.load_demo_this_will")},{reference:y((()=>[h("button",Q,D(e.$t("common.demo")),1)])),_:1},8,["title"])])])),_:1}),h("div",G,[h("div",Z,[(x(!0),g(T,null,$(e.translateTreeRoot,((a,t)=>{var s;return x(),j(m,{key:t,item:a,index:t,title:null==(s=e.fileHandle)?void 0:s.name},null,8,["item","index","title"])})),128)),a[10]||(a[10]=h("div",{class:"height-placeholder"},null,-1))])])],32)),[[u,e.isLoading]])}]]);export{z as default};
