import{d as e,t as o,r as t,_ as n,o as s,b as l,k as a,aA as i,e as r,V as c,D as d,u,N as p,K as m,I as w,q as h,aB as f,L as y,J as v,c as _,aC as g,ak as b,H as C,aD as S,i as x,P as L,M as k,T as D,g as T,w as X,aE as R,Z as N,Q as E,f as O,p as j,F,m as I,ax as $,aF as M}from"./index-Dcsrw7an.js";/* empty css                   *//* empty css                    *//* empty css                    */import{b as A}from"./index-BSUZN_B5.js";import{D as J,u as V}from"./use-file-drop-BJ7ff801.js";import{a as P}from"./use-beforeunload-HobKYt9I.js";import{C as B}from"./CommonNavbar-CYqCX-Ap.js";import{R as H}from"./RectSwitch-DyIQ1C31.js";import{T as z}from"./TabLayout-C1UfuSWM.js";import"./use-model-wrapper-D-qKYU8I.js";const K=e({name:"FileChooser",props:{showInput:{type:Boolean,default:!1},multiple:{type:Boolean,default:!1},sizeLimit:{type:Number,default:2},accept:{type:String,default:null}},emits:["selected"],setup(e,{emit:n}){const{multiple:s,sizeLimit:l}=o(e),a=t();return{handleInputFileChange:async e=>{const o=a.value;if(!o)return;const t=Array.from(o.files||[]);o.value="",n("selected",s.value?t:t[0])},chooseFile:()=>{a.value.click()},fileInputRef:a}}}),Y={class:"file-chooser"},U=["accept","multiple"];const W=n(K,[["render",function(e,o,t,n,c,d){return s(),l("div",Y,[a(r("input",{type:"file",ref:"fileInputRef",onChange:o[0]||(o[0]=(...o)=>e.handleInputFileChange&&e.handleInputFileChange(...o)),accept:e.accept,multiple:e.multiple},null,40,U),[[i,e.showInput]])])}]]),Z=e=>new Promise(((o,t)=>{if(document.getElementById(e))o();else{const n=document.createElement("script");n.src=e,n.id=e,n.onload=function(){this.onerror=this.onload=null,o()},n.onerror=function(e){this.onerror=this.onload=null,t(e)},document.body.appendChild(n)}}));window.demo_aoa_to_sheet=[["Name","Value","Num","Time","âœ¨Tips"],["test001","line1\nline2",123,new Date,"You can set window.json_to_sheet = [] to generate table!"],["test001","line1\n\nline3",-1,new Date,"window.json_to_sheet"]],window.demo_json_to_sheet=[{region:"DE",product_name:"Test1",code:"123456",url:"http://localhost:8080",tips:"âœ¨ You can set window.demo_json_to_sheet = [] to generate table!"},{region:"FR",product_name:"Test2",code:"7890",url:"https://example.com",tips:"window.demo_json_to_sheet"}];const q=e({name:"ExcelCopyTool",components:{TabLayout:z,RectSwitch:H,DropdownMenu:c,CommonNavbar:B,FileChooser:W,DropZone:J},setup(){const{t:e}=d(),o=u(),n=t(),s=t(),l=t(!1),a=p(null),i=p(),r=t([]),c=t(0);m(c,(()=>{k()}));const x=()=>{if(!l.value){const e="XLSX Not Ready!";throw window.$message.error(e),new Error(e)}},L=e=>(r.value=e.SheetNames,e.Sheets[r.value[c.value]]),k=()=>{const e=i.value;if(!e)return void(s.value.innerHTML="");console.log("[renderWorkbook]",e);const o=window.XLSX.utils.sheet_to_html(L(e));s.value.innerHTML=o},D=async e=>{if(a.value=null,x(),!/\.xlsx$/g.test(e.name))return void window.$message.error("Only supports reading xlsx format!");const o=new FileReader;i.value=null,o.onload=function(o){a.value=e;const t=o.target.result;c.value=0,i.value=window.XLSX.read(t,{type:"binary"}),k()},o.readAsBinaryString(e)},T=t(!0);w((async()=>{await(async()=>{if(window.XLSX)l.value=!0;else{try{await Z("./lib/xlsx.mini.js")}catch(e){window.$message.error(e.message),console.error(e)}window.$message.success("XLSX Ready!"),console.log("XLSX ready",window.XLSX),l.value=!0}})()}));const X=h(y.EXCEL_COPY_TOOL_COPY_MODE,f.HTML,localStorage,{listenToStorageChanges:!1}),R=({currentOnly:e=!1}={})=>{const o=e=>{const o=X.value;return o===f.DISABLED||o===f.TEXT?e:e.map((e=>{for(const t in e)"string"==typeof e[t]&&(e[t]=g(e[t],o));return e}))};if(!i.value){const e="Please open Excel file first!";throw window.$message.error(e),new Error(e)}if(e){const e=window.XLSX.utils.sheet_to_json(L(i.value));return o(e)}const t=i.value,n={};return t.SheetNames.forEach((function(e){const s=window.XLSX.utils.sheet_to_row_object_array(t.Sheets[e]);s.length>0&&(n[e]=o(s))})),n},N=async(e={})=>{var o;const t=R(e);let n=null==(o=a.value)?void 0:o.name;n&&(n=n.substring(0,n.lastIndexOf("."))),b(await C(n,"excel_sheet_export"),JSON.stringify(t,null,2),".json")};P((async()=>{await N()}));const E=[{label:"ðŸ§© Current Sheet",children:[{label:"ðŸ“¤ Export JSON",props:{onClick:async()=>{await N({currentOnly:!0})}}},{label:"ðŸ“‹ Copy JSON",props:{onClick:async()=>{const e=R({currentOnly:!0});await A(JSON.stringify(e,null,2)),window.$message.success("Sheet JSON Copied!")}}},{label:"ðŸ’» Print to Console",props:{onClick:async()=>{const e=R({currentOnly:!0});console.log(e),window.$message.success("Print to Console!")}}}]},{label:"ðŸ“— All Sheets",children:[{label:"ðŸ“¤ Export All JSON",props:{onClick:async()=>{await N()}}},{label:"ðŸ“‹ Copy All JSON",props:{onClick:async()=>{const e=R();await A(JSON.stringify(e,null,2)),window.$message.success("Sheet JSON Copied!")}}},{label:"ðŸ’» Print All to Console",props:{onClick:async()=>{const e=R();console.log(e),window.$message.success("Print to Console!")}}}]}],O=()=>{a.value=null,i.value=null,r.value=[],c.value=0,s.value.innerHTML=""};return v((()=>{O()})),{sheetNames:r,sheetNameIndex:c,handleImport:D,importFileChooserRef:n,loadDemo:()=>{x();const e=window.XLSX.utils.aoa_to_sheet(window.demo_aoa_to_sheet),o=window.XLSX.utils.json_to_sheet(window.demo_json_to_sheet),t=window.XLSX.utils.book_new();window.XLSX.utils.book_append_sheet(t,e,"aoa_to_sheet"),window.XLSX.utils.book_append_sheet(t,o,"json_to_sheet"),c.value=0,i.value=t,k()},tableWrapperElRef:s,handleClick:o=>{let t=o.target;if(!(e=>"td"===e.tagName.toLowerCase())(t)||!X.value||X.value===f.DISABLED)return;if(!t.innerText)return;let n=t.innerText;console.log(X.value);let s="";n=o.ctrlKey&&o.altKey?g(n,s=f.JSON):o.ctrlKey?g(n,s=f.TEXT):o.altKey?g(n,s=f.HTML):g(n,s=X.value),A(n),window.$message.success(s+" "+e("msgs.copy_success"));const l=document.createRange();l.selectNode(t);const a=window.getSelection();a&&(a.removeAllRanges(),a.addRange(l))},copyMode:X,modTextConvertOptions:_((()=>[{label:"Disabled",value:f.DISABLED},...S])),dropdownMenuOptions:E,textConvertMultipleLine:g,...V({cbFiles:e=>{e.length&&D(e[0])}}),isTrimEmptyLines:T,mainStore:o,isReady:l,workbookRef:i,fileRef:a,handleCloseFile:O}}}),Q={class:"flex-row-center-gap"},G={class:"flex-row-center-gap"},ee={class:"vp-button"},oe=r("span",{class:"mdi mdi-download"},null,-1),te=["disabled"],ne=["disabled"],se={key:0,class:"sheet-name-card vp-panel"};const le=n(q,[["render",function(e,o,t,n,c,d){const u=x("DropZone"),p=$,m=x("RectSwitch"),w=x("DropdownMenu"),h=x("CommonNavbar"),f=M,y=R,v=x("FileChooser"),_=N;return s(),l("div",{class:"excel-copy-tool",onDragover:o[8]||(o[8]=X(((...o)=>e.fileDragover&&e.fileDragover(...o)),["prevent","stop"])),onDragleave:o[9]||(o[9]=X((o=>e.showDropzone=!1),["prevent","stop"])),onDrop:o[10]||(o[10]=X(((...o)=>e.fileDrop&&e.fileDrop(...o)),["prevent","stop"]))},[L(D,{name:"mc-fade"},{default:k((()=>[a(L(u,{"position-fixed":"",text:"Drop Excel file here"},null,512),[[i,e.showDropzone]])])),_:1}),a((s(),l("div",null,[L(h,null,{extra:k((()=>[r("div",Q,[r("div",G,[L(p,{size:"small",modelValue:e.isTrimEmptyLines,"onUpdate:modelValue":o[0]||(o[0]=o=>e.isTrimEmptyLines=o)},{default:k((()=>[E(O(e.$t("msgs.trim_empty_lines")),1)])),_:1},8,["modelValue"]),r("a",{onClick:o[1]||(o[1]=o=>e.mainStore.isShowTextTransformer=!e.mainStore.isShowTextTransformer)},O(e.$t("common.text_transformer"))+": ",1),L(m,{size:"small",modelValue:e.copyMode,"onUpdate:modelValue":o[2]||(o[2]=o=>e.copyMode=o),options:e.modTextConvertOptions},null,8,["modelValue","options"])]),e.workbookRef?(s(),j(w,{key:0,options:e.dropdownMenuOptions,disabled:!e.isReady},{default:k((()=>[r("button",ee,[oe,E(" "+O(e.$t("actions.export")),1)])])),_:1},8,["options","disabled"])):T("",!0),e.fileRef?(s(),l("button",{key:2,class:"vp-button primary",onClick:o[4]||(o[4]=(...o)=>e.handleCloseFile&&e.handleCloseFile(...o))},O(e.$t("actions.close")),1)):(s(),l("button",{key:1,disabled:!e.isReady,onClick:o[3]||(o[3]=o=>e.importFileChooserRef.chooseFile()),class:"vp-button primary"},O(e.$t("actions.open")+" Excel"),9,te)),e.fileRef?T("",!0):(s(),l("button",{key:3,onClick:o[5]||(o[5]=(...o)=>e.loadDemo&&e.loadDemo(...o)),class:"vp-button",disabled:!e.isReady},O(e.$t("common.demo")),9,ne))])])),_:1}),e.isReady&&e.sheetNames.length?(s(),l("div",se,[L(y,{modelValue:e.sheetNameIndex,"onUpdate:modelValue":o[6]||(o[6]=o=>e.sheetNameIndex=o),type:"card"},{default:k((()=>[(s(!0),l(F,null,I(e.sheetNames,((e,o)=>(s(),j(f,{key:o,label:e,name:o},null,8,["label","name"])))),128))])),_:1},8,["modelValue"])])):T("",!0)])),[[_,!e.isReady]]),r("div",{ref:"tableWrapperElRef",class:"excel-table-container vp-panel",onClick:o[7]||(o[7]=(...o)=>e.handleClick&&e.handleClick(...o))},null,512),L(v,{ref:"importFileChooserRef",accept:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",onSelected:e.handleImport},null,8,["onSelected"])],32)}]]);export{le as default};
