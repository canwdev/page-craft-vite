import{t as e,c as t,cc as l,z as a,d as s,e as i,o as n,y as o,w as c,l as d,i as r,f as m,h as p,_ as u,r as v,J as b,Y as h,k as f,Z as C,U as y,$ as k,Q as w,T as g,a2 as D,a1 as x,p as M,cd as L,F as _,m as P,a0 as z,N as F,g as S,v as $}from"./index-BJklM7uy.js";/* empty css                   */import{_ as T}from"./QuickContextMenu.vue_vue_type_script_setup_true_lang-DIpGAXu5.js";import{u as Y,a as I,b as O,c as R}from"./use-navigation-B_J1vU-v.js";import{f as H,n as U,g as B}from"./index-BVPZ2aTg.js";import"./file-history-DSZQkfOk.js";import"./useIDBKeyval-vbfvgNrE.js";const N=s=>{const{item:i}=e(s);return{iconName:t((()=>i.value.isDirectory?"folder":"text-x-preview")),titleDesc:t((()=>`Name: ${i.value.name}\nSize: ${l(i.value.size)}\nType: ${i.value.mimeType||"-"}\nLast Modified: ${a(i.value.lastModified,"YYYY-MM-DD HH:mm:ss")}\nCreated: ${a(i.value.birthtime,"YYYY-MM-DD HH:mm:ss")}\n`))}},j=["title"],E={class:"list-col c-filename"},A=["checked"],V={class:"list-col c-size"},G={class:"list-col c-time"},K={class:"list-col c-time"},Q=u(s({__name:"FileListItem",props:{item:{},active:{type:Boolean}},emits:["open","select"],setup(e,{emit:t}){const s=e,{titleDesc:u}=N(s);return(e,t)=>(n(),i("button",{class:r(["btn-no-style file-list-item file-list-row",{active:e.active,hidden:e.item.hidden}]),onClick:t[4]||(t[4]=c((t=>e.$emit("select",{item:e.item,event:t})),["stop"])),onKeyup:t[5]||(t[5]=d((t=>e.$emit("open",e.item)),["enter"])),onDblclick:t[6]||(t[6]=c((t=>e.$emit("open",e.item)),["stop"])),title:o(u)},[m("div",E,[m("input",{class:"file-checkbox",type:"checkbox",checked:e.active,onClick:t[0]||(t[0]=c((t=>e.$emit("select",{item:e.item,event:t,toggle:!0})),["stop"])),onDblclick:t[1]||(t[1]=c((()=>{}),["stop"]))},null,40,A),m("span",{class:"text-overflow filename-text",onClick:t[2]||(t[2]=c((t=>e.$emit("open",e.item)),["stop"])),onDblclick:t[3]||(t[3]=c((()=>{}),["stop"]))},p(e.item.isDirectory?"📁":"📄")+" "+p(e.item.name),33)]),m("div",V,p(o(l)(e.item.size)),1),m("div",G,p(o(a)(e.item.lastModified)),1),m("div",K,p(o(a)(e.item.birthtime)),1)],42,j))}}),[["__scopeId","data-v-f9d28868"]]),q=["title"],J=["checked"],Z={class:"desktop-icon-image"},W=u(s({__name:"FileGridItem",props:{item:{},active:{type:Boolean}},emits:["open","select"],setup(e,{emit:t}){const l=e,{titleDesc:a}=N(l);return(e,t)=>(n(),i("button",{class:r(["file-grid-item btn-no-style",{active:e.active,hidden:e.item.hidden}]),onClick:t[4]||(t[4]=c((t=>e.$emit("select",{item:e.item,event:t})),["stop"])),onKeyup:t[5]||(t[5]=d((t=>e.$emit("open",e.item)),["enter"])),onDblclick:t[6]||(t[6]=c((t=>e.$emit("open",e.item)),["stop"])),title:o(a)},[m("input",{class:"file-checkbox",type:"checkbox",checked:e.active,onClick:t[0]||(t[0]=c((t=>e.$emit("select",{item:e.item,event:t,toggle:!0})),["stop"])),onDblclick:t[1]||(t[1]=c((()=>{}),["stop"]))},null,40,J),m("span",Z,p(e.item.isDirectory?"📁":"📄"),1),m("span",{class:"desktop-icon-name",onClick:t[2]||(t[2]=c((t=>e.$emit("open",e.item)),["stop"])),onDblclick:t[3]||(t[3]=c((()=>{}),["stop"]))},p(e.item.name),33)],42,q))}}),[["__scopeId","data-v-26e66db6"]]);var X=(e=>(e.default="default",e.name="name",e.nameDesc="nameDesc",e.size="size",e.sizeDesc="sizeDesc",e.extension="extension",e.extensionDesc="extensionDesc",e.lastModified="lastModified",e.lastModifiedDesc="lastModifiedDesc",e.birthTime="birthTime",e.birthTimeDesc="birthTimeDesc",e))(X||{});const ee={default:(e,t)=>{const l=(e.isDirectory?1:2)-(t.isDirectory?1:2);return 0!==l?l:e.name.toLowerCase().localeCompare(t.name.toLowerCase())},name:(e,t)=>e.name.toLowerCase().localeCompare(t.name.toLowerCase()),nameDesc:(e,t)=>-e.name.toLowerCase().localeCompare(t.name.toLowerCase()),size:(e,t)=>(e.size||0)-(t.size||0),sizeDesc:(e,t)=>-((e.size||0)-(t.size||0)),extension:(e,t)=>e.ext.toLowerCase().localeCompare(t.ext.toLowerCase()),extensionDesc:(e,t)=>-e.ext.toLowerCase().localeCompare(t.ext.toLowerCase()),lastModified:(e,t)=>e.lastModified-t.lastModified,lastModifiedDesc:(e,t)=>-(e.lastModified-t.lastModified),birthTime:(e,t)=>e.birthtime-t.birthtime,birthTimeDesc:(e,t)=>-(e.birthtime-t.birthtime)},te={class:"explorer-actions vp-panel"},le={class:"action-group"},ae=["disabled"],se=["disabled"],ie=["disabled"],ne=["disabled"],oe=["disabled"],ce={class:"action-group"},de={key:0,class:"mdi mdi-view-grid-outline"},re={key:1,class:"mdi mdi-view-list-outline"},me={class:"action-button-wrap"},pe={key:0,class:"explorer-list-view"},ue={key:1,class:"explorer-grid-view"},ve=u(s({__name:"FileList",props:{files:{},isLoading:{type:Boolean},basePath:{}},emits:["open","update:isLoading","refresh"],setup(l,{emit:a}){const s=a,d=l,{basePath:r,files:p}=e(d),u=h(d,"isLoading",s),{isGridView:F,showSortMenu:S,sortOptions:$,filteredFiles:R}=(e=>{const l=v(!1),a=v(X.default);return{isGridView:l,showSortMenu:v(!1),sortOptions:t((()=>[{label:"Default",value:X.default},{label:"Name ▲",value:X.name},{label:"Name ▼",value:X.nameDesc},{label:"Size ▲",value:X.size},{label:"Size ▼",value:X.sizeDesc},{label:"Extension ▲",value:X.extension},{label:"Extension ▼",value:X.extensionDesc},{label:"Last Modified ▲",value:X.lastModified},{label:"Last Modified ▼",value:X.lastModifiedDesc},{label:"Created Time ▲",value:X.birthTime},{label:"Created Time ▼",value:X.birthTimeDesc}].map((e=>({label:e.label,props:{class:a.value===e.value?"active":"",onClick:()=>{a.value=e.value}}}))))),filteredFiles:t((()=>e.value.sort(ee[a.value])))}})(p),{selectedItems:B,selectedItemsSet:N,explorerContentRef:j,toggleSelect:E,toggleSelectAll:A,selectedPaths:V}=Y({filteredFiles:R,basePath:r}),{enablePaste:G,handleCut:K,handleCopy:q,handlePaste:J}=I({selectedPaths:V,basePath:r,isLoading:u,emit:s}),{handleCreateFile:Z,handleCreateFolder:ve,handleRename:be,confirmDelete:he,ctxMenuOptions:fe,ctxMenuRef:Ce,handleShowCtxMenu:ye,enableAction:ke}=(({isLoading:e,selectedPaths:l,basePath:a,selectedItems:s,enablePaste:i,handlePaste:n,handleCut:o,handleCopy:c,selectedItemsSet:d,emit:r})=>{const m=async()=>{try{const t=s.value[0],l=await window.$mcUtils.showInputPrompt({title:"Rename",value:t.name});e.value=!0,await H.renameEntry({fromPath:U(a.value+"/"+t.name),toPath:U(a.value+"/"+l)}),r("refresh")}finally{e.value=!1}},p=async()=>{try{e.value=!0,await H.deleteEntry({path:l.value})}finally{e.value=!1,r("refresh")}},u=()=>{window.$dialog.confirm("确认删除？此操作不可撤销","Confirm Delete",{type:"warning"}).then((()=>{p()})).catch()},h=t((()=>{if(!s.value.length)return[{label:"Refresh",props:{onClick:()=>r("refresh")}},{label:"Paste",props:{onClick:n},disabled:!i.value}];const e=1===s.value.length;return[e&&{label:"Open",props:{onClick:()=>r("open",s.value[0])}},{split:!0},{label:"Cut",props:{onClick:o}},{label:"Copy",props:{onClick:c}},{split:!0},e&&{label:"Rename",props:{onClick:m}},{label:"Delete",props:{onClick:u}}].filter(Boolean)})),f=v(),C=t((()=>s.value.length>0));return{handleCreateFile:async()=>{try{const t=await window.$mcUtils.showInputPrompt({title:"Create File",value:`file_${b(new Date).format("YYYYMMDD_HHmmss")}.txt`});e.value=!0,await H.createFile({path:U(a.value+"/"+t),file:""}),r("refresh")}finally{e.value=!1}},handleCreateFolder:async()=>{try{const t=await window.$mcUtils.showInputPrompt({title:"Create Folder",value:`folder_${b(new Date).format("YYYYMMDD_HHmmss")}`});e.value=!0,await H.createDir({path:U(a.value+"/"+t)}),r("refresh")}finally{e.value=!1}},handleRename:m,doDeleteSelected:p,confirmDelete:u,ctxMenuOptions:h,ctxMenuRef:f,handleShowCtxMenu:(e,t)=>{e?d.value.has(e)||(s.value=[e]):s.value=[],f.value.showMenu(t)},enableAction:C}})({isLoading:u,selectedPaths:V,basePath:r,selectedItems:B,enablePaste:G,handlePaste:J,handleCut:K,handleCopy:q,selectedItemsSet:N,emit:s}),{handleOpenLocalDir:we,localDirHistoryOptions:ge}=O({emit:s});return(e,t)=>{const l=C;return f((n(),i("div",{class:"explorer-list-wrap",onContextmenu:t[16]||(t[16]=c((()=>{}),["prevent"]))},[m("div",te,[m("div",le,[m("button",{class:"btn-action btn-no-style",onClick:t[0]||(t[0]=e=>o(Z)()),title:"Create Document"},t[17]||(t[17]=[m("span",{class:"mdi mdi-file-document-plus-outline"},null,-1)])),m("button",{class:"btn-action btn-no-style",onClick:t[1]||(t[1]=(...e)=>o(ve)&&o(ve)(...e)),title:"Create Folder"},t[18]||(t[18]=[m("span",{class:"mdi mdi-folder-plus-outline"},null,-1)])),t[25]||(t[25]=m("div",{class:"split-line"},null,-1)),m("button",{class:"btn-action btn-no-style",disabled:!o(ke),onClick:t[2]||(t[2]=(...e)=>o(K)&&o(K)(...e)),title:"Cut"},t[19]||(t[19]=[m("span",{class:"mdi mdi-content-cut"},null,-1)]),8,ae),m("button",{class:"btn-action btn-no-style",disabled:!o(ke),onClick:t[3]||(t[3]=(...e)=>o(q)&&o(q)(...e)),title:"Copy"},t[20]||(t[20]=[m("span",{class:"mdi mdi-content-copy"},null,-1)]),8,se),m("button",{class:"btn-action btn-no-style",disabled:!o(G),onClick:t[4]||(t[4]=(...e)=>o(J)&&o(J)(...e)),title:"Paste"},t[21]||(t[21]=[m("span",{class:"mdi mdi-content-paste"},null,-1)]),8,ie),m("button",{class:"btn-action btn-no-style",disabled:1!==o(B).length,onClick:t[5]||(t[5]=(...e)=>o(be)&&o(be)(...e)),title:"Rename"},t[22]||(t[22]=[m("span",{class:"mdi mdi-rename"},null,-1)]),8,ne),m("button",{class:"btn-action btn-no-style",disabled:!o(ke),onClick:t[6]||(t[6]=(...e)=>o(he)&&o(he)(...e)),title:"Delete"},t[23]||(t[23]=[m("span",{class:"mdi mdi-delete-forever-outline"},null,-1)]),8,oe),t[26]||(t[26]=m("div",{class:"split-line"},null,-1)),y(k,{options:o(ge)},{default:w((()=>[m("button",{class:"btn-action btn-no-style",title:"Open Local Folder",onClick:t[7]||(t[7]=(...e)=>o(we)&&o(we)(...e))},t[24]||(t[24]=[m("span",{class:"mdi mdi-folder-open-outline"},null,-1)]))])),_:1},8,["options"])]),m("div",ce,[m("button",{onClick:t[8]||(t[8]=e=>F.value=!o(F)),class:"btn-action btn-no-style",title:"Toggle grid view"},[o(F)?(n(),i("span",de)):(n(),i("span",re))]),m("div",me,[m("button",{class:"btn-action btn-no-style",title:"Toggle Sort",onClick:t[9]||(t[9]=e=>S.value=!0)},t[27]||(t[27]=[m("span",{class:"mdi mdi-sort-alphabetical-variant"},null,-1)])),y(g,{name:"fade-scale"},{default:w((()=>[y(D,{visible:o(S),"onUpdate:visible":t[10]||(t[10]=e=>x(S)?S.value=e:null),options:o($)},null,8,["visible","options"])])),_:1})]),m("button",{class:"btn-action btn-no-style",onClick:t[11]||(t[11]=(...e)=>o(A)&&o(A)(...e)),title:"Toggle Select All"},t[28]||(t[28]=[m("span",{class:"mdi mdi-check-all"},null,-1)]))])]),m("div",{ref_key:"explorerContentRef",ref:j,class:"explorer-content",onClick:t[14]||(t[14]=e=>B.value=[]),onContextmenu:t[15]||(t[15]=c((e=>o(ye)(null,e)),["prevent","stop"]))},[o(F)?(n(),i("div",ue,[(n(!0),i(_,null,P(o(R),(e=>(n(),M(W,{class:"selectable",item:e,key:e.name,"data-name":e.name,active:o(N).has(e),onOpen:t[13]||(t[13]=e=>s("open",e)),onSelect:o(E),onContextmenu:c((t=>o(ye)(e,t)),["prevent","stop"])},null,8,["item","data-name","active","onSelect","onContextmenu"])))),128))])):(n(),i("div",pe,[t[29]||(t[29]=L('<div class="vp-bg file-list-header file-list-row" data-v-aed58de9><div class="list-col c-filename" style="padding-left:24px;" data-v-aed58de9>Name</div><div class="list-col c-size" data-v-aed58de9>Size</div><div class="list-col c-time" data-v-aed58de9>Last Modified</div><div class="list-col c-time" data-v-aed58de9>Created</div></div>',1)),(n(!0),i(_,null,P(o(R),(e=>(n(),M(Q,{class:"selectable",item:e,key:e.name,"data-name":e.name,active:o(N).has(e),onOpen:t[12]||(t[12]=e=>s("open",e)),onSelect:o(E),onContextmenu:c((t=>o(ye)(e,t)),["prevent","stop"])},null,8,["item","data-name","active","onSelect","onContextmenu"])))),128))])),(n(),M(z,{to:"body"},[y(T,{options:o(fe),ref_key:"ctxMenuRef",ref:Ce},null,8,["options"])]))],544)],32)),[[l,o(u)]])}}}),[["__scopeId","data-v-aed58de9"]]),be={class:"explorer-wrap"},he={class:"explorer-header vp-panel"},fe={class:"nav-address"},Ce={class:"nav-wrap"},ye=["disabled"],ke=["disabled"],we=["disabled"],ge={class:"input-wrap"},De={key:0,class:"mdi mdi-star"},xe={key:1,class:"mdi mdi-star-outline"},Me={key:0,class:"star-list"},Le=["onClick","title","onContextmenu"],_e={class:"explorer-content-wrap scrollbar-mini"},Pe=s({__name:"index",setup(e){const{isLoading:t,filteredFiles:l,handleOpen:a,handleRefresh:s,basePathNormalized:d,starList:r,handleOpenPath:u,backHistory:v,goBack:b,forwardHistory:h,goForward:C,allowUp:k,goUp:w,basePath:g,toggleStar:D,isStared:M,filterText:L}=R({getListFn:async()=>await H.getList({path:g.value,isStat:!0}),openEntryFn:async({item:e,path:t})=>{if(console.log({item:e,path:t}),Number(e.size)>1048576)return void console.error("文件大于1MB，不支持预览");const l=await H.getFile({path:t});console.log(l)}});return F((()=>{s()})),(e,z)=>(n(),i("div",be,[m("div",he,[m("div",fe,[m("div",Ce,[m("button",{disabled:o(v).length<=1,class:"btn-action vp-button",onClick:z[0]||(z[0]=(...e)=>o(b)&&o(b)(...e)),title:"Back"},z[9]||(z[9]=[m("span",{class:"mdi mdi-arrow-left"},null,-1)]),8,ye),m("button",{disabled:o(h).length<=0,class:"btn-action vp-button",onClick:z[1]||(z[1]=(...e)=>o(C)&&o(C)(...e)),title:"Forward"},z[10]||(z[10]=[m("span",{class:"mdi mdi-arrow-right"},null,-1)]),8,ke),m("button",{class:"btn-action vp-button",disabled:!o(k),onClick:z[2]||(z[2]=(...e)=>o(w)&&o(w)(...e)),title:"Up"},z[11]||(z[11]=[m("span",{class:"mdi mdi-arrow-up"},null,-1)]),8,we)]),m("div",ge,[f(m("input",{placeholder:"Path","onUpdate:modelValue":z[3]||(z[3]=e=>x(g)?g.value=e:null),class:"input-addr vp-input",onChange:z[4]||(z[4]=(...e)=>o(s)&&o(s)(...e))},null,544),[[$,o(g)]]),m("button",{class:"vp-button btn-action",onClick:z[5]||(z[5]=(...e)=>o(s)&&o(s)(...e))},z[12]||(z[12]=[m("span",{class:"mdi mdi-refresh"},null,-1)])),m("button",{class:"vp-button btn-action",onClick:z[6]||(z[6]=(...e)=>o(D)&&o(D)(...e))},[o(M)?(n(),i("span",De)):(n(),i("span",xe))]),f(m("input",{placeholder:"Filter name","onUpdate:modelValue":z[7]||(z[7]=e=>x(L)?L.value=e:null),class:"input-filter vp-input"},null,512),[[$,o(L)]])])]),o(r).length?(n(),i("div",Me,[(n(!0),i(_,null,P(o(r),((e,t)=>(n(),i("div",{key:e},[m("button",{onClick:t=>o(u)(e),class:"vp-button",title:e,onContextmenu:c((()=>o(r).splice(t,1)),["prevent"])},p(o(B)(e)),41,Le)])))),128))])):S("",!0)]),m("div",_e,[y(ve,{"is-loading":o(t),"onUpdate:isLoading":z[8]||(z[8]=e=>x(t)?t.value=e:null),files:o(l),onOpen:o(a),onRefresh:o(s),"base-path":o(d)},null,8,["is-loading","files","onOpen","onRefresh","base-path"])])]))}});export{Pe as default};
