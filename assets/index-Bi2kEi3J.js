import{d as e,t as l,r as n,a4 as i,o as t,c as a,a1 as o,f as s,z as u,g as r,_ as c,a as d,k as p,cT as m,cU as v,w as k,h as f,n as y,Q as h,an as x,s as C,y as b,e as w,B as _,i as O,F as B,m as g,p as I,l as S}from"./index-B_8g2bxo.js";import{_ as A}from"./VueRender.vue_vue_type_script_lang-B7jagunM.js";import{_ as T}from"./Dropdown-CsBF2fzf.js";const R={class:"dynamic-value-display"},z={key:0,class:"d-label"},F=c(e({__name:"DynamicValueDisplay",props:{text:{default:""},label:{},formatFn:{}},setup(e){const c=e,{text:d}=l(c),p=n("");return i(d,(()=>{"function"==typeof c.formatFn?p.value=c.formatFn(d.value):p.value=d.value}),{debounce:300,immediate:!0}),(e,l)=>(t(),a("div",R,[o(s(u(p))+" ",1),e.label?(t(),a("span",z,s(e.label),1)):r("",!0)]))}}),[["__scopeId","data-v-9a143af5"]]),q=["data-index"],D={key:0,class:"index-wrap"},Q={key:1,class:"item-icon"},V={key:2,class:"item-icon"},E=["src"],L=["innerHTML"],P={key:4,class:"item-content"},H={key:5,class:"item-content"},K={key:6,class:"item-content"},M=[d("div",{class:"css-arrow right"},null,-1)],N=e({name:"QuickOptions",components:{QOptionItem:e({__name:"QOptionItem",props:{item:{},index:{default:0},curIndex:{default:0},itemCls:{default:""},showIndex:{type:Boolean,default:!0}},emits:["onArrowClick"],setup:(e,{emit:l})=>(e,l)=>{var n,i,o,u,c,h;return t(),a("div",{class:f(["option-item",[{focus:e.curIndex===e.index,clickable:(null==(i=null==(n=e.item)?void 0:n.props)?void 0:i.onClick)||(null==(u=null==(o=e.item)?void 0:o.props)?void 0:u.isBack)||e.item.children&&e.item.children,disabled:e.item.disabled},e.itemCls,null==(c=e.item.props)?void 0:c.class]]),style:y(null==(h=e.item.props)?void 0:h.style),"data-index":e.index},[e.showIndex&&e.index<9?(t(),a("div",D,[d("span",null,s(e.index+1),1)])):r("",!0),e.item.iconRender?(t(),a("div",Q,[p(A,{"render-fn":e.item.iconRender},null,8,["render-fn"])])):e.item.icon?(t(),a("div",V,[d("img",{src:e.item.icon},null,8,E)])):r("",!0),e.item.html?(t(),a("div",{key:3,class:"item-content",innerHTML:e.item.html},null,8,L)):e.item.render?(t(),a("div",P,[p(A,{"render-fn":e.item.render},null,8,["render-fn"])])):e.item.dynamicProps?(t(),a("div",H,[p(F,m(v(e.item.dynamicProps)),null,16)])):(t(),a("div",K,s(e.item.label),1)),e.item.children&&e.item.children?(t(),a("div",{key:7,class:"arrow-wrap",onClick:l[0]||(l[0]=k((l=>e.$emit("onArrowClick")),["stop"]))},M)):r("",!0)],14,q)}})},props:{visible:{type:Boolean,default:!1},closeOnClick:{type:Boolean,default:!0},horizontal:{type:Boolean,default:!1},title:{type:String,default:""},options:{type:Array,default:()=>[]},isStatic:{type:Boolean,default:!1},autoFocus:{type:Boolean,default:!0},showIndex:{type:Boolean,default:!0},itemCls:{type:String,default:""}},emits:["onClose","update:visible","onBack","onEnter"],setup(e,{emit:i}){const{options:t,horizontal:a,isStatic:o,autoFocus:s,closeOnClick:u}=l(e),r=h(e,"visible",i),c=n();x(c,(e=>{o.value||setTimeout((()=>{r.value=!1}))}));const d=()=>{const e=c.value.querySelector(`[data-index="${p.value}"]`);_((()=>{e&&e.scrollIntoView({behavior:"instant",block:"center"})}))},p=n(0),m=e=>g.value[e]&&g.value[e].split?2:1,v=()=>{p.value-=m(p.value-1),p.value<0&&(p.value=g.value.length-1),d()},k=()=>{p.value+=m(p.value+1),p.value>g.value.length-1&&(p.value=0),d()},f=()=>{setTimeout((()=>{c.value.focus()}),10)};C((()=>{o.value&&s.value&&f()})),b(r,(e=>{e?(p.value=0,s.value&&f()):(y.value=[],O.value=[])}));const y=n([]),O=n([]),B=w((()=>{if(!O.value.length)return" ";const e=O.value[O.value.length-1];return e.html||e.label})),g=w((()=>{if(y.value.length){const e=y.value[y.value.length-1];return e.__v_isRef?e.value:e}return t.value})),I=()=>{y.value.length?(y.value.pop(),O.value.pop(),i("onBack")):(r.value=!1,setTimeout((()=>{i("onClose")}),100)),p.value=0,d()},S=()=>{const e=g.value[p.value];A(e)},A=async(e,l,n=!1)=>{var t,a;if(!e.disabled){if((null==(t=null==e?void 0:e.props)?void 0:t.onClick)&&!n)e.props.onClick(e,l),u.value&&(r.value=!1);else if(e.children){let l=[];"function"==typeof e.children?l=await e.children():e.children.length&&(l=e.children),y.value.push(l),O.value.push(e),p.value=0,i("onEnter")}if(null==(a=null==e?void 0:e.props)?void 0:a.isBack)if("number"==typeof e.props.isBack)for(let l=0;l<e.props.isBack;l++)I();else I()}};return{mVisible:r,quickRootRef:c,menuStack:y,curIndex:p,handleKeyPress:e=>{if(e.preventDefault(),"Escape"===e.key||"q"===e.key)I();else if("Tab"===e.key)k();else if("ArrowUp"===e.key)a.value?I():v();else if("ArrowDown"===e.key)a.value?S():k();else if("ArrowLeft"===e.key)a.value?v():I();else if("ArrowRight"===e.key)a.value?k():S();else if("Enter"===e.key)S();else if(" "===e.key)S();else if(e.keyCode>=49&&e.keyCode<=57){const l=Number(String.fromCharCode(e.keyCode));if(Number.isNaN(l))return;const n=g.value[l-1];n&&A(n)}},backTitle:B,handleBack:I,mOptions:g,handleOptionClick:A,handleOptionContextmenu:async(e,l)=>{var n;(null==(n=null==e?void 0:e.props)?void 0:n.onContextmenu)&&(null==l||l.preventDefault(),e.props.onContextmenu(e,l))},focus:f,isFocused:()=>document.activeElement!==c.value}}}),j={key:0,class:"option-title"},U=d("div",{class:"index-wrap"},[d("div",{style:{transform:"scale(0.7)"}},[d("div",{class:"css-arrow left"})])],-1),$=["innerHTML"],G={key:0,class:"option-split"};const J=c(N,[["render",function(e,l,n,i,u,c){const m=O("QOptionItem"),v=T;return e.mVisible||e.isStatic?(t(),a("div",{key:0,class:f(["quick-options _scrollbar_mini",{_absolute:!e.isStatic,_s:e.isStatic,horizontal:e.horizontal,"vp-panel":!e.horizontal&&!e.isStatic}]),onKeydown:l[2]||(l[2]=k(((...l)=>e.handleKeyPress&&e.handleKeyPress(...l)),["stop"])),tabindex:"0",ref:"quickRootRef"},[e.title?(t(),a("div",j,[o(s(e.title)+" ",1),d("button",{class:"btn-no-style",onClick:l[0]||(l[0]=l=>e.mVisible=!1)},"Ã—")])):r("",!0),e.menuStack.length?(t(),a("div",{key:1,class:"option-item vp-bg _back clickable",onClick:l[1]||(l[1]=(...l)=>e.handleBack&&e.handleBack(...l)),title:"Back (q)"},[U,d("span",{innerHTML:e.backTitle},null,8,$)])):r("",!0),(t(!0),a(B,null,g(e.mOptions,((l,n)=>(t(),a(B,{key:n},[l.split?(t(),a("div",G)):l.dropdown?(t(),I(v,{key:1,options:l.dropdown,"label-field":"label","key-field":"key",size:"small"},{default:S((()=>[p(m,{item:l,index:n,"cur-index":e.curIndex,"item-cls":e.itemCls,"show-index":e.showIndex,onClick:n=>e.handleOptionClick(l,n),onContextmenu:n=>e.handleOptionContextmenu(l,n),onOnArrowClick:n=>e.handleOptionClick(l,n,!0)},null,8,["item","index","cur-index","item-cls","show-index","onClick","onContextmenu","onOnArrowClick"])])),_:2},1032,["options"])):(t(),I(m,{key:2,item:l,index:n,"cur-index":e.curIndex,"item-cls":e.itemCls,"show-index":e.showIndex,onClick:n=>e.handleOptionClick(l,n),onContextmenu:n=>e.handleOptionContextmenu(l,n),onOnArrowClick:n=>e.handleOptionClick(l,n,!0)},null,8,["item","index","cur-index","item-cls","show-index","onClick","onContextmenu","onOnArrowClick"]))],64)))),128))],34)):r("",!0)}]]);export{J as Q};
