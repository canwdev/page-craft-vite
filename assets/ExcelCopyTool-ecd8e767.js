import{d as O,t as B,u as J,r as f,w as T,_ as R,o as k,c as F,a as p,b as C,e as l,f as U,g as V,h as j,s as W,i as A,j as H,k as X,l as K,m as P,n as L,p as Z,v as q,T as G,q as b,x as Q,F as Y,y as ee,z as N,A as oe,B as ne,C as te,D as se,E as le,G as ae,H as ie}from"./index-1f984db3.js";import{_ as I,u as re,a as pe,b as ue}from"./use-file-drop-5b8ff91d.js";const de=O({name:"CopyExampleDialog",props:{visible:{type:Boolean,default:!1},title:{type:String,default:""},formatText:{type:Function,default:null}},setup(e,{emit:o}){const{formatText:a}=B(e),i=J(e,o,"visible"),c=f(""),m=f("");return T(c,()=>{m.value=a?a.value(c.value):c.value}),{mVisible:i,textInput:c,textOutput:m}}});const ce={class:"style-tools"},me={class:"common-card"},_e={class:"main-box font-code"};function fe(e,o,a,i,c,m){const s=U,_=V;return k(),F(_,{show:e.mVisible,"onUpdate:show":o[2]||(o[2]=u=>e.mVisible=u),preset:"dialog",title:e.title,style:{"min-width":"800px"}},{default:p(()=>[C("div",ce,[C("div",me,[C("div",_e,[l(s,{class:"input-text",type:"textarea",value:e.textInput,"onUpdate:value":o[0]||(o[0]=u=>e.textInput=u),placeholder:"Text Input"},null,8,["value"]),l(s,{class:"input-text",type:"textarea",value:e.textOutput,"onUpdate:value":o[1]||(o[1]=u=>e.textOutput=u),placeholder:"Text Output"},null,8,["value"])])])])]),_:1},8,["show","title"])}const z=R(de,[["render",fe],["__scopeId","data-v-0777a83a"]]);let x=[];const ye=(e,o)=>{const a=document.getElementById(e),i=o||function(){};if(!a){const s=document.createElement("script");s.src=e,s.id=e,document.body.appendChild(s),x.push(i),("onload"in s?c:m)(s)}a&&i&&i(null,a);function c(s){s.onload=function(){this.onerror=this.onload=null;for(const _ of x)_(null,s);x=[]},s.onerror=function(){this.onerror=this.onload=null,i(new Error("Failed to load "+e),s)}}function m(s){s.onreadystatechange=function(){if(!(this.readyState!=="complete"&&this.readyState!=="loaded")){this.onreadystatechange=null;for(const _ of x)_(null,s);x=[]}}}},ge=ye,ve=""+new URL("excel-59df11bd.svg",import.meta.url).href,S=(e,o)=>{if(o===y.text)return e;let a=e.split(`
`);if(a=a.map(i=>i.trim()),o===y.json)return a.length===1?JSON.stringify(a[0]):JSON.stringify(a,null,2);if(o===y.html)return a.join("<br>")},we=e=>e.tagName.toLowerCase()==="td",y={none:"none",text:"text",html:"html",json:"json"},he=Object.values(y).map(e=>({label:e,value:e})),be=O({name:"ExcelCopyTool",components:{FileChooser:j,CopyExampleDialog:z,DropZone:I},setup(){const e=f(),o=f(),a=f(!1),i=W(),c=f([]),m=f(0),{metaTitle:s}=A();T(m,()=>{v()});const _=()=>{if(!a.value){const n="XLSX Not Ready!";throw window.$message.error(n),new Error(n)}},u=n=>(c.value=n.SheetNames,n.Sheets[c.value[m.value]]),v=()=>{const n=i.value;if(!n){o.value.innerHTML="";return}const d=window.XLSX.utils.sheet_to_html(u(n));o.value.innerHTML=d},w=async n=>{if(_(),!/\.xlsx$/g.test(n.name)){alert("Only supports reading xlsx format!");return}const d=new FileReader;i.value=null,d.onload=function(r){const t=r.target.result;m.value=0,i.value=window.XLSX.read(t,{type:"binary"}),v()},d.readAsBinaryString(n)};H(()=>{ge("//unpkg.com/xlsx@0.16.9/xlsx.mini.js",()=>{window.$message.success("XLSX Ready!"),console.log("XLSX ready",window.XLSX),a.value=!0})});const g=f(y.json),D=n=>{let d=n.target;if(!we(d)||!g.value||g.value===y.none||!d.innerText)return;let r=d.innerText.trim().replace(/ /gi," ");console.log(g.value);let t="";n.ctrlKey&&n.altKey?r=S(r,t=y.json):n.ctrlKey?r=S(r,t=y.text):n.altKey?r=S(r,t=y.html):r=S(r,t=g.value),X(r),window.$message.success(t+" copied!");const E=document.createRange();E.selectNode(d);const M=window.getSelection();M&&(M.removeAllRanges(),M.addRange(E))},h=()=>{if(!i.value){const n="Please open Excel file first!";throw window.$message.error(n),new Error(n)}return window.XLSX.utils.sheet_to_json(u(i.value))},$=f(!1);return{metaTitle:s,iconExcel:ve,sheetNames:c,sheetNameIndex:m,handleImport:w,importFileChooserRef:e,loadDemo(){_();const n=[["姓名","性别","年龄","注册时间"],["张三","男",18,new Date],["李四","女",22,new Date]],d=window.XLSX.utils.aoa_to_sheet(n),r=window.XLSX.utils.book_new();window.XLSX.utils.book_append_sheet(r,d,"Sheet1"),m.value=0,i.value=r,v()},tableWrapperRef:o,handleClick:D,copyMode:g,CopyModeOptions:he,dropdownMenuOptions:[{label:"Copy Sheet JSON",props:{onClick:async()=>{const n=h();X(JSON.stringify(n,null,2)),window.$message.success("Sheet JSON Copied!")}}},{label:"Export Sheet JSON",props:{onClick:async()=>{const n=h();K(P(null,"excel_sheet_export"),JSON.stringify(n,null,2),".json")}}}],isShowCopyExample:$,formatMultipleLine:S,...re({cbFiles:n=>{n.length&&w(n[0])}})}}});function xe(e,o,a,i,c,m){const s=I,_=pe,u=oe,v=ne,w=te,g=se,D=ue,h=le,$=ae,n=ie,d=j,r=z;return k(),L("div",{class:"excel-copy-tool",onDragover:o[7]||(o[7]=N((...t)=>e.fileDragover&&e.fileDragover(...t),["prevent","stop"])),onDragleave:o[8]||(o[8]=N(t=>e.showDropzone=!1,["prevent","stop"])),onDrop:o[9]||(o[9]=N((...t)=>e.fileDrop&&e.fileDrop(...t),["prevent","stop"]))},[l(G,{name:"fade"},{default:p(()=>[Z(l(s,{text:"Drop Excel file here"},null,512),[[q,e.showDropzone]])]),_:1}),C("div",null,[l(h,{size:"small"},{default:p(()=>[l(D,{subtitle:"",onBack:o[3]||(o[3]=t=>e.$router.push({name:"HomeView"}))},{title:p(()=>[b(Q(e.metaTitle),1)]),avatar:p(()=>[l(_,{src:e.iconExcel,style:{background:"none"}},null,8,["src"])]),extra:p(()=>[l(w,null,{default:p(()=>[l(w,{size:"small",align:"center"},{default:p(()=>[l(u,{text:"",onClick:o[0]||(o[0]=t=>e.isShowCopyExample=!0)},{default:p(()=>[b("CopyMode:")]),_:1}),l(v,{size:"small",value:e.copyMode,"onUpdate:value":o[1]||(o[1]=t=>e.copyMode=t),options:e.CopyModeOptions,style:{width:"100px"}},null,8,["value","options"])]),_:1}),l(u,{type:"primary",onClick:o[2]||(o[2]=t=>e.importFileChooserRef.chooseFile()),size:"small"},{default:p(()=>[b(" Import Excel ")]),_:1}),l(g,{options:e.dropdownMenuOptions,placement:"bottom-start","key-field":"label"},{default:p(()=>[l(u,{size:"small"},{default:p(()=>[b("Export")]),_:1})]),_:1},8,["options"]),l(u,{onClick:e.loadDemo,size:"small"},{default:p(()=>[b("Demo")]),_:1},8,["onClick"])]),_:1})]),_:1})]),_:1}),l(h,{class:"sheet-name-card",size:"small"},{default:p(()=>[l(n,{size:"small",type:"card",animated:"",value:e.sheetNameIndex,"onUpdate:value":o[4]||(o[4]=t=>e.sheetNameIndex=t)},{default:p(()=>[(k(!0),L(Y,null,ee(e.sheetNames,(t,E)=>(k(),F($,{style:{padding:"0"},name:E,tab:t,key:t},null,8,["name","tab"]))),128))]),_:1},8,["value"])]),_:1})]),C("div",{ref:"tableWrapperRef",class:"excel-table-container",onClick:o[5]||(o[5]=(...t)=>e.handleClick&&e.handleClick(...t))},null,512),l(d,{ref:"importFileChooserRef",accept:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",onSelected:e.handleImport},null,8,["onSelected"]),l(r,{visible:e.isShowCopyExample,"onUpdate:visible":o[6]||(o[6]=t=>e.isShowCopyExample=t),title:"Copy Mode Example: "+e.copyMode,"format-text":t=>e.formatMultipleLine(t,e.copyMode)},null,8,["visible","title","format-text"])],32)}const Ee=R(be,[["render",xe],["__scopeId","data-v-d94e6827"]]);export{Ee as default};
