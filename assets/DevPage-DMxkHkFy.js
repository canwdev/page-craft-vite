import{V as e}from"./index-ChBI-IfP.js";import{t,c as a,d as l,o as i,b as s,e as n,w as o,f as r,x as c,h as d,l as u,_ as p,r as m,E as v,S as f,k as b,O as h,L as C,U as w,V as g,W as k,T as x,F as y,m as D,p as _,X as M,bA as S,Y as L,Z as F,$ as P,I as $,v as z,g as I,P as T,al as R,i as Y}from"./index-D7imv_Md.js";/* empty css                   */import{d as O,f as U}from"./index-BR_HEkHY.js";import{_ as j}from"./QuickContextMenu.vue_vue_type_script_setup_true_lang-BpOU60Dx.js";import{u as H,a as B,b as N,c as E}from"./use-local-dir-CBTdfN0o.js";import{f as V,n as A,g as K}from"./humanfs-api-Dvdi9RO8.js";import{_ as W,S as q}from"./index.vue_vue_type_script_setup_true_lang-B7mdx2Oz.js";import{C as G}from"./CommonNavbar-BfH5DtYm.js";import"./file-history-CLLvp5b9.js";import"./useIDBKeyval-BIf4fra4.js";/* empty css                  */import"./RectSwitch-DEmfWnCV.js";import"./use-model-wrapper-B0P8Zqss.js";const Q=e=>{const{item:l}=t(e);return{iconName:a((()=>l.value.isDirectory?"folder":"text-x-preview")),titleDesc:a((()=>`Name: ${l.value.name}\nSize: ${O(l.value.size)}\nType: ${l.value.mimeType||"-"}\nLast Modified: ${U(l.value.lastModified,"YYYY-MM-DD HH:mm:ss")}\nCreated: ${U(l.value.birthtime,"YYYY-MM-DD HH:mm:ss")}\n`))}},X=["title"],Z={class:"list-col c-filename"},J=["checked"],ee={class:"list-col c-size"},te={class:"list-col c-time"},ae={class:"list-col c-time"},le=p(l({__name:"FileListItem",props:{item:{},active:{type:Boolean}},emits:["open","select"],setup(e,{emit:t}){const a=e,{iconName:l,titleDesc:p}=Q(a);return(e,t)=>(i(),s("button",{class:d(["btn-no-style file-list-item file-list-row",{active:e.active,hidden:e.item.hidden}]),onClick:t[4]||(t[4]=o((t=>e.$emit("select",{item:e.item,event:t})),["stop"])),onKeyup:t[5]||(t[5]=u((t=>e.$emit("open",e.item)),["enter"])),onDblclick:t[6]||(t[6]=o((t=>e.$emit("open",e.item)),["stop"])),title:c(p)},[n("div",Z,[n("input",{class:"file-checkbox",type:"checkbox",checked:e.active,onClick:t[0]||(t[0]=o((t=>e.$emit("select",{item:e.item,event:t,toggle:!0})),["stop"])),onDblclick:t[1]||(t[1]=o((()=>{}),["stop"]))},null,40,J),n("span",{class:"text-overflow filename-text",onClick:t[2]||(t[2]=o((t=>e.$emit("open",e.item)),["stop"])),onDblclick:t[3]||(t[3]=o((()=>{}),["stop"]))},r(e.item.isDirectory?"📁":"📄")+" "+r(e.item.name),33)]),n("div",ee,r(c(O)(e.item.size)),1),n("div",te,r(c(U)(e.item.lastModified)),1),n("div",ae,r(c(U)(e.item.birthtime)),1)],42,X))}}),[["__scopeId","data-v-f9d28868"]]),ie=["title"],se=["checked"],ne={class:"desktop-icon-image"},oe=p(l({__name:"FileGridItem",props:{item:{},active:{type:Boolean}},emits:["open","select"],setup(e,{emit:t}){const a=e,{iconName:l,titleDesc:p}=Q(a);return(e,t)=>(i(),s("button",{class:d(["file-grid-item btn-no-style",{active:e.active,hidden:e.item.hidden}]),onClick:t[4]||(t[4]=o((t=>e.$emit("select",{item:e.item,event:t})),["stop"])),onKeyup:t[5]||(t[5]=u((t=>e.$emit("open",e.item)),["enter"])),onDblclick:t[6]||(t[6]=o((t=>e.$emit("open",e.item)),["stop"])),title:c(p)},[n("input",{class:"file-checkbox",type:"checkbox",checked:e.active,onClick:t[0]||(t[0]=o((t=>e.$emit("select",{item:e.item,event:t,toggle:!0})),["stop"])),onDblclick:t[1]||(t[1]=o((()=>{}),["stop"]))},null,40,se),n("span",ne,r(e.item.isDirectory?"📁":"📄"),1),n("span",{class:"desktop-icon-name",onClick:t[2]||(t[2]=o((t=>e.$emit("open",e.item)),["stop"])),onDblclick:t[3]||(t[3]=o((()=>{}),["stop"]))},r(e.item.name),33)],42,ie))}}),[["__scopeId","data-v-26e66db6"]]);var re=(e=>(e.default="default",e.name="name",e.nameDesc="nameDesc",e.size="size",e.sizeDesc="sizeDesc",e.extension="extension",e.extensionDesc="extensionDesc",e.lastModified="lastModified",e.lastModifiedDesc="lastModifiedDesc",e.birthTime="birthTime",e.birthTimeDesc="birthTimeDesc",e))(re||{});const ce={default:(e,t)=>{const a=(e.isDirectory?1:2)-(t.isDirectory?1:2);return 0!==a?a:e.name.toLowerCase().localeCompare(t.name.toLowerCase())},name:(e,t)=>e.name.toLowerCase().localeCompare(t.name.toLowerCase()),nameDesc:(e,t)=>-e.name.toLowerCase().localeCompare(t.name.toLowerCase()),size:(e,t)=>(e.size||0)-(t.size||0),sizeDesc:(e,t)=>-((e.size||0)-(t.size||0)),extension:(e,t)=>e.ext.toLowerCase().localeCompare(t.ext.toLowerCase()),extensionDesc:(e,t)=>-e.ext.toLowerCase().localeCompare(t.ext.toLowerCase()),lastModified:(e,t)=>e.lastModified-t.lastModified,lastModifiedDesc:(e,t)=>-(e.lastModified-t.lastModified),birthTime:(e,t)=>e.birthtime-t.birthtime,birthTimeDesc:(e,t)=>-(e.birthtime-t.birthtime)},de=e=>(F("data-v-97e39a50"),e=e(),P(),e),ue={class:"explorer-actions vp-panel"},pe={class:"action-group"},me=[de((()=>n("i",{class:"fa fa-file-o","aria-hidden":"true"},null,-1)))],ve=[de((()=>n("i",{class:"fa fa-folder-o","aria-hidden":"true"},null,-1)))],fe=de((()=>n("div",{class:"split-line"},null,-1))),be=["disabled"],he=[de((()=>n("i",{class:"fa fa-scissors","aria-hidden":"true"},null,-1)))],Ce=["disabled"],we=[de((()=>n("i",{class:"fa fa-files-o","aria-hidden":"true"},null,-1)))],ge=["disabled"],ke=[de((()=>n("i",{class:"fa fa-clipboard","aria-hidden":"true"},null,-1)))],xe=["disabled"],ye=[de((()=>n("i",{class:"fa fa-pencil-square-o","aria-hidden":"true"},null,-1)))],De=["disabled"],_e=[de((()=>n("i",{class:"fa fa-trash-o","aria-hidden":"true"},null,-1)))],Me=de((()=>n("div",{class:"split-line"},null,-1))),Se=[de((()=>n("i",{class:"fa fa-folder-open-o","aria-hidden":"true"},null,-1)))],Le={class:"action-group"},Fe={class:"action-button-wrap"},Pe=[de((()=>n("i",{class:"fa fa-sort","aria-hidden":"true"},null,-1)))],$e=[de((()=>n("i",{class:"fa fa-check-square-o","aria-hidden":"true"},null,-1)))],ze={key:0,class:"explorer-list-view"},Ie=S('<div class="vp-bg file-list-header file-list-row" data-v-97e39a50><div class="list-col c-filename" style="padding-left:24px;" data-v-97e39a50>Name</div><div class="list-col c-size" data-v-97e39a50>Size</div><div class="list-col c-time" data-v-97e39a50>Last Modified</div><div class="list-col c-time" data-v-97e39a50>Created</div></div>',1),Te={key:1,class:"explorer-grid-view"},Re=p(l({__name:"FileList",props:{files:{},isLoading:{type:Boolean},basePath:{}},emits:["open","update:isLoading","refresh"],setup(e,{emit:l}){const d=l,u=e,{basePath:p,files:S}=t(u),F=f(u,"isLoading",d),{isGridView:P,showSortMenu:$,sortOptions:z,filteredFiles:I}=(e=>{const t=m(!1),l=m(re.default);return{isGridView:t,showSortMenu:m(!1),sortOptions:a((()=>[{label:"Default",value:re.default},{label:"Name ▲",value:re.name},{label:"Name ▼",value:re.nameDesc},{label:"Size ▲",value:re.size},{label:"Size ▼",value:re.sizeDesc},{label:"Extension ▲",value:re.extension},{label:"Extension ▼",value:re.extensionDesc},{label:"Last Modified ▲",value:re.lastModified},{label:"Last Modified ▼",value:re.lastModifiedDesc},{label:"Created Time ▲",value:re.birthTime},{label:"Created Time ▼",value:re.birthTimeDesc}].map((e=>({label:e.label,props:{class:l.value===e.value?"active":"",onClick:()=>{l.value=e.value}}}))))),filteredFiles:a((()=>e.value.sort(ce[l.value])))}})(S),{selectedItems:T,selectedItemsSet:R,explorerContentRef:Y,toggleSelect:O,toggleSelectAll:U,selectedPaths:E}=H({filteredFiles:I,basePath:p}),{enablePaste:K,handleCut:W,handleCopy:q,handlePaste:G}=B({selectedPaths:E,basePath:p,isLoading:F,emit:d}),{handleCreateFile:Q,handleCreateFolder:X,handleRename:Z,confirmDelete:J,ctxMenuOptions:ee,ctxMenuRef:te,handleShowCtxMenu:ae,enableAction:ie}=(({isLoading:e,selectedPaths:t,basePath:l,selectedItems:i,enablePaste:s,handlePaste:n,handleCut:o,handleCopy:r,selectedItemsSet:c,emit:d})=>{const u=async()=>{try{const t=i.value[0],a=await window.$mcUtils.showInputPrompt({title:"Rename",value:t.name});e.value=!0,await V.renameEntry({fromPath:A(l.value+"/"+t.name),toPath:A(l.value+"/"+a)}),d("refresh")}finally{e.value=!1}},p=async()=>{try{e.value=!0,await V.deleteEntry({path:t.value})}finally{e.value=!1,d("refresh")}},f=()=>{window.$dialog.confirm("确认删除？此操作不可撤销","Confirm Delete",{type:"warning"}).then((()=>{p()})).catch()},b=a((()=>{if(!i.value.length)return[{label:"Refresh",props:{onClick:()=>d("refresh")}},{label:"Paste",props:{onClick:n},disabled:!s.value}];const e=1===i.value.length;return[e&&{label:"Open",props:{onClick:()=>d("open",i.value[0])}},{split:!0},{label:"Cut",props:{onClick:o}},{label:"Copy",props:{onClick:r}},{split:!0},e&&{label:"Rename",props:{onClick:u}},{label:"Delete",props:{onClick:f}}].filter(Boolean)})),h=m(),C=a((()=>i.value.length>0));return{handleCreateFile:async()=>{try{const t=await window.$mcUtils.showInputPrompt({title:"Create File",value:`file_${v(new Date).format("YYYYMMDD_HHmmss")}.txt`});e.value=!0,await V.createFile({path:A(l.value+"/"+t),file:""}),d("refresh")}finally{e.value=!1}},handleCreateFolder:async()=>{try{const t=await window.$mcUtils.showInputPrompt({title:"Create Folder",value:`folder_${v(new Date).format("YYYYMMDD_HHmmss")}`});e.value=!0,await V.createDir({path:A(l.value+"/"+t)}),d("refresh")}finally{e.value=!1}},handleRename:u,doDeleteSelected:p,confirmDelete:f,ctxMenuOptions:b,ctxMenuRef:h,handleShowCtxMenu:(e,t)=>{e?c.value.has(e)||(i.value=[e]):i.value=[],h.value.showMenu(t)},enableAction:C}})({isLoading:F,selectedPaths:E,basePath:p,selectedItems:T,enablePaste:K,handlePaste:G,handleCut:W,handleCopy:q,selectedItemsSet:R,emit:d}),{handleOpenLocalDir:se,localDirHistoryOptions:ne,isShowDirHistory:de}=N({emit:d});return(e,t)=>{const a=L;return b((i(),s("div",{class:"explorer-list-wrap",onContextmenu:t[16]||(t[16]=o((()=>{}),["prevent"]))},[n("div",ue,[n("div",pe,[n("button",{class:"vp-button",onClick:t[0]||(t[0]=e=>c(Q)()),title:"Create Document"},me),n("button",{class:"vp-button",onClick:t[1]||(t[1]=(...e)=>c(X)&&c(X)(...e)),title:"Create Folder"},ve),fe,n("button",{class:"vp-button",disabled:!c(ie),onClick:t[2]||(t[2]=(...e)=>c(W)&&c(W)(...e)),title:"Cut"},he,8,be),n("button",{class:"vp-button",disabled:!c(ie),onClick:t[3]||(t[3]=(...e)=>c(q)&&c(q)(...e)),title:"Copy"},we,8,Ce),n("button",{class:"vp-button",disabled:!c(K),onClick:t[4]||(t[4]=(...e)=>c(G)&&c(G)(...e)),title:"Paste"},ke,8,ge),n("button",{class:"vp-button",disabled:1!==c(T).length,onClick:t[5]||(t[5]=(...e)=>c(Z)&&c(Z)(...e)),title:"Rename"},ye,8,xe),n("button",{class:"vp-button",disabled:!c(ie),onClick:t[6]||(t[6]=(...e)=>c(J)&&c(J)(...e)),title:"Delete"},_e,8,De),Me,h(w,{options:c(ne)},{default:C((()=>[n("button",{class:"vp-button",title:"Open Local Folder",onClick:t[7]||(t[7]=(...e)=>c(se)&&c(se)(...e))},Se)])),_:1},8,["options"])]),n("div",Le,[n("button",{onClick:t[8]||(t[8]=e=>P.value=!c(P)),class:"vp-button",title:"Toggle grid view"},r(c(P)?"🎛️":"🎚️"),1),n("div",Fe,[n("button",{class:"vp-button",title:"Toggle Sort",onClick:t[9]||(t[9]=e=>$.value=!0)},Pe),h(x,{name:"fade-scale"},{default:C((()=>[h(g,{visible:c($),"onUpdate:visible":t[10]||(t[10]=e=>k($)?$.value=e:null),options:c(z)},null,8,["visible","options"])])),_:1})]),n("button",{class:"vp-button",onClick:t[11]||(t[11]=(...e)=>c(U)&&c(U)(...e)),title:"Toggle Select All"},$e)])]),n("div",{ref_key:"explorerContentRef",ref:Y,class:"explorer-content",onClick:t[14]||(t[14]=e=>T.value=[]),onContextmenu:t[15]||(t[15]=o((e=>c(ae)(null,e)),["prevent","stop"]))},[c(P)?(i(),s("div",Te,[(i(!0),s(y,null,D(c(I),(e=>(i(),_(oe,{class:"selectable",item:e,key:e.name,"data-name":e.name,active:c(R).has(e),onOpen:t[13]||(t[13]=e=>d("open",e)),onSelect:c(O),onContextmenu:o((t=>c(ae)(e,t)),["prevent","stop"])},null,8,["item","data-name","active","onSelect","onContextmenu"])))),128))])):(i(),s("div",ze,[Ie,(i(!0),s(y,null,D(c(I),(e=>(i(),_(le,{class:"selectable",item:e,key:e.name,"data-name":e.name,active:c(R).has(e),onOpen:t[12]||(t[12]=e=>d("open",e)),onSelect:c(O),onContextmenu:o((t=>c(ae)(e,t)),["prevent","stop"])},null,8,["item","data-name","active","onSelect","onContextmenu"])))),128))])),(i(),_(M,{to:"body"},[h(j,{options:c(ee),ref_key:"ctxMenuRef",ref:te},null,8,["options"])]))],544)],32)),[[a,c(F)]])}}}),[["__scopeId","data-v-97e39a50"]]),Ye={class:"explorer-wrap"},Oe={class:"explorer-header vp-panel"},Ue={class:"nav-address"},je={class:"nav-wrap"},He=["disabled"],Be=[n("i",{class:"fa fa-chevron-left","aria-hidden":"true"},null,-1)],Ne=["disabled"],Ee=[n("i",{class:"fa fa-chevron-right","aria-hidden":"true"},null,-1)],Ve=["disabled"],Ae=[n("i",{class:"fa fa-level-up","aria-hidden":"true"},null,-1)],Ke={class:"input-wrap"},We=[n("i",{class:"fa fa-refresh","aria-hidden":"true"},null,-1)],qe={key:0,class:"fa fa-star","aria-hidden":"true"},Ge={key:1,class:"fa fa-star-o","aria-hidden":"true"},Qe={key:0,class:"star-list"},Xe=["onClick","title","onContextmenu"],Ze={class:"explorer-content-wrap scrollbar-mini"},Je=l({__name:"index",setup(e){const{isLoading:t,filteredFiles:a,handleOpen:l,handleRefresh:d,basePathNormalized:u,starList:p,handleOpenPath:m,backHistory:v,goBack:f,forwardHistory:C,goForward:w,allowUp:g,goUp:x,basePath:_,toggleStar:M,isStared:S,filterText:L}=E({getListFn:async()=>await V.getList({path:_.value,isStat:!0}),openEntryFn:async({item:e,path:t})=>{if(console.log({item:e,path:t}),Number(e.size)>1048576)return void console.error("文件大于1MB，不支持预览");const a=await V.getFile({path:t});console.log(a)}});return $((()=>{d()})),(e,F)=>(i(),s("div",Ye,[n("div",Oe,[n("div",Ue,[n("div",je,[n("button",{disabled:c(v).length<=1,class:"btn-action vp-button",onClick:F[0]||(F[0]=(...e)=>c(f)&&c(f)(...e)),title:"Back"},Be,8,He),n("button",{disabled:c(C).length<=0,class:"btn-action vp-button",onClick:F[1]||(F[1]=(...e)=>c(w)&&c(w)(...e)),title:"Forward"},Ee,8,Ne),n("button",{class:"btn-action vp-button",disabled:!c(g),onClick:F[2]||(F[2]=(...e)=>c(x)&&c(x)(...e)),title:"Up"},Ae,8,Ve)]),n("div",Ke,[b(n("input",{placeholder:"Path","onUpdate:modelValue":F[3]||(F[3]=e=>k(_)?_.value=e:null),class:"input-addr vp-input",onChange:F[4]||(F[4]=(...e)=>c(d)&&c(d)(...e))},null,544),[[z,c(_)]]),n("button",{class:"vp-button btn-action",onClick:F[5]||(F[5]=(...e)=>c(d)&&c(d)(...e))},We),n("button",{class:"vp-button btn-action",onClick:F[6]||(F[6]=(...e)=>c(M)&&c(M)(...e))},[c(S)?(i(),s("i",qe)):(i(),s("i",Ge))]),b(n("input",{placeholder:"Filter name","onUpdate:modelValue":F[7]||(F[7]=e=>k(L)?L.value=e:null),class:"input-filter vp-input"},null,512),[[z,c(L)]])])]),c(p).length?(i(),s("div",Qe,[(i(!0),s(y,null,D(c(p),((e,t)=>(i(),s("div",{key:e},[n("button",{onClick:t=>c(m)(e),class:"vp-button",title:e,onContextmenu:o((()=>c(p).splice(t,1)),["prevent"])},r(c(K)(e)),41,Xe)])))),128))])):I("",!0)]),n("div",Ze,[h(Re,{"is-loading":c(t),"onUpdate:isLoading":F[8]||(F[8]=e=>k(t)?t.value=e:null),files:c(a),onOpen:c(l),onRefresh:c(d),"base-path":c(u)},null,8,["is-loading","files","onOpen","onRefresh","base-path"])])]))}}),et=l({__name:"FileManagerWindow",props:{visible:{type:Boolean,default:!0}},emits:["update:visible"],setup(t,{emit:a}){const l=f(t,"visible",a);return(t,a)=>(i(),_(e,{ref:"iframeWinRef",class:"iframe-browser-vp-window",visible:c(l),"onUpdate:visible":a[0]||(a[0]=e=>k(l)?l.value=e:null),wid:"iframe_browser","allow-maximum":"","init-win-options":{width:"600px",height:"500px"}},{titleBarLeft:C((()=>[T("🗃️ "+r(t.$t("common.file_explorer")),1)])),default:C((()=>[c(l)?(i(),_(Je,{key:0})):I("",!0)])),_:1},8,["visible"]))}}),tt={class:"dev-page scrollbar-mini"},at={class:"container"},lt=p(l({__name:"DevPage",setup(e){const t=R({isShowFileManager:!1}),l=a((()=>[{label:"isShowFileManager",key:"isShowFileManager",store:t,type:q.SWITCH}]));return(e,a)=>{const o=Y("RouterLink");return i(),s("div",tt,[h(G,null,{extra:C((()=>[h(o,{to:{name:"CanUIDemoPage"}},{default:C((()=>[T("UI Demo")])),_:1})])),_:1}),n("div",at,[h(W,{style:{"max-width":"500px"},"option-list":c(l)},null,8,["option-list"])]),h(et,{visible:c(t).isShowFileManager,"onUpdate:visible":a[0]||(a[0]=e=>c(t).isShowFileManager=e)},null,8,["visible"])])}}}),[["__scopeId","data-v-45c4e58e"]]);export{lt as default};
