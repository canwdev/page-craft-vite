import{u as t,O as e,c as o}from"./ai-settings-IJi9YQ4b.js";import{u as s}from"./index-D7imv_Md.js";const r=()=>{const r=t(),n=s(),a=()=>{n.isShowSettings=!0,setTimeout((()=>{const t=document.querySelector('.system-settings .c-panel-item[data-key="ai"]');t&&(t.scrollIntoView({behavior:"smooth"}),(async(t,e=3)=>{const o=t.style.backgroundColor;t.style.transition="background-color 0.5s ease";const s=async e=>{t.style.backgroundColor=e,await new Promise((t=>setTimeout(t,300))),t.style.backgroundColor=o,await new Promise((t=>setTimeout(t,300)))};for(let r=0;r<e;r++)await s("var(--primary)");t.style.backgroundColor=o,t.style.transition=""})(t))}),800)},i=async(t={},o,s={})=>{var n,i;const c=r.openAiApiProxy||"https://api.openai.com/v1";t={model:r.model,stream:r.stream,...t};const l=await fetch(`${c}/chat/completions`,{method:"POST",headers:{Authorization:`Bearer ${r.openAiApiKey}`,"Content-Type":"application/json"},body:JSON.stringify(t),...s}),u=e[l.status];if(u){401===l.status&&a();const t=await l.json();throw new Error(`${u}\n\n${t.error.message}`)}if(!l.ok)throw new Error(`HTTP error! status: ${l.status}`);if(t.stream&&"function"==typeof o){const t=l.body.getReader(),e=new TextDecoder("utf-8"),s="";for(;;){const{done:s,value:r}=await t.read();if(s)break;const a=e.decode(r,{stream:!0}).split("\n").filter((t=>""!==t.trim()));for(const t of a)if(t.startsWith("data: ")){const e=t.replace("data: ","");if("[DONE]"!==e)try{const t=null==(i=null==(n=JSON.parse(e).choices[0])?void 0:n.delta)?void 0:i.content;t&&o(t)}catch(m){console.error("Error parsing JSON:",m),console.error("JSON:",e)}}}return s}return await l.json()};return{requestChatCompletion:i,requestAiChatMessage:async(t,e={})=>{var o;return((null==(o=(await i({messages:t,stream:!1,...e})).choices[0])?void 0:o.message)||{}).content||""},canUseVision:t=>{var e;return(null==(e=o.find((e=>e.value===t)))?void 0:e.vision)||!1}}},n=(t,e,o)=>[{role:"system",content:`你是一个后台翻译服务，负责翻译多语言文案，帮我翻译并只返回json内容，不需要markdown格式。json格式为：\`${JSON.stringify(t)}\``},{role:"user",content:`翻译内容(${e}):\n\`${o}\``}],a=t=>[{content:"你是一名擅长会话的助理，你需要将用户的会话总结为 10 个字以内的标题，不需要包含标点符号，输出语言为聊天内容所用的语言，对话内容如下",role:"system"},{content:`${t.map((t=>`${t.role}:${((t,e=200)=>{let o="";return o="string"!=typeof t?t.map((t=>t.text)).join("\n"):t,o.length>e?o.slice(0,e)+"...":o})(t.content)}`)).join("\n")}`,role:"user"}];export{a,n as p,r as u};
