import{d as e,V as a,D as t,u as s,r as o,aJ as n,N as i,aK as l,aL as r,y as c,G as m,aM as u,aN as p,_ as d,i as v,k as w,o as f,b as g,P as h,M as y,T as _,e as b,F as S,m as j,w as D,Z as N,aA as T,f as k,p as $,g as x,ad as I}from"./index-Dcsrw7an.js";/* empty css                   *//* empty css                      *//* empty css                   */import{T as C}from"./TranslateTreeItem-BA5C3IBp.js";import{D as F,u as O}from"./use-file-drop-BJ7ff801.js";import{a as J,u as R}from"./use-beforeunload-HobKYt9I.js";import{I as E}from"./I18nToolSettings-B23Yc7qA.js";import{u as H}from"./file-history-OL31BKSf.js";import{C as M}from"./CommonNavbar-CYqCX-Ap.js";/* empty css                  *//* empty css                        */import"./use-model-wrapper-D-qKYU8I.js";import"./index-BSUZN_B5.js";import"./i18n-tool-settings-DxxnBFQw.js";import"./index-CQE1pfcY.js";import"./index.vue_vue_type_script_setup_true_lang-D-CNzH-9.js";/* empty css                  */import"./RectSwitch-DyIQ1C31.js";import"./useIDBKeyval-DAptoUO-.js";const L={types:[{description:"JSON",accept:{"application/JSON":[".json"]}}]},P=e({name:"VueI18nEditTool",components:{DropdownMenu:a,CommonNavbar:M,I18nToolSettings:E,TranslateTreeItem:C,DropZone:F},setup(){const{t:e}=t(),a=s(),d=o(n.parseWithRoot()),v=o(!1),{appendHistory:w,historyMenuOptions:f}=H(p.I18N_FILE_HANDLE_HISTORY,(async e=>{g.value=e;const a=await e.getFile();await h(a)})),g=i(),h=async e=>{try{v.value=!0;const a=await l(e),t=JSON.parse(a);d.value=n.parseWithRoot(t)}catch(a){console.error(a),window.$message.error(a.message)}finally{v.value=!1}},y=async()=>{try{if(v.value=!0,!g.value)return;const a=await g.value.createWritable(),t=JSON.stringify(r(d.value),null,2);await a.write(t),await a.close(),window.$message.success(e("msgs.saved"))}catch(a){console.error(a),window.$message.error(a.message)}finally{v.value=!1}},_=async()=>{var a;try{v.value=!0,console.log(d.value);const t=JSON.stringify(r(d.value),null,2),s=await window.showSaveFilePicker({suggestedName:null==(a=g.value)?void 0:a.name,...L}),o=await s.createWritable();await o.write(t),await o.close(),window.$message.success(e("msgs.saved"))}catch(t){console.error(t),window.$message.error(t.message)}finally{v.value=!1}};J((()=>{g.value?y():_()})),R((()=>!!g.value));return{translateTreeRoot:d,fileHandle:g,handleImport:h,handleSelectFile:async()=>{const[e]=await window.showOpenFilePicker(L);await w(e),g.value=e;const a=await e.getFile();await h(a)},handleCloseFile:()=>{g.value=void 0,d.value=n.parseWithRoot()},handleSaveFile:y,handleExport:_,loadDemo:()=>{d.value=n.parseWithRoot({hello_world:{section_a:{test_str:"This is a test string",test_arr:["line 1","line 2","line 3"],test_number:114514,"":"ä¸­Englishæ··åˆ"},section_b:{"":"Blur this input and it'll generate the key automatically!"},section_c:{"":"å¹³è¡Œã€è¡Œåˆ—"}}})},...O({cb:async e=>{try{v.value=!0;for(const a of e.dataTransfer.items)if("file"===a.kind){const e=await a.getAsFileSystemHandle();if("directory"!==e.kind){await w(e),g.value=e;const a=await e.getFile();await h(a)}else window.$message.error("Please drag and drop a json file here!")}}catch(a){console.error(a),window.$message.error(a.message)}finally{v.value=!1}}}),mainStore:a,isLoading:v,historyMenuOptions:f,handleSettings:()=>{c.emit(m.OPEN_SETTINGS,u.I18N)}}}}),W={class:"flex-row-center-gap"},z={class:"vp-button"},A={class:"vp-button"},K={class:"scroll-content scrollbar-mini"},Q={class:"i18n-container"},Z=b("div",{class:"height-placeholder"},null,-1);const B=d(P,[["render",function(e,a,t,s,o,n){const i=v("DropZone"),l=I,r=v("DropdownMenu"),c=v("CommonNavbar"),m=v("TranslateTreeItem"),u=N;return w((f(),g("div",{class:"vue-i18n-edit-tool i18n-style",onDragover:a[7]||(a[7]=D(((...a)=>e.fileDragover&&e.fileDragover(...a)),["prevent","stop"])),onDragleave:a[8]||(a[8]=D((a=>e.showDropzone=!1),["prevent","stop"])),onDrop:a[9]||(a[9]=D(((...a)=>e.fileDrop&&e.fileDrop(...a)),["prevent","stop"]))},[h(_,{name:"mc-fade"},{default:y((()=>[w(h(i,{"position-fixed":"",text:e.$t("msgs.drag_file_here")},null,8,["text"]),[[T,e.showDropzone]])])),_:1}),h(c,null,{extra:y((()=>[b("div",W,[b("button",{class:"vp-button",onClick:a[0]||(a[0]=a=>e.handleSettings())},k(e.$t("common.settings")),1),b("button",{class:"vp-button",onClick:a[1]||(a[1]=a=>e.mainStore.isShowQuickLaunch=!e.mainStore.isShowQuickLaunch)},k(e.$t("common.toolbox")),1),e.fileHandle?(f(),$(l,{key:0,onConfirm:a[2]||(a[2]=a=>e.handleCloseFile()),title:e.$t("msgs.confirm_close")},{reference:y((()=>[b("button",z,"ðŸ’» "+k(e.$t("actions.close"))+" JSON",1)])),_:1},8,["title"])):(f(),$(r,{key:1,options:e.historyMenuOptions},{default:y((()=>[b("button",{class:"vp-button primary",onClick:a[3]||(a[3]=a=>e.handleSelectFile())}," ðŸ’» "+k(e.$t("actions.open"))+" JSON ",1)])),_:1},8,["options"])),e.fileHandle?(f(),g("button",{key:2,class:"vp-button primary",onClick:a[4]||(a[4]=a=>e.handleSaveFile())}," ðŸ’¾ "+k(e.$t("actions.save")),1)):x("",!0),b("button",{class:"vp-button",onClick:a[5]||(a[5]=a=>e.handleExport())},k(e.$t("actions.save_as"))+" ...",1),h(l,{onConfirm:a[6]||(a[6]=a=>e.loadDemo()),title:e.$t("msgs.load_demo_this_will")},{reference:y((()=>[b("button",A,k(e.$t("common.demo")),1)])),_:1},8,["title"])])])),_:1}),b("div",K,[b("div",Q,[(f(!0),g(S,null,j(e.translateTreeRoot,((a,t)=>{var s;return f(),$(m,{key:t,item:a,index:t,title:null==(s=e.fileHandle)?void 0:s.name},null,8,["item","index","title"])})),128)),Z])])],32)),[[u,e.isLoading]])}]]);export{B as default};
