var e=Object.defineProperty,t=(t,i,o)=>((t,i,o)=>i in t?e(t,i,{enumerable:!0,configurable:!0,writable:!0,value:o}):t[i]=o)(t,"symbol"!=typeof i?i+"":i,o);import{s as i,d as o,o as a,p as s,L as n,b as l,n as d,g as h,T as r,_ as u,S as c,r as p,O as v,x as w,F as g,m,e as y,ad as x,K as f,I as R,t as b,M as z,c as M,al as E,a6 as L,J as T,i as S,k as D,j as B,w as I,h as k,aA as O}from"./index-D7imv_Md.js";const _=Object.freeze({TOP_LEFT:{xRatio:0,yRatio:0,widthRatio:.5,heightRatio:.5},TOP_RIGHT:{xRatio:.5,yRatio:0,widthRatio:.5,heightRatio:.5},LEFT:{xRatio:0,yRatio:0,widthRatio:.5,heightRatio:1},RIGHT:{xRatio:.5,yRatio:0,widthRatio:.5,heightRatio:1},BOTTOM_LEFT:{xRatio:0,yRatio:.5,widthRatio:.5,heightRatio:.5},BOTTOM_RIGHT:{xRatio:.5,yRatio:.5,widthRatio:.5,heightRatio:.5},MAXIMIZE:{xRatio:0,yRatio:0,widthRatio:1,heightRatio:1,maximize:!0}}),C=[_.LEFT,_.MAXIMIZE,_.RIGHT,_.TOP_LEFT,{xRatio:0,yRatio:0,widthRatio:1,heightRatio:.5},_.TOP_RIGHT,{xRatio:.1,yRatio:.1,widthRatio:.8,heightRatio:.8},{xRatio:.2,yRatio:.2,widthRatio:.6,heightRatio:.6},{xRatio:.3,yRatio:.3,widthRatio:.4,heightRatio:.4},_.BOTTOM_LEFT,{xRatio:0,yRatio:.5,widthRatio:1,heightRatio:.5},_.BOTTOM_RIGHT],H=({x:e,y:t})=>t<=0?e<=0?_.TOP_LEFT:e>=window.innerWidth-1?_.TOP_RIGHT:_.MAXIMIZE:e<=0?t>=window.innerHeight-1?_.BOTTOM_LEFT:_.LEFT:e>=window.innerWidth-1?t>=window.innerHeight-1?_.BOTTOM_RIGHT:_.RIGHT:void 0,P="draggable-window-resize";var W=(e=>(e.n="n",e.s="s",e.w="w",e.e="e",e.nw="nw",e.ne="ne",e.se="se",e.sw="sw",e))(W||{});const A=Object.values(W),X=e=>{let t=0,i=0;if("touchstart"==e.type||"touchmove"==e.type||"touchend"==e.type||"touchcancel"==e.type){const o=e.touches[0]||e.changedTouches[0];t=o.pageX,i=o.pageY}else"mousedown"!=e.type&&"mouseup"!=e.type&&"mousemove"!=e.type&&"mouseover"!=e.type&&"mouseout"!=e.type&&"mouseenter"!=e.type&&"mouseleave"!=e.type||(t=e.clientX,i=e.clientY);return{x:t,y:i}},Z=new Set;class Y{constructor(e){t(this,"docEl"),t(this,"deltaX"),t(this,"deltaY"),t(this,"options"),t(this,"handleResizeDebounced"),t(this,"prevRect"),t(this,"currentResizeDirection"),t(this,"allowMove"),t(this,"maximized");const{dragHandleEl:o,dragTargetEl:a,onMove:s,autoPosOnResize:n}=e;this.options=e,this.docEl=document.documentElement,this.deltaX=0,this.deltaY=0,this.allowMove=!0,this.maximized=e.maximized||!1,this.handleDragStart=this.handleDragStart.bind(this),this.handleDragMove=this.handleDragMove.bind(this),this.handleDragStop=this.handleDragStop.bind(this),this.currentResizeDirection=null,this.handleResizeDebounced=i((()=>{if(this.isHidden())return;const{left:e,top:t}=this.setInScreenPosition({x:a.offsetLeft,y:a.offsetTop});this.debugLog("handleResizeDebounced",{left:e,top:t}),s&&s({top:t,left:e})}),500),n&&(window.addEventListener("resize",this.handleResizeDebounced),this.handleResizeDebounced()),this.updateZIndex=this.updateZIndex.bind(this),this.handleMouseDown=this.handleMouseDown.bind(this),["mousedown","touchstart"].forEach((e=>{o.addEventListener(e,this.handleDragStart),a.addEventListener(e,this.handleMouseDown)})),this.handleResizeStart=this.handleResizeStart.bind(this),this.handleResizeMove=this.handleResizeMove.bind(this),this.handleResizeStop=this.handleResizeStop.bind(this),this.prevRect=a.getBoundingClientRect(),this.options.resizeable&&A.forEach((e=>{const t=((e,t)=>{const i=document.createElement("div");i.className=P,i.style.position="absolute",i.style.cursor=`${t}-resize`,i.setAttribute("data-direction",String(t)),i.style.userSelect="none";const o=()=>{i.style.width="6px",i.style.height="6px"};switch(t){case"n":i.style.height="6px",i.style.top="-4px",i.style.left="2px",i.style.right="2px";break;case"e":i.style.width="6px",i.style.top="2px",i.style.bottom="2px",i.style.right="-4px";break;case"s":i.style.height="6px",i.style.bottom="-4px",i.style.left="2px",i.style.right="2px";break;case"w":i.style.width="6px",i.style.top="2px",i.style.left="-4px",i.style.bottom="2px";break;case"nw":o(),i.style.top="-4px",i.style.left="-4px";break;case"ne":o(),i.style.right="-4px",i.style.top="-4px";break;case"sw":o(),i.style.left="-4px",i.style.bottom="-4px";break;case"se":o(),i.style.right="-4px",i.style.bottom="-4px"}return e.appendChild(i),i})(a,e);["mousedown","touchstart"].forEach((e=>{t.addEventListener(e,this.handleResizeStart)}))})),setTimeout((()=>{this.updateZIndex()})),Z.add(this),this.debugLog("initialized",this)}destroy(){const{dragTargetEl:e,dragHandleEl:t,autoPosOnResize:i,resizeable:o}=this.options;if(["mousedown","touchstart"].forEach((i=>{t.removeEventListener(i,this.handleDragStart),e.removeEventListener(i,this.handleMouseDown)})),i&&window.addEventListener("resize",this.handleResizeDebounced),o){const t=e.querySelector(P);t&&e.removeChild(t)}Z.delete(this),this.debugLog("destroyed")}handleDragStart(e){if(!this.allowMove||this.maximized)return;const{docEl:t}=this,{preventNode:i,dragTargetEl:o}=this.options;if(i&&i.contains(e.target))return!1;const a=X(e);return this.deltaX=a.x-o.getBoundingClientRect().left,this.deltaY=a.y-o.getBoundingClientRect().top,["mousemove","touchmove"].forEach((e=>{t.addEventListener(e,this.handleDragMove)})),["mouseup","touchend"].forEach((e=>{t.addEventListener(e,this.handleDragStop)})),o.classList.add("_dragging"),!1}handleDragMove(e){const{deltaX:t,deltaY:i}=this,{dragTargetEl:o,onMove:a,opacify:s}=this.options,n=X(e),l=n.x-t,d=n.y-i;let h,r;if(this.options.allowOut){const{scaleX:e,scaleY:t}=this.fixZoom();h=o.style.left=Math.round(l)*e+"px",r=o.style.top=Math.round(d)*t+"px"}else{const e=this.setInScreenPosition({x:l,y:d});h=e.left,r=e.top}a&&a({pointerX:n.x,pointerY:n.y,top:r,left:h}),s&&(o.style.opacity=String(s))}handleDragStop(e){const{docEl:t}=this,{dragTargetEl:i,opacify:o,onMove:a}=this.options,{x:s,y:n}=e;if(a){const e={moveStop:!0};e.attachLayout=H({x:s,y:n}),a(e)}["mousemove","touchmove"].forEach((e=>{t.removeEventListener(e,this.handleDragMove)})),["mouseup","touchend"].forEach((e=>{t.removeEventListener(e,this.handleDragStop)})),o&&(i.style.opacity="1"),i.classList.remove("_dragging")}handleResizeStart(e){const{docEl:t}=this,{dragTargetEl:i}=this.options,o=X(e);this.deltaX=o.x,this.deltaY=o.y,this.prevRect=i.getBoundingClientRect(),e.target&&(this.currentResizeDirection=e.target.getAttribute("data-direction")||null),["mousemove","touchmove"].forEach((e=>{t.addEventListener(e,this.handleResizeMove)})),["mouseup","touchend"].forEach((e=>{t.addEventListener(e,this.handleResizeStop)})),i.classList.add("_dragging")}handleResizeMove(e){const{deltaX:t,deltaY:i}=this,{dragTargetEl:o}=this.options,a=X(e),s=a.x-t,n=a.y-i,l=this.prevRect,d=()=>{const e=l.top+n;o.style.top=e+"px",o.style.height=l.height-n+"px"},h=()=>{o.style.width=l.width+s+"px"},r=()=>{o.style.height=l.height+n+"px"},u=()=>{l.left,o.style.left=l.left+s+"px",o.style.width=l.width-s+"px"};switch(this.currentResizeDirection){case"n":d();break;case"e":h();break;case"s":r();break;case"w":u();break;case"nw":d(),u();break;case"ne":d(),h();break;case"se":r(),h();break;case"sw":r(),u()}}handleResizeStop(e){const{docEl:t}=this;["mousemove","touchmove"].forEach((e=>{t.removeEventListener(e,this.handleResizeMove)})),["mouseup","touchend"].forEach((e=>{t.removeEventListener(e,this.handleResizeStop)}));const{dragTargetEl:i}=this.options;i.classList.remove("_dragging")}handleMouseDown(e){1!==e.button&&2!==e.button&&this.updateZIndex()}isHidden(){const{dragHandleEl:e}=this.options;return null===e.offsetParent}fixZoom(){const{dragTargetEl:e}=this.options,t=e.getBoundingClientRect();return{scaleX:t.width/e.offsetWidth,scaleY:t.height/e.offsetHeight}}setInScreenPosition({x:e,y:t}){const{docEl:i}=this,{dragTargetEl:o}=this.options,a=o.getBoundingClientRect(),s=i.clientWidth-a.width,n=i.clientHeight-a.height;return{left:o.style.left=Math.round(Math.min(s,Math.max(0,e)))+"px",top:o.style.top=Math.round(Math.min(n,Math.max(0,t)))+"px"}}debugLog(e,...t){this.options.isDebug&&console.log(`[draggableWindow] ${e}`,...t)}updateZIndex(e={}){const{preventOnActive:t=!1}=e;if(!t){const{onActive:e}=this.options;e&&e()}if(!this.allowMove&&!this.maximized)return void this.debugLog("[updateZIndex] return");const{dragTargetEl:i}=this.options;let o=-1,a=null;const s=Array.from(Z).map((e=>e.options.dragTargetEl)).filter(Boolean);s.forEach((e=>{const t=getComputedStyle(e)["z-index"],i=parseInt(t)||0;i>o&&(o=i,a=e)})),i.classList.contains("_visible")&&(i.classList.add("_active"),i!==a&&(i.style.zIndex=String(o),Array.from(s).forEach((e=>{e!==i&&(e.style.zIndex=parseInt(getComputedStyle(e)["z-index"])-1,e.classList.remove("_active"))}))))}}const F=u(o({__name:"LayoutPreview",props:{previewData:{}},setup:e=>(e,t)=>(a(),s(r,{name:"fade-scale"},{default:n((()=>[e.previewData?(a(),l("div",{key:0,class:"vp-demo-layout",style:d({top:100*e.previewData.yRatio+"%",left:100*e.previewData.xRatio+"%",width:100*e.previewData.widthRatio+"%",height:100*e.previewData.heightRatio+"%"})},null,4)):h("",!0)])),_:1}))}),[["__scopeId","data-v-bbf1ccec"]]),G=["onMouseover","onClick"],N=o({__name:"LayoutHelper",props:{visible:{type:Boolean,default:!1}},emits:["update:visible","setWindowLayout"],setup(e,{emit:t}){const i=t,o=c(e,"visible",i),s=p();return(e,t)=>(a(),l(g,null,[v(r,{name:"fade"},{default:n((()=>[w(o)?(a(),l("div",{key:0,onMouseleave:t[1]||(t[1]=e=>o.value=!1),class:"vp-layout-helper vp-panel"},[(a(!0),l(g,null,m(w(C),((e,n)=>(a(),l("div",{key:n,class:"layout-item",onMouseover:t=>(e=>{o.value?s.value=e:s.value=void 0})(e),onMouseleave:t[0]||(t[0]=e=>s.value=void 0),onClick:t=>(e=>{i("setWindowLayout",e),o.value=!1,setTimeout((()=>{s.value=void 0}))})(e)},[y("div",{style:d({top:100*e.yRatio+"%",left:100*e.xRatio+"%",width:100*e.widthRatio+"%",height:100*e.heightRatio+"%"}),class:"layout-inner"},null,4)],40,G)))),128))],32)):h("",!0)])),_:1}),v(F,{"preview-data":w(s)},null,8,["preview-data"])],64))}}),V=(e,t,i)=>{const o=i=>{i?e.value.classList.add(t):e.value.classList.remove(t)};f(i,(e=>{o(e)})),R((()=>{o(i.value)}))},j=o({name:"ViewPortWindow",components:{LayoutPreview:F,LayoutHelper:u(N,[["__scopeId","data-v-95d64bd1"]])},props:{visible:{type:Boolean,default:!0},showClose:{type:Boolean,default:!0},allowMaximum:{type:Boolean,default:!1},maximized:{type:Boolean,default:!1},allowMinimum:{type:Boolean,default:!1},minimized:{type:Boolean,default:!1},allowMove:{type:Boolean,default:!0},wid:{type:[String],default:null},initWinOptions:{type:Object,default:null},initCenter:{type:Boolean,default:!0},transitionName:{type:String,default:"fade-scale"}},emits:["update:visible","resize","onActive","onClose","update:minimized","update:maximized"],setup(e,{emit:t}){const{allowMaximum:o,allowMove:a}=b(e),s="vp_window_"+e.wid,n=c(e,"visible",t),l=p(),d=p(),h=p(),r=z(null),u=c(e,"maximized",t,{passive:!0}),v=c(e,"minimized",t,{passive:!0}),w=p(!1),g=e=>{e?w.value=e:setTimeout((()=>{w.value=e}),300)};V(l,"_visible",n),V(l,"_maximized",u),V(l,"_transition",w);const m=M((()=>a.value&&!u.value));V(l,"_allow_move",m);let y={top:"10px",left:"10px",width:"300px",height:"auto",maximized:!1};const S=E({...y});L(S,(()=>{if(u.value){const e=JSON.parse(localStorage.getItem(s)||"null");e&&localStorage.setItem(s,JSON.stringify({...e,maximized:u.value}))}else e.wid&&localStorage.setItem(s,JSON.stringify({...S}))}),{deep:Boolean(e.wid),debounce:500}),f(a,(e=>{r.value.allowMove=e,e&&r.value.updateZIndex()})),f(u,(e=>{r.value.allowMove=!e,r.value.maximized=e,S.maximized=e})),f(n,(e=>{e&&(B.value||I(),r.value.updateZIndex())})),R((()=>{r.value=new Y({dragHandleEl:d.value,dragTargetEl:l.value,allowOut:!0,preventNode:h.value,onMove:O,onActive(){t("onActive")},autoPosOnResize:!0,isDebug:!1,resizeable:!0,maximized:S.maximized||!1}),u.value=S.maximized||!1,r.value.allowMove=a.value,new ResizeObserver((()=>{_()})).observe(l.value),I()}));const D=(e,t)=>{l.value.style[e]=S[e]=t},B=p(!1),I=()=>{if(!n.value)return;let t,i,o={...y};e.initWinOptions&&(o={...o,...e.initWinOptions}),e.wid?(i=JSON.parse(localStorage.getItem(s)||"null"),t=i||o):t=o,D("left",t.left),D("top",t.top),D("width",t.width),D("height",t.height),B.value=!0,setTimeout((()=>{if(e.initCenter&&!i){const e=l.value.getBoundingClientRect(),t=Math.round(window.innerWidth/2-e.width/2),i=Math.round(window.innerHeight/2-e.height/2);S.left=l.value.style.left=t+"px",S.top=l.value.style.top=i+"px"}else r.value.handleResizeDebounced()}))},k=i((e=>{X.value=H(e)}),150,!0),O=async e=>{if(e.moveStop)return setTimeout((()=>{X.value=void 0}),151),await((e=400)=>new Promise((t=>{setTimeout((()=>{const e=l.value.getBoundingClientRect();let i=!1;e.y<0&&(D("top","0px"),i=!0),e.x<=-e.width&&(D("left","0px"),i=!0),i||(e.y>window.innerHeight&&D("top",window.innerHeight-e.height+"px"),e.x>window.innerWidth&&D("left",window.innerWidth-e.width+"px")),t()}),e)})))(0),void(e.attachLayout&&W(e.attachLayout));const{top:t,left:i,pointerX:o,pointerY:a}=e;k({x:o,y:a}),S.top=t,S.left=i},_=i((()=>{if(!n.value||!l.value)return;const e=getComputedStyle(l.value);S.width=e.width,S.height=e.height,t("resize",S)}),50,!0);T((()=>{r.value&&r.value.destroy()}));const C=()=>{o.value&&(g(!0),u.value=!u.value,g(!1))},P=p(!1),W=e=>{const{xRatio:t,yRatio:i,widthRatio:o,heightRatio:a,maximize:s}=e;if(s)return void C();const{innerWidth:n,innerHeight:l}=window,d=Math.ceil(n*t),h=Math.ceil(l*i),r=Math.ceil(n*o),c=Math.ceil(l*a);u.value&&(u.value=!1),g(!0),setTimeout((()=>{D("left",d+"px"),D("top",h+"px"),D("width",r+"px"),D("height",c+"px"),g(!1)}))},A=p();((e,t={})=>{const{timeout:i=0,onEnter:o,onOut:a}=t;let s;x(e,"mouseover",(()=>{clearTimeout(s),s=setTimeout((()=>{o&&o()}),i)})),x(e,"mouseleave",(()=>{clearTimeout(s),a&&a()})),x(e,"click",(()=>{clearTimeout(s)}))})(A,{timeout:800,onEnter:()=>{P.value=!0}});const X=p(void 0);return{isInit:B,mVisible:n,rootRef:l,titleBarRef:d,titleBarButtonsRef:h,handleClose:()=>{n.value=!1,t("onClose")},setActive:()=>{r.value.updateZIndex({preventOnActive:!0})},isMaximized:u,isMinimized:v,toggleMaximized:C,isTransition:w,isShowLayoutHelper:P,setWindowLayout:W,setPos:D,mButtonRef:A,layoutPreviewData:X}}}),$=["id"],J={class:"vp-window-content"},q={class:"vp-window-title-bar-text text-overflow"},K=[y("svg",{width:"20",height:"20",xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 20 20"},[y("g",{fill:"none"},[y("rect",{x:"3",y:"9.25",width:"14",height:"1.5",rx:".75",fill:"currentColor"})])],-1)],U={key:0,width:"20",height:"20",xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 16 16"},Q=[y("g",{fill:"none"},[y("path",{d:"M13.854 2.854a.5.5 0 0 0-.708-.708L10 5.293V3.5a.5.5 0 0 0-1 0v2.9a.6.6 0 0 0 .6.6h2.9a.5.5 0 0 0 0-1h-1.793l3.147-3.146zM6.5 13a.5.5 0 0 1-.5-.5v-1.793l-3.146 3.147a.5.5 0 0 1-.708-.708L5.293 10H3.5a.5.5 0 0 1 0-1h2.9a.6.6 0 0 1 .6.6v2.9a.5.5 0 0 1-.5.5z",fill:"currentColor"})],-1)],ee={key:1,width:"16",height:"16",xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 16 16"},te=[y("g",{fill:"none"},[y("path",{d:"M8.5 2a.5.5 0 0 0 0 1h3.793L3 12.293V8.5a.5.5 0 0 0-1 0v4.9a.6.6 0 0 0 .6.6h4.9a.5.5 0 0 0 0-1H3.707L13 3.707V7.5a.5.5 0 0 0 1 0V2.6a.6.6 0 0 0-.6-.6H8.5z",fill:"currentColor"})],-1)],ie=[y("svg",{width:"20",height:"20",xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 20 20"},[y("g",{fill:"none"},[y("path",{d:"M4.089 4.216l.057-.07a.5.5 0 0 1 .638-.057l.07.057L10 9.293l5.146-5.147a.5.5 0 0 1 .638-.057l.07.057a.5.5 0 0 1 .057.638l-.057.07L10.707 10l5.147 5.146a.5.5 0 0 1 .057.638l-.057.07a.5.5 0 0 1-.638.057l-.07-.057L10 10.707l-5.146 5.147a.5.5 0 0 1-.638.057l-.07-.057a.5.5 0 0 1-.057-.638l.057-.07L9.293 10L4.146 4.854a.5.5 0 0 1-.057-.638l.057-.07l-.057.07z",fill:"currentColor"})])],-1)],oe={class:"vp-window-body _bg scrollbar-mini"};const ae=u(j,[["render",function(e,t,i,o,d,u){const c=S("LayoutPreview"),p=S("LayoutHelper");return a(),s(r,{name:e.transitionName},{default:n((()=>[D(y("div",{class:"vp-window",ref:"rootRef",id:e.wid},[v(c,{"preview-data":e.layoutPreviewData},null,8,["preview-data"]),v(p,{visible:e.isShowLayoutHelper,"onUpdate:visible":t[0]||(t[0]=t=>e.isShowLayoutHelper=t),onSetWindowLayout:e.setWindowLayout},null,8,["visible","onSetWindowLayout"]),y("div",J,[y("div",{ref:"titleBarRef",class:"vp-window-title-bar",onDblclick:t[5]||(t[5]=(...t)=>e.toggleMaximized&&e.toggleMaximized(...t))},[y("div",q,[B(e.$slots,"titleBarLeft")]),y("div",{onDblclick:t[4]||(t[4]=I((()=>{}),["stop"])),ref:"titleBarButtonsRef",class:"vp-window-controls"},[B(e.$slots,"titleBarRightControls"),B(e.$slots,"titleBarRight",{},(()=>[e.allowMinimum?(a(),l("button",{key:0,onClick:t[1]||(t[1]=t=>e.isMinimized=!0),class:"is-minimize"},K)):h("",!0),e.allowMaximum?(a(),l("button",{key:1,ref:"mButtonRef",onClick:t[2]||(t[2]=(...t)=>e.toggleMaximized&&e.toggleMaximized(...t)),class:k([e.isMaximized?"is-restore":"is-maximize"])},[e.isMaximized?(a(),l("svg",U,Q)):(a(),l("svg",ee,te))],2)):h("",!0),e.showClose?(a(),l("button",{key:2,title:"Close",onClick:t[3]||(t[3]=(...t)=>e.handleClose&&e.handleClose(...t)),class:"is-close"},ie)):h("",!0)]))],544)],544),y("div",oe,[B(e.$slots,"default")])])],8,$),[[O,e.isInit&&e.mVisible]])])),_:3},8,["name"])}]]);export{ae as V};
