import{d as e,t as o,r as t,_ as n,o as s,b as l,k as a,aA as i,e as r,U as c,D as d,u,M as p,K as m,I as w,q as h,aB as f,J as y,c as v,aC as _,ak as g,H as b,aD as S,i as C,O as x,L as k,T as L,g as D,w as T,aE as X,Y as R,P as N,f as E,p as j,F as O,m as F,ax as I,aF as $}from"./index-D7imv_Md.js";/* empty css                   *//* empty css                    *//* empty css                    */import{b as M}from"./index-BR_HEkHY.js";import{D as A,u as J}from"./use-file-drop-D66jDkLh.js";import{a as V}from"./use-beforeunload-walRddPp.js";import{C as B}from"./CommonNavbar-BfH5DtYm.js";import{R as z}from"./RectSwitch-DEmfWnCV.js";import{T as P}from"./TabLayout-CsB4Yfbx.js";import"./use-model-wrapper-B0P8Zqss.js";const H=e({name:"FileChooser",props:{showInput:{type:Boolean,default:!1},multiple:{type:Boolean,default:!1},sizeLimit:{type:Number,default:2},accept:{type:String,default:null}},emits:["selected"],setup(e,{emit:n}){const{multiple:s,sizeLimit:l}=o(e),a=t();return{handleInputFileChange:async e=>{const o=a.value;if(!o)return;const t=Array.from(o.files||[]);o.value="",n("selected",s.value?t:t[0])},chooseFile:()=>{a.value.click()},fileInputRef:a}}}),K={class:"file-chooser"},U=["accept","multiple"];const W=n(H,[["render",function(e,o,t,n,c,d){return s(),l("div",K,[a(r("input",{type:"file",ref:"fileInputRef",onChange:o[0]||(o[0]=(...o)=>e.handleInputFileChange&&e.handleInputFileChange(...o)),accept:e.accept,multiple:e.multiple},null,40,U),[[i,e.showInput]])])}]]),Y=e=>new Promise(((o,t)=>{if(document.getElementById(e))o();else{const n=document.createElement("script");n.src=e,n.id=e,n.onload=function(){this.onerror=this.onload=null,o()},n.onerror=function(e){this.onerror=this.onload=null,t(e)},document.body.appendChild(n)}}));window.demo_aoa_to_sheet=[["Name","Value","Num","Time","âœ¨Tips"],["test001","line1\nline2",123,new Date,"You can set window.json_to_sheet = [] to generate table!"],["test001","line1\n\nline3",-1,new Date,"window.json_to_sheet"]],window.demo_json_to_sheet=[{region:"DE",product_name:"Test1",code:"123456",url:"http://localhost:8080",tips:"âœ¨ You can set window.demo_json_to_sheet = [] to generate table!"},{region:"FR",product_name:"Test2",code:"7890",url:"https://example.com",tips:"window.demo_json_to_sheet"}];const Z=e({name:"ExcelCopyTool",components:{TabLayout:P,RectSwitch:z,DropdownMenu:c,CommonNavbar:B,FileChooser:W,DropZone:A},setup(){const{t:e}=d(),o=u(),n=t(),s=t(),l=t(!1),a=p(null),i=p(),r=t([]),c=t(0);m(c,(()=>{k()}));const C=()=>{if(!l.value){const e="XLSX Not Ready!";throw window.$message.error(e),new Error(e)}},x=e=>(r.value=e.SheetNames,e.Sheets[r.value[c.value]]),k=()=>{const e=i.value;if(!e)return void(s.value.innerHTML="");console.log("[renderWorkbook]",e);const o=window.XLSX.utils.sheet_to_html(x(e));s.value.innerHTML=o},L=async e=>{if(a.value=null,C(),!/\.xlsx$/g.test(e.name))return void window.$message.error("Only supports reading xlsx format!");const o=new FileReader;i.value=null,o.onload=function(o){a.value=e;const t=o.target.result;c.value=0,i.value=window.XLSX.read(t,{type:"binary"}),k()},o.readAsBinaryString(e)},D=t(!0);w((async()=>{await(async()=>{if(window.XLSX)l.value=!0;else{try{await Y("./lib/xlsx.mini.js")}catch(e){window.$message.error(e.message),console.error(e)}window.$message.success("XLSX Ready!"),console.log("XLSX ready",window.XLSX),l.value=!0}})()}));const T=h("excel_copy_tool_copy_mode",f.HTML,localStorage,{listenToStorageChanges:!1}),X=({currentOnly:e=!1}={})=>{const o=e=>{const o=T.value;return o===f.DISABLED||o===f.TEXT?e:e.map((e=>{for(const t in e)"string"==typeof e[t]&&(e[t]=_(e[t],o));return e}))};if(!i.value){const e="Please open Excel file first!";throw window.$message.error(e),new Error(e)}if(e){const e=window.XLSX.utils.sheet_to_json(x(i.value));return o(e)}const t=i.value,n={};return t.SheetNames.forEach((function(e){const s=window.XLSX.utils.sheet_to_row_object_array(t.Sheets[e]);s.length>0&&(n[e]=o(s))})),n},R=async(e={})=>{var o;const t=X(e);let n=null==(o=a.value)?void 0:o.name;n&&(n=n.substring(0,n.lastIndexOf("."))),g(await b(n,"excel_sheet_export"),JSON.stringify(t,null,2),".json")};V((async()=>{await R()}));const N=[{label:"ðŸ§© Current Sheet",children:[{label:"ðŸ“¤ Export JSON",props:{onClick:async()=>{await R({currentOnly:!0})}}},{label:"ðŸ“‹ Copy JSON",props:{onClick:async()=>{const e=X({currentOnly:!0});await M(JSON.stringify(e,null,2)),window.$message.success("Sheet JSON Copied!")}}},{label:"ðŸ’» Print to Console",props:{onClick:async()=>{const e=X({currentOnly:!0});console.log(e),window.$message.success("Print to Console!")}}}]},{label:"ðŸ“— All Sheets",children:[{label:"ðŸ“¤ Export All JSON",props:{onClick:async()=>{await R()}}},{label:"ðŸ“‹ Copy All JSON",props:{onClick:async()=>{const e=X();await M(JSON.stringify(e,null,2)),window.$message.success("Sheet JSON Copied!")}}},{label:"ðŸ’» Print All to Console",props:{onClick:async()=>{const e=X();console.log(e),window.$message.success("Print to Console!")}}}]}],E=()=>{a.value=null,i.value=null,r.value=[],c.value=0,s.value.innerHTML=""};return y((()=>{E()})),{sheetNames:r,sheetNameIndex:c,handleImport:L,importFileChooserRef:n,loadDemo:()=>{C();const e=window.XLSX.utils.aoa_to_sheet(window.demo_aoa_to_sheet),o=window.XLSX.utils.json_to_sheet(window.demo_json_to_sheet),t=window.XLSX.utils.book_new();window.XLSX.utils.book_append_sheet(t,e,"aoa_to_sheet"),window.XLSX.utils.book_append_sheet(t,o,"json_to_sheet"),c.value=0,i.value=t,k()},tableWrapperElRef:s,handleClick:o=>{let t=o.target;if(!(e=>"td"===e.tagName.toLowerCase())(t)||!T.value||T.value===f.DISABLED)return;if(!t.innerText)return;let n=t.innerText;console.log(T.value);let s="";n=o.ctrlKey&&o.altKey?_(n,s=f.JSON):o.ctrlKey?_(n,s=f.TEXT):o.altKey?_(n,s=f.HTML):_(n,s=T.value),M(n),window.$message.success(s+" "+e("msgs.copy_success"));const l=document.createRange();l.selectNode(t);const a=window.getSelection();a&&(a.removeAllRanges(),a.addRange(l))},copyMode:T,modTextConvertOptions:v((()=>[{label:"Disabled",value:f.DISABLED},...S])),dropdownMenuOptions:N,textConvertMultipleLine:_,...J({cbFiles:e=>{e.length&&L(e[0])}}),isTrimEmptyLines:D,mainStore:o,isReady:l,workbookRef:i,fileRef:a,handleCloseFile:E}}}),q={class:"flex-row-center-gap"},G={class:"flex-row-center-gap"},Q={class:"vp-button"},ee=r("i",{class:"fa fa-download","aria-hidden":"true"},null,-1),oe=["disabled"],te=["disabled"],ne={key:0,class:"sheet-name-card vp-panel"};const se=n(Z,[["render",function(e,o,t,n,c,d){const u=C("DropZone"),p=I,m=C("RectSwitch"),w=C("DropdownMenu"),h=C("CommonNavbar"),f=$,y=X,v=C("FileChooser"),_=R;return s(),l("div",{class:"excel-copy-tool",onDragover:o[8]||(o[8]=T(((...o)=>e.fileDragover&&e.fileDragover(...o)),["prevent","stop"])),onDragleave:o[9]||(o[9]=T((o=>e.showDropzone=!1),["prevent","stop"])),onDrop:o[10]||(o[10]=T(((...o)=>e.fileDrop&&e.fileDrop(...o)),["prevent","stop"]))},[x(L,{name:"mc-fade"},{default:k((()=>[a(x(u,{"position-fixed":"",text:"Drop Excel file here"},null,512),[[i,e.showDropzone]])])),_:1}),a((s(),l("div",null,[x(h,null,{extra:k((()=>[r("div",q,[r("div",G,[x(p,{size:"small",modelValue:e.isTrimEmptyLines,"onUpdate:modelValue":o[0]||(o[0]=o=>e.isTrimEmptyLines=o)},{default:k((()=>[N(E(e.$t("msgs.trim_empty_lines")),1)])),_:1},8,["modelValue"]),r("a",{onClick:o[1]||(o[1]=o=>e.mainStore.isShowTextTransformer=!e.mainStore.isShowTextTransformer)},E(e.$t("common.text_transformer"))+": ",1),x(m,{size:"small",modelValue:e.copyMode,"onUpdate:modelValue":o[2]||(o[2]=o=>e.copyMode=o),options:e.modTextConvertOptions},null,8,["modelValue","options"])]),e.workbookRef?(s(),j(w,{key:0,options:e.dropdownMenuOptions,disabled:!e.isReady},{default:k((()=>[r("button",Q,[ee,N(" "+E(e.$t("actions.export")),1)])])),_:1},8,["options","disabled"])):D("",!0),e.fileRef?(s(),l("button",{key:2,class:"vp-button primary",onClick:o[4]||(o[4]=(...o)=>e.handleCloseFile&&e.handleCloseFile(...o))},E(e.$t("actions.close")),1)):(s(),l("button",{key:1,disabled:!e.isReady,onClick:o[3]||(o[3]=o=>e.importFileChooserRef.chooseFile()),class:"vp-button primary"},E(e.$t("actions.open")+" Excel"),9,oe)),e.fileRef?D("",!0):(s(),l("button",{key:3,onClick:o[5]||(o[5]=(...o)=>e.loadDemo&&e.loadDemo(...o)),class:"vp-button",disabled:!e.isReady},E(e.$t("common.demo")),9,te))])])),_:1}),e.isReady&&e.sheetNames.length?(s(),l("div",ne,[x(y,{modelValue:e.sheetNameIndex,"onUpdate:modelValue":o[6]||(o[6]=o=>e.sheetNameIndex=o),type:"card"},{default:k((()=>[(s(!0),l(O,null,F(e.sheetNames,((e,o)=>(s(),j(f,{key:o,label:e,name:o},null,8,["label","name"])))),128))])),_:1},8,["modelValue"])])):D("",!0)])),[[_,!e.isReady]]),r("div",{ref:"tableWrapperElRef",class:"excel-table-container vp-panel",onClick:o[7]||(o[7]=(...o)=>e.handleClick&&e.handleClick(...o))},null,512),x(v,{ref:"importFileChooserRef",accept:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",onSelected:e.handleImport},null,8,["onSelected"])],32)}]]);export{se as default};
